<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r2308 - in trunk/rpms: asterisk asterisk-sounds fftw plone	python-imaging rhythmbox rpmlint xmms-acme zope
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2308%20-%20in%20trunk/rpms%3A%20asterisk%20asterisk-sounds%20fftw%20plone%0A%09python-imaging%20rhythmbox%20rpmlint%20xmms-acme%20zope&In-Reply-To=%3C20041025114725.896D818137%40web22.us.megagiga.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001113.html">
   <LINK REL="Next"  HREF="001115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r2308 - in trunk/rpms: asterisk asterisk-sounds fftw plone	python-imaging rhythmbox rpmlint xmms-acme zope</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2308%20-%20in%20trunk/rpms%3A%20asterisk%20asterisk-sounds%20fftw%20plone%0A%09python-imaging%20rhythmbox%20rpmlint%20xmms-acme%20zope&In-Reply-To=%3C20041025114725.896D818137%40web22.us.megagiga.com%3E"
       TITLE="[SVN] r2308 - in trunk/rpms: asterisk asterisk-sounds fftw plone	python-imaging rhythmbox rpmlint xmms-acme zope">svn-commits at rpmforge.net
       </A><BR>
    <I>Mon Oct 25 13:47:25 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="001113.html">[SVN] r2307 - trunk/rpms/sudosh
</A></li>
        <LI>Next message: <A HREF="001115.html">[SVN] r2309 - in trunk/rpms: libtheora xmame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1114">[ date ]</a>
              <a href="thread.html#1114">[ thread ]</a>
              <a href="subject.html#1114">[ subject ]</a>
              <a href="author.html#1114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dude
Date: 2004-10-25 13:47:23 +0200 (Mon, 25 Oct 2004)
New Revision: 2308

Added:
   trunk/rpms/asterisk/asterisk-1.0-RC2-cdr.patch
   trunk/rpms/python-imaging/python-imaging-1.1.4-setup.patch
Removed:
   trunk/rpms/asterisk/asterisk-1.0-RC1-cdr.patch
Modified:
   trunk/rpms/asterisk-sounds/asterisk-sounds.spec
   trunk/rpms/asterisk/asterisk.spec
   trunk/rpms/fftw/fftw.spec
   trunk/rpms/plone/plone.spec
   trunk/rpms/rhythmbox/rhythmbox.spec
   trunk/rpms/rpmlint/config.fedora
   trunk/rpms/rpmlint/rpmlint.spec
   trunk/rpms/xmms-acme/xmms-acme.spec
   trunk/rpms/zope/zope.spec
Log:
Minor and normal updates.


Deleted: trunk/rpms/asterisk/asterisk-1.0-RC1-cdr.patch
===================================================================
--- trunk/rpms/asterisk/asterisk-1.0-RC1-cdr.patch	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/asterisk/asterisk-1.0-RC1-cdr.patch	2004-10-25 11:47:23 UTC (rev 2308)
@@ -1,63 +0,0 @@
---- cdr/cdr_pgsql.c.orig	2004-01-22 18:03:11.000000000 +0100
-+++ cdr/cdr_pgsql.c	2004-07-29 13:27:39.124746432 +0200
-@@ -148,7 +148,10 @@
- 
- static int my_unload_module(void)
- { 
--	PQfinish(conn);
-+        if (conn)
-+                PQfinish(conn);
-+        conn = NULL;
-+
- 	connected = 0;
- 	if (pghostname &amp;&amp; hostname_alloc) {
- 		free(pghostname);
-@@ -201,6 +204,7 @@
- 	var = ast_variable_browse(cfg, &quot;global&quot;);
- 	if (!var) {
- 		/* nothing configured */
-+		ast_destroy(cfg);
- 		return 0;
- 	}
- 
-@@ -212,6 +216,7 @@
- 			strcpy(pghostname,tmp);
- 		} else {
- 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
-+			ast_destroy(cfg);
- 			return -1;
- 		}
- 	} else {
-@@ -227,6 +232,7 @@
- 			strcpy(pgdbname,tmp);
- 		} else {
- 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
-+			ast_destroy(cfg);
- 			return -1;
- 		}
- 	} else {
-@@ -242,6 +248,7 @@
- 			strcpy(pgdbuser,tmp);
- 		} else {
- 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
-+			ast_destroy(cfg);
- 			return -1;
- 		}
- 	} else {
-@@ -257,6 +264,7 @@
- 			strcpy(pgpassword,tmp);
- 		} else {
- 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
-+			ast_destroy(cfg);
- 			return -1;
- 		}
- 	} else {
-@@ -272,6 +280,7 @@
- 			strcpy(pgdbport,tmp);
- 		} else {
- 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
-+			ast_destroy(cfg);
- 			return -1;
- 		}
- 	} else {
-

Added: trunk/rpms/asterisk/asterisk-1.0-RC2-cdr.patch
===================================================================
--- trunk/rpms/asterisk/asterisk-1.0-RC2-cdr.patch	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/asterisk/asterisk-1.0-RC2-cdr.patch	2004-10-25 11:47:23 UTC (rev 2308)
@@ -0,0 +1,390 @@
+diff -Naupr asterisk-1.0-RC2.orig/cdr/cdr_pgsql.c asterisk-1.0-RC2/cdr/cdr_pgsql.c
+--- asterisk-1.0-RC2.orig/cdr/cdr_pgsql.c	2004-07-28 20:42:35.000000000 +0200
++++ asterisk-1.0-RC2/cdr/cdr_pgsql.c	2004-08-26 12:49:09.858528016 +0200
+@@ -197,6 +197,7 @@ static int my_load_module(void)
+ 	var = ast_variable_browse(cfg, &quot;global&quot;);
+ 	if (!var) {
+ 		/* nothing configured */
++		ast_destroy(cfg);
+ 		return 0;
+ 	}
+ 
+@@ -209,6 +210,7 @@ static int my_load_module(void)
+ 			strncpy(pghostname, tmp, strlen(tmp));
+ 		} else {
+ 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			ast_destroy(cfg);
+ 			return -1;
+ 		}
+ 	} else {
+@@ -225,6 +227,7 @@ static int my_load_module(void)
+ 			strncpy(pgdbname, tmp, strlen(tmp));
+ 		} else {
+ 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			ast_destroy(cfg);
+ 			return -1;
+ 		}
+ 	} else {
+@@ -241,6 +244,7 @@ static int my_load_module(void)
+ 			strncpy(pgdbuser, tmp, strlen(tmp));
+ 		} else {
+ 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			ast_destroy(cfg);
+ 			return -1;
+ 		}
+ 	} else {
+@@ -257,6 +261,7 @@ static int my_load_module(void)
+ 			strncpy(pgpassword, tmp, strlen(tmp));
+ 		} else {
+ 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			ast_destroy(cfg);
+ 			return -1;
+ 		}
+ 	} else {
+@@ -273,6 +278,7 @@ static int my_load_module(void)
+ 			strncpy(pgdbport, tmp, strlen(tmp));
+ 		} else {
+ 			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			ast_destroy(cfg);
+ 			return -1;
+ 		}
+ 	} else {
+diff -Naupr asterisk-1.0-RC2.orig/cdr/cdr_pgsql.c.orig asterisk-1.0-RC2/cdr/cdr_pgsql.c.orig
+--- asterisk-1.0-RC2.orig/cdr/cdr_pgsql.c.orig	1970-01-01 01:00:00.000000000 +0100
++++ asterisk-1.0-RC2/cdr/cdr_pgsql.c.orig	2004-07-28 20:42:35.000000000 +0200
+@@ -0,0 +1,335 @@
++/*
++ * Asterisk -- A telephony toolkit for Linux.
++ *
++ * PostgreSQL CDR logger 
++ *
++ * Matthew D. Hardeman &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">mhardemn at papersoft.com</A>&gt; 
++ * Adapted from the MySQL CDR logger originally by James Sharp 
++ *
++ * Modified September 2003
++ * Matthew D. Hardeman &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">mhardemn at papersoft.com</A>&gt;
++ *
++ * This program is free software, distributed under the terms of
++ * the GNU General Public License.
++ *
++ */
++
++#include &lt;sys/types.h&gt;
++#include &lt;asterisk/config.h&gt;
++#include &lt;asterisk/options.h&gt;
++#include &lt;asterisk/channel.h&gt;
++#include &lt;asterisk/cdr.h&gt;
++#include &lt;asterisk/module.h&gt;
++#include &lt;asterisk/logger.h&gt;
++#include &quot;../asterisk.h&quot;
++
++#include &lt;stdio.h&gt;
++#include &lt;string.h&gt;
++
++#include &lt;stdlib.h&gt;
++#include &lt;unistd.h&gt;
++#include &lt;time.h&gt;
++
++#include &lt;libpq-fe.h&gt;
++
++#define DATE_FORMAT &quot;%Y-%m-%d %T&quot;
++
++static char *desc = &quot;PostgreSQL CDR Backend&quot;;
++static char *name = &quot;pgsql&quot;;
++static char *config = &quot;cdr_pgsql.conf&quot;;
++static char *pghostname = NULL, *pgdbname = NULL, *pgdbuser = NULL, *pgpassword = NULL, *pgdbsock = NULL, *pgdbport = NULL;
++static int hostname_alloc = 0, dbname_alloc = 0, dbuser_alloc = 0, password_alloc = 0, dbsock_alloc = 0, dbport_alloc = 0;
++static int connected = 0;
++
++AST_MUTEX_DEFINE_STATIC(pgsql_lock);
++
++PGconn		*conn;
++PGresult	*result;
++
++static int pgsql_log(struct ast_cdr *cdr)
++{
++	struct tm tm;
++	char sqlcmd[2048] = &quot;&quot;, timestr[128];
++	char *pgerror;
++
++	ast_mutex_lock(&amp;pgsql_lock);
++
++	localtime_r(&amp;cdr-&gt;start.tv_sec,&amp;tm);
++	strftime(timestr, sizeof(timestr), DATE_FORMAT, &amp;tm);
++
++	if ((!connected) &amp;&amp; pghostname &amp;&amp; pgdbuser &amp;&amp; pgpassword &amp;&amp; pgdbname) {
++		conn = PQsetdbLogin(pghostname, pgdbport, NULL, NULL, pgdbname, pgdbuser, pgpassword);
++		if (PQstatus(conn) != CONNECTION_BAD) {
++			connected = 1;
++		} else {
++			pgerror = PQerrorMessage(conn);
++			ast_log(LOG_ERROR, &quot;cdr_pgsql: Unable to connect to database server %s.  Calls will not be logged!\n&quot;, pghostname);
++                        ast_log(LOG_ERROR, &quot;cdr_pgsql: Reason: %s\n&quot;, pgerror);
++		}
++	}
++
++	if (connected) {
++		char *clid=NULL, *dcontext=NULL, *channel=NULL, *dstchannel=NULL, *lastapp=NULL, *lastdata=NULL;
++		char *uniqueid=NULL, *userfield=NULL;
++
++		/* Maximum space needed would be if all characters needed to be escaped, plus a trailing NULL */
++		if ((clid = alloca(strlen(cdr-&gt;clid) * 2 + 1)) != NULL)
++			PQescapeString(clid, cdr-&gt;clid, strlen(cdr-&gt;clid));
++		if ((dcontext = alloca(strlen(cdr-&gt;dcontext) * 2 + 1)) != NULL)
++			PQescapeString(dcontext, cdr-&gt;dcontext, strlen(cdr-&gt;dcontext));
++		if ((channel = alloca(strlen(cdr-&gt;channel) * 2 + 1)) != NULL)
++			PQescapeString(channel, cdr-&gt;channel, strlen(cdr-&gt;channel));
++		if ((dstchannel = alloca(strlen(cdr-&gt;dstchannel) * 2 + 1)) != NULL)
++			PQescapeString(dstchannel, cdr-&gt;dstchannel, strlen(cdr-&gt;dstchannel));
++		if ((lastapp = alloca(strlen(cdr-&gt;lastapp) * 2 + 1)) != NULL)
++			PQescapeString(lastapp, cdr-&gt;lastapp, strlen(cdr-&gt;lastapp));
++		if ((lastdata = alloca(strlen(cdr-&gt;lastdata) * 2 + 1)) != NULL)
++			PQescapeString(lastdata, cdr-&gt;lastdata, strlen(cdr-&gt;lastdata));
++		if ((uniqueid = alloca(strlen(cdr-&gt;uniqueid) * 2 + 1)) != NULL)
++			PQescapeString(uniqueid, cdr-&gt;uniqueid, strlen(cdr-&gt;uniqueid));
++		if ((userfield = alloca(strlen(cdr-&gt;userfield) * 2 + 1)) != NULL)
++			PQescapeString(userfield, cdr-&gt;userfield, strlen(cdr-&gt;userfield));
++
++		/* Check for all alloca failures above at once */
++		if ((!clid) || (!dcontext) || (!channel) || (!dstchannel) || (!lastapp) || (!lastdata) || (!uniqueid) || (!userfield)) {
++			ast_log(LOG_ERROR, &quot;cdr_pgsql:  Out of memory error (insert fails)\n&quot;);
++			ast_mutex_unlock(&amp;pgsql_lock);
++			return -1;
++		}
++
++		ast_log(LOG_DEBUG,&quot;cdr_pgsql: inserting a CDR record.\n&quot;);
++
++		snprintf(sqlcmd,sizeof(sqlcmd),&quot;INSERT INTO cdr (calldate,clid,src,dst,dcontext,channel,dstchannel,lastapp,lastdata,duration,billsec,disposition,amaflags,accountcode,uniqueid,userfield) VALUES ('%s','%s','%s','%s','%s', '%s','%s','%s','%s',%i,%i,'%s',%i,'%s','%s','%s')&quot;,timestr,clid,cdr-&gt;src, cdr-&gt;dst, dcontext,channel, dstchannel, lastapp, lastdata,cdr-&gt;duration,cdr-&gt;billsec,ast_cdr_disp2str(cdr-&gt;disposition),cdr-&gt;amaflags, cdr-&gt;accountcode, uniqueid, userfield);
++		ast_log(LOG_DEBUG,&quot;cdr_pgsql: SQL command executed:  %s\n&quot;,sqlcmd);
++	
++		/* Test to be sure we're still connected... */
++		/* If we're connected, and connection is working, good. */
++		/* Otherwise, attempt reconnect.  If it fails... sorry... */
++		if (PQstatus(conn) == CONNECTION_OK) {
++			connected = 1;
++		} else {
++			ast_log(LOG_ERROR, &quot;cdr_pgsql: Connection was lost... attempting to reconnect.\n&quot;);
++			PQreset(conn);
++			if (PQstatus(conn) == CONNECTION_OK) {
++				ast_log(LOG_ERROR, &quot;cdr_pgsql: Connection reestablished.\n&quot;);
++				connected = 1;
++			} else {
++				pgerror = PQerrorMessage(conn);
++				ast_log(LOG_ERROR, &quot;cdr_pgsql: Unable to reconnect to database server %s. Calls will not be logged!\n&quot;, pghostname);
++				ast_log(LOG_ERROR, &quot;cdr_pgsql: Reason: %s\n&quot;, pgerror);
++				connected = 0;
++				ast_mutex_unlock(&amp;pgsql_lock);
++				return -1;
++			}
++		}
++		result = PQexec(conn, sqlcmd);
++		if ( PQresultStatus(result) != PGRES_COMMAND_OK) {
++                        pgerror = PQresultErrorMessage(result);
++			ast_log(LOG_ERROR,&quot;cdr_pgsql: Failed to insert call detail record into database!\n&quot;);
++                        ast_log(LOG_ERROR,&quot;cdr_pgsql: Reason: %s\n&quot;, pgerror);
++			ast_mutex_unlock(&amp;pgsql_lock);
++			return -1;
++		}
++	}
++	ast_mutex_unlock(&amp;pgsql_lock);
++	return 0;
++}
++
++char *description(void)
++{
++	return desc;
++}
++
++static int my_unload_module(void)
++{ 
++	if (conn)
++		PQfinish(conn);
++	conn = NULL;
++	connected = 0;
++	if (pghostname &amp;&amp; hostname_alloc) {
++		free(pghostname);
++		pghostname = NULL;
++		hostname_alloc = 0;
++	}
++	if (pgdbname &amp;&amp; dbname_alloc) {
++		free(pgdbname);
++		pgdbname = NULL;
++		dbname_alloc = 0;
++	}
++	if (pgdbuser &amp;&amp; dbuser_alloc) {
++		free(pgdbuser);
++		pgdbuser = NULL;
++		dbuser_alloc = 0;
++	}
++	if (pgdbsock &amp;&amp; dbsock_alloc) {
++		free(pgdbsock);
++		pgdbsock = NULL;
++		dbsock_alloc = 0;
++	}
++	if (pgpassword &amp;&amp; password_alloc) {
++		free(pgpassword);
++		pgpassword = NULL;
++		password_alloc = 0;
++	}
++	if (pgdbport &amp;&amp; dbport_alloc) {
++		free(pgdbport);
++		pgdbport = NULL;
++		dbport_alloc = 0;
++	}
++	ast_cdr_unregister(name);
++	return 0;
++}
++
++static int my_load_module(void)
++{
++	int res;
++	struct ast_config *cfg;
++	struct ast_variable *var;
++        char *pgerror;
++	char *tmp;
++
++	cfg = ast_load(config);
++	if (!cfg) {
++		ast_log(LOG_WARNING, &quot;Unable to load config for PostgreSQL CDR's: %s\n&quot;, config);
++		return 0;
++	}
++	
++	var = ast_variable_browse(cfg, &quot;global&quot;);
++	if (!var) {
++		/* nothing configured */
++		return 0;
++	}
++
++	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;hostname&quot;);
++	if (tmp) {
++		pghostname = malloc(strlen(tmp) + 1);
++		if (pghostname != NULL) {
++			memset(pghostname, 0, strlen(tmp) + 1);
++			hostname_alloc = 1;
++			strncpy(pghostname, tmp, strlen(tmp));
++		} else {
++			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			return -1;
++		}
++	} else {
++		ast_log(LOG_WARNING,&quot;PostgreSQL server hostname not specified.  Assuming localhost\n&quot;);
++		pghostname = &quot;localhost&quot;;
++	}
++
++	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;dbname&quot;);
++	if (tmp) {
++		pgdbname = malloc(strlen(tmp) + 1);
++		if (pgdbname != NULL) {
++			memset(pgdbname, 0, strlen(tmp) + 1);
++			dbname_alloc = 1;
++			strncpy(pgdbname, tmp, strlen(tmp));
++		} else {
++			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			return -1;
++		}
++	} else {
++		ast_log(LOG_WARNING,&quot;PostgreSQL database not specified.  Assuming asterisk\n&quot;);
++		pgdbname = &quot;asteriskcdrdb&quot;;
++	}
++
++	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;user&quot;);
++	if (tmp) {
++		pgdbuser = malloc(strlen(tmp) + 1);
++		if (pgdbuser != NULL) {
++			memset(pgdbuser, 0, strlen(tmp) + 1);
++			dbuser_alloc = 1;
++			strncpy(pgdbuser, tmp, strlen(tmp));
++		} else {
++			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			return -1;
++		}
++	} else {
++		ast_log(LOG_WARNING,&quot;PostgreSQL database user not specified.  Assuming root\n&quot;);
++		pgdbuser = &quot;root&quot;;
++	}
++
++	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;password&quot;);
++	if (tmp) {
++		pgpassword = malloc(strlen(tmp) + 1);
++		if (pgpassword != NULL) {
++			memset(pgpassword, 0, strlen(tmp) + 1);
++			password_alloc = 1;
++			strncpy(pgpassword, tmp, strlen(tmp));
++		} else {
++			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			return -1;
++		}
++	} else {
++		ast_log(LOG_WARNING,&quot;PostgreSQL database password not specified.  Assuming blank\n&quot;);
++		pgpassword = &quot;&quot;;
++	}
++
++	tmp = ast_variable_retrieve(cfg,&quot;global&quot;,&quot;port&quot;);
++	if (tmp) {
++		pgdbport = malloc(strlen(tmp) + 1);
++		if (pgdbport != NULL) {
++			memset(pgdbport, 0, strlen(tmp) + 1);
++			dbport_alloc = 1;
++			strncpy(pgdbport, tmp, strlen(tmp));
++		} else {
++			ast_log(LOG_ERROR,&quot;Out of memory error.\n&quot;);
++			return -1;
++		}
++	} else {
++		ast_log(LOG_WARNING,&quot;PostgreSQL database port not specified.  Using default 5432.\n&quot;);
++		pgdbport = &quot;5432&quot;;
++	}
++
++	ast_destroy(cfg);
++
++	ast_log(LOG_DEBUG,&quot;cdr_pgsql: got hostname of %s\n&quot;,pghostname);
++	ast_log(LOG_DEBUG,&quot;cdr_pgsql: got port of %s\n&quot;,pgdbport);
++	if (pgdbsock)
++		ast_log(LOG_DEBUG,&quot;cdr_pgsql: got sock file of %s\n&quot;,pgdbsock);
++	ast_log(LOG_DEBUG,&quot;cdr_pgsql: got user of %s\n&quot;,pgdbuser);
++	ast_log(LOG_DEBUG,&quot;cdr_pgsql: got dbname of %s\n&quot;,pgdbname);
++	ast_log(LOG_DEBUG,&quot;cdr_pgsql: got password of %s\n&quot;,pgpassword);
++
++	conn = PQsetdbLogin(pghostname, pgdbport, NULL, NULL, pgdbname, pgdbuser, pgpassword);
++	if (PQstatus(conn) != CONNECTION_BAD) {
++		ast_log(LOG_DEBUG,&quot;Successfully connected to PostgreSQL database.\n&quot;);
++		connected = 1;
++	} else {
++                pgerror = PQerrorMessage(conn);
++		ast_log(LOG_ERROR, &quot;cdr_pgsql: Unable to connect to database server %s.  Calls will not be logged!\n&quot;, pghostname);
++                ast_log(LOG_ERROR, &quot;cdr_pgsql: Reason: %s\n&quot;, pgerror);
++		connected = 0;
++	}
++
++	res = ast_cdr_register(name, desc, pgsql_log);
++	if (res) {
++		ast_log(LOG_ERROR, &quot;Unable to register PGSQL CDR handling\n&quot;);
++	}
++	return res;
++}
++
++int load_module(void)
++{
++	return my_load_module();
++}
++
++int unload_module(void)
++{
++	return my_unload_module();
++}
++
++int reload(void)
++{
++	my_unload_module();
++	return my_load_module();
++}
++
++int usecount(void)
++{
++	return connected;
++}
++
++char *key()
++{
++	return ASTERISK_GPL_KEY;
++}

Modified: trunk/rpms/asterisk/asterisk.spec
===================================================================
--- trunk/rpms/asterisk/asterisk.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/asterisk/asterisk.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -6,18 +6,18 @@
 %define gname asterisk
 
 # For pre-versions
-%define prever RC1
+#define prever RC2
 
 Summary: The Asterisk PBX and telephony application and toolkit
 Name: asterisk
-Version: 1.0
-Release: %{?prever:0.%{prever}.}5
+Version: 1.0.1
+Release: %{?prever:0.%{prever}.}0
 License: GPL
 Group: Applications/Internet
 URL: <A HREF="http://www.asterisk.org/">http://www.asterisk.org/</A>
 Source0: <A HREF="ftp://ftp.asterisk.org/pub/telephony/asterisk/asterisk-%{version">ftp://ftp.asterisk.org/pub/telephony/asterisk/asterisk-%{version</A>}%{?prever:-%{prever}}.tar.gz
 Source1: asterisk.init
-Patch: asterisk-1.0-RC1-cdr.patch
+Patch: asterisk-1.0-RC2-cdr.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: openssl, zlib, perl, speex, zaptel
 Requires: gtk+, mysql, newt, ncurses, postgresql-libs
@@ -49,7 +49,7 @@
 
 %prep
 %setup -n asterisk-%{version}%{?prever:-%{prever}}
-%patch -p0 -b .cdr
+%patch -p1 -b .cdr
 
 
 %build
@@ -81,7 +81,7 @@
 %{__mkdir_p} %{buildroot}%{_localstatedir}/run/asterisk
 
 # Fix the safe_asterix script, to be run as non-root
-%{__perl} -pi.orig -e 's|(asterisk \${ASTARGS})|%{_sbindir}/$1|g' \
+%{__perl} -pi.orig -e 's|(asterisk \${CLIARGS})|%{_sbindir}/$1|g' \
     %{buildroot}%{_sbindir}/safe_asterisk
 
 # Install demo sounds
@@ -123,23 +123,37 @@
 %attr(640, %{uname}, %{gname}) %config(noreplace) %{_sysconfdir}/asterisk/*.conf
 %attr(640, %{uname}, %{gname}) %config(noreplace) %{_sysconfdir}/asterisk/*.adsi
 %{_initrddir}/asterisk
-%{_libdir}/asterisk
+%{_libdir}/asterisk/
 %{_sbindir}/*
-%attr(-  , %{uname}, %{gname}) %{_localstatedir}/lib/asterisk
-%attr(750, %{uname}, %{gname}) %{_localstatedir}/run/asterisk
-%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/log/asterisk
-%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk
-                                    %{_localstatedir}/spool/asterisk/vm
-%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/voicemail
-%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/voicemail/default
+%{_mandir}/man8/asterisk.8*
+%attr(-  , %{uname}, %{gname}) %{_localstatedir}/lib/asterisk/
+%attr(750, %{uname}, %{gname}) %{_localstatedir}/run/asterisk/
+%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/log/asterisk/
+%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/
+                                    %{_localstatedir}/spool/asterisk/vm/
+%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/voicemail/
+%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/voicemail/default/
+%attr(750, %{uname}, %{gname}) %dir %{_localstatedir}/spool/asterisk/voicemail/default/1234/
+                                    %{_localstatedir}/spool/asterisk/voicemail/default/1234/*.gsm
 
 
 %files devel
+%defattr(-, root, root, 0755)
 %doc doc/api/html/*
-%{_includedir}/asterisk
+%{_includedir}/asterisk/
 
 
 %changelog
+* Mon Oct 18 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0.1-0
+- Update to 1.0.1.
+
+* Wed Sep  1 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0-0.RC2.1
+- Fix safe_asterisk again, ${CLIARGS} instead of ${ASTARGS}.
+
+* Thu Aug 26 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0-0.RC2.0
+- Update to 1.0-RC2.
+- Updated cdr patch, one fix made it upstream.
+
 * Thu Jul 29 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0-0.RC1.5
 - Added Areski's cdr patch -2.
 - Fix /var/run/asterisk -3.

Modified: trunk/rpms/asterisk-sounds/asterisk-sounds.spec
===================================================================
--- trunk/rpms/asterisk-sounds/asterisk-sounds.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/asterisk-sounds/asterisk-sounds.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -1,13 +1,14 @@
 # $Id$
 # Authority: matthias
+# Dist: nodist
 
 # For pre-versions
-%define prever RC1
+#define prever RC2
 
 Summary: Sound files for the Asterisk PBX and telephony application and toolkit
 Name: asterisk-sounds
-Version: 1.0
-Release: %{?prever:0.%{prever}.}1
+Version: 1.0.1
+Release: %{?prever:0.%{prever}.}0
 License: BSD
 Group: Applications/Internet
 URL: <A HREF="http://www.asterisk.org/">http://www.asterisk.org/</A>
@@ -54,6 +55,12 @@
 
 
 %changelog
+* Mon Oct 18 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0.1-0
+- Update to 1.0.1.
+
+* Thu Aug 26 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0-0.RC2.0
+- Update to 1.0-RC2.
+
 * Mon Jul 26 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 1.0-0.RC1.1
 - Initial RPM release.
 

Modified: trunk/rpms/fftw/fftw.spec
===================================================================
--- trunk/rpms/fftw/fftw.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/fftw/fftw.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -23,6 +23,8 @@
 %package devel
 Summary: Headers, development libraries and documentation for the FFTW library
 Group: Development/Libraries
+#Requires(post): info
+#Requires(preun): info
 Requires: %{name} = %{version}
 
 %description devel
@@ -89,6 +91,16 @@
 /sbin/ldconfig
 
 
+#post devel
+# warning: no info dir entry in `/usr/share/info/fftw.info.gz'
+#/sbin/install-info %{_infodir}/fftw.info.gz %{_infodir}/dir
+
+#preun devel
+#if [ $1 -eq 0]; then
+#    /sbin/install-info --delete %{_infodir}/fftw.info.gz %{_infodir}/dir
+#fi
+
+
 %files
 %defattr(-, root, root, 0755)
 %doc AUTHORS COPYING COPYRIGHT ChangeLog NEWS README* TODO
@@ -101,10 +113,13 @@
 %{_libdir}/*.a
 %exclude %{_libdir}/*.la
 %{_libdir}/*.so
-%{_infodir}/*.info*
+%{_infodir}/fftw.info*
 
 
 %changelog
+* Mon Aug 30 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.1.5-4
+- Added install-info calls for the devel sub-package... nope, doesn't work.
+
 * Wed May 26 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.1.5-4
 - Rebuild for Fedora Core 2.
 

Modified: trunk/rpms/plone/plone.spec
===================================================================
--- trunk/rpms/plone/plone.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/plone/plone.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -2,25 +2,23 @@
 # Authority: matthias
 
 %define real_name      Plone
-%define real_version   2.0.2
+%define real_version   2.0.4
 %define zope_minver    2.6.4
-%define cmf_minver     1.4.2
 
 %define zope_home      %{_prefix}/lib/zope
 %define software_home  %{zope_home}/lib/python
 
-Summary: Content management system built over Zope's content management framework
+Summary: Content management system built over Zope's framework
 Name: plone
-Version: 2.0.2
+Version: 2.0.4
 Release: 0.1
 License: GPL
 Group: System Environment/Daemons
 Source: <A HREF="http://dl.sf.net/plone/%{real_name">http://dl.sf.net/plone/%{real_name</A>}-%{real_version}.tar.gz
 URL: <A HREF="http://plone.org/">http://plone.org/</A>
-BuildRoot: %{_tmppath}/%{name}-%{version}-root
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 BuildArch: noarch
 Requires: zope &gt;= %{zope_minver}
-#Requires: zope-cmf &gt;= %{cmf_minver}
 BuildRequires: python
 
 %description
@@ -57,8 +55,12 @@
 
 
 %changelog
+* Wed Oct 20 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.0.4-0.1
+- Update to 2.0.4.
+
 * Fri May 14 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.0.2-0.1
 - Update to 2.0.2.
+- No longer require zope-cmf, it seems provided now.
 
 * Wed Mar 24 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.0-0.3
 - Update to 2.0 final.

Added: trunk/rpms/python-imaging/python-imaging-1.1.4-setup.patch
===================================================================
--- trunk/rpms/python-imaging/python-imaging-1.1.4-setup.patch	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/python-imaging/python-imaging-1.1.4-setup.patch	2004-10-25 11:47:23 UTC (rev 2308)
@@ -0,0 +1,15 @@
+diff -Naur Imaging-1.1.4/setup.py Imaging-1.1.4.patched/setup.py
+--- Imaging-1.1.4/setup.py	2003-05-09 14:00:56.000000000 +0200
++++ Imaging-1.1.4.patched/setup.py	2004-10-18 21:17:44.688210376 +0200
+@@ -45,6 +45,11 @@
+ LIBRARY_DIRS = [&quot;libImaging&quot;]
+ LIBRARIES = [&quot;Imaging&quot;]
+ 
++# thomasvs: in my build this was not defined, and this setup.py is
++# badly written
++EXTRA_COMPILE_ARGS = None
++EXTRA_LINK_ARGS = None
++
+ # Add some standard search spots for MacOSX/darwin
+ if os.path.exists('/sw/include'):
+     INCLUDE_DIRS.append('/sw/include')

Modified: trunk/rpms/rhythmbox/rhythmbox.spec
===================================================================
--- trunk/rpms/rhythmbox/rhythmbox.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/rhythmbox/rhythmbox.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -9,7 +9,7 @@
 
 Name: rhythmbox%{?_with_xine:-xine}
 Summary: Music Management Application 
-Version: %{majmin}.7
+Version: %{majmin}.8
 Release: 0
 License: GPL
 Group: Applications/Multimedia
@@ -66,8 +66,9 @@
 %{__rm} -rf %{buildroot}
 
 
-%post 
+%post
 /sbin/ldconfig
+scrollkeeper-update
 export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
 SCHEMAS=&quot;rhythmbox.schemas&quot;
 for S in $SCHEMAS; do 
@@ -76,6 +77,7 @@
 
 %postun
 /sbin/ldconfig
+scrollkeeper-update
 
 
 %files -f rhythmbox.lang
@@ -83,13 +85,13 @@
 %doc AUTHORS COPYING ChangeLog README NEWS
 %{_bindir}/*
 %{_sysconfdir}/gconf/schemas/rhythmbox.schemas
-%{_datadir}/rhythmbox/*
+%{_datadir}/rhythmbox/
 %{_datadir}/applications/rhythmbox.desktop
 %{_datadir}/pixmaps/rhythmbox.png
 %{_datadir}/gnome-2.0/ui/*.xml
 %{_datadir}/application-registry/*
-%{_datadir}/gnome/help/rhythmbox
-%{_datadir}/omf/rhythmbox/*
+%{_datadir}/gnome/help/rhythmbox/
+%{_datadir}/omf/rhythmbox/
 %{_datadir}/idl/Rhythmbox.idl
 %{_datadir}/mime-info/rhythmbox.keys
 %{_libdir}/bonobo/librb-nautilus-context-menu.so
@@ -98,6 +100,12 @@
 
 
 %changelog
+* Sat Oct 16 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.8.8-0
+- Added scrollkeeper-update to the scriplets.
+
+* Wed Oct 13 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.8.8-0
+- Update to 0.8.8.
+
 * Fri Oct  1 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.8.7-0
 - Update to 0.8.7.
 

Modified: trunk/rpms/rpmlint/config.fedora
===================================================================
--- trunk/rpms/rpmlint/config.fedora	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/rpmlint/config.fedora	2004-10-25 11:47:23 UTC (rev 2308)
@@ -26,7 +26,7 @@
 # Configuration options used by the checks for Fedora Core Development
 
 setOption(&quot;Vendor&quot;, &quot;Red Hat, Inc.&quot;)
-setOption(&quot;Distribution&quot;, &quot;Red Hat Linux&quot;)
+setOption(&quot;Distribution&quot;, &quot;Red Hat (FC-3)&quot;)
 setOption(&quot;Packager&quot;, &quot;Red Hat, Inc. &lt;<A HREF="http://bugzilla.redhat.com/bugzilla">http://bugzilla.redhat.com/bugzilla</A>&gt;&quot;)
 setOption(&quot;ValidBuildHost&quot;, &quot;\.redhat\.com$&quot;)
 setOption(&quot;UseBzip2&quot;, 0)
@@ -74,14 +74,16 @@
 addFilter(&quot;.* perl5-naming-policy-not-applied&quot;)
 
 # filters for TagsCheck.py
-addFilter(&quot;gcc3. devel-dependency glibc-devel&quot;)
+addFilter(&quot;gcc(3.|4) devel-dependency glibc-devel&quot;)
 addFilter(&quot;(compat-)?gcc.*-c\+\+ devel-dependency (compat-)?libstdc\+\+-devel&quot;)
 addFilter(&quot;(compat-)?gcc-java devel-dependency (compat-)?libgcj-devel&quot;)
 # No changelog is included in fedora-release
 addFilter(&quot;fedora-release no-changelogname-tag&quot;)
+# Tool for developing KDE applications
+addFilter(&quot;kdevelop devel-dependency kdelibs-devel&quot;)
 # Tool for developing python modules
 addFilter(&quot;Pyrex devel-dependency python-devel&quot;)
-# Tool for developing qt applications
+# Tool for developing Qt applications
 addFilter(&quot;qt-designer devel-dependency qt-devel&quot;)
 
 # filters for BinariesCheck.py
@@ -93,8 +95,10 @@
 addFilter(&quot;gal no-binary&quot;)
 # Specificities for x86_64 at least
 addFilter(&quot;glibc-kernheaders no-binary&quot;)
+# From the spec : WE ARE NOT NOARCH, /usr/lib/pkgconfig is not noarch.
+addFilter(&quot;gnome-mime-data no-binary&quot;)
 # The binary is in /boot, doesn't get detected properly by rpmlint it seems
-addFilter(&quot;memtest86+ no-binary&quot;)
+addFilter(&quot;memtest86\+ no-binary&quot;)
 # Binaries are in mew-common
 addFilter(&quot;mew no-binary&quot;)
 # Deps are different across archs (genromfs, slilo, syslinux)
@@ -117,13 +121,13 @@
 addFilter(&quot;.* dangling-symlink .* /usr/share/desktop-menu-patches/&quot;)
 addFilter(&quot;.* symlink-should-be-relative .* /usr/share/desktop-menu-patches/&quot;)
 # KDE docs often link back to the main docs, or so it seems
-addFilter(&quot;.* dangling-symlink .* /usr/share/doc/HTML/en/common$&quot;)
-addFilter(&quot;.* symlink-should-be-relative .* /usr/share/doc/HTML/en/common$&quot;)
+addFilter(&quot;.* dangling-symlink .* /usr/share/doc/HTML/../common$&quot;)
+addFilter(&quot;.* symlink-should-be-relative .* /usr/share/doc/HTML/../common$&quot;)
 # Log has group utmp and logrotate is done from the main /etc/logrotate.conf
 addFilter(&quot;initscripts non-root-group-log-file /var/log/wtmp utmp&quot;)
 addFilter(&quot;initscripts log-files-without-logrotate /var/log/wtmp&quot;)
 # Log belongs to mysql
-addFilter(&quot;mysql-server non-root-.*-log-file /var/log/mysqld.log mysql&quot;)
+addFilter(&quot;mysql-server non-root-.*-log-file /var/log/mysqld\.log mysql&quot;)
 
 # filters for PostCheck.py
 # Proper shell syntax : mkdir -p &quot;${device%/*}&quot;
@@ -132,6 +136,8 @@
 addFilter(&quot;cyrus-imapd percent-in-%post&quot;)
 # Uses TMP=$(mktemp /tmp/fstab.XXXXXX)
 addFilter(&quot;dev use-tmp-in-%post&quot;)
+# Uses rel=${rel%.cat}
+addFilter(&quot;docbook-style-dsssl percent-in-%post&quot;)
 # HOME=/root is used, since fc-cache being run will use ~/fc.cache
 addFilter(&quot;fontconfig use-of-home-in-%post&quot;)
 # echo -e '%s/color=&quot;#20305a&quot;/color=&quot;#444444&quot;/g\nw'
@@ -145,3 +151,9 @@
 # Uses TmpFile=`/bin/mktemp /tmp/.zshrpmXXXXXX`
 addFilter(&quot;zsh use-tmp-in-%postun&quot;)
 
+# filters for DistributionCheck.py
+# Bug in rpmlint : serial/8250/many/ports.h matches man?/*.?
+addFilter(&quot;kernel(-smp)? manpage-not-gzipped /lib/modules/.*&quot;)
+# This is the old value, not replaced everywhere yet
+addFilter(&quot;invalid-distribution Red Hat Linux&quot;)
+

Modified: trunk/rpms/rpmlint/rpmlint.spec
===================================================================
--- trunk/rpms/rpmlint/rpmlint.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/rpmlint/rpmlint.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -1,5 +1,5 @@
 # $Id$
-# Authority: dag
+# Authority: matthias
 
 Summary: RPM correctness checker
 Name: rpmlint
@@ -8,17 +8,12 @@
 License: GPL
 Group: Development/Tools
 URL: <A HREF="http://people.mandrakesoft.com/~flepied/projects/rpmlint/">http://people.mandrakesoft.com/~flepied/projects/rpmlint/</A>
-
-Packager: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
-Vendor: Dag Apt Repository, <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
-
 Source: <A HREF="http://people.mandrakesoft.com/~flepied/projects/rpmlint/dist/rpmlint-%{version">http://people.mandrakesoft.com/~flepied/projects/rpmlint/dist/rpmlint-%{version</A>}.tar.bz2
 Source1: config.fedora
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-
-BuildArch: noarch
-BuildRequires: python &gt;= 1.5.2, rpm-python
 Requires: python &gt;= 1.5.2, rpm-python
+BuildRequires: python &gt;= 1.5.2, rpm-python
+BuildArch: noarch
 
 %description
 Rpmlint is a tool to check common errors on rpm packages.

Modified: trunk/rpms/xmms-acme/xmms-acme.spec
===================================================================
--- trunk/rpms/xmms-acme/xmms-acme.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/xmms-acme/xmms-acme.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -1,12 +1,12 @@
 # $Id$
 # Authority: matthias
 
-%define xmms_generaldir %(xmms-config --general-plugin-dir)
+%define xmms_generaldir %(xmms-config --general-plugin-dir || echo %{_libdir}/xmms/General)
 
 Summary: XMMS plugin to use special multimedia keys in GNOME or through acme
 Name: xmms-acme
-Version: 0.4.1
-Release: 3
+Version: 0.4.2
+Release: 1
 License: GPL
 Group: Applications/Multimedia
 URL: <A HREF="http://www.devin.com/xmms-xf86audio/">http://www.devin.com/xmms-xf86audio/</A>
@@ -49,6 +49,9 @@
 
 
 %changelog
+* Mon Oct 25 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.4.2-1
+- Update to 0.4.2.
+
 * Mon Jul  5 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.4.1-3
 - Fix for x86_64.
 

Modified: trunk/rpms/zope/zope.spec
===================================================================
--- trunk/rpms/zope/zope.spec	2004-10-25 09:09:47 UTC (rev 2307)
+++ trunk/rpms/zope/zope.spec	2004-10-25 11:47:23 UTC (rev 2308)
@@ -1,17 +1,18 @@
 # $Id$
 
 %define real_name      Zope
-%define python         /usr/bin/python
-%define python_minver  2.3.2
+%define real_version   2.7.2-0
+%define python         %{_bindir}/python
+%define python_minver  2.3.3
 %define zope_user      zope
-%define zope_group     %{zope_user}
+%define zope_group     zope
 
 %define zope_home      %{_prefix}/lib/zope
 %define software_home  %{zope_home}/lib/python
-%define instance_home  %{_localstatedir}/lib/zope
+%define instance_home  %{_var}/lib/zope
 %define client_home    %{instance_home}/data
-%define run_dir        %{_localstatedir}/run/zope
-%define log_dir        %{_localstatedir}/log/zope
+%define run_dir        %{_var}/run/zope
+%define log_dir        %{_var}/log/zope
 %define config_file    %{_sysconfdir}/zope.conf
 
 %define zopectl        %{_bindir}/zopectl
@@ -20,12 +21,12 @@
 
 Summary: Web application server for flexible content management applications
 Name: zope
-Version: 2.7.1
+Version: 2.7.2
 Release: 0.1
 License: ZPL
 Group: System Environment/Daemons
 URL: <A HREF="http://www.zope.org/">http://www.zope.org/</A>
-Source0: <A HREF="http://zope.org/Products/Zope/%{version">http://zope.org/Products/Zope/%{version</A>}/%{real_name}-%{version}.tgz
+Source0: <A HREF="http://zope.org/Products/Zope/%{version">http://zope.org/Products/Zope/%{version</A>}/%{real_name}-%{real_version}.tgz
 Source1: zope.init.in
 Source2: zope.logrotate.in
 Patch: Zope-2.7.0-config.patch
@@ -58,8 +59,7 @@
 
 
 %install
-%{__rm} -rf %{buildroot}
-%{__rm} -rf rpm-skel
+%{__rm} -rf %{buildroot} rpm-skel
 
 # Copy over files from the default skel to the rpm-skel
 %{__install} -D -m 644 skel/etc/zope.conf.in rpm-skel/etc/zope.conf.in
@@ -69,11 +69,11 @@
 # Create all required additional directories
 for dir in %{zope_home} %{software_home} %{client_home} %{log_dir} %{run_dir} \
     %{instance_home}/{Products,bin}; do
-    %{__mkdir_p} %{buildroot}$dir
+        %{__mkdir_p} %{buildroot}$dir
 done
 
 # Install additional files in the rpm-skel
-%{__install} -D -m 755 %{SOURCE1} rpm-skel%{_initrddir}/zope.in
+%{__install} -D -m 755 %{SOURCE1} rpm-skel%{_sysconfdir}/rc.d/init.d/zope.in
 %{__install} -D -m 644 %{SOURCE2} rpm-skel%{_sysconfdir}/logrotate.d/zope.in
 
 # Install the skel, translating paths, into the build root
@@ -92,7 +92,7 @@
      --replace=&quot;ZOPECTL:%{zopectl}&quot; \
      --replace=&quot;RUNZOPE:%{runzope}&quot;
 
-# Actually copy all the other files over
+# Now, copy all the other files over
 %{__make} install
 
 # Symlink to include in the docs
@@ -117,7 +117,7 @@
 
 %preun
 if [ $1 -eq 0 ]; then
-    /sbin/service zope stop &gt;/dev/null 2&gt;&amp;1
+    /sbin/service zope stop &gt;/dev/null 2&gt;&amp;1 || :
     /sbin/chkconfig --del zope
 fi
 
@@ -133,21 +133,25 @@
 %doc docs
 %config(noreplace) %{config_file}
 %config(noreplace) %{_sysconfdir}/logrotate.d/zope
-%config %{_initrddir}/zope
+%config %{_sysconfdir}/rc.d/init.d/zope
 %attr(0755, root, root) %{runzope}
 %attr(0755, root, root) %{zopectl}
-%dir %{zope_home}
-%{zope_home}/bin
-%{zope_home}/doc
-%{zope_home}/import
-%{zope_home}/lib
-%exclude %{zope_home}/skel
-%attr(0700, %{zope_user}, %{zope_group}) %verify(not md5 size mtime) %{instance_home}
-%attr(0755, %{zope_user}, %{zope_group}) %dir %{_localstatedir}/log/zope
-%attr(0755, %{zope_user}, %{zope_group}) %dir %{_localstatedir}/run/zope
+%dir %{zope_home}/
+%{zope_home}/bin/
+%{zope_home}/doc/
+%{zope_home}/import/
+%{zope_home}/lib/
+%exclude %{zope_home}/skel/
+%attr(0700, %{zope_user}, %{zope_group}) %verify(not md5 size mtime) %{instance_home}/
+%attr(0755, %{zope_user}, %{zope_group}) %dir %{_var}/log/zope/
+%attr(0755, %{zope_user}, %{zope_group}) %dir %{_var}/run/zope/
 
 
 %changelog
+* Wed Oct 20 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.7.2-0.1
+- Update to 2.7.2.
+- Minor spec updates and cleanups.
+
 * Wed Jul 14 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 2.7.1-0.1
 - Update to 2.7.1.
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001113.html">[SVN] r2307 - trunk/rpms/sudosh
</A></li>
	<LI>Next message: <A HREF="001115.html">[SVN] r2309 - in trunk/rpms: libtheora xmame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1114">[ date ]</a>
              <a href="thread.html#1114">[ thread ]</a>
              <a href="subject.html#1114">[ subject ]</a>
              <a href="author.html#1114">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
