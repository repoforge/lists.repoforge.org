<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r9345 - in /trunk/elrepo/dag: ./ cciss-kmod/ drbd83-kmod/ lin_tape-kmod/ ndiswrapper-kmod/ ocfs2-kmod/
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9345%20-%20in%20/trunk/elrepo/dag%3A%20./%20cciss-kmod/%20drbd83-kmod/%0A%20lin_tape-kmod/%20ndiswrapper-kmod/%20ocfs2-kmod/&In-Reply-To=%3C201011300026.oAU0Q9Sk028793%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008128.html">
   <LINK REL="Next"  HREF="008130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r9345 - in /trunk/elrepo/dag: ./ cciss-kmod/ drbd83-kmod/ lin_tape-kmod/ ndiswrapper-kmod/ ocfs2-kmod/</H1>
    <B>Dag Wieers</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9345%20-%20in%20/trunk/elrepo/dag%3A%20./%20cciss-kmod/%20drbd83-kmod/%0A%20lin_tape-kmod/%20ndiswrapper-kmod/%20ocfs2-kmod/&In-Reply-To=%3C201011300026.oAU0Q9Sk028793%40surya.karan.org%3E"
       TITLE="[svn] r9345 - in /trunk/elrepo/dag: ./ cciss-kmod/ drbd83-kmod/ lin_tape-kmod/ ndiswrapper-kmod/ ocfs2-kmod/">dag at wieers.com
       </A><BR>
    <I>Tue Nov 30 01:26:09 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008128.html">[svn] r9344 - in /trunk/elrepo/dag: cciss-kmod/cciss-kmod-el6.spec lin_tape-kmod/lin_tape-kmod-el6.spec
</A></li>
        <LI>Next message: <A HREF="008130.html">[svn] r9346 - in /trunk/elrepo/dag: cciss-kmod/ drbd83-kmod/ ndiswrapper-kmod/ ocfs2-kmod/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8129">[ date ]</a>
              <a href="thread.html#8129">[ thread ]</a>
              <a href="subject.html#8129">[ subject ]</a>
              <a href="author.html#8129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: Tue Nov 30 00:26:09 2010
New Revision: 9345

URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge?rev=9345&amp;view=rev">http://svn.rpmforge.net/viewvc/rpmforge?rev=9345&amp;view=rev</A>
Log:
More changes to templates

Added:
    trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh
    trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec
Modified:
    trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec
    trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec
    trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh
    trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh
    trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec
    trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec
    trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh
    trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh
    trunk/elrepo/dag/kmodtool-template-el5.sh
    trunk/elrepo/dag/kmodtool-template-el6.sh
    trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh
    trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh
    trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec
    trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec
    trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh
    trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec
    trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec
    trunk/elrepo/dag/template-kmod-el5.spec
    trunk/elrepo/dag/template-kmod-el6.spec

Modified: trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec (original)
+++ trunk/elrepo/dag/cciss-kmod/cciss-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -62,7 +62,7 @@
 for kvariant in %{kvariants} ; do
     %{__cp} -a %{kmod_name}-source-%{real_version} _kmod_build_$kvariant
 done
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
@@ -70,7 +70,7 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$kpath/drivers/block&quot;
+    %{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$kpath/drivers/block&quot;
 done
 
 %install
@@ -80,9 +80,9 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$kpath/drivers/block&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath/drivers/block&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 

Modified: trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec (original)
+++ trunk/elrepo/dag/cciss-kmod/cciss-kmod-el6.spec Tue Nov 30 00:26:09 2010
@@ -45,21 +45,21 @@
 
 %prep
 %setup -n %{kmod_name}-source-%{real_version}
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
 %build
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$PWD/drivers/block&quot;
+%{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$PWD/drivers/block&quot;
 
 %install
 %{__rm} -rf %{buildroot}
 export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
 export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$PWD/drivers/block&quot;
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$PWD/drivers/block&quot;
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 # Remove the files that are not required.

Modified: trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh (original)
+++ trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el5.sh Tue Nov 30 00:26:09 2010
@@ -166,7 +166,7 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${variant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
     echo &quot;%config /etc/udev/rules.d/62-cciss.rules&quot;
     echo &quot;/sbin/cciss-udev&quot;
     #BZ252188 - I've commented this out for the moment since RHEL5 doesn't

Modified: trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh (original)
+++ trunk/elrepo/dag/cciss-kmod/kmodtool-cciss-el6.sh Tue Nov 30 00:26:09 2010
@@ -192,7 +192,7 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${dotvariant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
     echo &quot;%config /etc/udev/rules.d/62-cciss.rules&quot;
     echo &quot;/sbin/cciss-udev&quot;
 else

Modified: trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec (original)
+++ trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -76,7 +76,7 @@
 for kvariant in %{kvariants} ; do
     %{__cp} -a %{real_name}-%{version} _kmod_build_$kvariant
 done
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
@@ -84,7 +84,7 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;$kpath&quot; module KDIR=&quot;${ksrc}&quot;
+    %{__make} -C &quot;$kpath&quot; module KDIR=&quot;$ksrc&quot;
 done
 
 %install
@@ -94,9 +94,9 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$kpath&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 

Modified: trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec (original)
+++ trunk/elrepo/dag/drbd83-kmod/drbd83-kmod-el6.spec Tue Nov 30 00:26:09 2010
@@ -55,21 +55,21 @@
     --without-utils \
     --without-xen
 
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
 %build
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} %{?_smp_mflags} module KDIR=&quot;${ksrc}&quot;
+%{__make} %{?_smp_mflags} module KDIR=&quot;$ksrc&quot;
 
 %install
 %{__rm} -rf %{buildroot}
 export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
 export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$PWD&quot;
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$PWD&quot;
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 # Remove the files that are not required.

Modified: trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh (original)
+++ trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el5.sh Tue Nov 30 00:26:09 2010
@@ -172,7 +172,7 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${variant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
     #BZ252188 - I've commented this out for the moment since RHEL5 doesn't
     #           really support external firmware e.g. at install time. If
     #           you really want it, use an override filelist solution.

Modified: trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh (original)
+++ trunk/elrepo/dag/drbd83-kmod/kmodtool-drbd83-el6.sh Tue Nov 30 00:26:09 2010
@@ -198,7 +198,7 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${dotvariant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
 else
     cat &quot;$override_filelist&quot; | get_filelist
 fi

Modified: trunk/elrepo/dag/kmodtool-template-el5.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/kmodtool-template-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/kmodtool-template-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/kmodtool-template-el5.sh (original)
+++ trunk/elrepo/dag/kmodtool-template-el5.sh Tue Nov 30 00:26:09 2010
@@ -166,8 +166,8 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${variant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
-    echo &quot;%doc /usr/share/doc/${kmod_name}-%{version}/&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
+    echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
     #BZ252188 - I've commented this out for the moment since RHEL5 doesn't
     #           really support external firmware e.g. at install time. If
     #           you really want it, use an override filelist solution.

Modified: trunk/elrepo/dag/kmodtool-template-el6.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/kmodtool-template-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/kmodtool-template-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/kmodtool-template-el6.sh (original)
+++ trunk/elrepo/dag/kmodtool-template-el6.sh Tue Nov 30 00:26:09 2010
@@ -192,8 +192,8 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${dotvariant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
-    echo &quot;%doc /usr/share/doc/${kmod_name}-%{version}/&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
+    echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
 else
     cat &quot;$override_filelist&quot; | get_filelist
 fi

Modified: trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh (original)
+++ trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el5.sh Tue Nov 30 00:26:09 2010
@@ -166,7 +166,7 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${variant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
     echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
 #    echo &quot;%config %{_sysconfdir}/udev/rules/98-lin_tape.rules&quot;
     echo &quot;%config %{_sysconfdir}/udev/permissions.d/98-lin_tape.permissions&quot;

Modified: trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh (original)
+++ trunk/elrepo/dag/lin_tape-kmod/kmodtool-lin_tape-el6.sh Tue Nov 30 00:26:09 2010
@@ -192,8 +192,8 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${dotvariant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
-    echo &quot;%doc /usr/share/doc/${kmod_name}-%{version}/&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
+    echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
 #    echo &quot;%config %{_sysconfdir}/udev/rules/98-lin_tape.rules&quot;
     echo &quot;%config %{_sysconfdir}/udev/permissions.d/98-lin_tape.permissions&quot;
 #    echo &quot;%{_sbindir}/udev.get_lin_tape_id.sh&quot;

Modified: trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec (original)
+++ trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -64,7 +64,7 @@
 for kvariant in %{kvariants} ; do
     %{__cp} -a %{kmod_name}-%{version} _kmod_build_$kvariant
 done
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
@@ -72,7 +72,7 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$kpath&quot;
+    %{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$kpath&quot;
 done
 
 %install
@@ -82,9 +82,9 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$kpath&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 

Modified: trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec (original)
+++ trunk/elrepo/dag/lin_tape-kmod/lin_tape-kmod-el6.spec Tue Nov 30 00:26:09 2010
@@ -47,14 +47,14 @@
 tar -xvzf lin_tape-%{version}.tgz
 
 cd %{kmod_name}-%{version}
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
 %build
 cd %{kmod_name}-%{version}
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$PWD&quot;
+%{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$PWD&quot;
 
 %install
 %{__rm} -rf %{buildroot}
@@ -62,9 +62,8 @@
 export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
 export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$PWD&quot;
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
-%{__install} -Dp -m0644 %{SOURCE5} %{buildroot}%{_docdir}/%{name}-%{version}/GPL-v2.0.txt
+%{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$PWD&quot;
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 # Remove the files that are not required.

Modified: trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh (original)
+++ trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el5.sh Tue Nov 30 00:26:09 2010
@@ -96,6 +96,7 @@
     cat &lt;&lt;EOF
 Provides:         kabi-modules = ${verrel}${variant}
 Provides:         ${kmod_name}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}
+Conflicts:        module-init-tools = 3.3-0.pre3.1.60.el5
 EOF
 
     if [ -z &quot;$kmp&quot; ]; then
@@ -105,7 +106,6 @@
     cat &lt;&lt;EOF
 Requires(post):   /sbin/depmod
 Requires(postun): /sbin/depmod
-Requires: ndiswrapper-utils &gt;= %{?epoch:%{epoch}:}%{version}
 EOF
 
 if [ &quot;no&quot; != &quot;$kmp_nobuildreqs&quot; ]
@@ -120,7 +120,7 @@
 
 cat &lt;&lt;EOF
 %description   -n kmod-${kmod_name}${dashvariant}
-This package provides the ${kmod_name} kernel module built
+This package provides the ${kmod_name} kernel module(s) built
 for the Linux kernel using the %{_target_cpu} family of processors.
 
 %post          -n kmod-${kmod_name}${dashvariant}
@@ -131,14 +131,12 @@
 
     if [ ! -z &quot;$kmp&quot; ]; then
         cat &lt;&lt;EOF
-if [ &quot;\$1&quot; = &quot;1&quot; ]; then
 echo &quot;Working. This may take some time ...&quot;
 modules=( \$(find /lib/modules/${verrel}${variant}/extra/${kmod_name} | grep '\.ko$') )
 if [ -x &quot;/sbin/weak-modules&quot; ]; then
     printf '%s\n' &quot;\${modules[@]}&quot; | /sbin/weak-modules --add-modules
 fi
 echo &quot;Done.&quot;
-fi
 
 %preun         -n kmod-${kmod_name}${dashvariant}
 rpm -ql kmod-${kmod_name}${dashvariant} | grep '\.ko$' \
@@ -155,16 +153,9 @@
         cat &lt;&lt;EOF
 echo &quot;Working. This may take some time ...&quot;
 modules=( \$(cat /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules) )
-#rm /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules
+rm /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules
 if [ -x &quot;/sbin/weak-modules&quot; ]; then
     printf '%s\n' &quot;\${modules[@]}&quot; | /sbin/weak-modules --remove-modules
-fi
-
-if [ &quot;\$1&quot; = &quot;1&quot; ]; then
-modules=( \$(find /lib/modules/${verrel}${variant}/extra/${kmod_name} | grep '\.ko$') )
-if [ -x &quot;/sbin/weak-modules&quot; ]; then
-    printf '%s\n' &quot;\${modules[@]}&quot; | /sbin/weak-modules --add-modules
-fi
 fi
 echo &quot;Done.&quot;
 EOF
@@ -175,7 +166,8 @@
 then
     echo &quot;%defattr(644,root,root,755)&quot;
     echo &quot;/lib/modules/${verrel}${variant}/&quot;
-    echo &quot;%config /etc/depmod.d/${kmod_name}.conf&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
+    echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
     #BZ252188 - I've commented this out for the moment since RHEL5 doesn't
     #           really support external firmware e.g. at install time. If
     #           you really want it, use an override filelist solution.

Added: trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh?rev=9345&amp;view=markup">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh?rev=9345&amp;view=markup</A>
==============================================================================
--- trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh (added)
+++ trunk/elrepo/dag/ndiswrapper-kmod/kmodtool-ndiswrapper-el6.sh Tue Nov 30 00:26:09 2010
@@ -1,0 +1,283 @@
+#!/bin/bash
+
+# kmodtool - Helper script for building kernel module RPMs
+#            An original version appeared in Fedora. This version is
+#            generally called only by the %kernel_module_package RPM macro
+#            during the process of building Driver Update Packages (which
+#            are also known as &quot;kmods&quot; in the Fedora community).
+#
+# Copyright (c) 2003-2010 Ville Skytt&#195;&#164; &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ville.skytta at iki.fi</A>&gt;,
+#                         Thorsten Leemhuis &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fedora at leemhuis.info</A>&gt;
+#                         Jon Masters &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">jcm at redhat.com</A>&gt;
+#
+# Permission is hereby granted, free of charge, to any person obtaining
+# a copy of this software and associated documentation files (the
+# &quot;Software&quot;), to deal in the Software without restriction, including
+# without limitation the rights to use, copy, modify, merge, publish,
+# distribute, sublicense, and/or sell copies of the Software, and to
+# permit persons to whom the Software is furnished to do so, subject to
+# the following conditions:
+#
+# The above copyright notice and this permission notice shall be
+# included in all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
+# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
+# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
+# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+# Changelog:
+#
+#            2010/07/28 - Add fixes for filelists in line with LF standard
+#                       - Remove now defunct &quot;framepointer&quot; kernel variant
+#                       - Change version to &quot;rhel6-rh2&quot; as a consequence.
+#
+#            2010/01/10 - Simplified for RHEL6. We are working on upstream
+#                         moving to a newer format and in any case do not
+#                         need to retain support for really old systems.
+
+shopt -s extglob
+
+myprog=&quot;kmodtool&quot;
+myver=&quot;rhel6-rh2&quot;
+knownvariants=@(debug|kdump)
+kmod_name=
+kver=
+verrel=
+variant=
+
+get_verrel ()
+{
+  verrel=${1:-$(uname -r)}
+  verrel=${verrel%%$knownvariants}
+}
+
+print_verrel ()
+{
+  get_verrel $@
+  echo &quot;${verrel}&quot;
+}
+
+get_variant ()
+{
+  get_verrel $@
+  variant=${1:-$(uname -r)}
+  variant=${variant##$verrel}
+  variant=${variant:-'&quot;&quot;'}
+}
+
+print_variant ()
+{
+  get_variant $@
+  echo &quot;${variant}&quot;
+}
+
+get_filelist() {
+	local IFS=$'\n'
+	filelist=($(cat))
+
+	if [ ${#filelist[@]} -gt 0 ];
+	then
+		for ((n = 0; n &lt; ${#filelist[@]}; n++));
+		do
+			line=&quot;${filelist[n]}&quot;
+			line=$(echo &quot;$line&quot; \
+				| sed -e &quot;s/%verrel/$verrel/g&quot; \
+				| sed -e &quot;s/%variant/$variant/g&quot; \
+				| sed -e &quot;s/%dashvariant/$dashvariant/g&quot; \
+				| sed -e &quot;s/%dotvariant/$dotvariant/g&quot; \
+				| sed -e &quot;s/\.%1/$dotvariant/g&quot; \
+				| sed -e &quot;s/\-%1/$dotvariant/g&quot; \
+				| sed -e &quot;s/%2/$verrel/g&quot;)
+			echo &quot;$line&quot;
+		done
+	else
+		echo &quot;%defattr(644,root,root,755)&quot;
+		echo &quot;/lib/modules/${verrel}${dotvariant}&quot;
+	fi
+}
+
+get_rpmtemplate ()
+{
+    local variant=&quot;${1}&quot;
+    local dashvariant=&quot;${variant:+-${variant}}&quot;
+    local dotvariant=&quot;${variant:+.${variant}}&quot;
+
+    echo &quot;%package       -n kmod-${kmod_name}${dashvariant}&quot;
+
+    if [ -z &quot;$kmod_provides_summary&quot; ]; then
+        echo &quot;Summary:          ${kmod_name} kernel module(s)&quot;
+    fi
+
+    if [ -z &quot;$kmod_provides_group&quot; ]; then
+        echo &quot;Group:            System Environment/Kernel&quot;
+    fi
+
+    if [ ! -z &quot;$kmod_version&quot; ]; then
+        echo &quot;Version: %{kmod_version}&quot;
+    fi
+
+    if [ ! -z &quot;$kmod_release&quot; ]; then
+        echo &quot;Release: %{kmod_release}&quot;
+    fi
+
+    # Turn off the internal dep generator so we will use the kmod scripts.
+    echo &quot;%global _use_internal_dependency_generator 0&quot;
+
+    cat &lt;&lt;EOF
+Provides:         kabi-modules = ${verrel}${dotvariant}
+Provides:         ${kmod_name}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}
+Requires(post):   /sbin/depmod
+Requires(postun): /sbin/depmod
+EOF
+
+    if [ &quot;no&quot; != &quot;$nobuildreqs&quot; ]
+    then
+        echo &quot;BuildRequires: kernel${dashvariant}-devel&quot;
+    fi
+
+    if [ &quot;&quot; != &quot;$override_preamble&quot; ]
+    then
+        cat &quot;$override_preamble&quot;
+    fi
+
+cat &lt;&lt;EOF
+%description   -n kmod-${kmod_name}${dashvariant}
+This package provides the ${kmod_name} kernel module(s) built
+for the Linux kernel using the %{_target_cpu} family of processors.
+EOF
+
+##############################################################################
+## The following are not part of this script directly, they are scripts     ##
+## that will be executed by RPM during various stages of package processing ##
+##############################################################################
+
+cat &lt;&lt;EOF
+%post          -n kmod-${kmod_name}${dashvariant}
+echo &quot;Working. This may take some time ...&quot;
+if [ -e &quot;/boot/System.map-${verrel}${dotvariant}&quot; ]; then
+    /sbin/depmod -aeF &quot;/boot/System.map-${verrel}${dotvariant}&quot; &quot;${verrel}${dotvariant}&quot; &gt; /dev/null || :
+fi
+modules=( \$(find /lib/modules/${verrel}${dotvariant}/extra/${kmod_name} | grep '\.ko$') )
+if [ -x &quot;/sbin/weak-modules&quot; ]; then
+    printf '%s\n' &quot;\${modules[@]}&quot; | /sbin/weak-modules --add-modules
+fi
+echo &quot;Done.&quot;
+EOF
+
+cat &lt;&lt;EOF
+%preun         -n kmod-${kmod_name}${dashvariant}
+rpm -ql kmod-${kmod_name}${dashvariant}-%{version}-%{release}.$(arch) | grep '\.ko$' &gt; /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules
+EOF
+
+cat &lt;&lt;EOF
+%postun        -n kmod-${kmod_name}${dashvariant}
+echo &quot;Working. This may take some time ...&quot;
+if [ -e &quot;/boot/System.map-${verrel}${dotvariant}&quot; ]; then
+    /sbin/depmod -aeF &quot;/boot/System.map-${verrel}${dotvariant}&quot; &quot;${verrel}${dotvariant}&quot; &gt; /dev/null || :
+fi
+modules=( \$(cat /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules) )
+rm /var/run/rpm-kmod-${kmod_name}${dashvariant}-modules
+if [ -x &quot;/sbin/weak-modules&quot; ]; then
+    printf '%s\n' &quot;\${modules[@]}&quot; | /sbin/weak-modules --remove-modules
+fi
+echo &quot;Done.&quot;
+EOF
+
+echo &quot;%files         -n kmod-${kmod_name}${dashvariant}&quot;
+if [ &quot;&quot; == &quot;$override_filelist&quot; ];
+then
+    echo &quot;%defattr(644,root,root,755)&quot;
+    echo &quot;/lib/modules/${verrel}${dotvariant}/&quot;
+    echo &quot;%config /etc/depmod.d/kmod-${kmod_name}.conf&quot;
+    echo &quot;%doc /usr/share/doc/kmod-${kmod_name}-%{version}/&quot;
+else
+    cat &quot;$override_filelist&quot; | get_filelist
+fi
+}
+
+print_rpmtemplate ()
+{
+  kmod_name=&quot;${1}&quot;
+  shift
+  kver=&quot;${1}&quot;
+  get_verrel &quot;${1}&quot;
+  shift
+  if [ -z &quot;${kmod_name}&quot; ] ; then
+    echo &quot;Please provide the kmodule-name as first parameter.&quot; &gt;&amp;2
+    exit 2
+  elif [ -z &quot;${kver}&quot; ] ; then
+    echo &quot;Please provide the kver as second parameter.&quot; &gt;&amp;2
+    exit 2
+  elif [ -z &quot;${verrel}&quot; ] ; then
+    echo &quot;Couldn't find out the verrel.&quot; &gt;&amp;2
+    exit 2
+  fi
+
+  for variant in &quot;$@&quot; ; do
+      if [ &quot;default&quot; == &quot;$variant&quot; ];
+      then
+            get_rpmtemplate &quot;&quot;
+      else
+            get_rpmtemplate &quot;${variant}&quot;
+      fi
+  done
+}
+
+usage ()
+{
+  cat &lt;&lt;EOF
+You called: ${invocation}
+
+Usage: ${myprog} &lt;command&gt; &lt;option&gt;+
+ Commands:
+  verrel &lt;uname&gt;                               
+    - Get &quot;base&quot; version-release.
+  variant &lt;uname&gt;                               
+    - Get variant from uname.
+  rpmtemplate &lt;mainpgkname&gt; &lt;uname&gt; &lt;variants&gt; 
+    - Return a template for use in a source RPM
+  version  
+    - Output version number and exit.
+EOF
+}
+
+invocation=&quot;$(basename ${0}) $@&quot;
+while [ &quot;${1}&quot; ] ; do
+  case &quot;${1}&quot; in
+    verrel)
+      shift
+      print_verrel $@
+      exit $?
+      ;;
+    variant)
+      shift
+      print_variant $@
+      exit $?
+      ;;
+    rpmtemplate)
+      shift
+      print_rpmtemplate &quot;$@&quot;
+      exit $?
+      ;;
+    version)
+      echo &quot;${myprog} ${myver}&quot;
+      exit 0
+      ;;
+    *)
+      echo &quot;Error: Unknown option '${1}'.&quot; &gt;&amp;2
+      usage &gt;&amp;2
+      exit 2
+      ;;
+  esac
+done
+
+# Local variables:
+# mode: sh
+# sh-indentation: 2
+# indent-tabs-mode: nil
+# End:
+# ex: ts=2 sw=2 et

Modified: trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec (original)
+++ trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -1,12 +1,13 @@
 # $Id$
 # Authority: dag
-
-%define kversion 2.6.18-8.el5
 
 # Define the kmod package name here.
 %define kmod_name ndiswrapper
 
-Summary: %{kmod_name} kernel modules
+# If kversion isn't defined on the rpmbuild line, define it here.
+%{!?kversion:%define kversion 2.6.18-8.el5}
+
+Summary: %{kmod_name} kernel module(s)
 Name: %{kmod_name}-kmod
 Version: 1.56
 Release: 1%{?dist}
@@ -17,12 +18,11 @@
 # Sources.
 Source0: <A HREF="http://heanet.dl.sourceforge.net/project/ndiswrapper/stable/%{version">http://heanet.dl.sourceforge.net/project/ndiswrapper/stable/%{version</A>}/ndiswrapper-%{version}.tar.gz
 Source10: kmodtool-%{kmod_name}-el5.sh
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-build-%(%{__id_u} -n)
 
 ExclusiveArch: i686 x86_64
-
-# If kversion isn't defined on the rpmbuild line, build for the current kernel.
-%{!?kversion: %define kversion %(uname -r)}
+BuildRequires: redhat-rpm-config
+BuildRequires: rpm-build
 
 # Define the variants for each architecture.
 %define basevar &quot;&quot;
@@ -40,39 +40,52 @@
 %define kmodtool sh %{SOURCE10}
 %{expand:%(%{kmodtool} rpmtemplate_kmp %{kmod_name} %{kversion} %{kvariants} 2&gt;/dev/null)}
 
+# Disable the building of the debug package(s).
+%define debug_package %{nil}
+
+# Define the filter.
+%define __find_requires sh %{_builddir}/%{buildsubdir}/filter-requires.sh
+
 %description
-This package provides the %{kmod_name} kernel modules.
+This package provides the %{kmod_name} kernel module(s).
 It is built to depend upon the specific ABI provided by a range of releases
 of the same variant of the Linux kernel and not on any one specific build.
 
 %prep
 %setup -c -T -a 0
+echo &quot;/usr/lib/rpm/redhat/find-requires | %{__sed} -e '/^ksym.*/d'&quot; &gt;filter-requires.sh
 for kvariant in %{kvariants} ; do
     %{__cp} -a %{kmod_name}-%{version} _kmod_build_$kvariant
 done
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
 %build
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
-    %{__make} -C _kmod_build_$kvariant KVERS=&quot;%{kversion}&quot; KBUILD=&quot;${ksrc}&quot;
+    kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
+    %{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$kpath/driver&quot;
+#    %{__make} -C &quot;$kpath&quot; KVERS=&quot;%{kversion}&quot; KBUILD=&quot;$ksrc&quot;
 done
 
 %install
 %{__rm} -rf %{buildroot}
-
 export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
 export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$kpath/driver&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath/driver&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
-find %{buildroot} -type f -name \*.ko -exec strip --strip-debug \{\} \;
+find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
+
+### Move documentation in place
+for file in AUTHORS ChangeLog INSTALL README; do
+    %{__install} -Dp -m0644 $file %{buildroot}%{_docdir}/kmod-%{kmod_name}-%{version}/$file
+done
 
 %clean
 %{__rm} -rf %{buildroot}

Added: trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec?rev=9345&amp;view=markup">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec?rev=9345&amp;view=markup</A>
==============================================================================
--- trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec (added)
+++ trunk/elrepo/dag/ndiswrapper-kmod/ndiswrapper-kmod-el6.spec Tue Nov 30 00:26:09 2010
@@ -1,0 +1,72 @@
+# $Id$
+# Authority: dag
+
+# Define the kmod package name here.
+%define kmod_name ndiswrapper
+
+# If kversion isn't defined on the rpmbuild line, define it here.
+%{!?kversion:%define kversion 2.6.32-71.el6.%{_target_cpu}}
+
+Summary: %{kmod_name} kernel module(s)
+Name: %{kmod_name}-kmod
+Version: 1.56
+Release: 1%{?dist}
+License: GPL v2
+Group: System Environment/Kernel
+URL: <A HREF="http://ndiswrapper.sourceforge.net/">http://ndiswrapper.sourceforge.net/</A>
+
+# Sources.
+Source0: <A HREF="http://heanet.dl.sourceforge.net/project/ndiswrapper/stable/%{version">http://heanet.dl.sourceforge.net/project/ndiswrapper/stable/%{version</A>}/ndiswrapper-%{version}.tar.gz
+Source10: kmodtool-%{kmod_name}-el6.sh
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-build-%(%{__id_u} -n)
+
+ExclusiveArch: i686 x86_64
+BuildRequires: redhat-rpm-config
+BuildRequires: rpm-build
+
+# Magic hidden here.
+%define kmodtool sh %{SOURCE10}
+%{expand:%(%{kmodtool} rpmtemplate %{kmod_name} %{kversion} &quot;&quot; 2&gt;/dev/null)}
+
+# Disable the building of the debug package(s).
+%define	debug_package %{nil}
+
+%description
+This package provides the %{kmod_name} kernel module(s).
+It is built to depend upon the specific ABI provided by a range of releases
+of the same variant of the Linux kernel and not on any one specific build.
+
+%prep
+%setup -n %{kmod_name}-%{version}
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
+override %{kmod_name} * weak-updates/%{kmod_name}
+EOF
+
+%build
+ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
+%{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$PWD/driver&quot;
+#%{__make} -C &quot;$PWD&quot; KVERS=&quot;%{kversion}&quot; KBUILD=&quot;$ksrc&quot;
+
+%install
+%{__rm} -rf %{buildroot}
+export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
+export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
+ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
+%{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$PWD/driver&quot;
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
+# Strip the module(s).
+find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
+# Remove the files that are not required.
+%{__rm} -f %{buildroot}/lib/modules/%{kversion}/modules.*
+
+### Move documentation in place
+for file in AUTHORS ChangeLog INSTALL README; do
+    %{__install} -Dp -m0644 $file %{buildroot}%{_docdir}/kmod-%{kmod_name}-%{version}/$file
+done
+
+%clean
+%{__rm} -rf %{buildroot}
+
+%changelog
+* Mon Nov 29 2010 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at elrepo.org</A>&gt; - 1.56-1
+- Initial package for RHEL6.

Modified: trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec (original)
+++ trunk/elrepo/dag/ocfs2-kmod/ocfs2-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -57,7 +57,7 @@
     %configure --with-vendor=&quot;rhel5&quot; --with-vendorkernel=&quot;%{kversion}&quot;
     popd
 done
-%{__cat} &lt;&lt;-EOF &gt;_kmod_build_$kvariant/fs/%{kmod_name}.conf
+%{__cat} &lt;&lt;-EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 override %{kmod_name}_nodemanager * weak-updates/%{kmod_name}/cluster
 override %{kmod_name}_dlm * weak-updates/%{kmod_name}/dlm
@@ -68,7 +68,7 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules M=&quot;$kpath/fs&quot;
+    %{__make} -C &quot;$ksrc&quot; modules M=&quot;$kpath/fs&quot;
 done
 
 %install
@@ -78,11 +78,11 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$PWD/fs&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath/fs&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
 # Strip the module(s).
-find %{buildroot} -type f -name \*.ko -exec strip --strip-debug \{\} \;
+find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 
 %clean
 %{__rm} -rf %{buildroot}

Modified: trunk/elrepo/dag/template-kmod-el5.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/template-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/template-kmod-el5.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/template-kmod-el5.spec (original)
+++ trunk/elrepo/dag/template-kmod-el5.spec Tue Nov 30 00:26:09 2010
@@ -58,7 +58,7 @@
 for kvariant in %{kvariants} ; do
     %{__cp} -a %{kmod_name}-%{version} _kmod_build_$kvariant
 done
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
@@ -66,7 +66,7 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$kpath&quot;
+    %{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$kpath&quot;
 done
 
 %install
@@ -76,10 +76,10 @@
 for kvariant in %{kvariants} ; do
     ksrc=&quot;%{_usrsrc}/kernels/%{kversion}${kvariant:+-$kvariant}-%{_target_cpu}&quot;
     kpath=&quot;$PWD/_kmod_build_$kvariant&quot;
-    %{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$kpath&quot;
+    %{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$kpath&quot;
 done
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
-%{__install} -Dp -m0644 %{SOURCE5} %{buildroot}%{_docdir}/%{kmod_name}-%{version}/GPL-v2.0.txt
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
+%{__install} -Dp -m0644 %{SOURCE5} %{buildroot}%{_docdir}/kmod-%{kmod_name}-%{version}/GPL-v2.0.txt
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 

Modified: trunk/elrepo/dag/template-kmod-el6.spec
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/template-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/elrepo/dag/template-kmod-el6.spec?rev=9345&amp;r1=9344&amp;r2=9345&amp;view=diff</A>
==============================================================================
--- trunk/elrepo/dag/template-kmod-el6.spec (original)
+++ trunk/elrepo/dag/template-kmod-el6.spec Tue Nov 30 00:26:09 2010
@@ -39,22 +39,22 @@
 
 %prep
 %setup -n %{kmod_name}-%{version}
-%{__cat} &lt;&lt;EOF &gt;%{kmod_name}.conf
+%{__cat} &lt;&lt;EOF &gt;kmod-%{kmod_name}.conf
 override %{kmod_name} * weak-updates/%{kmod_name}
 EOF
 
 %build
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; %{?_smp_mflags} modules M=&quot;$PWD&quot;
+%{__make} -C &quot;$ksrc&quot; %{?_smp_mflags} modules M=&quot;$PWD&quot;
 
 %install
 %{__rm} -rf %{buildroot}
 export INSTALL_MOD_PATH=&quot;%{buildroot}&quot;
 export INSTALL_MOD_DIR=&quot;extra/%{kmod_name}&quot;
 ksrc=&quot;%{_usrsrc}/kernels/%{kversion}&quot;
-%{__make} -C &quot;${ksrc}&quot; modules_install M=&quot;$PWD&quot;
-%{__install} -Dp -m0644 %{kmod_name}.conf %{buildroot}/etc/depmod.d/%{kmod_name}.conf
-%{__install} -Dp -m0644 %{SOURCE5} %{buildroot}%{_docdir}/%{name}-%{version}/GPL-v2.0.txt
+%{__make} -C &quot;$ksrc&quot; modules_install M=&quot;$PWD&quot;
+%{__install} -Dp -m0644 kmod-%{kmod_name}.conf %{buildroot}/etc/depmod.d/kmod-%{kmod_name}.conf
+%{__install} -Dp -m0644 %{SOURCE5} %{buildroot}%{_docdir}/kmod-%{kmod_name}-%{version}/GPL-v2.0.txt
 # Strip the module(s).
 find %{buildroot} -type f -name \*.ko -exec %{__strip} --strip-debug \{\} \;
 # Remove the files that are not required.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008128.html">[svn] r9344 - in /trunk/elrepo/dag: cciss-kmod/cciss-kmod-el6.spec lin_tape-kmod/lin_tape-kmod-el6.spec
</A></li>
	<LI>Next message: <A HREF="008130.html">[svn] r9346 - in /trunk/elrepo/dag: cciss-kmod/ drbd83-kmod/ ndiswrapper-kmod/ ocfs2-kmod/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8129">[ date ]</a>
              <a href="thread.html#8129">[ thread ]</a>
              <a href="subject.html#8129">[ subject ]</a>
              <a href="author.html#8129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
