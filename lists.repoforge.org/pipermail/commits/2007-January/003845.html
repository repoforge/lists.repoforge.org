<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r5045 - in trunk/rpms: . nvidia-x11-drv nvidia-x11-drv-96xx
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r5045%20-%20in%20trunk/rpms%3A%20.%20nvidia-x11-drv%20nvidia-x11-drv-96xx&In-Reply-To=%3C20070108110409.977B9944A98%40pooch.vmhosting.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003844.html">
   <LINK REL="Next"  HREF="003846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r5045 - in trunk/rpms: . nvidia-x11-drv nvidia-x11-drv-96xx</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r5045%20-%20in%20trunk/rpms%3A%20.%20nvidia-x11-drv%20nvidia-x11-drv-96xx&In-Reply-To=%3C20070108110409.977B9944A98%40pooch.vmhosting.org%3E"
       TITLE="[svn] r5045 - in trunk/rpms: . nvidia-x11-drv nvidia-x11-drv-96xx">packagers at lists.rpmforge.net
       </A><BR>
    <I>Mon Jan  8 12:04:09 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003844.html">[svn] r5044 - in trunk/rpms: . perl-Acme-ProgressBar	perl-Acme-Steganography-Image-Png perl-Algorithm-Cluster	perl-Algorithm-RabinKarp perl-Bio-Trace-ABIF perl-Boost-Graph	perl-CGI-Auth-Auto perl-CGI-GuruMeditation	perl-CGI-Session-Hidden perl-Catalyst-Model-File	perl-Catalyst-Plugin-DBIC-Schema-Profiler	perl-Catalyst-Plugin-I18N-DBIC perl-Catalyst-Plugin-I18N-Request	perl-Class-Accessor-Fast-Contained perl-Class-C3	perl-Class-DBI-Plugin-AccessionSearch	perl-Class-DispatchToAll perl-Class-XML-Parser	perl-Compress-Raw-Bzip2 perl-Compress-Raw-Zlib	perl-Config-Wild perl-Data-Alias perl-Data-Pagination	perl-Data-Phrasebook perl-Data-Phrasebook-Loader-YAML	perl-Date-Holidays-USFederal	perl-DateTime-Calendar-WarwickUniversity	perl-DateTime-Event-WarwickUniversity	perl-DateTime-Util-DayOfWeek-Locale perl-Dir-Split	perl-Encode-RAD50 perl-ExtUtils-FindFunctions perl-FCGI-Async	perl-File-Copy-Reliable perl-File-Find-Rule-VCS	perl-Finance-TW-TSEQuote perl-Font-GlyphNames	perl-Geography-States perl-Graphics-ColorUtils	perl-HTML-Prototype perl-HTML-ResolveLink	perl-IO-Compress-Base perl-IO-Compress-Lzop	perl-IO-Compress-Zlib perl-JavaScript-RPC	perl-Language-Indonesia perl-Lingua-Alphabet-Phonetic	perl-Lingua-StopWords perl-Log-Funlog perl-Logger-Syslog	perl-MIME-Charset perl-MIME-EncWords perl-MP4-Info	perl-Module-Build-Convert perl-Module-Extract	perl-Module-Manifest perl-Module-Math-Depends	perl-Net-Domain-ExpireDate perl-Net-MAC-Vendor perl-Net-SDP	perl-Net-Whois-Raw perl-OODoc perl-Object-Deadly	perl-Object-Signature perl-POE-Component-CPAN-YACSmoke	perl-POE-Component-Client-HTTP perl-POE-Component-Server-DNS	perl-POE-Component-Server-IRC perl-Path-Class-File-Stat	perl-Pod-MultiLang perl-Pod-Perldoc-ToToc perl-Pod-XML	perl-RPM2 perl-Regexp-Common-net-CIDR perl-SQL-Interpolate	perl-Socket-Multicast6 perl-String-Sprintf perl-Sub-ForceEval	perl-Sys-RunAlone perl-Sys-RunAlways perl-Template-Magic	perl-Template-Plugin-NoFollow perl-Test-CheckManifest	perl-Text-Bastardize perl-Text-DHCPparse	perl-Text-MediawikiFormat perl-Text-Same perl-Text-Templet	perl-Time-HiRes-Value perl-WWW-IndexParser	perl-WWW-Shorten-0rz perl-WWW-Wikipedia	perl-WebService-PhotoZou perl-XML-Genx perl-YAML-Tiny
</A></li>
        <LI>Next message: <A HREF="003846.html">[svn] r5046 - trunk/rpms/nvidia-x11-drv-96xx
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3845">[ date ]</a>
              <a href="thread.html#3845">[ thread ]</a>
              <a href="subject.html#3845">[ subject ]</a>
              <a href="author.html#3845">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: thias
Date: 2007-01-08 12:04:07 +0100 (Mon, 08 Jan 2007)
New Revision: 5045

Added:
   trunk/rpms/nvidia-x11-drv-96xx/
   trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch
   trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt
   trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec
Removed:
   trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch
   trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt
   trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec
Modified:
   trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec
Log:
Update NVIDIA driver and fork 96xx legacy driver.


Modified: trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec
===================================================================
--- trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec	2007-01-08 10:23:08 UTC (rev 5044)
+++ trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec	2007-01-08 11:04:07 UTC (rev 5045)
@@ -4,7 +4,7 @@
 # ExclusiveDist: fc6
 
 %define majmin          1.0
-%define relver          9631
+%define relver          9746
 %define nvidialibdir    %{_libdir}/nvidia
 %define nvidialib32dir  %{_prefix}/lib/nvidia
 %define desktop_vendor  rpmforge
@@ -34,7 +34,7 @@
 Patch1: NVIDIA-Linux-1.0-9629-xenrt.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 # Required for proper dkms operation
-Requires: gcc
+Requires: gcc, make
 Requires(post): dkms, /sbin/ldconfig
 Requires(preun): dkms
 # Required by the nvidia-config-display utility/script
@@ -283,6 +283,9 @@
 
 
 %changelog
+* Fri Dec 22 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9746-1
+- Update to 1.0-9746 (stable).
+
 * Mon Dec 11 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9631-1
 - Update to 1.0-9631 (stable).
 

Copied: trunk/rpms/nvidia-x11-drv-96xx (from rev 5002, trunk/rpms/nvidia-x11-drv)

Deleted: trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch
===================================================================
--- trunk/rpms/nvidia-x11-drv/NVIDIA-Linux-1.0-9629-xenrt.patch	2006-12-18 16:35:37 UTC (rev 5002)
+++ trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch	2007-01-08 11:04:07 UTC (rev 5045)
@@ -1,117 +0,0 @@
-diff -urN usr/src/nv/nv.c usr/src/nv-xenrt/nv.c
---- usr/src/nv/nv.c	2006-09-26 21:33:35.000000000 +0200
-+++ usr/src/nv-xenrt/nv.c	2006-10-03 01:15:42.000000000 +0200
-@@ -42,8 +42,26 @@
- 
- int nv_pat_enabled = 0;
- 
-+/*
-+ * disable PAT support if XEN or PREEMPT_RT is configured in kernel
-+ */
-+
-+#if defined(CONFIG_XEN) || defined(CONFIG_PREEMPT_RT)
-+static int nv_disable_pat = 1;
-+#else
- static int nv_disable_pat = 0;
-+#endif
-+
-+/*
-+ * you can re-enable PAT support for PREEMPT_RT when applying
-+ * &quot;nv_disable_pat=0&quot; as kernel parameter for the sake of slightly
-+ * better 3D performance but at the expense of higher latencies.
-+ * if XEN is configured, then PAT support can't be enabled!
-+ */
-+
-+#if !defined(CONFIG_XEN)
- NV_MODULE_PARAMETER(nv_disable_pat);
-+#endif
- 
- #if defined(NVCPU_X86) || defined(NVCPU_X86_64)
- NvU64 __nv_supported_pte_mask = ~_PAGE_NX;
-diff -urN usr/src/nv/nv-linux.h usr/src/nv-xenrt/nv-linux.h
---- usr/src/nv/nv-linux.h	2006-09-26 21:33:37.000000000 +0200
-+++ usr/src/nv-xenrt/nv-linux.h	2006-10-03 01:15:42.000000000 +0200
-@@ -226,7 +226,7 @@
-  * tiny, and the kernel panics when it is exhausted. try to warn the user that
-  * they need to boost the size of their pool.
-  */
--#if defined(CONFIG_SWIOTLB) &amp;&amp; !defined(GFP_DMA32)
-+#if defined(CONFIG_SWIOTLB) &amp;&amp; !defined(GFP_DMA32) &amp;&amp; !defined(CONFIG_XEN)
- #define NV_SWIOTLB 1
- #endif
- 
-@@ -734,7 +734,10 @@
- #define NV_VM_INSERT_PAGE(vma, addr, page) \
-     vm_insert_page(vma, addr, page)
- #endif
--#if defined(NV_REMAP_PFN_RANGE_PRESENT)
-+#if defined(CONFIG_XEN)
-+#define NV_REMAP_PAGE_RANGE(from, offset, x...) \
-+    io_remap_pfn_range(vma, from, ((offset) &gt;&gt; PAGE_SHIFT), x)
-+#elif defined(NV_REMAP_PFN_RANGE_PRESENT)
- #define NV_REMAP_PAGE_RANGE(from, offset, x...) \
-     remap_pfn_range(vma, from, ((offset) &gt;&gt; PAGE_SHIFT), x)
- #elif defined(NV_REMAP_PAGE_RANGE_5_PRESENT)
-@@ -746,6 +749,9 @@
- #define NV_REMAP_PAGE_RANGE(x...) remap_page_range(x)
- #endif
- 
-+#if !defined(CONFIG_XEN)
-+#define phys_to_machine(x) x
-+#endif
- 
- #define NV_PGD_OFFSET(address, kernel, mm)              \
-    ({                                                   \
-diff -urN usr/src/nv/nv-vm.c usr/src/nv-xenrt/nv-vm.c
---- usr/src/nv/nv-vm.c	2006-09-26 21:33:37.000000000 +0200
-+++ usr/src/nv-xenrt/nv-vm.c	2006-10-03 01:24:31.000000000 +0200
-@@ -352,6 +352,9 @@
- 
- static void nv_flush_caches(void)
- {
-+#if defined(CONFIG_PREEMPT_RT)
-+    if(!nv_pat_enabled) return;
-+#endif
- #if defined(KERNEL_2_4)
-     // for 2.4 kernels, just automatically flush the caches and invalidate tlbs
- #ifdef CONFIG_SMP
-@@ -508,7 +511,7 @@
-         page_ptr-&gt;phys_addr = phys_addr;
-         page_ptr-&gt;page_count = NV_GET_PAGE_COUNT(page_ptr);
-         page_ptr-&gt;virt_addr = virt_addr;
--        page_ptr-&gt;dma_addr = page_ptr-&gt;phys_addr;
-+        page_ptr-&gt;dma_addr = phys_to_machine(page_ptr-&gt;phys_addr);
- 
-         /* lock the page for dma purposes */
-         nv_lock_page(page_ptr);
-diff -urN usr/src/nv/os-agp.c usr/src/nv-xenrt/os-agp.c
---- usr/src/nv/os-agp.c	2006-09-26 21:33:37.000000000 +0200
-+++ usr/src/nv-xenrt/os-agp.c	2006-10-03 01:15:42.000000000 +0200
-@@ -286,7 +286,7 @@
- 
-          page_ptr-&gt;phys_addr = (ptr-&gt;memory[i] &amp; PAGE_MASK);
-          page_ptr-&gt;virt_addr = (unsigned long) __va(page_ptr-&gt;phys_addr);
--         page_ptr-&gt;dma_addr  = page_ptr-&gt;phys_addr;
-+         page_ptr-&gt;dma_addr  = phys_to_machine(page_ptr-&gt;phys_addr);
-     }
- 
-     return RM_OK;
-diff -urN usr/src/nv/os-interface.c usr/src/nv-xenrt/os-interface.c
---- usr/src/nv/os-interface.c	2006-09-26 21:33:37.000000000 +0200
-+++ usr/src/nv-xenrt/os-interface.c	2006-10-03 01:15:42.000000000 +0200
-@@ -527,6 +527,7 @@
-     MicroSeconds = MilliSeconds * 1000;
-     tm_end.tv_usec = MicroSeconds;
-     tm_end.tv_sec = 0;
-+#if !defined(CONFIG_XEN)
-     NV_TIMERADD(&amp;tm_aux, &amp;tm_end, &amp;tm_end);
- 
-     /* do we have a full jiffie to wait? */
-@@ -564,6 +565,7 @@
-                 MicroSeconds = 0;
-         } while ((jiffies = NV_USECS_TO_JIFFIES(MicroSeconds)) != 0);
-     }
-+#endif
- 
-     if (MicroSeconds &gt; 1000)
-     {

Copied: trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch (from rev 5018, trunk/rpms/nvidia-x11-drv/NVIDIA-Linux-1.0-9629-xenrt.patch)
===================================================================
--- trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch	                        (rev 0)
+++ trunk/rpms/nvidia-x11-drv-96xx/NVIDIA-Linux-1.0-9629-xenrt.patch	2007-01-08 11:04:07 UTC (rev 5045)
@@ -0,0 +1,117 @@
+diff -urN usr/src/nv/nv.c usr/src/nv-xenrt/nv.c
+--- usr/src/nv/nv.c	2006-09-26 21:33:35.000000000 +0200
++++ usr/src/nv-xenrt/nv.c	2006-10-03 01:15:42.000000000 +0200
+@@ -42,8 +42,26 @@
+ 
+ int nv_pat_enabled = 0;
+ 
++/*
++ * disable PAT support if XEN or PREEMPT_RT is configured in kernel
++ */
++
++#if defined(CONFIG_XEN) || defined(CONFIG_PREEMPT_RT)
++static int nv_disable_pat = 1;
++#else
+ static int nv_disable_pat = 0;
++#endif
++
++/*
++ * you can re-enable PAT support for PREEMPT_RT when applying
++ * &quot;nv_disable_pat=0&quot; as kernel parameter for the sake of slightly
++ * better 3D performance but at the expense of higher latencies.
++ * if XEN is configured, then PAT support can't be enabled!
++ */
++
++#if !defined(CONFIG_XEN)
+ NV_MODULE_PARAMETER(nv_disable_pat);
++#endif
+ 
+ #if defined(NVCPU_X86) || defined(NVCPU_X86_64)
+ NvU64 __nv_supported_pte_mask = ~_PAGE_NX;
+diff -urN usr/src/nv/nv-linux.h usr/src/nv-xenrt/nv-linux.h
+--- usr/src/nv/nv-linux.h	2006-09-26 21:33:37.000000000 +0200
++++ usr/src/nv-xenrt/nv-linux.h	2006-10-03 01:15:42.000000000 +0200
+@@ -226,7 +226,7 @@
+  * tiny, and the kernel panics when it is exhausted. try to warn the user that
+  * they need to boost the size of their pool.
+  */
+-#if defined(CONFIG_SWIOTLB) &amp;&amp; !defined(GFP_DMA32)
++#if defined(CONFIG_SWIOTLB) &amp;&amp; !defined(GFP_DMA32) &amp;&amp; !defined(CONFIG_XEN)
+ #define NV_SWIOTLB 1
+ #endif
+ 
+@@ -734,7 +734,10 @@
+ #define NV_VM_INSERT_PAGE(vma, addr, page) \
+     vm_insert_page(vma, addr, page)
+ #endif
+-#if defined(NV_REMAP_PFN_RANGE_PRESENT)
++#if defined(CONFIG_XEN)
++#define NV_REMAP_PAGE_RANGE(from, offset, x...) \
++    io_remap_pfn_range(vma, from, ((offset) &gt;&gt; PAGE_SHIFT), x)
++#elif defined(NV_REMAP_PFN_RANGE_PRESENT)
+ #define NV_REMAP_PAGE_RANGE(from, offset, x...) \
+     remap_pfn_range(vma, from, ((offset) &gt;&gt; PAGE_SHIFT), x)
+ #elif defined(NV_REMAP_PAGE_RANGE_5_PRESENT)
+@@ -746,6 +749,9 @@
+ #define NV_REMAP_PAGE_RANGE(x...) remap_page_range(x)
+ #endif
+ 
++#if !defined(CONFIG_XEN)
++#define phys_to_machine(x) x
++#endif
+ 
+ #define NV_PGD_OFFSET(address, kernel, mm)              \
+    ({                                                   \
+diff -urN usr/src/nv/nv-vm.c usr/src/nv-xenrt/nv-vm.c
+--- usr/src/nv/nv-vm.c	2006-09-26 21:33:37.000000000 +0200
++++ usr/src/nv-xenrt/nv-vm.c	2006-10-03 01:24:31.000000000 +0200
+@@ -352,6 +352,9 @@
+ 
+ static void nv_flush_caches(void)
+ {
++#if defined(CONFIG_PREEMPT_RT)
++    if(!nv_pat_enabled) return;
++#endif
+ #if defined(KERNEL_2_4)
+     // for 2.4 kernels, just automatically flush the caches and invalidate tlbs
+ #ifdef CONFIG_SMP
+@@ -508,7 +511,7 @@
+         page_ptr-&gt;phys_addr = phys_addr;
+         page_ptr-&gt;page_count = NV_GET_PAGE_COUNT(page_ptr);
+         page_ptr-&gt;virt_addr = virt_addr;
+-        page_ptr-&gt;dma_addr = page_ptr-&gt;phys_addr;
++        page_ptr-&gt;dma_addr = phys_to_machine(page_ptr-&gt;phys_addr);
+ 
+         /* lock the page for dma purposes */
+         nv_lock_page(page_ptr);
+diff -urN usr/src/nv/os-agp.c usr/src/nv-xenrt/os-agp.c
+--- usr/src/nv/os-agp.c	2006-09-26 21:33:37.000000000 +0200
++++ usr/src/nv-xenrt/os-agp.c	2006-10-03 01:15:42.000000000 +0200
+@@ -286,7 +286,7 @@
+ 
+          page_ptr-&gt;phys_addr = (ptr-&gt;memory[i] &amp; PAGE_MASK);
+          page_ptr-&gt;virt_addr = (unsigned long) __va(page_ptr-&gt;phys_addr);
+-         page_ptr-&gt;dma_addr  = page_ptr-&gt;phys_addr;
++         page_ptr-&gt;dma_addr  = phys_to_machine(page_ptr-&gt;phys_addr);
+     }
+ 
+     return RM_OK;
+diff -urN usr/src/nv/os-interface.c usr/src/nv-xenrt/os-interface.c
+--- usr/src/nv/os-interface.c	2006-09-26 21:33:37.000000000 +0200
++++ usr/src/nv-xenrt/os-interface.c	2006-10-03 01:15:42.000000000 +0200
+@@ -527,6 +527,7 @@
+     MicroSeconds = MilliSeconds * 1000;
+     tm_end.tv_usec = MicroSeconds;
+     tm_end.tv_sec = 0;
++#if !defined(CONFIG_XEN)
+     NV_TIMERADD(&amp;tm_aux, &amp;tm_end, &amp;tm_end);
+ 
+     /* do we have a full jiffie to wait? */
+@@ -564,6 +565,7 @@
+                 MicroSeconds = 0;
+         } while ((jiffies = NV_USECS_TO_JIFFIES(MicroSeconds)) != 0);
+     }
++#endif
+ 
+     if (MicroSeconds &gt; 1000)
+     {

Deleted: trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt
===================================================================
--- trunk/rpms/nvidia-x11-drv/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt	2006-12-18 16:35:37 UTC (rev 5002)
+++ trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt	2007-01-08 11:04:07 UTC (rev 5045)
@@ -1,16 +0,0 @@
-diff -ru usr/src/nv/nv-i2c.c usr/src/nv.NOSMBUS/nv-i2c.c
---- usr/src/nv/nv-i2c.c	2006-09-15 01:10:17.000000000 +0200
-+++ usr/src/nv.NOSMBUS/nv-i2c.c	2006-09-22 21:56:17.259789750 +0200
-@@ -138,11 +138,7 @@
- 
- static u32 nv_i2c_algo_functionality(struct i2c_adapter *adap)
- {
--    return (I2C_FUNC_I2C |
--            I2C_FUNC_SMBUS_QUICK |
--            I2C_FUNC_SMBUS_BYTE |
--            I2C_FUNC_SMBUS_BYTE_DATA |
--            I2C_FUNC_SMBUS_WORD_DATA);
-+    return I2C_FUNC_I2C;
- }
- 
- static struct i2c_algorithm nv_i2c_algo = {

Copied: trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt (from rev 5018, trunk/rpms/nvidia-x11-drv/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt)
===================================================================
--- trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt	                        (rev 0)
+++ trunk/rpms/nvidia-x11-drv-96xx/NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt	2007-01-08 11:04:07 UTC (rev 5045)
@@ -0,0 +1,16 @@
+diff -ru usr/src/nv/nv-i2c.c usr/src/nv.NOSMBUS/nv-i2c.c
+--- usr/src/nv/nv-i2c.c	2006-09-15 01:10:17.000000000 +0200
++++ usr/src/nv.NOSMBUS/nv-i2c.c	2006-09-22 21:56:17.259789750 +0200
+@@ -138,11 +138,7 @@
+ 
+ static u32 nv_i2c_algo_functionality(struct i2c_adapter *adap)
+ {
+-    return (I2C_FUNC_I2C |
+-            I2C_FUNC_SMBUS_QUICK |
+-            I2C_FUNC_SMBUS_BYTE |
+-            I2C_FUNC_SMBUS_BYTE_DATA |
+-            I2C_FUNC_SMBUS_WORD_DATA);
++    return I2C_FUNC_I2C;
+ }
+ 
+ static struct i2c_algorithm nv_i2c_algo = {

Deleted: trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec
===================================================================
--- trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec	2006-12-18 16:35:37 UTC (rev 5002)
+++ trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec	2007-01-08 11:04:07 UTC (rev 5045)
@@ -1,352 +0,0 @@
-# $Id$
-# Authority: matthias
-# Dist: nodist
-# ExclusiveDist: fc6
-
-%define majmin          1.0
-%define relver          9631
-%define nvidialibdir    %{_libdir}/nvidia
-%define nvidialib32dir  %{_prefix}/lib/nvidia
-%define desktop_vendor  rpmforge
-
-#define beta .beta
-
-%define debug_package   %{nil}
-
-Summary: Proprietary NVIDIA hardware accelerated OpenGL display driver
-Name: nvidia-x11-drv
-Version: %{majmin}.%{relver}
-Release: 1%{?beta}
-License: Proprietary
-Group: User Interface/X Hardware Support
-URL: <A HREF="http://www.nvidia.com/object/unix.html">http://www.nvidia.com/object/unix.html</A>
-# i386
-Source0: <A HREF="http://download.nvidia.com/XFree86/Linux-x86/%{majmin">http://download.nvidia.com/XFree86/Linux-x86/%{majmin</A>}-%{relver}/NVIDIA-Linux-x86-%{majmin}-%{relver}-pkg0.run
-# x86_64
-Source1: <A HREF="http://download.nvidia.com/XFree86/Linux-x86_64/%{majmin">http://download.nvidia.com/XFree86/Linux-x86_64/%{majmin</A>}-%{relver}/NVIDIA-Linux-x86_64-%{majmin}-%{relver}-pkg2.run
-Source2: nvidia.sh
-Source3: nvidia.csh
-Source4: nvidia-config-display
-Source5: nvidia.modprobe
-# <A HREF="http://www.nvnews.net/vbulletin/attachment.php?attachmentid=20486&amp;d=1158955681">http://www.nvnews.net/vbulletin/attachment.php?attachmentid=20486&amp;d=1158955681</A>
-Patch0: NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt
-# <A HREF="http://www.nvnews.net/vbulletin/showthread.php?t=77597">http://www.nvnews.net/vbulletin/showthread.php?t=77597</A>
-Patch1: NVIDIA-Linux-1.0-9629-xenrt.patch
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-# Required for proper dkms operation
-Requires: gcc
-Requires(post): dkms, /sbin/ldconfig
-Requires(preun): dkms
-# Required by the nvidia-config-display utility/script
-Requires: pyxf86config
-# Required by the NVIDIA run file
-Buildrequires: tar
-# Required for our build
-BuildRequires: desktop-file-utils
-ExclusiveArch: i386 x86_64
-Provides: dkms-nvidia = %{version}-%{release}
-Conflicts: xorg-x11-drv-nvidia
-
-%description
-Proprietary NVIDIA GL libraries, Xorg and Linux module for hardware
-accelerated OpenGL support.
-
-INSTALLING THIS PACKAGE WILL TAINT YOUR KERNEL, SO PLEASE DO NOT REPORT *ANY*
-BUGS BEFORE YOU UNINSTALL THE PACKAGE AND REBOOT THE SYSTEM.
-
-
-%prep
-%setup -T -c
-# Extract the proper &quot;sources&quot; for the current architecture
-# We need to extract to a &quot;not yet existing&quot; directory first, so no &quot;.&quot;
-%ifarch i386
-sh %{SOURCE0} --extract-only --target tmp/
-%endif
-%ifarch x86_64
-sh %{SOURCE1} --extract-only --target tmp/
-%endif
-# Move all the files back from tmp/ to the main directory
-%{__mv} tmp/* .
-%{__rm} -rf tmp/
-%patch0 -p0
-%patch1 -p0
-
-
-%build
-
-
-%install
-%{__rm} -rf %{buildroot}
-
-# Fix for FC6 kernels
-%{__perl} -pi -e 's|#include &lt;linux/config.h&gt;||g' usr/src/nv/nv-linux.h
-
-%define dkms_name nvidia
-%define dkms_vers %{version}-%{release}
-%define quiet -q
-
-# Copy dkms conf file
-%{__mkdir_p} %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
-%{__cat} &gt; %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/dkms.conf &lt;&lt; 'EOF'
-PACKAGE_NAME=%{dkms_name}
-PACKAGE_VERSION=%{dkms_vers}
-MAKE[0]=&quot;make module KERNDIR=/lib/modules/$kernelver IGNORE_CC_MISMATCH=1 SYSSRC=$kernel_source_dir&quot;
-BUILT_MODULE_NAME[0]=nvidia
-DEST_MODULE_LOCATION[0]=/kernel/drivers/video/nvidia
-AUTOINSTALL=YES
-EOF
-
-# Install all the files, even the binary ones. Ick.
-%{__install} -p -m 0644 usr/src/nv/{*.c,*.h,*.o,makefile,Makefile.kbuild} \
-    %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
-%{__install} -p -m 0755 usr/src/nv/*.sh \
-    %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
-
-# Install libXvMCNVIDIA.*
-%{__mkdir_p} %{buildroot}%{nvidialibdir}/
-%{__install} -p -m 0755 usr/X11R6/lib/libXvMCNVIDIA.so.* \
-    %{buildroot}%{nvidialibdir}/
-%{__install} -p -m 0644 usr/X11R6/lib/libXvMCNVIDIA.a \
-    %{buildroot}%{nvidialibdir}/
-
-# Install X driver and extension (is the nvidia_drv.o useful?)
-%{__mkdir_p} %{buildroot}%{_libdir}/xorg/modules/drivers/
-%{__install} -p -m 0755 usr/X11R6/lib/modules/drivers/nvidia_drv.so \
-    %{buildroot}%{_libdir}/xorg/modules/drivers/
-%{__mkdir_p} %{buildroot}%{_libdir}/xorg/modules/extensions/nvidia/
-%{__install} -p -m 0755 usr/X11R6/lib/modules/extensions/libglx.so.%{version} \
-    %{buildroot}%{_libdir}/xorg/modules/extensions/nvidia/libglx.so
-
-# Install GL and tls libs
-%{__mkdir_p} %{buildroot}%{nvidialibdir}/tls/
-%{__install} -p -m 0755 usr/lib/*.so.%{version} \
-    %{buildroot}%{nvidialibdir}/
-%{__install} -p -m 0755 usr/lib/tls/*.so.%{version} \
-    %{buildroot}%{nvidialibdir}/tls/
-
-%ifarch x86_64
-# Install 32bit compat GL and tls libs
-%{__mkdir_p} %{buildroot}%{nvidialib32dir}/tls/
-%{__install} -p -m 0755 usr/lib32/*.so.%{version} \
-    %{buildroot}%{nvidialib32dir}/
-%{__install} -p -m 0755 usr/lib32/tls/*.so.%{version} \
-    %{buildroot}%{nvidialib32dir}/tls/
-%endif
-
-# Create .so symlinks
-for libname in libGLcore libGL libnvidia-cfg libnvidia-tls tls/libnvidia-tls; do
-    %{__ln_s} `basename ${libname}`.so.%{version} \
-        %{buildroot}%{nvidialibdir}/${libname}.so.1
-    %{__ln_s} `basename ${libname}`.so.%{version} \
-        %{buildroot}%{nvidialibdir}/${libname}.so
-done
-%ifarch x86_64
-for libname in libGLcore libGL libnvidia-cfg libnvidia-tls tls/libnvidia-tls; do
-    %{__ln_s} `basename ${libname}`.so.%{version} \
-        %{buildroot}%{nvidialib32dir}/${libname}.so.1
-    %{__ln_s} `basename ${libname}`.so.%{version} \
-        %{buildroot}%{nvidialib32dir}/${libname}.so
-done
-%endif
-
-# Install useful nvidia tools
-%{__mkdir_p} %{buildroot}%{_bindir}/
-%{__install} -p -m 0755 usr/bin/{nvidia-bug-report.sh,nvidia-settings} \
-    %{buildroot}%{_bindir}/
-%{__mkdir_p} %{buildroot}%{_sbindir}/
-%{__install} -p -m 0755 usr/bin/nvidia-xconfig \
-    %{buildroot}%{_sbindir}/
-
-# Install man pages (the other, nvidia-installer, isn't relevant)
-%{__mkdir_p} %{buildroot}%{_mandir}/man1/
-%{__install} -p -m 0644 usr/share/man/man1/nvidia-{settings,xconfig}* \
-    %{buildroot}%{_mandir}/man1/
-
-# Install pixmap for the desktop entry
-%{__mkdir_p} %{buildroot}%{_datadir}/pixmaps/
-%{__install} -p -m 0644 usr/share/pixmaps/nvidia-settings.png \
-    %{buildroot}%{_datadir}/pixmaps/
-
-# Remove &quot;__UTILS_PATH__/&quot; before the Exec command name
-# Replace &quot;__PIXMAP_PATH__/&quot; with the proper pixmaps path
-%{__perl} -pi -e 's|(Exec=).*/(.*)|$1$2|g;
-                  s|(Icon=).*/(.*)|$1%{_datadir}/pixmaps/$2|g' \
-    usr/share/applications/nvidia-settings.desktop
-
-# Desktop entry for nvidia-settings
-%{__mkdir_p} %{buildroot}%{_datadir}/applications/
-desktop-file-install --vendor %{desktop_vendor} \
-    --dir %{buildroot}/%{_datadir}/applications/ \
-    --add-category System \
-    --add-category Application \
-    --add-category GNOME \
-    usr/share/applications/nvidia-settings.desktop
-
-# Install modprobe.d file
-%{__install} -D -p -m 0644 %{SOURCE5} \
-    %{buildroot}%{_sysconfdir}/modprobe.d/nvidia
-
-# Install ld.so.conf.d file
-%{__mkdir_p} %{buildroot}%{_sysconfdir}/ld.so.conf.d/
-echo %{nvidialibdir} &gt;    %{buildroot}%{_sysconfdir}/ld.so.conf.d/nvidia.conf
-%ifarch x86_64
-echo %{nvidialib32dir} &gt;&gt; %{buildroot}%{_sysconfdir}/ld.so.conf.d/nvidia.conf
-%endif
-
-# Install profile.d files
-%{__install} -D -p -m 0755 %{SOURCE2} \
-    %{buildroot}%{_sysconfdir}/profile.d/nvidia.sh
-%{__install} -D -p -m 0755 %{SOURCE3} \
-    %{buildroot}%{_sysconfdir}/profile.d/nvidia.csh
-
-# Install X configuration script
-%{__install} -D -p -m 0755 %{SOURCE4} \
-    %{buildroot}%{_sbindir}/nvidia-config-display
-
-
-%clean
-%{__rm} -rf %{buildroot}
-
-
-%post
-/sbin/ldconfig
-# Make sure we have a Files section in xorg.conf, otherwise create an empty one
-XORGCONF=/etc/X11/xorg.conf
-[ -w ${XORGCONF} ] &amp;&amp; ! grep -q 'Section &quot;Files&quot;' ${XORGCONF} &amp;&amp; \
-    echo -e 'Section &quot;Files&quot;\nEndSection' &gt;&gt; ${XORGCONF}
-# Enable the proprietary driver
-%{_sbindir}/nvidia-config-display enable || :
-# Add to DKMS registry
-dkms add -m %{dkms_name} -v %{dkms_vers} %{?quiet} || :
-# Rebuild and make available for the currenty running kernel
-dkms build -m %{dkms_name} -v %{dkms_vers} %{?quiet} || :
-dkms install -m %{dkms_name} -v %{dkms_vers} %{?quiet} --force || :
-
-%preun
-# Remove all versions from DKMS registry
-dkms remove -m %{dkms_name} -v %{dkms_vers} %{?quiet} --all || :
-# Last removal, disable the proprietary driver
-if [ $1 -eq 0 ]; then
-    %{_sbindir}/nvidia-config-display disable || :
-fi
-
-%postun -p /sbin/ldconfig
-
-
-%files
-%defattr(-,root,root,0755)
-%doc LICENSE usr/share/doc/*
-# Kernel and dkms related bits
-%config %{_sysconfdir}/modprobe.d/nvidia
-%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
-# Devices for udev to copy directly
-%attr(0600,root,root) %dev(c,195,0) %{_sysconfdir}/udev/devices/nvidia0
-%attr(0600,root,root) %dev(c,195,1) %{_sysconfdir}/udev/devices/nvidia1
-%attr(0600,root,root) %dev(c,195,2) %{_sysconfdir}/udev/devices/nvidia2
-%attr(0600,root,root) %dev(c,195,3) %{_sysconfdir}/udev/devices/nvidia3
-%attr(0600,root,root) %dev(c,195,4) %{_sysconfdir}/udev/devices/nvidia4
-%attr(0600,root,root) %dev(c,195,5) %{_sysconfdir}/udev/devices/nvidia5
-%attr(0600,root,root) %dev(c,195,6) %{_sysconfdir}/udev/devices/nvidia6
-%attr(0600,root,root) %dev(c,195,7) %{_sysconfdir}/udev/devices/nvidia7
-%attr(0600,root,root) %dev(c,195,8) %{_sysconfdir}/udev/devices/nvidia8
-%attr(0600,root,root) %dev(c,195,9) %{_sysconfdir}/udev/devices/nvidia9
-%attr(0600,root,root) %dev(c,195,255) %{_sysconfdir}/udev/devices/nvidiactl
-# Libraries and X modules
-%config %{_sysconfdir}/ld.so.conf.d/nvidia.conf
-%dir %{nvidialibdir}/
-%{nvidialibdir}/*.so.*
-%{nvidialibdir}/tls/
-%ifarch x86_64
-%dir %{nvidialib32dir}/
-%{nvidialib32dir}/*.so.*
-%{nvidialib32dir}/tls/
-%endif
-%{_libdir}/xorg/modules/drivers/nvidia_drv.so
-%dir %{_libdir}/xorg/modules/extensions/nvidia/
-%{_libdir}/xorg/modules/extensions/nvidia/libglx.so
-# Tools and utilities
-%{_sysconfdir}/profile.d/*
-%{_bindir}/*
-%{_sbindir}/*
-%{_datadir}/applications/*
-%{_datadir}/pixmaps/*
-%{_mandir}/man1/*
-
-# Not needed devel but would violate the license not to include them
-#files devel
-#defattr(-,root,root,0755)
-%{nvidialibdir}/*.a
-%{nvidialibdir}/*.so
-%ifarch x86_64
-%{nvidialib32dir}/*.so
-%endif
-
-
-%changelog
-* Mon Dec 11 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9631-1
-- Update to 1.0-9631 (stable).
-
-* Thu Nov 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9742-1.beta
-- Update to the latest 1.0-9742 beta driver.
-
-* Thu Nov 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-3
-- Use the pkg0 file for i386 since it's the same as the pkg1 but without all
-  of the precompiled kernel modules we don't use anyway. We save 6MB+ of SRPM.
-- For x86_64 there are no precompiled modules (ATM) so pkg0 and pkg1 are the
-  same, but pkg2 has the lib32 files in addition, so it makes sense to use
-  pkg2 there.
-
-* Thu Nov 16 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-2
-- Include Xen patch and spec fixes from Juliano F. Ravasi.
-
-* Wed Nov  8 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-1
-- Update to 1.0-9629.
-
-* Tue Oct 31 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-4
-- Include patch to fix black X screen on startup (disables i2c, though).
-
-* Mon Oct 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-3
-- 32bit libs weren't being included on x86_64, the 64bits were twice instead.
-
-* Tue Oct 24 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-2
-- Include nvidia-xconfig, Edward Rudd.
-- Move extracting the installer to the %%prep stage, Edward Rudd.
-- No longer do everything from the pkg/ directory.
-
-* Mon Oct 16 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-1
-- Update to 1.0-9626.
-
-* Wed Oct 11 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9625-2
-- Fix desktop entry.
-- Remove static dev entries, let udev take care of copying them to /dev.
-- Small fix to the driver file mode and remove the created empty directory.
-- Add %%{nvidialib32dir} to the ld.so.conf.d file on x86_64.
-- Make sure we have a Files section in xorg.conf, otherwise create an empty
-  one for the nvidia-config-display utility/script to work properly.
-- Run the nvidia-config-display utility/script in %%post.
-
-* Tue Oct 10 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9625-1
-- Update to the 1.0-9625 beta drivers.
-
-* Tue Oct 10 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-3
-- Add the rpm release to the dkms module version, to make updating the module
-  to a fixed same version work (--rpm_safe_upgrade doesn't work as advertised).
-- Force modules install so that the same version can be overwritten instead of
-  uninstalled by the old package's %%preun when updating.
-- Add build time quiet flag for the scriplets. Undefine to do verbose testing.
-
-* Mon Oct  9 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-2.1
-- Add dkms-nvidia provides.
-- Use %%{dkms_name} macro for the usr/src directory name.
-
-* Sat Oct  7 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-2
-- Include both x86 and x86_64 pkg.run files in the source rpm, so that the
-  same can be used for both i386 and x86_64.
-
-* Wed Oct  4 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-1
-- Add x86_64 support.
-- Rework into a single nvidia-x11-drv package.
-
-* Mon Oct 02 2006 Richard Hughes &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">richard at hughsie.com</A>&gt; 8774-4
-- 1st Release, First public build
-

Copied: trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec (from rev 5044, trunk/rpms/nvidia-x11-drv/nvidia-x11-drv.spec)
===================================================================
--- trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec	                        (rev 0)
+++ trunk/rpms/nvidia-x11-drv-96xx/nvidia-x11-drv.spec	2007-01-08 11:04:07 UTC (rev 5045)
@@ -0,0 +1,355 @@
+# $Id$
+# Authority: matthias
+# Dist: nodist
+# ExclusiveDist: fc6
+
+%define majmin          1.0
+%define relver          9631
+%define nvidialibdir    %{_libdir}/nvidia
+%define nvidialib32dir  %{_prefix}/lib/nvidia
+%define desktop_vendor  rpmforge
+
+#define beta .beta
+
+%define debug_package   %{nil}
+
+Summary: Proprietary NVIDIA hardware accelerated OpenGL display driver
+Name: nvidia-x11-drv-96xx
+Version: %{majmin}.%{relver}
+Release: 1%{?beta}
+License: Proprietary
+Group: User Interface/X Hardware Support
+URL: <A HREF="http://www.nvidia.com/object/unix.html">http://www.nvidia.com/object/unix.html</A>
+# i386
+Source0: <A HREF="http://download.nvidia.com/XFree86/Linux-x86/%{majmin">http://download.nvidia.com/XFree86/Linux-x86/%{majmin</A>}-%{relver}/NVIDIA-Linux-x86-%{majmin}-%{relver}-pkg0.run
+# x86_64
+Source1: <A HREF="http://download.nvidia.com/XFree86/Linux-x86_64/%{majmin">http://download.nvidia.com/XFree86/Linux-x86_64/%{majmin</A>}-%{relver}/NVIDIA-Linux-x86_64-%{majmin}-%{relver}-pkg2.run
+Source2: nvidia.sh
+Source3: nvidia.csh
+Source4: nvidia-config-display
+Source5: nvidia.modprobe
+# <A HREF="http://www.nvnews.net/vbulletin/attachment.php?attachmentid=20486&amp;d=1158955681">http://www.nvnews.net/vbulletin/attachment.php?attachmentid=20486&amp;d=1158955681</A>
+Patch0: NVIDIA_kernel-1.0-9625-NOSMBUS.diff.txt
+# <A HREF="http://www.nvnews.net/vbulletin/showthread.php?t=77597">http://www.nvnews.net/vbulletin/showthread.php?t=77597</A>
+Patch1: NVIDIA-Linux-1.0-9629-xenrt.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+# Required for proper dkms operation
+Requires: gcc, make
+Requires(post): dkms, /sbin/ldconfig
+Requires(preun): dkms
+# Required by the nvidia-config-display utility/script
+Requires: pyxf86config
+# Required by the NVIDIA run file
+Buildrequires: tar
+# Required for our build
+BuildRequires: desktop-file-utils
+ExclusiveArch: i386 x86_64
+Provides: dkms-nvidia = %{version}-%{release}
+Conflicts: xorg-x11-drv-nvidia
+
+%description
+Proprietary NVIDIA GL libraries, Xorg and Linux module for hardware
+accelerated OpenGL support.
+
+INSTALLING THIS PACKAGE WILL TAINT YOUR KERNEL, SO PLEASE DO NOT REPORT *ANY*
+BUGS BEFORE YOU UNINSTALL THE PACKAGE AND REBOOT THE SYSTEM.
+
+
+%prep
+%setup -T -c
+# Extract the proper &quot;sources&quot; for the current architecture
+# We need to extract to a &quot;not yet existing&quot; directory first, so no &quot;.&quot;
+%ifarch i386
+sh %{SOURCE0} --extract-only --target tmp/
+%endif
+%ifarch x86_64
+sh %{SOURCE1} --extract-only --target tmp/
+%endif
+# Move all the files back from tmp/ to the main directory
+%{__mv} tmp/* .
+%{__rm} -rf tmp/
+%patch0 -p0
+%patch1 -p0
+
+
+%build
+
+
+%install
+%{__rm} -rf %{buildroot}
+
+# Fix for FC6 kernels
+%{__perl} -pi -e 's|#include &lt;linux/config.h&gt;||g' usr/src/nv/nv-linux.h
+
+%define dkms_name nvidia
+%define dkms_vers %{version}-%{release}
+%define quiet -q
+
+# Copy dkms conf file
+%{__mkdir_p} %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
+%{__cat} &gt; %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/dkms.conf &lt;&lt; 'EOF'
+PACKAGE_NAME=%{dkms_name}
+PACKAGE_VERSION=%{dkms_vers}
+MAKE[0]=&quot;make module KERNDIR=/lib/modules/$kernelver IGNORE_CC_MISMATCH=1 SYSSRC=$kernel_source_dir&quot;
+BUILT_MODULE_NAME[0]=nvidia
+DEST_MODULE_LOCATION[0]=/kernel/drivers/video/nvidia
+AUTOINSTALL=YES
+EOF
+
+# Install all the files, even the binary ones. Ick.
+%{__install} -p -m 0644 usr/src/nv/{*.c,*.h,*.o,makefile,Makefile.kbuild} \
+    %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
+%{__install} -p -m 0755 usr/src/nv/*.sh \
+    %{buildroot}%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
+
+# Install libXvMCNVIDIA.*
+%{__mkdir_p} %{buildroot}%{nvidialibdir}/
+%{__install} -p -m 0755 usr/X11R6/lib/libXvMCNVIDIA.so.* \
+    %{buildroot}%{nvidialibdir}/
+%{__install} -p -m 0644 usr/X11R6/lib/libXvMCNVIDIA.a \
+    %{buildroot}%{nvidialibdir}/
+
+# Install X driver and extension (is the nvidia_drv.o useful?)
+%{__mkdir_p} %{buildroot}%{_libdir}/xorg/modules/drivers/
+%{__install} -p -m 0755 usr/X11R6/lib/modules/drivers/nvidia_drv.so \
+    %{buildroot}%{_libdir}/xorg/modules/drivers/
+%{__mkdir_p} %{buildroot}%{_libdir}/xorg/modules/extensions/nvidia/
+%{__install} -p -m 0755 usr/X11R6/lib/modules/extensions/libglx.so.%{version} \
+    %{buildroot}%{_libdir}/xorg/modules/extensions/nvidia/libglx.so
+
+# Install GL and tls libs
+%{__mkdir_p} %{buildroot}%{nvidialibdir}/tls/
+%{__install} -p -m 0755 usr/lib/*.so.%{version} \
+    %{buildroot}%{nvidialibdir}/
+%{__install} -p -m 0755 usr/lib/tls/*.so.%{version} \
+    %{buildroot}%{nvidialibdir}/tls/
+
+%ifarch x86_64
+# Install 32bit compat GL and tls libs
+%{__mkdir_p} %{buildroot}%{nvidialib32dir}/tls/
+%{__install} -p -m 0755 usr/lib32/*.so.%{version} \
+    %{buildroot}%{nvidialib32dir}/
+%{__install} -p -m 0755 usr/lib32/tls/*.so.%{version} \
+    %{buildroot}%{nvidialib32dir}/tls/
+%endif
+
+# Create .so symlinks
+for libname in libGLcore libGL libnvidia-cfg libnvidia-tls tls/libnvidia-tls; do
+    %{__ln_s} `basename ${libname}`.so.%{version} \
+        %{buildroot}%{nvidialibdir}/${libname}.so.1
+    %{__ln_s} `basename ${libname}`.so.%{version} \
+        %{buildroot}%{nvidialibdir}/${libname}.so
+done
+%ifarch x86_64
+for libname in libGLcore libGL libnvidia-cfg libnvidia-tls tls/libnvidia-tls; do
+    %{__ln_s} `basename ${libname}`.so.%{version} \
+        %{buildroot}%{nvidialib32dir}/${libname}.so.1
+    %{__ln_s} `basename ${libname}`.so.%{version} \
+        %{buildroot}%{nvidialib32dir}/${libname}.so
+done
+%endif
+
+# Install useful nvidia tools
+%{__mkdir_p} %{buildroot}%{_bindir}/
+%{__install} -p -m 0755 usr/bin/{nvidia-bug-report.sh,nvidia-settings} \
+    %{buildroot}%{_bindir}/
+%{__mkdir_p} %{buildroot}%{_sbindir}/
+%{__install} -p -m 0755 usr/bin/nvidia-xconfig \
+    %{buildroot}%{_sbindir}/
+
+# Install man pages (the other, nvidia-installer, isn't relevant)
+%{__mkdir_p} %{buildroot}%{_mandir}/man1/
+%{__install} -p -m 0644 usr/share/man/man1/nvidia-{settings,xconfig}* \
+    %{buildroot}%{_mandir}/man1/
+
+# Install pixmap for the desktop entry
+%{__mkdir_p} %{buildroot}%{_datadir}/pixmaps/
+%{__install} -p -m 0644 usr/share/pixmaps/nvidia-settings.png \
+    %{buildroot}%{_datadir}/pixmaps/
+
+# Remove &quot;__UTILS_PATH__/&quot; before the Exec command name
+# Replace &quot;__PIXMAP_PATH__/&quot; with the proper pixmaps path
+%{__perl} -pi -e 's|(Exec=).*/(.*)|$1$2|g;
+                  s|(Icon=).*/(.*)|$1%{_datadir}/pixmaps/$2|g' \
+    usr/share/applications/nvidia-settings.desktop
+
+# Desktop entry for nvidia-settings
+%{__mkdir_p} %{buildroot}%{_datadir}/applications/
+desktop-file-install --vendor %{desktop_vendor} \
+    --dir %{buildroot}/%{_datadir}/applications/ \
+    --add-category System \
+    --add-category Application \
+    --add-category GNOME \
+    usr/share/applications/nvidia-settings.desktop
+
+# Install modprobe.d file
+%{__install} -D -p -m 0644 %{SOURCE5} \
+    %{buildroot}%{_sysconfdir}/modprobe.d/nvidia
+
+# Install ld.so.conf.d file
+%{__mkdir_p} %{buildroot}%{_sysconfdir}/ld.so.conf.d/
+echo %{nvidialibdir} &gt;    %{buildroot}%{_sysconfdir}/ld.so.conf.d/nvidia.conf
+%ifarch x86_64
+echo %{nvidialib32dir} &gt;&gt; %{buildroot}%{_sysconfdir}/ld.so.conf.d/nvidia.conf
+%endif
+
+# Install profile.d files
+%{__install} -D -p -m 0755 %{SOURCE2} \
+    %{buildroot}%{_sysconfdir}/profile.d/nvidia.sh
+%{__install} -D -p -m 0755 %{SOURCE3} \
+    %{buildroot}%{_sysconfdir}/profile.d/nvidia.csh
+
+# Install X configuration script
+%{__install} -D -p -m 0755 %{SOURCE4} \
+    %{buildroot}%{_sbindir}/nvidia-config-display
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%post
+/sbin/ldconfig
+# Make sure we have a Files section in xorg.conf, otherwise create an empty one
+XORGCONF=/etc/X11/xorg.conf
+[ -w ${XORGCONF} ] &amp;&amp; ! grep -q 'Section &quot;Files&quot;' ${XORGCONF} &amp;&amp; \
+    echo -e 'Section &quot;Files&quot;\nEndSection' &gt;&gt; ${XORGCONF}
+# Enable the proprietary driver
+%{_sbindir}/nvidia-config-display enable || :
+# Add to DKMS registry
+dkms add -m %{dkms_name} -v %{dkms_vers} %{?quiet} || :
+# Rebuild and make available for the currenty running kernel
+dkms build -m %{dkms_name} -v %{dkms_vers} %{?quiet} || :
+dkms install -m %{dkms_name} -v %{dkms_vers} %{?quiet} --force || :
+
+%preun
+# Remove all versions from DKMS registry
+dkms remove -m %{dkms_name} -v %{dkms_vers} %{?quiet} --all || :
+# Last removal, disable the proprietary driver
+if [ $1 -eq 0 ]; then
+    %{_sbindir}/nvidia-config-display disable || :
+fi
+
+%postun -p /sbin/ldconfig
+
+
+%files
+%defattr(-,root,root,0755)
+%doc LICENSE usr/share/doc/*
+# Kernel and dkms related bits
+%config %{_sysconfdir}/modprobe.d/nvidia
+%{_usrsrc}/%{dkms_name}-%{dkms_vers}/
+# Devices for udev to copy directly
+%attr(0600,root,root) %dev(c,195,0) %{_sysconfdir}/udev/devices/nvidia0
+%attr(0600,root,root) %dev(c,195,1) %{_sysconfdir}/udev/devices/nvidia1
+%attr(0600,root,root) %dev(c,195,2) %{_sysconfdir}/udev/devices/nvidia2
+%attr(0600,root,root) %dev(c,195,3) %{_sysconfdir}/udev/devices/nvidia3
+%attr(0600,root,root) %dev(c,195,4) %{_sysconfdir}/udev/devices/nvidia4
+%attr(0600,root,root) %dev(c,195,5) %{_sysconfdir}/udev/devices/nvidia5
+%attr(0600,root,root) %dev(c,195,6) %{_sysconfdir}/udev/devices/nvidia6
+%attr(0600,root,root) %dev(c,195,7) %{_sysconfdir}/udev/devices/nvidia7
+%attr(0600,root,root) %dev(c,195,8) %{_sysconfdir}/udev/devices/nvidia8
+%attr(0600,root,root) %dev(c,195,9) %{_sysconfdir}/udev/devices/nvidia9
+%attr(0600,root,root) %dev(c,195,255) %{_sysconfdir}/udev/devices/nvidiactl
+# Libraries and X modules
+%config %{_sysconfdir}/ld.so.conf.d/nvidia.conf
+%dir %{nvidialibdir}/
+%{nvidialibdir}/*.so.*
+%{nvidialibdir}/tls/
+%ifarch x86_64
+%dir %{nvidialib32dir}/
+%{nvidialib32dir}/*.so.*
+%{nvidialib32dir}/tls/
+%endif
+%{_libdir}/xorg/modules/drivers/nvidia_drv.so
+%dir %{_libdir}/xorg/modules/extensions/nvidia/
+%{_libdir}/xorg/modules/extensions/nvidia/libglx.so
+# Tools and utilities
+%{_sysconfdir}/profile.d/*
+%{_bindir}/*
+%{_sbindir}/*
+%{_datadir}/applications/*
+%{_datadir}/pixmaps/*
+%{_mandir}/man1/*
+
+# Not needed devel but would violate the license not to include them
+#files devel
+#defattr(-,root,root,0755)
+%{nvidialibdir}/*.a
+%{nvidialibdir}/*.so
+%ifarch x86_64
+%{nvidialib32dir}/*.so
+%endif
+
+
+%changelog
+* Mon Jan  8 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9631-1
+- Fork 96xx legacy driver (required for older video cards).
+
+* Mon Dec 11 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9631-1
+- Update to 1.0-9631 (stable).
+
+* Thu Nov 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9742-1.beta
+- Update to the latest 1.0-9742 beta driver.
+
+* Thu Nov 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-3
+- Use the pkg0 file for i386 since it's the same as the pkg1 but without all
+  of the precompiled kernel modules we don't use anyway. We save 6MB+ of SRPM.
+- For x86_64 there are no precompiled modules (ATM) so pkg0 and pkg1 are the
+  same, but pkg2 has the lib32 files in addition, so it makes sense to use
+  pkg2 there.
+
+* Thu Nov 16 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-2
+- Include Xen patch and spec fixes from Juliano F. Ravasi.
+
+* Wed Nov  8 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9629-1
+- Update to 1.0-9629.
+
+* Tue Oct 31 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-4
+- Include patch to fix black X screen on startup (disables i2c, though).
+
+* Mon Oct 30 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-3
+- 32bit libs weren't being included on x86_64, the 64bits were twice instead.
+
+* Tue Oct 24 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-2
+- Include nvidia-xconfig, Edward Rudd.
+- Move extracting the installer to the %%prep stage, Edward Rudd.
+- No longer do everything from the pkg/ directory.
+
+* Mon Oct 16 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9626-1
+- Update to 1.0-9626.
+
+* Wed Oct 11 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9625-2
+- Fix desktop entry.
+- Remove static dev entries, let udev take care of copying them to /dev.
+- Small fix to the driver file mode and remove the created empty directory.
+- Add %%{nvidialib32dir} to the ld.so.conf.d file on x86_64.
+- Make sure we have a Files section in xorg.conf, otherwise create an empty
+  one for the nvidia-config-display utility/script to work properly.
+- Run the nvidia-config-display utility/script in %%post.
+
+* Tue Oct 10 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.9625-1
+- Update to the 1.0-9625 beta drivers.
+
+* Tue Oct 10 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-3
+- Add the rpm release to the dkms module version, to make updating the module
+  to a fixed same version work (--rpm_safe_upgrade doesn't work as advertised).
+- Force modules install so that the same version can be overwritten instead of
+  uninstalled by the old package's %%preun when updating.
+- Add build time quiet flag for the scriplets. Undefine to do verbose testing.
+
+* Mon Oct  9 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-2.1
+- Add dkms-nvidia provides.
+- Use %%{dkms_name} macro for the usr/src directory name.
+
+* Sat Oct  7 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-2
+- Include both x86 and x86_64 pkg.run files in the source rpm, so that the
+  same can be used for both i386 and x86_64.
+
+* Wed Oct  4 2006 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.8774-1
+- Add x86_64 support.
+- Rework into a single nvidia-x11-drv package.
+
+* Mon Oct 02 2006 Richard Hughes &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">richard at hughsie.com</A>&gt; 8774-4
+- 1st Release, First public build
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003844.html">[svn] r5044 - in trunk/rpms: . perl-Acme-ProgressBar	perl-Acme-Steganography-Image-Png perl-Algorithm-Cluster	perl-Algorithm-RabinKarp perl-Bio-Trace-ABIF perl-Boost-Graph	perl-CGI-Auth-Auto perl-CGI-GuruMeditation	perl-CGI-Session-Hidden perl-Catalyst-Model-File	perl-Catalyst-Plugin-DBIC-Schema-Profiler	perl-Catalyst-Plugin-I18N-DBIC perl-Catalyst-Plugin-I18N-Request	perl-Class-Accessor-Fast-Contained perl-Class-C3	perl-Class-DBI-Plugin-AccessionSearch	perl-Class-DispatchToAll perl-Class-XML-Parser	perl-Compress-Raw-Bzip2 perl-Compress-Raw-Zlib	perl-Config-Wild perl-Data-Alias perl-Data-Pagination	perl-Data-Phrasebook perl-Data-Phrasebook-Loader-YAML	perl-Date-Holidays-USFederal	perl-DateTime-Calendar-WarwickUniversity	perl-DateTime-Event-WarwickUniversity	perl-DateTime-Util-DayOfWeek-Locale perl-Dir-Split	perl-Encode-RAD50 perl-ExtUtils-FindFunctions perl-FCGI-Async	perl-File-Copy-Reliable perl-File-Find-Rule-VCS	perl-Finance-TW-TSEQuote perl-Font-GlyphNames	perl-Geography-States perl-Graphics-ColorUtils	perl-HTML-Prototype perl-HTML-ResolveLink	perl-IO-Compress-Base perl-IO-Compress-Lzop	perl-IO-Compress-Zlib perl-JavaScript-RPC	perl-Language-Indonesia perl-Lingua-Alphabet-Phonetic	perl-Lingua-StopWords perl-Log-Funlog perl-Logger-Syslog	perl-MIME-Charset perl-MIME-EncWords perl-MP4-Info	perl-Module-Build-Convert perl-Module-Extract	perl-Module-Manifest perl-Module-Math-Depends	perl-Net-Domain-ExpireDate perl-Net-MAC-Vendor perl-Net-SDP	perl-Net-Whois-Raw perl-OODoc perl-Object-Deadly	perl-Object-Signature perl-POE-Component-CPAN-YACSmoke	perl-POE-Component-Client-HTTP perl-POE-Component-Server-DNS	perl-POE-Component-Server-IRC perl-Path-Class-File-Stat	perl-Pod-MultiLang perl-Pod-Perldoc-ToToc perl-Pod-XML	perl-RPM2 perl-Regexp-Common-net-CIDR perl-SQL-Interpolate	perl-Socket-Multicast6 perl-String-Sprintf perl-Sub-ForceEval	perl-Sys-RunAlone perl-Sys-RunAlways perl-Template-Magic	perl-Template-Plugin-NoFollow perl-Test-CheckManifest	perl-Text-Bastardize perl-Text-DHCPparse	perl-Text-MediawikiFormat perl-Text-Same perl-Text-Templet	perl-Time-HiRes-Value perl-WWW-IndexParser	perl-WWW-Shorten-0rz perl-WWW-Wikipedia	perl-WebService-PhotoZou perl-XML-Genx perl-YAML-Tiny
</A></li>
	<LI>Next message: <A HREF="003846.html">[svn] r5046 - trunk/rpms/nvidia-x11-drv-96xx
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3845">[ date ]</a>
              <a href="thread.html#3845">[ thread ]</a>
              <a href="subject.html#3845">[ subject ]</a>
              <a href="author.html#3845">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
