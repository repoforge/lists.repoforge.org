<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r2731 - in trunk/tools/pydar2: . php pydar tests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2731%20-%20in%20trunk/tools/pydar2%3A%20.%20php%20pydar%20tests&In-Reply-To=%3C20050101205131.DDF4317F5E%40web22.us.megagiga.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001535.html">
   <LINK REL="Next"  HREF="001537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r2731 - in trunk/tools/pydar2: . php pydar tests</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2731%20-%20in%20trunk/tools/pydar2%3A%20.%20php%20pydar%20tests&In-Reply-To=%3C20050101205131.DDF4317F5E%40web22.us.megagiga.com%3E"
       TITLE="[SVN] r2731 - in trunk/tools/pydar2: . php pydar tests">svn-commits at rpmforge.net
       </A><BR>
    <I>Sat Jan  1 21:51:31 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001535.html">[SVN] r2730 - in trunk/rpms: . gambas luola luola-levels mathomatic	perl-RPC-XML
</A></li>
        <LI>Next message: <A HREF="001537.html">[SVN] r2732 - in trunk/rpms: . elmo gpgme libtar perl-DNS-BL	perl-Test-Reporter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1536">[ date ]</a>
              <a href="thread.html#1536">[ thread ]</a>
              <a href="subject.html#1536">[ subject ]</a>
              <a href="author.html#1536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dries
Date: 2005-01-01 21:51:30 +0100 (Sat, 01 Jan 2005)
New Revision: 2731

Added:
   trunk/tools/pydar2/php/auroradriestodo.php
   trunk/tools/pydar2/php/auroratodo.php
   trunk/tools/pydar2/php/fc1x86driestodo.php
   trunk/tools/pydar2/php/fc2x86driestodo.php
   trunk/tools/pydar2/php/fc3x86driestodo.php
   trunk/tools/pydar2/pydar-buildserver-master.py
   trunk/tools/pydar2/pydar-buildserver-slave.py
   trunk/tools/pydar2/pydar/buildroot.py
   trunk/tools/pydar2/pydar/buildrootresult.py
   trunk/tools/pydar2/pydar/command.py
   trunk/tools/pydar2/pydar/config.py
   trunk/tools/pydar2/pydar/store.py
   trunk/tools/pydar2/pydar/yumbasedbuildroot.py
Modified:
   trunk/tools/pydar2/php/build.php
   trunk/tools/pydar2/php/buildqueue.php
   trunk/tools/pydar2/php/finishedbuilds.php
   trunk/tools/pydar2/php/index.php
   trunk/tools/pydar2/php/navigation.php
   trunk/tools/pydar2/php/specfile.php
   trunk/tools/pydar2/php/specfiles.php
   trunk/tools/pydar2/php/specfileversion.php
   trunk/tools/pydar2/php/stats.php
   trunk/tools/pydar2/pydar/specfile.py
   trunk/tools/pydar2/tests/specfile-test.py
Log:
temp commit, does not work yet, far from finished, may eat your computer

Added: trunk/tools/pydar2/php/auroradriestodo.php
===================================================================
--- trunk/tools/pydar2/php/auroradriestodo.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/auroradriestodo.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,7 @@
+&lt;?php
+    $fullname = &quot;Aurora 1.92 (dries only)&quot;;
+    $buildscript = &quot;./aurorabuild&quot;;
+    $releasetag = &quot;.0.au1.92.rf&quot;;
+    $authority = &quot;dries&quot;;
+    include(&quot;stats.php&quot;);
+?&gt;
\ No newline at end of file

Added: trunk/tools/pydar2/php/auroratodo.php
===================================================================
--- trunk/tools/pydar2/php/auroratodo.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/auroratodo.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,7 @@
+&lt;?php
+    $fullname = &quot;Aurora 1.92&quot;;
+    $buildscript = &quot;./aurorabuild&quot;;
+    $releasetag = &quot;.0.au1.92.rf&quot;;
+    # $authority = 
+    include(&quot;stats.php&quot;);
+?&gt;
\ No newline at end of file

Modified: trunk/tools/pydar2/php/build.php
===================================================================
--- trunk/tools/pydar2/php/build.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/build.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -35,7 +35,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : build &lt;?php echo $id; ?&gt;&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : build &lt;?php echo $id; ?&gt;&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/buildqueue.php
===================================================================
--- trunk/tools/pydar2/php/buildqueue.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/buildqueue.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -7,7 +7,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : build queue&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : build queue&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Added: trunk/tools/pydar2/php/fc1x86driestodo.php
===================================================================
--- trunk/tools/pydar2/php/fc1x86driestodo.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/fc1x86driestodo.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,7 @@
+&lt;?php
+    $fullname = &quot;Fedora Core 1 x86 (dries)&quot;;
+    $buildscript = &quot;./fc1build&quot;;
+    $releasetag = &quot;.1.fc1.dries&quot;;
+    $authority = &quot;dries&quot;;
+    include(&quot;stats.php&quot;);
+?&gt;
\ No newline at end of file

Added: trunk/tools/pydar2/php/fc2x86driestodo.php
===================================================================
--- trunk/tools/pydar2/php/fc2x86driestodo.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/fc2x86driestodo.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,7 @@
+&lt;?php
+    $fullname = &quot;Fedora Core 2 x86 (dries)&quot;;
+    $buildscript = &quot;./fc2build&quot;;
+    $releasetag = &quot;.1.fc2.dries&quot;;
+    $authority = &quot;dries&quot;;
+    include(&quot;stats.php&quot;);
+?&gt;
\ No newline at end of file

Added: trunk/tools/pydar2/php/fc3x86driestodo.php
===================================================================
--- trunk/tools/pydar2/php/fc3x86driestodo.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/fc3x86driestodo.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,7 @@
+&lt;?php
+    $fullname = &quot;Fedora Core 3 x86 (dries)&quot;;
+    $buildscript = &quot;./fc3build&quot;;
+    $releasetag = &quot;.1.fc3.rf&quot;;
+    $authority = &quot;dries&quot;;
+    include(&quot;stats.php&quot;);
+?&gt;
\ No newline at end of file

Modified: trunk/tools/pydar2/php/finishedbuilds.php
===================================================================
--- trunk/tools/pydar2/php/finishedbuilds.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/finishedbuilds.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -7,7 +7,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : finished builds&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : finished builds&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/index.php
===================================================================
--- trunk/tools/pydar2/php/index.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/index.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -7,7 +7,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/navigation.php
===================================================================
--- trunk/tools/pydar2/php/navigation.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/navigation.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -1,18 +1,37 @@
-&lt;div class=&quot;navigation&quot;&gt;
-  &lt;div class=&quot;navpart&quot;&gt;Online:&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/">http://dries.studentenweb.org/ayo/</A>&quot;&gt;APT/YUM config&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/packages.html">http://dries.studentenweb.org/ayo/packages.html</A>&quot;&gt;Packages&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/RPM-GPG-KEY.dries.txt">http://dries.studentenweb.org/ayo/RPM-GPG-KEY.dries.txt</A>&quot;&gt;GPG key&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/fedora/fc2/i386/RPMS.dries">http://dries.studentenweb.org/ayo/fedora/fc2/i386/RPMS.dries</A>&quot;&gt;fc2 i386 rpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/fedora/fc2/i386/SRPMS.dries">http://dries.studentenweb.org/ayo/fedora/fc2/i386/SRPMS.dries</A>&quot;&gt;fc2 i386 srpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/fedora/fc1/i386/RPMS.dries">http://dries.studentenweb.org/ayo/fedora/fc1/i386/RPMS.dries</A>&quot;&gt;fc1 i386 rpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/fedora/fc1/i386/SRPMS.dries">http://dries.studentenweb.org/ayo/fedora/fc1/i386/SRPMS.dries</A>&quot;&gt;fc1 i386 srpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/redhat/el3/en/i386/RPMS.dries">http://dries.studentenweb.org/ayo/redhat/el3/en/i386/RPMS.dries</A>&quot;&gt;el3 i386 rpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/redhat/el3/en/i386/SRPMS.dries">http://dries.studentenweb.org/ayo/redhat/el3/en/i386/SRPMS.dries</A>&quot;&gt;el3 i386 srpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/aurora/1.91/sparc/RPMS.dries">http://dries.studentenweb.org/ayo/aurora/1.91/sparc/RPMS.dries</A>&quot;&gt;au 1.91 rpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.studentenweb.org/ayo/aurora/1.91/sparc/SRPMS.dries">http://dries.studentenweb.org/ayo/aurora/1.91/sparc/SRPMS.dries</A>&quot;&gt;au 1.91 srpms&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navpart&quot;&gt;Build system:&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;buildqueue.php&quot;&gt;Build queue&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;finishedbuilds.php&quot;&gt;Finished builds&lt;/a&gt;&lt;/div&gt;
-  &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;specfiles.php&quot;&gt;list of spec files&lt;/a&gt;&lt;/div&gt;
+&lt;div&gt;
+  &lt;div class=&quot;navigation&quot;&gt;
+    &lt;div class=&quot;navpart&quot;&gt;Online:&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/">http://dries.ulyssis.org/ayo/</A>&quot;&gt;APT/YUM config&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/packages.html">http://dries.ulyssis.org/ayo/packages.html</A>&quot;&gt;Packages&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/RPM-GPG-KEY.dries.txt">http://dries.ulyssis.org/ayo/RPM-GPG-KEY.dries.txt</A>&quot;&gt;GPG key&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/fedora/fc3/i386/RPMS.dries">http://dries.ulyssis.org/ayo/fedora/fc3/i386/RPMS.dries</A>&quot;&gt;fc3 i386 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/fedora/fc2/i386/RPMS.dries">http://dries.ulyssis.org/ayo/fedora/fc2/i386/RPMS.dries</A>&quot;&gt;fc2 i386 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/fedora/fc1/i386/RPMS.dries">http://dries.ulyssis.org/ayo/fedora/fc1/i386/RPMS.dries</A>&quot;&gt;fc1 i386 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/redhat/el3/en/i386/RPMS.dries">http://dries.ulyssis.org/ayo/redhat/el3/en/i386/RPMS.dries</A>&quot;&gt;el3 i386 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/aurora/1.92/sparc/RPMS.dries">http://dries.ulyssis.org/ayo/aurora/1.92/sparc/RPMS.dries</A>&quot;&gt;au 1.92 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dries.ulyssis.org/ayo/aurora/1.91/sparc/RPMS.dries">http://dries.ulyssis.org/ayo/aurora/1.91/sparc/RPMS.dries</A>&quot;&gt;au 1.91 rpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navpart&quot;&gt;Build system:&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/buildqueue.php">http://pydar2.vmhosting.org/buildqueue.php</A>&quot;&gt;Build queue&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/finishedbuilds.php">http://pydar2.vmhosting.org/finishedbuilds.php</A>&quot;&gt;Finished builds&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/specfiles.php">http://pydar2.vmhosting.org/specfiles.php</A>&quot;&gt;list of spec files&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/fc3x86driestodo.php">http://pydar2.vmhosting.org/fc3x86driestodo.php</A>&quot;&gt;Todo fc3/x86/dries&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/fc2x86driestodo.php">http://pydar2.vmhosting.org/fc2x86driestodo.php</A>&quot;&gt;Todo fc2/x86/dries&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/fc1x86driestodo.php">http://pydar2.vmhosting.org/fc1x86driestodo.php</A>&quot;&gt;Todo fc1/x86/dries&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/auroratodo.php">http://pydar2.vmhosting.org/auroratodo.php</A>&quot;&gt;Todo au1.92&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://pydar2.vmhosting.org/auroradriestodo.php">http://pydar2.vmhosting.org/auroradriestodo.php</A>&quot;&gt;Todo au1.92/dries&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navpart&quot;&gt;Other repo's:&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://dag.wieers.com/home-made/apt">http://dag.wieers.com/home-made/apt</A>&quot;&gt;DAG&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&quot;&gt;Freshrpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://apt.sw.be/bert">http://apt.sw.be/bert</A>&quot;&gt;Bert&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://newrpms.sunsite.dk">http://newrpms.sunsite.dk</A>&quot;&gt;Newrpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://atrpms.physik.fu-berlin.de/">http://atrpms.physik.fu-berlin.de/</A>&quot;&gt;ATrpms&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://kde-redhat.sourceforge.net/">http://kde-redhat.sourceforge.net/</A>&quot;&gt;kde-redhat&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navpart&quot;&gt;Varia:&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;&lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://carolien.ulyssis.org/fotos.htm">http://carolien.ulyssis.org/fotos.htm</A>&quot;&gt;Pictures!&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navpart&quot;&gt;Thanks:&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;Buildsystem hosted at &lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://www.ithomi.com/">http://www.ithomi.com/</A>&quot;&gt;ithomi&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;Static site hosted at &lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://www.ulyssis.org/">http://www.ulyssis.org/</A>&quot;&gt;ULYSSIS&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;Primary mirror hosted at &lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://www.hea.net/">http://www.hea.net/</A>&quot;&gt;HEAnet&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;navitem&quot;&gt;Rsync site hosted at &lt;a class=&quot;navitem&quot; href=&quot;<A HREF="http://3ti.ericom.be/">http://3ti.ericom.be/</A>&quot;&gt;3TI&lt;/a&gt;&lt;/div&gt;
+  &lt;/div&gt;
 &lt;/div&gt;
\ No newline at end of file

Modified: trunk/tools/pydar2/php/specfile.php
===================================================================
--- trunk/tools/pydar2/php/specfile.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/specfile.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -44,7 +44,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : spec file &lt;?php echo $name; ?&gt;&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : spec file &lt;?php echo $name; ?&gt;&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/specfiles.php
===================================================================
--- trunk/tools/pydar2/php/specfiles.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/specfiles.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -7,7 +7,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : list of spec files&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : list of spec files&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/specfileversion.php
===================================================================
--- trunk/tools/pydar2/php/specfileversion.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/specfileversion.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -37,7 +37,7 @@
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : list of spec files&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : list of spec files&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;

Modified: trunk/tools/pydar2/php/stats.php
===================================================================
--- trunk/tools/pydar2/php/stats.php	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/php/stats.php	2005-01-01 20:51:30 UTC (rev 2731)
@@ -1,3 +1,6 @@
+&lt;?php
+if (isset($fullname) &amp;&amp; isset($buildscript) &amp;&amp; isset($releasetag)) {
+?&gt;
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
 &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;
@@ -3,14 +6,14 @@
   &lt;head&gt;
     &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
-    &lt;title&gt;Dries APT/YUM Repository : Build system : aurora 1.92 todo&lt;/title&gt;
+    &lt;title&gt;Dries APT/YUM Repository : Build system : &lt;?php echo $fullname; ?&gt; todo&lt;/title&gt;
     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; type=&quot;text/css&quot; /&gt;
   &lt;/head&gt;
   &lt;body&gt;
-    &lt;div class=&quot;header&quot;&gt;&lt;h1&gt;Dries APT/YUM RPM Repository : Build system : aurora 1.92 todo&lt;/h1&gt;&lt;/div&gt;
+    &lt;div class=&quot;header&quot;&gt;&lt;h3&gt;Dries APT/YUM RPM Repository : Build system : &lt;?php echo $fullname; ?&gt; todo&lt;/h3&gt;&lt;/div&gt;
     &lt;div class=&quot;pagecontents&quot;&gt;
       &lt;?php include('navigation.php'); ?&gt;
       &lt;div class=&quot;contents&quot;&gt;
        &lt;p&gt;
-        The following stuff needs to be build for aurora linux 1.92:
+        The following stuff needs to be build for &lt;?php echo $fullname; ?&gt;:
        &lt;/p&gt;
 &lt;?php
@@ -31,11 +34,15 @@
 // lijst van alle spec files + hun meest recente svncmtrev
 // select max(v.svncmtrev) as max, v.specfileid, s.name from pydar2_specfile_version v, pydar2_specfile s where  s.id=v.specfileid group by v.specfileid, s.name
 
-$sSqlStmt = &quot;select l.specfileid, l.name from pydar2_specfile_lastversion l where l.latestsvncmtrev not in (select r.svncmtrev from pydar2_rpmfile r where r.specfileid=l.specfileid) order by name asc&quot;;
+$addwhereclause = &quot;&quot;;
+if (isset($authority)) {
+    $addwhereclause = &quot; and l.authority='&quot; . $authority . &quot;' &quot;;
+}
+$sSqlStmt = &quot;select l.specfileid, l.name from pydar2_specfile_lastversion_and_authority l where l.latestsvncmtrev not in (select r.svncmtrev from pydar2_rpmfile r where r.specfileid=l.specfileid and r.specrpmrelease like '%&quot; . $releasetag . &quot;') &quot; . $addwhereclause . &quot; order by name asc&quot;;
 
 $rs = dbx_query($dbh,$sSqlStmt);
 echo &quot;&lt;table&gt;&quot;;
-echo &quot;&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Specfile ID&lt;/th&gt;&lt;th&gt;spec file&lt;/th&gt;&lt;/tr&gt;&quot;;
+echo &quot;&lt;tr&gt;&lt;th&gt;Specfile ID&lt;/th&gt;&lt;th&gt;spec file&lt;/th&gt;&lt;/tr&gt;&quot;;
 $counter=0;
 foreach ($rs-&gt;data as $row) {
     $counter = $counter + 1;
@@ -43,9 +50,10 @@
     echo &quot;&lt;td&gt;&lt;a href=\&quot;specfile.php?id=&quot; . $row[0] . &quot;\&quot;&gt;&quot; . $row[0] . &quot;&lt;/a&gt;&lt;/td&gt;&quot;;
     echo &quot;&lt;td&gt;&lt;a href=\&quot;specfile.php?name=&quot; . $row[1] . &quot;\&quot;&gt;&quot; . $row[1] . &quot;&lt;/a&gt;&lt;/td&gt;&quot;;
     echo &quot;&lt;/tr&gt;&quot;;
-    $fullstring = $fullstring . &quot;./aurorabuild &quot; . str_replace(&quot;.spec&quot;,&quot;&quot;,$row[1]) . &quot;\n&quot;;
+    $fullstring = $fullstring . $buildscript . &quot; &quot; . str_replace(&quot;.spec&quot;,&quot;&quot;,$row[1]) . &quot;\n&quot;;
 }
 echo &quot;&lt;/table&gt;&quot;;
+echo &quot;&lt;p&gt;Count: &quot; . $counter . &quot;&lt;/p&gt;&quot;;
 print &quot;&lt;pre&gt;\n\n&quot;;
 print $fullstring;
 print &quot;&lt;/pre&gt;&quot;;
@@ -57,4 +65,7 @@
       &lt;/div&gt;
     &lt;/div&gt;
   &lt;/body&gt;
-&lt;/html&gt;
\ No newline at end of file
+&lt;/html&gt;
+&lt;?php
+}
+?&gt;
\ No newline at end of file

Added: trunk/tools/pydar2/pydar/buildroot.py
===================================================================
--- trunk/tools/pydar2/pydar/buildroot.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/buildroot.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,68 @@
+
+&quot;&quot;&quot; A superclass for buildroots &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+# normally you don't use this class but a subclass which implements 
+# these functions
+# for example: YmBasedBuildRoot
+
+# example usage:
+# fc3br = BlaBlaBuildRoot(cfg,'fedora-3-i386-core')
+# result = fc3br.prepareRoot()
+# result = fc3br.buildRpm(SpecFile('a.spec'),'1.fc3.rf')
+# result = fc3br.prepareRoot()
+# result = fc3br.buildRpm(SpecFile('b.spec'),'1.fc3.rf')
+# result = fc3br.prepareRoot()
+# result = fc3br.buildRpm(SpecFile('c.spec'),'1.fc3.rf')
+# normally you should check the result each time
+
+from log4py import Logger
+from specfile import SpecFile
+
+class BuildRoot:
+    # this will already set certain variables
+    def __init__(self,myconfig,rootname):
+        self.cat = Logger().get_instance(self)
+        self.cat.debug(&quot;start&quot;)
+    
+    # this cleans up this root
+    # depends on the implementation
+    # the result is a BuildRootResult object
+    def cleanRoot(self):
+        self.cat.debug(&quot;start&quot;)
+    
+    # this prepares a buildroot so it can be used for building an rpm
+    # this calls cleanRoot if needed
+    # this creates the buildRoot from scratch if needed
+    # the result is a BuildRootResult object
+    def prepareRoot(self):
+        self.cat.debug(&quot;start&quot;)
+       
+    # the argument is a SpecFile object
+    # the result is a BuildRootResult object
+    def buildRpm(self,spec):
+        self.cat.debug(&quot;start&quot;)
+        
+    # rpms is an array of strings (names of rpms)
+    # this is used for installing the buildrequirements
+    # this only works on a root which has been prepared already
+    # otherwise you get a lot of errors (so use prepareRoot first)
+    # the result is a BuildRootResult object
+    def installRpms(self,rpms):
+        self.cat.debug(&quot;start&quot;)
+        
+    
\ No newline at end of file

Added: trunk/tools/pydar2/pydar/buildrootresult.py
===================================================================
--- trunk/tools/pydar2/pydar/buildrootresult.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/buildrootresult.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,42 @@
+
+&quot;&quot;&quot; A class which represents the result of a function on a buildroot object &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+from log4py import Logger
+
+
+class BuildRootResult:
+    __init__(self,buildrootobj):
+        self.buildrootobj = buildrootobj
+        self.containsErrors = 0
+        self.containsWarnings = 0
+        self.logText = &quot;&quot;
+        self.srpm = &quot;&quot;
+        self.rpms = []
+        self.buildlog = &quot;&quot;
+        self.configlog = &quot;&quot;
+        
+    def logErrorLine(self,line):
+        self.logText = self.logText + &quot;ERROR:&quot; + line + &quot;\n&quot;
+        print &quot;ERROR:&quot; + line
+        self.containsErrors = 1
+        
+    def logDebugLine(self,line):
+        self.logText = self.logText + line + &quot;\n&quot;
+        print line
+        
+        

Added: trunk/tools/pydar2/pydar/command.py
===================================================================
--- trunk/tools/pydar2/pydar/command.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/command.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,35 @@
+
+&quot;&quot;&quot; This class represents one command given by an rpc client &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+class Command:
+    def __init__(self, commandName,userId,specName,toEmail,releaseTag,machRoot,priority):
+        self.commandName=commandName
+        self.userId=userId
+        self.specName = specName
+        self.toEmail = toEmail
+        self.releaseTag = releaseTag
+        self.machRoot = machRoot
+        self.priority = priority
+
+    def setCommandId(self,id):
+        self.commandId = id
+
+    def toString(self):
+        return &quot;commandName=&quot; + self.commandName + &quot;,userId=&quot; + self.userId + &quot;,specName=&quot; + self.specName + &quot;,toEmail=&quot; + self.toEmail + &quot;,releaseTag=&quot; + self.releaseTag + &quot;,machRoot=&quot; + self.machRoot + &quot;,commandId=&quot; + self.commandId + &quot;,priority=&quot; + self.priority
+
+

Added: trunk/tools/pydar2/pydar/config.py
===================================================================
--- trunk/tools/pydar2/pydar/config.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/config.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,56 @@
+
+#!/usr/bin/python
+
+&quot;&quot;&quot; Contains some settings for pydar &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+import ConfigParser, os
+
+class Config:
+    def __init__(self):
+               
+        myParser = ConfigParser.ConfigParser()
+        try:
+            myParser.readfp(open('/usr/share/pydar/defaults.conf'))
+        except:
+            myParser.readfp(open('defaults.conf'))
+        myParser.read(['/etc/pydar/pydar.conf','~/.pydar.conf', 'pydar.conf'])
+        
+        self.buildmasterhostname = myParser.get('master','buildmasterhostname')
+        self.buildmasterport = myParser.getint('master','buildmasterport')
+        self.buildmasterurl = myParser.get('client','buildmasterurl')
+        self.buildslavehostname = myParser.get('slave','buildslavehostname')
+        self.buildslaveport = myParser.getint('slave','buildslaveport')
+        self.buildslaveurl = myParser.get('slave','buildslaveurl')
+        self.mastersvnroot = myParser.get('svn','svnroot')
+        self.mastersvnrpmsdir = myParser.get('svn','svnrpmsdir')
+        self.smtpserver = myParser.get('master','smtpserver')
+        self.mailFrom = myParser.get('master','mailfrom')
+        self.mailTo = myParser.get('client','mailto')
+        self.releaseTag = myParser.get('client','defaultreleasetag')
+        self.machRoot = myParser.get('client','defaultmachroot')
+        self.userid = myParser.get('client','userid')
+        self.dbconnectstring = myParser.get('master','dbconnectstring')
+        self.buildmachineid = myParser.get('slave','buildmachineid')
+        self.dirtestbuilds = myParser.get('slave','dirtestbuilds')
+
+        self.sleeptime = 5
+
+        # get the supported machroots
+        self.machroots = []
+        for key in myParser.options('machroots'):
+            self.machroots.append(myParser.get('machroots',key))
\ No newline at end of file

Modified: trunk/tools/pydar2/pydar/specfile.py
===================================================================
--- trunk/tools/pydar2/pydar/specfile.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/specfile.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -18,7 +18,7 @@
 
 # This class can be used for reading the values of certain tags from spec files
 
-import re, os, commands
+import re, os, commands, string
 from log4py import Logger
 from tagsfile import TagsFile
 
@@ -34,6 +34,39 @@
     def __init__(self, specfile, defineargs):
         TagsFile.__init__(self,defineargs, &quot; --specfile &quot;, specfile)
 
+    # returns an array of names of rpms to install
+    def getBuildRequires(self):
+        commandpart = &quot;&quot;
+        f = open(self.filename, 'r')
+        line = f.readline()
+        while line != '' and string.find(line,&quot;%description&quot;) &lt; 0:
+            if string.find(string.lower(line),'buildrequires') &gt;= 0:
+                l = line.strip()
+                commandpart = commandpart + &quot;, &quot; + l
+            line = f.readline()
+        f.close()
+        self.cat.debug(&quot;commandpart=&quot; + commandpart)
+        commandline = &quot;rpm &quot; + self.defineargs + &quot; -E '&quot; + commandpart + &quot;'&quot;
+        self.cat.debug(&quot;commandline=&quot; + commandline)
+        result = commands.getoutput(commandline)
+        self.cat.debug(&quot;result1=&quot; + result)
+        reobj = re.compile('BuildRequires:',re.IGNORECASE)
+        result = re.sub(reobj,&quot;&quot;,result)
+        self.cat.debug(&quot;result2=&quot; + result)
+        buildreqsarr = string.split(result,',')
+        finalbuildreqs = []
+        print &quot;buildreqsarr=&quot; + str(buildreqsarr)
+        for br in buildreqsarr:
+            # remove leading spaces
+            br = re.sub('^ *','',br)
+            # remove everything from the first space
+            br = re.sub(' .*','',br)
+            # remove all buildreqs which contain a '/' or a '('
+            if string.find(br,'/') &lt; 0 and string.find(br,'(') &lt; 0 and br != &quot;&quot;:
+                finalbuildreqs.append(br)
+                self.cat.debug(&quot;good buildreq: &quot; + br)
+        return finalbuildreqs
+       
         
     def parseRpmForgeTags(self):
         f = open(self.filename, 'r')

Added: trunk/tools/pydar2/pydar/store.py
===================================================================
--- trunk/tools/pydar2/pydar/store.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/store.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,135 @@
+
+&quot;&quot;&quot; This class contains all the functions for storing stuff in the database &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+# if you want to have a pydar which works without a database, then you have to replace 
+# this class with something else
+
+
+from command import Command
+from log4py import Logger
+import pgdb
+
+class Store:
+    def __init__(self,myconfig):
+        self.cat = Logger().get_instance(self)
+        self.config = myconfig
+        self.cat.debug(&quot;initialized&quot;)
+
+    def createCommand(self,commandName,userId,specName,toEmail,releaseTag,machRoot,priority):
+        # spec name can also be the contents of a specfile...
+        self.cat.debug(&quot;start&quot;)
+        aCommand = Command(commandName,userId,specName,toEmail,releaseTag,machRoot,priority)
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;insert into pydar_commands (commandname,userid,specname,toemail,releasetag,machroot,priority) values ('&quot;
+        + aCommand.commandName + &quot;','&quot;
+        + aCommand.userId + &quot;','&quot;
+        + aCommand.specName + &quot;','&quot;
+        + aCommand.toEmail + &quot;','&quot;
+        + aCommand.releaseTag + &quot;','&quot;
+        + aCommand.machRoot + &quot;',&quot;
+        + aCommand.priority + &quot;)&quot;)
+        conn.commit()
+        cursor.close()
+        conn.close()
+
+    def checkIfValidUserId(self, userId):
+        self.cat.debug(&quot;start, userId=&quot; + userId)
+        retval = 0
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;select * from pydar_users where id='&quot; + userId + &quot;'&quot;)
+        if cursor.rowcount &gt; 0:
+            retval = 1
+        cursor.close()
+        conn.close()
+        self.cat.debug(&quot;retval=&quot; + str(retval))
+        return retval
+
+    def checkIfValidBuildMachineId(self, buildmachineid):
+        self.cat.debug(&quot;start, id=&quot; + buildmachineid)
+        conn = pgdb.connect(self.config.dbconnectstring)
+        retval = 0
+        cursor = conn.cursor()
+        cursor.execute(&quot;select * from pydar_buildmachines where id='&quot; + buildmachineid + &quot;'&quot;)
+        if cursor.rowcount &gt; 0:
+            retval = 1
+        cursor.close()
+        conn.close()
+        self.cat.debug(&quot;retval=&quot; + str(retval))
+        return retval
+
+    def registerSlave(self, buildmachineid):
+        self.cat.debug(&quot;start, buildmachineid=&quot; + buildmachineid)
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;insert into pydar_buildmachine_registrations (id) values ('&quot; + buildmachineid + &quot;')&quot;)
+        cursor.execute(&quot;delete from pydar_buildmachine_machroots where buildmachineid='&quot; + buildmachineid + &quot;'&quot;)
+        conn.commit()
+        cursor.close()
+        conn.close()
+
+    def addMachRoot(self, buildmachineid, machroot):
+        self.cat.debug(&quot;start, id=&quot; + buildmachineid + &quot;,machroot=&quot; + machroot)
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;insert into pydar_buildmachine_machroots (buildmachineid,machroot) values ('&quot; + buildmachineid + &quot;','&quot; + machroot + &quot;')&quot;)
+        conn.commit()
+        cursor.close()
+        conn.close()
+
+    def addResultFileName(self,buildmachineid,commandId,fileName):
+        # no check on buildmachineid yet...
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;insert into pydar_actions_files (commandid,filename) values (&quot; + str(commandId) + &quot;,'&quot; + fileName + &quot;')&quot;)
+        conn.commit()
+        cursor.close()
+        conn.close()
+
+    def setBuildResult(self,buildmachineid,commandId,buildResult):
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;insert into pydar_actions (buildmachineid,commandid,statusid) values ('&quot; + buildmachineid + &quot;',&quot; + str(commandId) + &quot;,&quot; + str(buildResult+1) + &quot;)&quot;)
+        cursor.execute(&quot;update pydar_commands set handled=true,inprogress=false where id=&quot; + str(commandId))
+        conn.commit()
+        cursor.close()
+        conn.close()
+
+
+    def reserveCommand(self, buildmachineid):
+        self.cat.debug(&quot;start, buildmachineid=&quot; + buildmachineid)
+        conn = pgdb.connect(self.config.dbconnectstring)
+        cursor = conn.cursor()
+        cursor.execute(&quot;select pc.id, pc.specname, pc.toemail, pc.releasetag, pc.machroot, pc.commandname from pydar_commands pc where (pc.commandname='BUILD' or pc.commandname='TESTBUILD') and not pc.handled and not pc.inprogress and pc.machroot in (select machroot from pydar_buildmachine_machroots where buildmachineid='&quot; + buildmachineid + &quot;')  order by pc.priority desc, pc.machroot desc, pc.id asc&quot;)
+        retval = &quot;&quot;
+        if cursor.rowcount &gt; 0:
+            rs = cursor.fetchone()
+            self.cat.debug(&quot;command found for buildmachineid=&quot; + buildmachineid + &quot;,rs=&quot; + str(rs))
+            aCommand = Command(rs[5],'-1',rs[1],rs[2],rs[3],rs[4])
+            aCommand.setCommandId(rs[0])
+            cursor.execute(&quot;update pydar_commands set inprogress=true where id=&quot; + str(aCommand.commandId))
+            cursor.execute(&quot;insert into pydar_actions (commandid, statusid, buildmachineid) values (&quot; + str(aCommand.commandId) + &quot;,0,'&quot; + buildmachineid + &quot;')&quot;)
+            retval = aCommand
+        else:
+            self.cat.debug(&quot;nothing to do for buildmachineid=&quot; + buildmachineid)
+            retval = &quot;&quot;
+        conn.commit()
+        cursor.close()
+        conn.close()
+        return retval

Added: trunk/tools/pydar2/pydar/yumbasedbuildroot.py
===================================================================
--- trunk/tools/pydar2/pydar/yumbasedbuildroot.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar/yumbasedbuildroot.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,182 @@
+
+&quot;&quot;&quot; A buildroot based on yum &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+
+import getopt, os, sys, Queue, posix, posixpath, string, re, os.path, shutil, commands
+from log4py import Logger
+from specfile import SpecFile
+
+
+
+class YumBasedBuildRoot(BuildRoot):
+    def __init__(self,myconfig,rootname):
+        self.cat = Logger().get_instance(self)
+        brr = BuildRootResult(self)
+        self.config = myconfig
+        self.rootname = rootname
+        self.setVars(brr)
+        self.cat.debug(&quot;initialized&quot;)
+        return brr
+
+    
+    def cleanRoot(self):
+        self.cat.debug(&quot;cleaning this root..&quot;)
+        brr = BuildRootResult(self)
+        cmd = &quot;sudo umount &quot; + self.rootdir + &quot;/proc&quot;
+        self.logCommandWithoutErrors(cmd,brr)
+        cmd = &quot;sudo umount &quot; + self.rootdir + &quot;/sys&quot;
+        self.logCommandWithoutErrors(cmd,brr)
+        cmd = &quot;sudo rm -Rf &quot; + self.rootdir
+        self.logCommand(cmd,brr)
+        return brr
+        
+    def setVars(self,brr):
+        if self.rootname == &quot;fedora-3-i386-core&quot;:
+            self.rootdir = &quot;/var/lib/pydar2/roots/&quot; + self.rootname
+            self.minimalRpmsPart1 = &quot;basesystem filesystem setup bash glibc&quot;
+            self.minimalRpmsPart2 = &quot;coreutils findutils&quot;
+            self.minimalRpmsPart3 = &quot;rpm-devel rpm-build make gcc tar gzip patch unzip bzip2 diffutils cpio elfutils redhat-rpm-config perl&quot;
+            self.minimalRpmsPart4 = &quot;&quot;
+            self.yumConfFile = &quot;/etc/pydar2/yum/fc3-i386.conf&quot;
+            self.yumCacheDir = &quot;/var/lib/pydar2/yum/cache/fc3-i386&quot;
+        elif self.rootname == &quot;fedora-2-i386-core&quot;:
+            self.rootdir = &quot;/var/lib/pydar2/roots/&quot; + self.rootname
+        elif self.rootname == &quot;fedora-1-i386-core&quot;:
+            self.rootdir = &quot;/var/lib/pydar2/roots/&quot; + self.rootname
+        else:
+            brr.logErrorLine(&quot;unknown rootname: &quot; + self.rootname)
+            self.cat.error(&quot;unknown rootname: &quot; + self.rootname)
+        brr.logDebugLine(&quot;rootdir:&quot; + self.rootdir)
+    
+
+                
+    def installRpms(self,builddepsarr):
+        brr = BuildRootResult(self)
+        commandpart = &quot;&quot;
+        for b in builddepsarr:
+            commandpart = commandpart + &quot; &quot; + b
+        cmd = &quot;sudo yum -c &quot; + self.yumConfFile + &quot; -y -t --installroot=&quot; + self.rootdir + &quot; install &quot; + commandpart
+        self.logCommand(cmd,brr)
+        return brr
+        
+    # makes a new root
+    def prepareRoot(self):
+        brr = BuildRootResult(self)
+        cmd = []
+        # create some directories first
+        cmd.append(&quot;sudo mkdir -p &quot; + self.rootdir + &quot;/var/lib/rpm &quot; + self.rootdir + &quot;/var/log &quot; + self.rootdir + &quot;/var/cache &quot; + self.rootdir + &quot;/etc &quot; + self.rootdir + &quot;/proc &quot; + self.rootdir + &quot;/sys &quot; + self.rootdir + &quot;/usr/src/redhat/BUILD &quot; + self.rootdir + &quot;/usr/src/redhat/RPMS &quot; + self.rootdir + &quot;/usr/src/redhat/SOURCES &quot; + self.rootdir + &quot;/usr/src/redhat/SPECS &quot; + self.rootdir + &quot;/usr/src/redhat/SRPMS &quot; + self.rootdir + &quot;/dev/&quot;)
+        # copy fstab
+        cmd.append(&quot;sudo cp /etc/fstab &quot; + self.rootdir + &quot;/etc&quot;)
+        # mount proc
+        cmd.append(&quot;sudo mount -t proc none &quot; + self.rootdir + &quot;/proc&quot;)
+        # mount sys
+        cmd.append(&quot;sudo mount -t sysfs none &quot; + self.rootdir + &quot;/sys&quot;)
+        # create /dev/null
+        cmd.append(&quot;sudo mknod &quot; + self.rootdir + &quot;/dev/null c 1 3&quot;)
+        # rpm initdb
+        cmd.append(&quot;sudo rpm --root=&quot; + self.rootdir + &quot; --initdb&quot;)
+        # use a central yum cache
+        cmd.append(&quot;sudo ln -s &quot; + self.yumCacheDir + &quot; &quot; + self.rootdir + &quot;/var/cache/yum&quot;)
+        # install the rpms
+        if self.minimalRpmsPart1 != &quot;&quot;:
+            cmd.append(&quot;sudo yum -c &quot; + self.yumConfFile + &quot; -y -t --installroot=&quot; + self.rootdir + &quot; install &quot; + self.minimalRpmsPart1)
+        if self.minimalRpmsPart2 != &quot;&quot;:
+            cmd.append(&quot;sudo yum -c &quot; + self.yumConfFile + &quot; -y -t --installroot=&quot; + self.rootdir + &quot; install &quot; + self.minimalRpmsPart2)
+        if self.minimalRpmsPart3 != &quot;&quot;:
+            cmd.append(&quot;sudo yum -c &quot; + self.yumConfFile + &quot; -y -t --installroot=&quot; + self.rootdir + &quot; install &quot; + self.minimalRpmsPart3)
+        if self.minimalRpmsPart4 != &quot;&quot;:
+            cmd.append(&quot;sudo yum -c &quot; + self.yumConfFile + &quot; -y -t --installroot=&quot; + self.rootdir + &quot; install &quot; + self.minimalRpmsPart4)
+        self.logCommands(cmd,brr)
+        return brr
+        
+    def logCommands(self,cmdArr,brr):
+        for cmd in cmdArr:
+            self.logCommand(cmd,brr)
+            # todo: if error =&gt; stop
+        
+    def logCommand(self,cmd,brr):
+        brr.logDebugLine(&quot;CMD: Command line:&quot; + cmd)
+        (status,output) = commands.getstatusoutput(cmd)
+        brr.logDebugLine(&quot;CMD: Status:&quot; + str(status))
+        # first remove all the '\rInstalling: .*? [0-9][0-9]? % done [0-9]*\/[0-9]*
+        output = re.sub('\rInstalling: .*? [0-9][0-9]? % done [0-9]*\/[0-9]*',&quot;&quot;,output)
+        output = re.sub('\r',&quot;&quot;,output)
+        brr.logDebugLine(&quot;CMD: output:&quot; + str(output))
+        if status != 0:
+            brr.logErrorLine(&quot;CMD: status is not 0 !&quot;)
+        
+    def logCommandWithoutErrors(self,cmd,brr):
+        brr.logDebugLine(&quot;CMD: Command line:&quot; + cmd)
+        (status,output) = commands.getstatusoutput(cmd)
+        brr.logDebugLine(&quot;CMD: Status:&quot; + str(status))
+        # first remove all the '\rInstalling: .*? [0-9][0-9]? % done [0-9]*\/[0-9]*
+        output = re.sub('\rInstalling: .*? [0-9][0-9]? % done [0-9]*\/[0-9]*',&quot;&quot;,output)
+        output = re.sub('\r',&quot;&quot;,output)
+        brr.logDebugLine(&quot;CMD: output:&quot; + str(output))
+        
+    def buildRpm(self,spec,releasetag):
+        brr = BuildRootResult(self)
+        self.cat.debug(&quot;start,spec=&quot; + spec.filename)
+        # download (if needed) and copy the sources
+        self.copySources(spec,brr)
+        # copy the spec file and modify it first (releasetag, svnid)
+        self.copySpecFile(spec,releasetag)
+        # create a script which does the actual building
+        self.createScript(spec,brr)
+        # then we call the script
+        self.callBuildScript(brr)
+        # then we get the buildlog and config.log if needed
+        self.getLogs(brr)
+        # then we parse it for rpm files
+        self.parseLogForRpmFiles(brr)
+        return brr
+    
+    def copySources(spec,brr):
+        # todo: the sources should be available in a certain dir
+        self.cat.debug(&quot;start&quot;)
+        
+    def copySpecFile(spec,brr)
+        # todo
+        self.cat.debug(&quot;start&quot;)
+        
+    def createScript(spec,brr)
+        # todo
+        self.cat.debug(&quot;start&quot;)
+        script = &quot;#!/bin/bash\n&quot;
+        script = script + 'for i in /etc/profile.d/*.sh; do' + &quot;\n&quot;
+        script = script + '    if [ -r &quot;$i&quot; ]; then' + &quot;\n&quot;
+        script = script + '        . $i' + &quot;\n&quot;
+        script = script + &quot;    fi\n&quot;
+        script = script + &quot;done\n&quot;
+
+        
+    def callBuildScript(brr)
+        cmd = &quot;sudo chroot &quot; + self.rootdir + &quot;/bin/bash /pydar2build.sh&quot;
+        self.logCommand(cmd,brr)
+    
+# tests
+myRoot = YumBasedBuildRoot(&quot;&quot;,&quot;fedora-3-i386-core&quot;)
+myRoot.cleanRoot()
+myRoot.prepareRoot()
+spec = SpecFile('/home/dries/projects/rap-svn/svn/trunk/rpms/aldo/aldo.spec',' --define &quot;fc3 1&quot; ')
+myRoot.installRpms(spec.getBuildRequires())
+myRoot.
+print myRoot.logText
+
+
+

Added: trunk/tools/pydar2/pydar-buildserver-master.py
===================================================================
--- trunk/tools/pydar2/pydar-buildserver-master.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar-buildserver-master.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,174 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot; Accept commands from clients or slave systems and store a queue in a database &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+import getopt, os, sys, Queue, posix, posixpath, string
+from log4py import Logger
+sys.path.append(&quot;/usr/share/pydar/pydar&quot;)
+sys.path.append(&quot;pydar&quot;)
+from xmlrpclib import Server
+from SimpleXMLRPCServer import SimpleXMLRPCServer
+from config import Config
+from thread import start_new_thread
+from command import Command
+from store import Store
+import time
+
+
+os.environ['HOME'] = '/root'
+
+# This class contains the functions which get called by RPC clients
+# these functions must check if the caller has a valid ID
+
+class MasterRpc:
+    def __init__(self,myconfig,mystore):
+        self.cat = Logger().get_instance(self)
+        self.config = myconfig
+        self.store = mystore
+        self.cat.debug(&quot;initialized&quot;)
+
+    # a slave wants to register itself (timestamp is saved)
+    def registerSlave(self,buildmachineId):
+        self.cat.debug(&quot;start, buildmachineId=&quot; + buildmachineId)
+        if self.store.checkIfValidBuildMachineId(buildmachineId):
+            self.store.registerSlave(buildmachineId)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN BUILDMACHINEID&quot;
+
+    # used for debugging, not needed anymore
+#    def longWait(self):
+#        self.cat.debug(&quot;start&quot;)
+#        time.sleep(200)
+#        self.cat.debug(&quot;end&quot;)
+#        return &quot;OK&quot;
+
+    def sendResultFileName(self, buildmachineid, commandId,fileName):
+        self.cat.debug(&quot;buildmachineid=&quot; + buildmachineid + &quot;,commandId=&quot; + str(commandId) + &quot;,fileName=&quot; + fileName)
+        if self.store.checkIfValidBuildMachineId(buildmachineid):
+            self.store.addResultFileName(buildmachineid,commandId,fileName)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN BUILDMACHINEID&quot;
+
+    def sendBuildResult(self, buildmachineid, commandId, buildResult):
+        self.cat.debug(&quot;start,buildmachineid=&quot; + buildmachineid + &quot;,commandId=&quot; + str(commandId) + &quot;,buildResult=&quot; + str(buildResult))
+        if self.store.checkIfValidBuildMachineId(buildmachineid):
+            self.store.setBuildResult(buildmachineid,commandId,buildResult)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN BUILDMACHINEID&quot;
+
+
+    def addMachRoot(self,buildmachineId,machRoot):
+        METHOD_NAME = &quot;MasterRpc::addMachRoot(..) - &quot;
+        self.cat.debug(&quot;start, buildmachineId=&quot; + buildmachineId + &quot;, machRoot=&quot; + machRoot)
+        if self.store.checkIfValidBuildMachineId(buildmachineId):
+            self.store.addMachRoot(buildmachineId,machRoot)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN BUILDMACHINEID&quot;
+
+
+    def getCommand(self,buildmachineId):
+        self.cat.debug(&quot;start, buildmachineId=&quot; + buildmachineId)
+        if self.store.checkIfValidBuildMachineId(buildmachineId):
+            aCommand = self.store.reserveCommand(buildmachineId)
+            return aCommand
+        else:
+            return &quot;UNKNOWN BUILDMACHINEID&quot;
+
+
+    def buildSpec(self, userId, specFileName, toEmail, releaseTag, machRoot, priority):
+        self.cat.debug(&quot;start, userId=&quot; + userId + &quot;,specFileName=&quot; + specFileName + &quot;,toEmail=&quot; + toEmail + &quot;,releaseTag=&quot; + releaseTag + &quot;,machRoot=&quot; + machRoot + &quot;,priority=&quot; + priority)
+        if self.store.checkIfValidUserId(userId):
+            self.store.createCommand(&quot;BUILD&quot;,userId, specFileName,toEmail,releaseTag,machRoot,priority)
+            #self.commandQueue.put(aCommand)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN USERID&quot;
+
+    def testBuildSpec(self, userId, specFileContents, toEmail, releaseTag, machRoot, priority):
+        self.cat.debug(&quot;start, userId=&quot; + userId + &quot;,specFileContents.length=&quot; + str(len(specFileContents)) + &quot;,toEmail=&quot; + toEmail + &quot;,releaseTag=&quot; + releaseTag + &quot;,machRoot=&quot; + machRoot + &quot;,priority=&quot; + priority)
+        if self.store.checkIfValidUserId(userId):
+            self.store.createCommand(&quot;TESTBUILD&quot;,userId, specFileContents,toEmail,releaseTag,machRoot,priority)
+            #self.commandQueue.put(aCommand)
+            return &quot;OK&quot;
+        else:
+            return &quot;UNKNOWN USERID&quot;
+
+
+class Master:
+    def __init__(self,myconfig):
+        self.cat = Logger().get_instance(self)
+        self.config = myconfig
+        # open a connection to the db
+        self.store = Store(self.config)
+        self.cat.debug(&quot;initialized&quot;)
+
+    def run(self):
+        self.cat.debug(&quot;start&quot;)
+        self.startListener()
+
+    def startListener(self):
+        # open a listen socket and wait for commands from the master
+        self.cat.debug(&quot;buildmasterhostname=&quot; +self.config.buildmasterhostname + &quot;,buildmasterport=&quot; + str(self.config.buildmasterport))
+        myslaveserver = SimpleXMLRPCServer((self.config.buildmasterhostname,self.config.buildmasterport))
+        myslaveserver.register_instance(MasterRpc(self.config,self.store))
+        myslaveserver.serve_forever()
+
+
+def main():
+        myConfig = Config()
+        myInstance = Master(myConfig)
+        myInstance.run()
+
+
+# code from <A HREF="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66012">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66012</A>
+if __name__ == &quot;__main__&quot;:
+    if len(sys.argv) &gt; 2 and sys.argv[1] == &quot;-d&quot;:
+        # do the UNIX double-fork magic, see Stevens' &quot;Advanced 
+        # Programming in the UNIX Environment&quot; for details (ISBN 0201563177)
+        try: 
+            pid = os.fork()
+            if pid &gt; 0:
+                # exit first parent
+                sys.exit(0)
+        except OSError, e:
+            print &gt;&gt;sys.stderr, &quot;fork #1 failed: %d (%s)&quot; % (e.errno, e.strerror) 
+            sys.exit(1)
+
+        # decouple from parent environment
+        os.chdir(&quot;/&quot;) 
+        os.setsid()
+        os.umask(0) 
+
+        # do second fork
+        try: 
+            pid = os.fork() 
+            if pid &gt; 0:
+                # exit from second parent, print eventual PID before
+                print &quot;Daemon PID %d&quot; % pid 
+                sys.exit(0) 
+        except OSError, e: 
+            print &gt;&gt;sys.stderr, &quot;fork #2 failed: %d (%s)&quot; % (e.errno, e.strerror) 
+            sys.exit(1) 
+        # start the daemon main loop
+	main()
+    else:
+        main()


Property changes on: trunk/tools/pydar2/pydar-buildserver-master.py
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/pydar2/pydar-buildserver-slave.py
===================================================================
--- trunk/tools/pydar2/pydar-buildserver-slave.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/pydar-buildserver-slave.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -0,0 +1,314 @@
+#!/usr/bin/python
+
+&quot;&quot;&quot; The slave daemon which does the actual building &quot;&quot;&quot;
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Copyright 2004 Dries Verachtert
+
+
+import getopt, os, sys, Queue, posix, posixpath, string, re, os.path, shutil
+sys.path.append(&quot;/usr/share/pydar/pydar&quot;)
+sys.path.append(&quot;pydar&quot;)
+from log4py import Logger
+from config import Config
+from command import Command
+import xmlrpclib
+from SimpleXMLRPCServer import SimpleXMLRPCServer
+from xmlrpclib import Server
+import time
+from svnwrapper import SvnWrapper
+from stringfile import StringFile
+import mach
+import smtplib
+from svn import fs, repos
+from email.MIMEText import MIMEText
+
+class Slave:
+    def __init__(self,myconfig):
+        self.cat = Logger().get_instance(self)
+        self.config = myconfig
+        self.dirMapping = {}
+        self.cat.debug(&quot;initialized&quot;)
+
+    def run(self):
+        self.cat.debug(&quot;url of master: &quot; + self.config.buildmasterurl)
+        self.cat.debug(&quot;local buildmachineid: &quot; + self.config.buildmachineid)
+        self.myserverclient = Server(self.config.buildmasterurl)
+        # let the master now that we exist
+        self.notifyMaster()
+        # wait for commands from the master
+        #self.startListener()
+        self.doBuilds()
+
+    def notifyMaster(self):
+        # do a call to the master server so he knows
+        # we're ready to build rpms
+        retval = self.myserverclient.registerSlave(self.config.buildmachineid)
+        self.cat.debug(&quot;retval:&quot; + retval)
+        for m in self.config.machroots:
+            self.cat.debug(&quot;machroot:&quot; + m)
+            retval = self.myserverclient.addMachRoot(self.config.buildmachineid, m)
+            self.cat.debug(&quot;retval=&quot; + retval)
+        self.cat.debug(&quot;notify done&quot;)
+
+    def doSvnUpdate(self):
+        self.cat.debug(&quot;start&quot;)
+        svnwrap = SvnWrapper(self.config)
+        svnwrap.startTransaction()
+        svnwrap.updateLocalCopy()
+        svnwrap.stopTransaction()
+        self.cat.debug(&quot;end&quot;)
+
+    def doCheckAllSpecs(self):
+        self.cat.debug(&quot;start&quot;)
+        self.dirMapping = {}
+        rpmsDirList = posix.listdir(self.config.mastersvnrpmsdir)
+        for rpmDir in rpmsDirList:
+            #self.cat.debug(&quot;rpmDir=&quot; + rpmDir)
+            fullRpmDir = posixpath.join(self.config.mastersvnrpmsdir,rpmDir)
+            if posixpath.isdir(fullRpmDir):
+                #self.cat.debug(&quot;it's a dir!&quot;)
+                fileList = posix.listdir(fullRpmDir)
+                for file in fileList:
+                    #self.cat.debug(&quot;part1:&quot; + str(string.rfind(file,'.spec')))
+                    #self.cat.debug(&quot;part2:&quot; + str(len(file) - len('.spec')))
+                    rindex = string.rfind(file,'.spec')
+                    if rindex &gt; 0 and rindex == len(file) - len('.spec'):
+                        #self.cat.debug(&quot;spec match, file=&quot; + file)
+                        self.doCheckSpec(rpmDir, fullRpmDir, file)
+
+    def doCheckSpec(self,rpmDirName,fullRpmDir,specFileName):
+        self.dirMapping[specFileName] = fullRpmDir;
+
+    def getLastChangedSvnRevId(self, dirName, specName):
+        svnwrap = SvnWrapper(self.cat,self.config)
+        svnwrap.startTransaction()
+        retval = svnwrap.getLastCommitRev(dirName,dirName + &quot;/&quot; + specName)
+        svnwrap.stopTransaction()
+        return string.rstrip(str(retval))
+
+    def doBuildSpec(self,command):
+        # choose one implementation
+        doBuildSpecRsyncYumBased(self,command):
+        specFileName = command.specName
+        lastChangedSvnRevId = self.getLastChangedSvnRevId(self.dirMapping[specFileName], command.specName)
+        self.cat.debug(&quot;start, specFileName=&quot; + specFileName)
+        
+    
+    def doBuildSpecRsyncYumBased(self,command):
+        specFileName = command.specName
+        lastChangedSvnRevId = self.getLastChangedSvnRevId(self.dirMapping[specFileName], command.specName)
+        self.cat.debug(&quot;start, specFileName=&quot; + specFileName)
+        
+        
+        
+    def doBuildSpecMachBased(self,command):
+        specFileName=command.specName
+        lastChangedSvnRevId = self.getLastChangedSvnRevId(self.dirMapping[specFileName], command.specName)
+        finalOutputDir = &quot;&quot;
+        self.cat.debug(&quot;start, specFileName=&quot; + specFileName)
+        buffer = StringFile()
+        buffer2 = StringFile()
+        buildResult = 0
+        srpm = &quot;&quot;
+        rpms = ()
+        try:
+            self.cat.debug(&quot;dir will be: &quot; + self.dirMapping[specFileName])
+            mach.config['quiet'] = 1
+            mach.config['release'] = command.releaseTag
+            mach.config['lastchangedsvnrevid'] = lastChangedSvnRevId
+            mach.config['defaultroot'] = command.machRoot
+            self.cat.debug(&quot;mach config set to quiet&quot;)
+            os.chdir(self.dirMapping[specFileName])
+            shutil.copyfile(specFileName,'rpmforge-' + specFileName)
+	    commandLine = 'perl -i -npe ' + &quot;'&quot; + 'if ($ch==1) {chomp; $_ = $_ . &quot; #' + lastChangedSvnRevId + '\n&quot;; $ch=0;} if (/\%changelog/) {$ch=1;}' + &quot;' rpmforge-&quot; + specFileName;
+            self.cat.debug(&quot;command: &quot; + commandLine)
+            os.system(commandLine)
+            sys.stdout = buffer2
+            sys.stderr = buffer2
+            mach.config['collect'] = 1
+            mach.DEBUG = 1
+            mach.main(mach.config,[&quot;unlock&quot;])
+            mach.main(mach.config,[&quot;clean&quot;])
+            mach.main(mach.config,[&quot;setup&quot;, &quot;build&quot;])
+            sys.stdout = buffer
+            sys.stderr = buffer
+            myparams = ()
+            if command.machRoot == &quot;fedora-1-i386-core&quot;:
+                myparams = [&quot;build&quot;, 'rpmforge-' + specFileName, '--define', '&quot;fc1', '1&quot;']
+            else:
+                if command.machRoot == &quot;fedora-2-i386-core&quot;:
+                    myparams = [&quot;build&quot;, 'rpmforge-' + specFileName, '--define', '&quot;fc2', '1&quot;']
+                else:
+                    if command.machRoot == &quot;fedora-3-i386-core&quot;:
+                        myparams = [&quot;build&quot;, 'rpmforge-' + specFileName, '--define', '&quot;fc3', '1&quot;']
+                    else:
+                        if command.machRoot == &quot;aurora-1.92-sparc-core&quot;:
+                            myparams = [&quot;build&quot;, 'rpmforge-' + specFileName, '--define', '&quot;fc2', '1&quot;']
+                        else:
+                            myparams = [&quot;build&quot;, 'rpmforge-' + specFileName]
+            print &quot;myparams=&quot;, myparams
+            (srpm, rpms) = mach.main(mach.config,myparams)
+            self.cat.debug(&quot;srpm:&quot; + srpm)
+            self.cat.debug(&quot;rpms:&quot; + str(rpms))
+            buildResult = 1
+            os.mkdir(str(command.commandId))
+            myFileName = self.getRpmFileName(srpm)
+            # os.rename(myFileName , str(command.commandId) + &quot;/&quot; + myFileName)
+            for rpmname in rpms:
+                myFileName = self.getRpmFileName(rpmname)
+                os.rename(myFileName, str(command.commandId) + &quot;/&quot; + myFileName)
+            os.system(&quot;mv *.log *.md5sum *.*.spec &quot; + str(command.commandId))                
+        except:
+            sys.stdout = sys.__stdout__
+            sys.stderr = sys.__stderr__
+            self.cat.debug(&quot;in except part&quot;)
+            self.cat.print_exc()
+            buildResult = 0
+        sys.stdout = sys.__stdout__
+        sys.stderr = sys.__stderr__
+        self.cat.debug(&quot;buffer contains: &quot;)
+        tempbuf = &quot;&quot;
+        for line in buffer.readlines():
+            #self.cat.debug(&quot;line: &quot; + line)
+            tempbuf = tempbuf + line
+        #  blabla to server
+        self.informMasterAfterRebuild(buildResult, tempbuf, srpm, rpms, command, self.dirMapping[specFileName])
+        self.mailOutput(tempbuf,command.toEmail, specFileName, &quot;build: &quot; + str(buildResult), command)
+
+    def doTestBuildSpec(self,command):
+        METHOD_NAME = &quot;Slave::doTestBuildSpec(..) - &quot;
+        specContents=command.specName
+        specFileName=str(command.commandId) + &quot;.spec&quot;
+        finalOutputDir = &quot;&quot;
+        
+        self.cat.debug(&quot;start, specFileName=&quot; + specFileName)
+        buffer = StringFile()
+        buildResult = 0
+        srpm = &quot;&quot;
+        rpms = ()
+        try:
+            specDir = self.config.dirtestbuilds + &quot;/&quot; + str(command.commandId)
+            self.cat.debug(&quot;dir will be: &quot; + specDir)
+            mach.config['quiet'] = 1
+            mach.config['release'] = command.releaseTag
+            mach.config['defaultroot'] = command.machRoot
+            self.cat.debug(&quot;mach config set to quiet&quot;)
+            os.mkdir(specDir)
+            os.chdir(specDir)
+            f = open(specFileName, 'w')
+            f.write(specContents)
+            f.close()
+            sys.stdout = buffer
+            sys.stderr = buffer
+            mach.config['collect'] = 1
+            mach.DEBUG = 1
+            mach.main(mach.config,[&quot;unlock&quot;])
+            (srpm, rpms) = mach.main(mach.config,[&quot;build&quot;,specFileName])
+            self.cat.debug(&quot;srpm:&quot; + srpm)
+            self.cat.debug(&quot;rpms:&quot; + str(rpms))
+            buildResult = 1
+            os.mkdir(str(command.commandId))
+            myFileName = self.getRpmFileName(srpm)
+            os.rename(myFileName , str(command.commandId) + &quot;/&quot; + myFileName)
+            for rpmname in rpms:
+                myFileName = self.getRpmFileName(rpmname)
+                os.rename(myFileName, str(command.commandId) + &quot;/&quot; + myFileName)
+            #os.system(&quot;mv *.log *.md5sum *.*.spec &quot; + str(command.commandId))                
+        except:
+            sys.stdout = sys.__stdout__
+            sys.stderr = sys.__stderr__
+            self.cat.debug(&quot;in except part&quot;)
+            self.cat.print_exc()
+            buildResult = 0
+        sys.stdout = sys.__stdout__
+        sys.stderr = sys.__stderr__
+        self.cat.debug(&quot;buffer contains: &quot;)
+        tempbuf = &quot;&quot;
+        for line in buffer.readlines():
+            self.cat.debug(&quot;line: &quot; + line)
+            tempbuf = tempbuf + line
+        #  blabla to server
+        self.informMasterAfterRebuild(buildResult, tempbuf, srpm, rpms, command, specDir)
+        self.mailOutput(tempbuf,command.toEmail, specFileName, &quot;build: &quot; + str(buildResult), command)
+
+    def informMasterAfterRebuild(self,buildResult, logbuffer, srpmname, rpmsnames, command, dirName):
+        METHOD_NAME=&quot;informMasterAfterRebuild(..) - &quot;
+        self.cat.debug(&quot;start&quot;)
+        if buildResult:
+            fileName = self.getRpmFileName(srpmname)
+            self.myserverclient.sendResultFileName(self.config.buildmachineid, command.commandId,fileName)
+            for rpm in rpmsnames:
+                fileName = self.getRpmFileName(rpm)
+                self.myserverclient.sendResultFileName(self.config.buildmachineid, command.commandId, fileName)
+        self.myserverclient.sendBuildResult(self.config.buildmachineid, command.commandId, buildResult)
+
+
+    def getRpmFileName(self, rpmname):
+        METHOD_NAME = &quot;getRpmFile(..) - &quot;
+        fileName = rpmname[string.rfind(rpmname, '/') + 1:]
+        self.cat.debug(&quot;fileName=&quot; + fileName)
+        return fileName
+
+    def mailOutput(self,output, victim, specName, subjectPart, command):
+        METHOD_NAME = &quot;Slave::mailOutput(..) - &quot;
+        self.cat.debug(&quot;start, victim=&quot; + victim + &quot;, output=&quot; + output)
+        output = &quot;Results can be found at:\<A HREF="nhttp://buildmachine1.edesign.be/">nhttp://buildmachine1.edesign.be/</A>&quot; + string.replace(specName,&quot;.spec&quot;,&quot;&quot;) + &quot;/&quot; + str(command.commandId) + &quot;\n\n&quot; + output
+        msg = MIMEText(output)
+        msg['Subject'] = &quot;pydar: &quot; + command.machRoot + &quot; &quot; + str(command.commandId) + &quot; &quot; + specName + &quot;: &quot; + subjectPart
+        msg['From'] = self.config.mailFrom
+        msg['To'] = victim
+        me = self.config.mailFrom
+        you = victim
+        # copypaste from example on www.python.org
+        s = smtplib.SMTP(self.config.smtpserver)
+        #s.connect()
+        s.sendmail(me, [you], msg.as_string())
+        s.close()
+
+    def doBuilds(self):
+        METHOD_NAME = &quot;Slave::doBuilds(self) - &quot;
+        self.cat.debug(&quot;start&quot;)
+	self.doCheckAllSpecs()
+        while 1:
+            retval = self.myserverclient.getCommand(self.config.buildmachineid)
+            if retval == &quot;&quot;:
+                time.sleep(self.config.sleeptime)
+            else:
+                commandName = retval['commandName']
+                userId = retval['userId']
+                specName = retval['specName']
+                toEmail = retval['toEmail']
+                releaseTag = retval['releaseTag']
+                machRoot = retval['machRoot']
+                commandId = retval['commandId']
+                aCommand = Command(commandName,userId,specName,toEmail,releaseTag,machRoot)
+                aCommand.setCommandId(commandId)
+                self.cat.debug(&quot;aCommand=&quot; + str(aCommand))
+                self.cat.debug(&quot;commandid=&quot; + str(aCommand.commandId))
+                if commandName == &quot;BUILD&quot;:
+                    #self.doSvnUpdate()
+                    self.doCheckAllSpecs()
+                    self.doBuildSpec(aCommand)
+                else:
+                    if commandName == &quot;TESTBUILD&quot;:
+                        self.doTestBuildSpec(aCommand)
+                    else:
+                        self.cat.debug(&quot;command is not BUILD or TESTBUILD ?? commandName=&quot; + commandName)
+
+
+myConfig = Config()
+myInstance = Slave(myConfig)
+myInstance.run()


Property changes on: trunk/tools/pydar2/pydar-buildserver-slave.py
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/tools/pydar2/tests/specfile-test.py
===================================================================
--- trunk/tools/pydar2/tests/specfile-test.py	2005-01-01 20:10:16 UTC (rev 2730)
+++ trunk/tools/pydar2/tests/specfile-test.py	2005-01-01 20:51:30 UTC (rev 2731)
@@ -25,7 +25,7 @@
 
 # all paths relative from svn/trunk/tools/pydar2/tests/ directory
 
-sf = SpecFile('../../../rpms/aget/aget.spec',' --define &quot;fc2 1&quot;')
+sf = SpecFile('../../../rpms/aldo/aldo.spec',' --define &quot;fc3 1&quot;')
 
 for tag in sf.rpmforgetags:
     print 'rpmforge tag: ' + tag
@@ -33,3 +33,4 @@
 for tag in sf.standardtags:
     print 'standard tag: ' + tag
     print 'value: ' + sf.standardtags[tag]
+print str(sf.getBuildRequires())


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001535.html">[SVN] r2730 - in trunk/rpms: . gambas luola luola-levels mathomatic	perl-RPC-XML
</A></li>
	<LI>Next message: <A HREF="001537.html">[SVN] r2732 - in trunk/rpms: . elmo gpgme libtar perl-DNS-BL	perl-Test-Reporter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1536">[ date ]</a>
              <a href="thread.html#1536">[ thread ]</a>
              <a href="subject.html#1536">[ subject ]</a>
              <a href="author.html#1536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
