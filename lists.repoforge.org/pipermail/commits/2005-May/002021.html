<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r3219 - trunk/tools/pydar2/pydar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3219%20-%20trunk/tools/pydar2/pydar&In-Reply-To=%3C20050517204232.57C291D02A0%40pooch.vmhosting.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002020.html">
   <LINK REL="Next"  HREF="002022.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r3219 - trunk/tools/pydar2/pydar</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3219%20-%20trunk/tools/pydar2/pydar&In-Reply-To=%3C20050517204232.57C291D02A0%40pooch.vmhosting.org%3E"
       TITLE="[svn] r3219 - trunk/tools/pydar2/pydar">packagers at lists.rpmforge.net
       </A><BR>
    <I>Tue May 17 22:42:32 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002020.html">[svn] r3218 - trunk/rpms/vcdimager
</A></li>
        <LI>Next message: <A HREF="002022.html">[svn] r3220 - trunk/rpms/amule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2021">[ date ]</a>
              <a href="thread.html#2021">[ thread ]</a>
              <a href="subject.html#2021">[ subject ]</a>
              <a href="author.html#2021">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dries
Date: 2005-05-17 22:42:31 +0200 (Tue, 17 May 2005)
New Revision: 3219

Modified:
   trunk/tools/pydar2/pydar/rpmforgesite.py
Log:
update

Modified: trunk/tools/pydar2/pydar/rpmforgesite.py
===================================================================
--- trunk/tools/pydar2/pydar/rpmforgesite.py	2005-05-17 13:58:11 UTC (rev 3218)
+++ trunk/tools/pydar2/pydar/rpmforgesite.py	2005-05-17 20:42:31 UTC (rev 3219)
@@ -34,12 +34,14 @@
     so.generate()
     
 class DistroArchObject:
-    def __init__(self,shortName,displayName, rpmsUrl):
+    def __init__(self,shortName,displayName, rpmsUrl, suffixes, fullName):
         self.shortName = shortName
         self.displayName = displayName
         self.rpmsUrl = rpmsUrl
         self.rpms = []
         self.srpms = []
+        self.suffixes = suffixes
+        self.fullName = fullName
     
 class SiteObject:
     def __init__(self,specRepo):
@@ -50,13 +52,14 @@
         self.__siterootdir =  &quot;/tmp/packages/&quot;
         self.__storage = storagefactory.StorageFactory.getStorage()
         self.__rpmlists = []
-        self.__rpmlists.append(DistroArchObject(&quot;el4-i386-dries&quot;, &quot;el4 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;el3-i386-dries&quot;, &quot;el3 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;fc3-i386-dries&quot;, &quot;fc3 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;fc2-i386-dries&quot;, &quot;fc2 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;fc1-i386-dries&quot;, &quot;fc1 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;au1.92-sparc-dries&quot;, &quot;au1.92 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/</A>&quot;))
-        #self.__rpmlists.append(DistroArchObject(&quot;au1.91-sparc-dries&quot;, &quot;au1.91 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/</A>&quot;))
+        self.__rpmlists.append(DistroArchObject(&quot;el4-i386-dries&quot;, &quot;el4 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>&quot;, [&quot;el4.rf&quot;], &quot;Red Hat Enterprise Linux 4 for i386&quot;))
+        self.__rpmlists.append(DistroArchObject(&quot;el3-i386-dries&quot;, &quot;el3 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>&quot;, [&quot;el3.rf&quot;], &quot;Red Hat Enterprise Linux 3 for i386&quot;))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc3-i386-dries&quot;, &quot;fc3 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>&quot;, [&quot;fc3.rf&quot;, &quot;fc3.dries&quot;], &quot;Fedora Core 3 for i386&quot;))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc2-i386-dries&quot;, &quot;fc2 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/</A>&quot;[&quot;fc2.rf&quot;, &quot;fc2.dries&quot;], &quot;Fedora Core 2 for i386&quot;))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc1-i386-dries&quot;, &quot;fc1 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/</A>&quot;, [&quot;fc1.rf&quot;, &quot;fc1.dries&quot;], &quot;Fedora Core 1 for i386&quot;))
+        #self.__rpmlists.append(DistroArchObject(&quot;au1.92-sparc-dries&quot;, &quot;au1.92 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/</A>&quot;, [&quot;au1.92.rf&quot;, &quot;au1.92.dries&quot;], &quot;Aurora 1.92 for sparc&quot;))
+        #self.__rpmlists.append(DistroArchObject(&quot;au1.91-sparc-dries&quot;, &quot;au1.91 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/</A>&quot;, [&quot;au1.91.rf&quot;, &quot;au1.92.dries&quot;],&quot;Aurora 1.91 for sparc&quot;))
+        self.__rpmNameToSpecSubDirName = {}
         self.__completeRpmsLists()
         
     def __completeRpmsLists(self):
@@ -86,6 +89,7 @@
                     if i&lt;len(packagenames):
                         print &quot;match: &quot; + rpm + &quot;, package=&quot; + packagenames[i]
                         nametospecrepospecfile[packagenames[i]].rpmfilenames.append(listje.rpmsUrl + rpm)
+                        self.__rpmNameToSpecSubDirName[rpm] = packagenames[i]
                 lijn = f.readline()
             f.close()
             
@@ -108,6 +112,7 @@
                     if i&lt;len(packagenames):
                         print &quot;match: &quot; + rpm + &quot;, package=&quot; + packagenames[i]
                         nametospecrepospecfile[packagenames[i]].srpmfilenames.append(listje.rpmsUrl.replace(&quot;RPMS&quot;,&quot;SRPMS&quot;) + rpm)
+                        self.__rpmNameToSpecSubDirName[rpm] = packagenames[i]
                 lijn = f.readline()
             f.close()
         
@@ -121,10 +126,33 @@
         
     def generate(self):
         # generate the content
-       self.generatePackagesPage() 
-       for i in self.__specRepo.getSpecRepositorySpecFiles():
+        self.generatePackagesPage() 
+        for i in self.__specRepo.getSpecRepositorySpecFiles():
             self.generateOnePackagePage(i)
+        for i in self.__rpmlists:
+            self.generateDistroArchPageRpm(i)
+            self.generateDistroArchPageSrpm(i)
             
+            
+    def generateDistroArchPageRpm(self,distroArch):
+        contents = &quot;&quot;
+        contents = &quot;&lt;h2&gt;Rpms for &quot; + distroArch.fullName + &quot;&lt;/h2&gt;&quot;
+        for r in distroArch.rpms:
+            linkToPackage = &quot;&quot;
+            if r in self.__rpmNameToSpecSubDirName:
+                linkToPackage = &quot;&amp;nbsp;-&amp;nbsp&lt;a href=\&quot;/packages/&quot; + self.__rpmNameToSpecSubDirName[r] + &quot;/info.html\&quot;&gt;&quot; + self.__rpmNameToSpecSubDirName[r] + &quot;&lt;/a&gt;&quot;
+            contents = contents + &quot;&lt;a href=\&quot;&quot; + distroArch.rpmsUrl + r + &quot;\&quot;&gt;&quot; + r + &quot;&lt;/a&gt;&quot; + linkToPackage + &quot;&lt;br /&gt;&quot;
+        self.generateFullPage(contents, [distroArch.displayName], distroArch.shortName + &quot;-rpms.html&quot;,distroArch.displayName + &quot;: Dries RPM Repository&quot;)
+    
+    def generateDistroArchPageSrpm(self,distroArch):
+        contents = &quot;&quot;
+        url = distroArch.rpmsUrl.replace(&quot;RPMS&quot;,&quot;SRPMS&quot;)
+        contents = &quot;&lt;h2&gt;Srpms for &quot; + distroArch.fullName + &quot;&lt;/h2&gt;&quot;
+        for r in distroArch.rpms:
+            contents = contents + &quot;&lt;a href=\&quot;&quot; + url + r + &quot;\&quot;&gt;&quot; + r + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+        self.generateFullPage(contents, [distroArch.displayName], distroArch.shortName + &quot;-srpms.html&quot;,distroArch.displayName + &quot;: Dries RPM Repository&quot;)
+        
+            
     def generatePackagesPage(self):
         contents = &quot;&quot;
         for i in self.__specRepo.getSpecRepositorySpecFiles():
@@ -153,7 +181,10 @@
         menu = menu + &quot;&lt;a href=\&quot;/rpm/packages.html\&quot;&gt;List of packages&lt;/a&gt;&lt;br /&gt;&quot;
         menu = menu + &quot;&lt;a href=\&quot;/rpm/RPM-GPG-KEY.dries.txt\&quot;&gt;GPG key&lt;/a&gt;&lt;br /&gt;&quot;
         for k in self.__rpmlists:
-            menu = menu + &quot;&lt;a href=\&quot;/rpm/&quot; + k.shortName + &quot;.html\&quot;&gt;&quot; + k.displayName + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+            menu = menu + &quot;&lt;a href=\&quot;/rpm/&quot; + k.shortName + &quot;-rpms.html\&quot;&gt;&quot; + k.displayName + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+        for k in self.__rpmlists:
+            menu = menu + &quot;&lt;a href=\&quot;/rpm/&quot; + k.shortName + &quot;-srpms.html\&quot;&gt;&quot; + k.displayName.replace(&quot;rpms&quot;,&quot;srpms&quot;) + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+            
         menu = menu + &quot;&quot;
         return menu
         
@@ -202,16 +233,27 @@
         contents = contents + &quot;&lt;/pre&gt;&quot;
         self.generateFullPage(contents, [&quot;Packages&quot;,shortName, &quot;Spec file of &quot; + shortName], &quot;packages/&quot; + shortName  + &quot;/&quot; + shortName + &quot;-spec.html&quot;, &quot;Spec file of &quot; + shortName)
         
+    def getDistroNameFromRpmName(self, rpm):
+        for distro in self.__rpmlists:
+            for suf in distro.suffixes:
+                if rpm.rfind(suf) &gt; 0:
+                    return distro.fullName
+        
     def generateOnePackagePageFirstPage(self, specRepoSpecFile, versions):
         shortName = specRepoSpecFile.getSubDir()
         contents = &quot;&quot;
         contents = contents + &quot;&lt;h2&gt;General info:&lt;/h2&gt;&lt;br /&gt;&quot;
         contents = contents + &quot;&lt;h2&gt;Rpms:&lt;/h2&gt;&lt;br /&gt;&quot;
         for f in specRepoSpecFile.rpmfilenames:
-            contents = contents + &quot;&lt;a href=\&quot; + f + \&quot;&gt;&quot; + f + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+            #print f.rfind(&quot;/&quot;) , len(f)
+            short = f[f.rfind(&quot;/&quot;) +1: len(f)]
+            distroName = self.getDistroNameFromRpmName(short)
+            contents = contents + &quot;&lt;a href=\&quot;&quot; + f + &quot;\&quot;&gt;&quot; + short + &quot;&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + distroName + &quot;&lt;br /&gt;&quot;
         contents = contents + &quot;&lt;h2&gt;Srpms:&lt;/h2&gt;&lt;br /&gt;&quot;
         for f in specRepoSpecFile.srpmfilenames:
-            contents = contents + &quot;&lt;a href=\&quot; + f + \&quot;&gt;&quot; + f + &quot;&lt;/a&gt;&lt;br /&gt;&quot;
+            short = f[f.rfind(&quot;/&quot;)+1:  len(f)]
+            distroName = self.getDistroNameFromRpmName(short)
+            contents = contents + &quot;&lt;a href=\&quot;&quot; + f + &quot;\&quot;&gt;&quot; + short + &quot;&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; + distroName + &quot;&lt;br /&gt;&quot;
         contents = contents + &quot;&lt;h2&gt;Spec info:&lt;/h2&gt;&lt;br /&gt;&quot;
         contents = contents + &quot;Spec filename: &quot; + specRepoSpecFile.getFileName() + &quot;&lt;br /&gt;&quot;
         contents = contents + &quot;View spec: &lt;a href=\&quot;&quot; + specRepoSpecFile.getSubDir() + &quot;-spec.html\&quot;&gt;&quot; + specRepoSpecFile.getSubDir() + &quot; spec file&lt;/a&gt;&lt;br /&gt;&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002020.html">[svn] r3218 - trunk/rpms/vcdimager
</A></li>
	<LI>Next message: <A HREF="002022.html">[svn] r3220 - trunk/rpms/amule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2021">[ date ]</a>
              <a href="thread.html#2021">[ thread ]</a>
              <a href="subject.html#2021">[ subject ]</a>
              <a href="author.html#2021">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
