<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r1775 - trunk/rpms/thunderbird
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1775%20-%20trunk/rpms/thunderbird&In-Reply-To=%3C20040727165132.1737C1FCAA%40server01.nl.egwn.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000583.html">
   <LINK REL="Next"  HREF="000585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r1775 - trunk/rpms/thunderbird</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1775%20-%20trunk/rpms/thunderbird&In-Reply-To=%3C20040727165132.1737C1FCAA%40server01.nl.egwn.net%3E"
       TITLE="[SVN] r1775 - trunk/rpms/thunderbird">svn-commits at rpmforge.net
       </A><BR>
    <I>Tue Jul 27 18:51:32 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000583.html">[SVN] r1774 - in trunk/rpms: dvgrab firefox kino php-mmcache	php-pecl-mailparse videolan-client
</A></li>
        <LI>Next message: <A HREF="000585.html">[SVN] r1776 - in trunk/rpms: . hddtemp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#584">[ date ]</a>
              <a href="thread.html#584">[ thread ]</a>
              <a href="subject.html#584">[ subject ]</a>
              <a href="author.html#584">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dude
Date: 2004-07-27 18:51:29 +0200 (Tue, 27 Jul 2004)
New Revision: 1775

Added:
   trunk/rpms/thunderbird/thunderbird-0.7.2-gcc34.patch
Removed:
   trunk/rpms/thunderbird/mozilla-1.4-x86_64.patch
   trunk/rpms/thunderbird/mozilla-1.6-gtk2xtbin.patch
   trunk/rpms/thunderbird/mozilla-xremote.patch
   trunk/rpms/thunderbird/thunderbird-icon.png
Modified:
   trunk/rpms/thunderbird/thunderbird.spec
Log:
Update to 0.7.2, the startup script probably still needs tweaking, though.


Deleted: trunk/rpms/thunderbird/mozilla-1.4-x86_64.patch
===================================================================
--- trunk/rpms/thunderbird/mozilla-1.4-x86_64.patch	2004-07-27 16:02:28 UTC (rev 1774)
+++ trunk/rpms/thunderbird/mozilla-1.4-x86_64.patch	2004-07-27 16:51:29 UTC (rev 1775)
@@ -1,685 +0,0 @@
---- mozilla/nsprpub/pr/include/md/_linux.cfg.foo	Wed Feb 26 18:53:38 2003
-+++ mozilla/nsprpub/pr/include/md/_linux.cfg	Thu Jun 19 14:08:14 2003
-@@ -182,6 +182,52 @@
- #define PR_BYTES_PER_WORD_LOG2  3
- #define PR_BYTES_PER_DWORD_LOG2 3
- 
-+#elif defined(__x86_64__)
-+
-+#define IS_LITTLE_ENDIAN 1
-+#undef  IS_BIG_ENDIAN
-+#define IS_64
-+
-+#define PR_BYTES_PER_BYTE   1
-+#define PR_BYTES_PER_SHORT  2
-+#define PR_BYTES_PER_INT    4
-+#define PR_BYTES_PER_INT64  8
-+#define PR_BYTES_PER_LONG   8
-+#define PR_BYTES_PER_FLOAT  4
-+#define PR_BYTES_PER_DOUBLE 8
-+#define PR_BYTES_PER_WORD   8
-+#define PR_BYTES_PER_DWORD  8
-+
-+#define PR_BITS_PER_BYTE    8
-+#define PR_BITS_PER_SHORT   16
-+#define PR_BITS_PER_INT     32
-+#define PR_BITS_PER_INT64   64
-+#define PR_BITS_PER_LONG    64
-+#define PR_BITS_PER_FLOAT   32
-+#define PR_BITS_PER_DOUBLE  64
-+#define PR_BITS_PER_WORD    64
-+
-+#define PR_BITS_PER_BYTE_LOG2   3
-+#define PR_BITS_PER_SHORT_LOG2  4
-+#define PR_BITS_PER_INT_LOG2    5
-+#define PR_BITS_PER_INT64_LOG2  6
-+#define PR_BITS_PER_LONG_LOG2   6
-+#define PR_BITS_PER_FLOAT_LOG2  5
-+#define PR_BITS_PER_DOUBLE_LOG2 6
-+#define PR_BITS_PER_WORD_LOG2   6
-+
-+#define PR_ALIGN_OF_SHORT   2
-+#define PR_ALIGN_OF_INT     4
-+#define PR_ALIGN_OF_LONG    8
-+#define PR_ALIGN_OF_INT64   8
-+#define PR_ALIGN_OF_FLOAT   4
-+#define PR_ALIGN_OF_DOUBLE  8
-+#define PR_ALIGN_OF_POINTER 8
-+#define PR_ALIGN_OF_WORD    8
-+
-+#define PR_BYTES_PER_WORD_LOG2  3
-+#define PR_BYTES_PER_DWORD_LOG2 3
-+
- #elif defined(__mc68000__)
- 
- #undef  IS_LITTLE_ENDIAN
---- mozilla/nsprpub/pr/include/md/_linux.h.foo	Wed Feb 26 18:53:39 2003
-+++ mozilla/nsprpub/pr/include/md/_linux.h	Thu Jun 19 14:08:14 2003
-@@ -49,6 +49,8 @@
- #define _PR_SI_ARCHITECTURE &quot;alpha&quot;
- #elif defined(__ia64__)
- #define _PR_SI_ARCHITECTURE &quot;ia64&quot;
-+#elif defined(__x86_64__)
-+#define _PR_SI_ARCHITECTURE &quot;x86-64&quot;
- #elif defined(__mc68000__)
- #define _PR_SI_ARCHITECTURE &quot;m68k&quot;
- #elif defined(__sparc__)
-@@ -107,6 +109,19 @@
- #define _MD_ATOMIC_SET                _PR_ia64_AtomicSet
- #endif
- 
-+#if defined(__x86_64__)
-+#define _PR_HAVE_ATOMIC_OPS
-+#define _MD_INIT_ATOMIC()
-+extern PRInt32 _PR_x86_64_AtomicIncrement(PRInt32 *val);
-+#define _MD_ATOMIC_INCREMENT          _PR_x86_64_AtomicIncrement
-+extern PRInt32 _PR_x86_64_AtomicDecrement(PRInt32 *val);
-+#define _MD_ATOMIC_DECREMENT          _PR_x86_64_AtomicDecrement
-+extern PRInt32 _PR_x86_64_AtomicAdd(PRInt32 *ptr, PRInt32 val);
-+#define _MD_ATOMIC_ADD                _PR_x86_64_AtomicAdd
-+extern PRInt32 _PR_x86_64_AtomicSet(PRInt32 *val, PRInt32 newval);
-+#define _MD_ATOMIC_SET                _PR_x86_64_AtomicSet
-+#endif
-+
- #define USE_SETJMP
- #if defined(__GLIBC__) &amp;&amp; __GLIBC__ &gt;= 2
- #define _PR_POLL_AVAILABLE
---- mozilla/nsprpub/pr/src/io/prprf.c.foo	Wed Feb 26 18:53:42 2003
-+++ mozilla/nsprpub/pr/src/io/prprf.c	Thu Jun 19 14:08:14 2003
-@@ -51,7 +51,10 @@
- ** Note: on some platforms va_list is defined as an array,
- ** and requires array notation.
- */
--#if (defined(LINUX) &amp;&amp; defined(__powerpc__)) || \
-+#if (defined(LINUX) &amp;&amp; defined(__x86_64__))
-+#include &lt;stdarg.h&gt;
-+#define VARARGS_ASSIGN(foo, bar) __va_copy((foo), (bar))
-+#elif (defined(LINUX) &amp;&amp; defined(__powerpc__)) || \
-     (defined(LINUX) &amp;&amp; defined(__s390__)) || \
-     (defined(LINUX) &amp;&amp; defined(__s390x__)) || \
-     defined(WIN16) || defined(QNX) || \
---- mozilla/nsprpub/pr/src/md/unix/os_Linux_x86_64.s.foo	Thu Jun 19 14:08:14 2003
-+++ mozilla/nsprpub/pr/src/md/unix/os_Linux_x86_64.s	Thu Jun 19 14:08:14 2003
-@@ -0,0 +1,91 @@
-+/ -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*-
-+/ 
-+/ The contents of this file are subject to the Mozilla Public
-+/ License Version 1.1 (the &quot;License&quot;); you may not use this file
-+/ except in compliance with the License. You may obtain a copy of
-+/ the License at <A HREF="http://www.mozilla.org/MPL/">http://www.mozilla.org/MPL/</A>
-+/ 
-+/ Software distributed under the License is distributed on an &quot;AS
-+/ IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or
-+/ implied. See the License for the specific language governing
-+/ rights and limitations under the License.
-+/ 
-+/ The Original Code is the Netscape Portable Runtime (NSPR).
-+/ 
-+/ The Initial Developer of the Original Code is Netscape
-+/ Communications Corporation.  Portions created by Netscape are 
-+/ Copyright (C) 2000 Netscape Communications Corporation.  All
-+/ Rights Reserved.
-+/ 
-+/ Contributor(s):
-+/ 
-+/ Alternatively, the contents of this file may be used under the
-+/ terms of the GNU General Public License Version 2 or later (the
-+/ &quot;GPL&quot;), in which case the provisions of the GPL are applicable 
-+/ instead of those above.  If you wish to allow use of your 
-+/ version of this file only under the terms of the GPL and not to
-+/ allow others to use your version of this file under the MPL,
-+/ indicate your decision by deleting the provisions above and
-+/ replace them with the notice and other provisions required by
-+/ the GPL.  If you do not delete the provisions above, a recipient
-+/ may use your version of this file under either the MPL or the
-+/ GPL.
-+/ 
-+
-+/ PRInt32 _PR_x86_64_AtomicIncrement(PRInt32 *val)
-+/
-+/ Atomically increment the integer pointed to by 'val' and return
-+/ the result of the increment.
-+/
-+    .text
-+    .globl _PR_x86_64_AtomicIncrement
-+    .align 4
-+_PR_x86_64_AtomicIncrement:
-+    movl $1, %eax
-+    lock
-+    xaddl %eax, (%rdi)
-+    incl %eax
-+    ret
-+
-+/ PRInt32 _PR_x86_64_AtomicDecrement(PRInt32 *val)
-+/
-+/ Atomically decrement the integer pointed to by 'val' and return
-+/ the result of the decrement.
-+/
-+    .text
-+    .globl _PR_x86_64_AtomicDecrement
-+    .align 4
-+_PR_x86_64_AtomicDecrement:
-+    movl $-1, %eax
-+    lock
-+    xaddl %eax, (%rdi)
-+    decl %eax
-+    ret
-+
-+/ PRInt32 _PR_x86_64_AtomicSet(PRInt32 *val, PRInt32 newval)
-+/
-+/ Atomically set the integer pointed to by 'val' to the new
-+/ value 'newval' and return the old value.
-+    .text
-+    .globl _PR_x86_64_AtomicSet
-+    .align 4
-+_PR_x86_64_AtomicSet:
-+    movl %esi, %eax
-+    lock
-+    xchgl %eax, (%rdi)
-+    ret
-+
-+/ PRInt32 _PR_x86_64_AtomicAdd(PRInt32 *ptr, PRInt32 val)
-+/
-+/ Atomically add 'val' to the integer pointed to by 'ptr'
-+/ and return the result of the addition.
-+/
-+    .text
-+    .globl _PR_x86_64_AtomicAdd
-+    .align 4
-+_PR_x86_64_AtomicAdd:
-+    movl %esi, %eax
-+    lock
-+    xaddl %eax, (%rdi)
-+    addl %esi, %eax
-+    ret
---- mozilla/nsprpub/configure.in.foo	Mon May 19 15:05:48 2003
-+++ mozilla/nsprpub/configure.in	Thu Jun 19 14:08:14 2003
-@@ -1218,6 +1218,9 @@
-     ia64)
-         PR_MD_ASFILES=os_Linux_ia64.s
-         ;;
-+    x86_64)
-+        PR_MD_ASFILES=os_Linux_x86_64.s
-+        ;;
-     m68k)
-         CFLAGS=&quot;$CFLAGS -m68020-60&quot;
-         CXXFLAGS=&quot;$CXXFLAGS -m68020-60&quot;
---- mozilla/nsprpub/configure.foo	Mon May 19 15:05:42 2003
-+++ mozilla/nsprpub/configure	Thu Jun 19 14:08:14 2003
-@@ -3729,6 +3729,9 @@
-     ia64)
-         PR_MD_ASFILES=os_Linux_ia64.s
-         ;;
-+    x86_64)
-+        PR_MD_ASFILES=os_Linux_x86_64.s
-+        ;;
-     m68k)
-         CFLAGS=&quot;$CFLAGS -m68020-60&quot;
-         CXXFLAGS=&quot;$CXXFLAGS -m68020-60&quot;
---- mozilla/security/coreconf/Linux.mk.foo	Wed Apr 30 20:31:20 2003
-+++ mozilla/security/coreconf/Linux.mk	Thu Jun 19 14:08:14 2003
-@@ -66,6 +66,10 @@
- 	OS_REL_CFLAGS	= -DLINUX1_2 -D_XOPEN_SOURCE
- 	CPU_ARCH	= ia64
- else
-+ifeq ($(OS_TEST),x86_64)
-+	OS_REL_CFLAGS	= -DLINUX1_2 -D_XOPEN_SOURCE
-+	CPU_ARCH	= x86_64
-+else
- ifeq ($(OS_TEST),sparc)
- 	OS_REL_CFLAGS   = -DLINUX1_2 -D_XOPEN_SOURCE
- 	CPU_ARCH        = sparc
-@@ -99,6 +103,7 @@
- endif
- endif
- endif
-+endif
- endif
- endif
- endif
---- mozilla/directory/c-sdk/ldap/libraries/liblber/lber-int.h.foo	Tue Mar 26 16:53:23 2002
-+++ mozilla/directory/c-sdk/ldap/libraries/liblber/lber-int.h	Thu Jun 19 14:08:14 2003
-@@ -236,23 +236,22 @@
- 	     (((_l)&amp;0xff0000)&gt;&gt;8) + (((_l)&amp;0xff000000)&gt;&gt;24))
- #define LBER_NTOHL(_l) LBER_HTONL(_l)
- 
--#elif !defined(__alpha) || defined(VMS)
-+#elif !defined(__x86_64__) &amp;&amp; (!defined(__alpha) || defined(VMS))
- 
- #define LBER_HTONL( l )	htonl( l )
- #define LBER_NTOHL( l )	ntohl( l )
- 
- #else /* __alpha */
- /*
-- * htonl and ntohl on the DEC Alpha under OSF 1 seem to only swap the
-- * lower-order 32-bits of a (64-bit) long, so we define correct versions
-- * here.
-+ * htonl and ntohl on the 64-bit UNIX platforms only swap the lower-order
-+ * 32-bits of a (64-bit) long, so we define correct versions here.
-  */
- #define LBER_HTONL( l )	(((long)htonl( (l) &amp; 0x00000000FFFFFFFF )) &lt;&lt; 32 \
-     			| htonl( ( (l) &amp; 0xFFFFFFFF00000000 ) &gt;&gt; 32 ))
- 
- #define LBER_NTOHL( l )	(((long)ntohl( (l) &amp; 0x00000000FFFFFFFF )) &lt;&lt; 32 \
-     			| ntohl( ( (l) &amp; 0xFFFFFFFF00000000 ) &gt;&gt; 32 ))
--#endif /* __alpha */
-+#endif /* __alpha || __x86_64__ */
- 
- 
- /* function prototypes */
---- mozilla/config/mkdepend/imakemdep.h.foo	Sat Sep  5 00:22:25 1998
-+++ mozilla/config/mkdepend/imakemdep.h	Thu Jun 19 14:08:14 2003
-@@ -277,6 +277,9 @@
- # ifdef __i386__
- 	&quot;-D__i386__&quot;,
- # endif
-+# ifdef __x86_64__
-+	&quot;-D__x86_64__&quot;,
-+# endif
- # ifdef __GNUC__
- 	&quot;-traditional&quot;,
- # endif
---- mozilla/xpcom/reflect/xptcall/src/md/unix/Makefile.in.foo	Wed Jun 18 23:01:13 2003
-+++ mozilla/xpcom/reflect/xptcall/src/md/unix/Makefile.in	Thu Jun 19 14:11:52 2003
-@@ -55,10 +55,15 @@
- # Migrate other platforms here after testing
- #
- ifneq (,$(filter Linux,$(OS_ARCH)))
-+# Linux/x86-64
-+ifeq (x86_64,$(OS_TEST))
-+CPPSRCS		:= xptcinvoke_x86_64_linux.cpp xptcstubs_x86_64_linux.cpp
-+else
- ifeq (86,$(findstring 86,$(OS_TEST)))
- CPPSRCS		:= xptcinvoke_gcc_x86_unix.cpp xptcstubs_gcc_x86_unix.cpp
- endif
- endif
-+endif
- # IA64 Linux
- ifneq (,$(filter Linux,$(OS_ARCH)))
- ifneq (,$(findstring ia64,$(OS_TEST)))
---- mozilla/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_linux.cpp.foo	Thu Jun 19 14:08:14 2003
-+++ mozilla/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_linux.cpp	Thu Jun 19 14:08:14 2003
-@@ -0,0 +1,174 @@
-+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
-+// Platform specific code to invoke XPCOM methods on native objects
-+
-+#include &quot;xptcprivate.h&quot;
-+
-+// 6 integral parameters are passed in registers
-+const PRUint32 GPR_COUNT = 6;
-+
-+// 8 floating point parameters are passed in SSE registers
-+const PRUint32 FPR_COUNT = 8;
-+
-+// Remember that these 'words' are 64-bit long
-+static inline void
-+invoke_count_words(PRUint32 paramCount, nsXPTCVariant * s,
-+                   PRUint32 &amp; nr_gpr, PRUint32 &amp; nr_fpr, PRUint32 &amp; nr_stack)
-+{
-+    nr_gpr = 1; // skip one GP register for 'that'
-+    nr_fpr = 0;
-+    nr_stack = 0;
-+
-+    /* Compute number of eightbytes of class MEMORY.  */
-+    for (uint32 i = 0; i &lt; paramCount; i++, s++) {
-+        if (!s-&gt;IsPtrData()
-+            &amp;&amp; (s-&gt;type == nsXPTType::T_FLOAT || s-&gt;type == nsXPTType::T_DOUBLE)) {
-+            if (nr_fpr &lt; FPR_COUNT)
-+                nr_fpr++;
-+            else
-+                nr_stack++;
-+        }
-+        else {
-+            if (nr_gpr &lt; GPR_COUNT)
-+                nr_gpr++;
-+            else
-+                nr_stack++;
-+        }
-+    }
-+}
-+
-+static void
-+invoke_copy_to_stack(PRUint64 * d, PRUint32 paramCount, nsXPTCVariant * s,
-+                     PRUint64 * gpregs, double * fpregs)
-+{
-+    PRUint32 nr_gpr = 1; // skip one GP register for 'that'
-+    PRUint32 nr_fpr = 0;
-+    PRUint64 value;
-+
-+    for (uint32 i = 0; i &lt; paramCount; i++, s++) {
-+        if (s-&gt;IsPtrData())
-+            value = (PRUint64) s-&gt;ptr;
-+        else {
-+            switch (s-&gt;type) {
-+            case nsXPTType::T_FLOAT:                                break;
-+            case nsXPTType::T_DOUBLE:                               break;
-+            case nsXPTType::T_I8:     value = s-&gt;val.i8;            break;
-+            case nsXPTType::T_I16:    value = s-&gt;val.i16;           break;
-+            case nsXPTType::T_I32:    value = s-&gt;val.i32;           break;
-+            case nsXPTType::T_I64:    value = s-&gt;val.i64;           break;
-+            case nsXPTType::T_U8:     value = s-&gt;val.u8;            break;
-+            case nsXPTType::T_U16:    value = s-&gt;val.u16;           break;
-+            case nsXPTType::T_U32:    value = s-&gt;val.u32;           break;
-+            case nsXPTType::T_U64:    value = s-&gt;val.u64;           break;
-+            case nsXPTType::T_BOOL:   value = s-&gt;val.b;             break;
-+            case nsXPTType::T_CHAR:   value = s-&gt;val.c;             break;
-+            case nsXPTType::T_WCHAR:  value = s-&gt;val.wc;            break;
-+            default:                  value = (PRUint64) s-&gt;val.p;  break;
-+            }
-+        }
-+
-+        if (!s-&gt;IsPtrData() &amp;&amp; s-&gt;type == nsXPTType::T_DOUBLE) {
-+            if (nr_fpr &lt; FPR_COUNT)
-+                fpregs[nr_fpr++] = s-&gt;val.d;
-+            else {
-+                *((double *)d) = s-&gt;val.d;
-+                d++;
-+            }
-+        }
-+        else if (!s-&gt;IsPtrData() &amp;&amp; s-&gt;type == nsXPTType::T_FLOAT) {
-+            if (nr_fpr &lt; FPR_COUNT)
-+                // The value in %xmm register is already prepared to
-+                // be retrieved as a float. Therefore, we pass the
-+                // value verbatim, as a double without conversion.
-+                fpregs[nr_fpr++] = s-&gt;val.d;
-+            else {
-+                *((float *)d) = s-&gt;val.f;
-+                d++;
-+            }
-+        }
-+        else {
-+            if (nr_gpr &lt; GPR_COUNT)
-+                gpregs[nr_gpr++] = value;
-+            else
-+                *d++ = value;
-+        }
-+    }
-+}
-+
-+extern &quot;C&quot;
-+XPTC_PUBLIC_API(nsresult)
-+XPTC_InvokeByIndex(nsISupports * that, PRUint32 methodIndex,
-+                   PRUint32 paramCount, nsXPTCVariant * params)
-+{
-+    PRUint32 nr_gpr, nr_fpr, nr_stack;
-+    invoke_count_words(paramCount, params, nr_gpr, nr_fpr, nr_stack);
-+    
-+    // Stack, if used, must be 16-bytes aligned
-+    if (nr_stack)
-+        nr_stack = (nr_stack + 1) &amp; ~1;
-+
-+    // Load parameters to stack, if necessary
-+    PRUint64 *stack = (PRUint64 *) __builtin_alloca(nr_stack * 8);
-+    PRUint64 gpregs[GPR_COUNT];
-+    double fpregs[FPR_COUNT];
-+    invoke_copy_to_stack(stack, paramCount, params, gpregs, fpregs);
-+
-+    // Load FPR registers from fpregs[]
-+    register double d0 asm(&quot;xmm0&quot;);
-+    register double d1 asm(&quot;xmm1&quot;);
-+    register double d2 asm(&quot;xmm2&quot;);
-+    register double d3 asm(&quot;xmm3&quot;);
-+    register double d4 asm(&quot;xmm4&quot;);
-+    register double d5 asm(&quot;xmm5&quot;);
-+    register double d6 asm(&quot;xmm6&quot;);
-+    register double d7 asm(&quot;xmm7&quot;);
-+
-+    switch (nr_fpr) {
-+#define ARG_FPR(N) \
-+    case N+1: d##N = fpregs[N];
-+        ARG_FPR(7);
-+        ARG_FPR(6);
-+        ARG_FPR(5);
-+        ARG_FPR(4);
-+        ARG_FPR(3);
-+        ARG_FPR(2);
-+        ARG_FPR(1);
-+        ARG_FPR(0);
-+    case 0:;
-+#undef ARG_FPR
-+    }
-+    
-+    // Load GPR registers from gpregs[]
-+    register PRUint64 a0 asm(&quot;rdi&quot;);
-+    register PRUint64 a1 asm(&quot;rsi&quot;);
-+    register PRUint64 a2 asm(&quot;rdx&quot;);
-+    register PRUint64 a3 asm(&quot;rcx&quot;);
-+    register PRUint64 a4 asm(&quot;r8&quot;);
-+    register PRUint64 a5 asm(&quot;r9&quot;);
-+    
-+    switch (nr_gpr) {
-+#define ARG_GPR(N) \
-+    case N+1: a##N = gpregs[N];
-+        ARG_GPR(5);
-+        ARG_GPR(4);
-+        ARG_GPR(3);
-+        ARG_GPR(2);
-+        ARG_GPR(1);
-+    case 1: a0 = (PRUint64) that;
-+    case 0:;
-+#undef ARG_GPR
-+    }
-+
-+    // Ensure that assignments to SSE registers won't be optimized away
-+    asm(&quot;&quot; ::
-+        &quot;x&quot; (d0), &quot;x&quot; (d1), &quot;x&quot; (d2), &quot;x&quot; (d3),
-+        &quot;x&quot; (d4), &quot;x&quot; (d5), &quot;x&quot; (d6), &quot;x&quot; (d7));
-+    
-+    // Get pointer to method
-+    PRUint64 methodAddress = *((PRUint64 *)that);
-+    methodAddress += 8 * methodIndex;
-+    methodAddress = *((PRUint64 *)methodAddress);
-+    
-+    typedef PRUint32 (*Method)(PRUint64, PRUint64, PRUint64, PRUint64, PRUint64, PRUint64);
-+    PRUint32 result = ((Method)methodAddress)(a0, a1, a2, a3, a4, a5);
-+    return result;
-+}
---- mozilla/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp.foo	Thu Jun 19 14:08:14 2003
-+++ mozilla/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp	Thu Jun 19 14:08:14 2003
-@@ -0,0 +1,206 @@
-+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
-+
-+// Implement shared vtbl methods.
-+
-+#include &quot;xptcprivate.h&quot;
-+
-+// The Linux/x86-64 ABI passes the first 6 integral parameters and the
-+// first 8 floating point parameters in registers (rdi, rsi, rdx, rcx,
-+// r8, r9 and xmm0-xmm7), no stack space is allocated for these by the
-+// caller.  The rest of the parameters are passed in the callers stack
-+// area.
-+
-+const PRUint32 PARAM_BUFFER_COUNT   = 16;
-+const PRUint32 GPR_COUNT            = 6;
-+const PRUint32 FPR_COUNT            = 8;
-+
-+// PrepareAndDispatch() is called by SharedStub() and calls the actual method.
-+//
-+// - 'args[]' contains the arguments passed on stack
-+// - 'gpregs[]' contains the arguments passed in integer registers
-+// - 'fpregs[]' contains the arguments passed in floating point registers
-+// 
-+// The parameters are mapped into an array of type 'nsXPTCMiniVariant'
-+// and then the method gets called.
-+
-+extern &quot;C&quot; nsresult
-+PrepareAndDispatch(nsXPTCStubBase * self, PRUint32 methodIndex,
-+                   PRUint64 * args, PRUint64 * gpregs, double *fpregs)
-+{
-+    nsXPTCMiniVariant paramBuffer[PARAM_BUFFER_COUNT];
-+    nsXPTCMiniVariant* dispatchParams = NULL;
-+    nsIInterfaceInfo* iface_info = NULL;
-+    const nsXPTMethodInfo* info;
-+    PRUint32 paramCount;
-+    PRUint32 i;
-+    nsresult result = NS_ERROR_FAILURE;
-+
-+    NS_ASSERTION(self,&quot;no self&quot;);
-+
-+    self-&gt;GetInterfaceInfo(&amp;iface_info);
-+    NS_ASSERTION(iface_info,&quot;no interface info&quot;);
-+    if (! iface_info)
-+        return NS_ERROR_UNEXPECTED;
-+
-+    iface_info-&gt;GetMethodInfo(PRUint16(methodIndex), &amp;info);
-+    NS_ASSERTION(info,&quot;no method info&quot;);
-+    if (! info)
-+        return NS_ERROR_UNEXPECTED;
-+
-+    paramCount = info-&gt;GetParamCount();
-+
-+    // setup variant array pointer
-+    if(paramCount &gt; PARAM_BUFFER_COUNT)
-+        dispatchParams = new nsXPTCMiniVariant[paramCount];
-+    else
-+        dispatchParams = paramBuffer;
-+
-+    NS_ASSERTION(dispatchParams,&quot;no place for params&quot;);
-+    if (! dispatchParams)
-+        return NS_ERROR_OUT_OF_MEMORY;
-+
-+    PRUint64* ap = args;
-+    PRUint32 nr_gpr = 1;    // skip one GPR register for 'that'
-+    PRUint32 nr_fpr = 0;
-+    PRUint64 value;
-+
-+    for(i = 0; i &lt; paramCount; i++) {
-+        const nsXPTParamInfo&amp; param = info-&gt;GetParam(i);
-+        const nsXPTType&amp; type = param.GetType();
-+        nsXPTCMiniVariant* dp = &amp;dispatchParams[i];
-+	
-+        if (!param.IsOut() &amp;&amp; type == nsXPTType::T_DOUBLE) {
-+            if (nr_fpr &lt; FPR_COUNT)
-+                dp-&gt;val.d = fpregs[nr_fpr++];
-+            else
-+                dp-&gt;val.d = *(double*) ap++;
-+            continue;
-+        }
-+        else if (!param.IsOut() &amp;&amp; type == nsXPTType::T_FLOAT) {
-+            if (nr_fpr &lt; FPR_COUNT)
-+                // The value in %xmm register is already prepared to
-+                // be retrieved as a float. Therefore, we pass the
-+                // value verbatim, as a double without conversion.
-+                dp-&gt;val.d = *(double*) ap++;
-+            else
-+                dp-&gt;val.f = *(float*) ap++;
-+            continue;
-+        }
-+        else {
-+            if (nr_gpr &lt; GPR_COUNT)
-+                value = gpregs[nr_gpr++];
-+            else
-+                value = *ap++;
-+        }
-+
-+        if (param.IsOut() || !type.IsArithmetic()) {
-+            dp-&gt;val.p = (void*) value;
-+            continue;
-+        }
-+
-+        switch (type) {
-+        case nsXPTType::T_I8:      dp-&gt;val.i8  = (PRInt8)   value; break;
-+        case nsXPTType::T_I16:     dp-&gt;val.i16 = (PRInt16)  value; break;
-+        case nsXPTType::T_I32:     dp-&gt;val.i32 = (PRInt32)  value; break;
-+        case nsXPTType::T_I64:     dp-&gt;val.i64 = (PRInt64)  value; break;
-+        case nsXPTType::T_U8:      dp-&gt;val.u8  = (PRUint8)  value; break;
-+        case nsXPTType::T_U16:     dp-&gt;val.u16 = (PRUint16) value; break;
-+        case nsXPTType::T_U32:     dp-&gt;val.u32 = (PRUint32) value; break;
-+        case nsXPTType::T_U64:     dp-&gt;val.u64 = (PRUint64) value; break;
-+        case nsXPTType::T_BOOL:    dp-&gt;val.b   = (PRBool)   value; break;
-+        case nsXPTType::T_CHAR:    dp-&gt;val.c   = (char)     value; break;
-+        case nsXPTType::T_WCHAR:   dp-&gt;val.wc  = (wchar_t)  value; break;
-+
-+        default:
-+            NS_ASSERTION(0, &quot;bad type&quot;);
-+            break;
-+        }
-+    }
-+
-+    result = self-&gt;CallMethod((PRUint16) methodIndex, info, dispatchParams);
-+
-+    NS_RELEASE(iface_info);
-+
-+    if (dispatchParams != paramBuffer)
-+        delete [] dispatchParams;
-+
-+    return result;
-+}
-+
-+#if defined(__GXX_ABI_VERSION) &amp;&amp; __GXX_ABI_VERSION &gt;= 100 /* G++ V3 ABI */
-+// Linux/x86-64 uses gcc &gt;= 3.1
-+#define STUB_ENTRY(n) \
-+asm(&quot;.section	\&quot;.text\&quot;\n\t&quot; \
-+    &quot;.align	2\n\t&quot; \
-+    &quot;.if	&quot; #n &quot; &lt; 10\n\t&quot; \
-+    &quot;.globl	_ZN14nsXPTCStubBase5Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.type	_ZN14nsXPTCStubBase5Stub&quot; #n &quot;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">Ev, at function</A>\n&quot; \
-+    &quot;_ZN14nsXPTCStubBase5Stub&quot; #n &quot;Ev:\n\t&quot; \
-+    &quot;.elseif	&quot; #n &quot; &lt; 100\n\t&quot; \
-+    &quot;.globl	_ZN14nsXPTCStubBase6Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.type	_ZN14nsXPTCStubBase6Stub&quot; #n &quot;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">Ev, at function</A>\n&quot; \
-+    &quot;_ZN14nsXPTCStubBase6Stub&quot; #n &quot;Ev:\n\t&quot; \
-+    &quot;.elseif    &quot; #n &quot; &lt; 1000\n\t&quot; \
-+    &quot;.globl     _ZN14nsXPTCStubBase7Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.type      _ZN14nsXPTCStubBase7Stub&quot; #n &quot;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">Ev, at function</A>\n&quot; \
-+    &quot;_ZN14nsXPTCStubBase7Stub&quot; #n &quot;Ev:\n\t&quot; \
-+    &quot;.else\n\t&quot; \
-+    &quot;.err	\&quot;stub number &quot; #n &quot; &gt;= 1000 not yet supported\&quot;\n\t&quot; \
-+    &quot;.endif\n\t&quot; \
-+    &quot;movl	$&quot; #n &quot;, %eax\n\t&quot; \
-+    &quot;jmp	SharedStub\n\t&quot; \
-+    &quot;.if	&quot; #n &quot; &lt; 10\n\t&quot; \
-+    &quot;.size	_ZN14nsXPTCStubBase5Stub&quot; #n &quot;Ev,.-_ZN14nsXPTCStubBase5Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.elseif	&quot; #n &quot; &lt; 100\n\t&quot; \
-+    &quot;.size	_ZN14nsXPTCStubBase6Stub&quot; #n &quot;Ev,.-_ZN14nsXPTCStubBase6Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.else\n\t&quot; \
-+    &quot;.size	_ZN14nsXPTCStubBase7Stub&quot; #n &quot;Ev,.-_ZN14nsXPTCStubBase7Stub&quot; #n &quot;Ev\n\t&quot; \
-+    &quot;.endif&quot;);
-+
-+// static nsresult SharedStub(PRUint32 methodIndex)
-+asm(&quot;.section   \&quot;.text\&quot;\n\t&quot;
-+    &quot;.align     2\n\t&quot;
-+    &quot;.type      <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">SharedStub, at function</A>\n\t&quot;
-+    &quot;SharedStub:\n\t&quot;
-+    // make room for gpregs (48), fpregs (64)
-+    &quot;pushq      %rbp\n\t&quot;
-+    &quot;movq       %rsp,%rbp\n\t&quot;
-+    &quot;subq       $112,%rsp\n\t&quot;
-+    // save GP registers
-+    &quot;movq       %rdi,-112(%rbp)\n\t&quot;
-+    &quot;movq       %rsi,-104(%rbp)\n\t&quot;
-+    &quot;movq       %rdx, -96(%rbp)\n\t&quot;
-+    &quot;movq       %rcx, -88(%rbp)\n\t&quot;
-+    &quot;movq       %r8 , -80(%rbp)\n\t&quot;
-+    &quot;movq       %r9 , -72(%rbp)\n\t&quot;
-+    &quot;leaq       -112(%rbp),%rcx\n\t&quot;
-+    // save FP registers
-+    &quot;movsd      %xmm0,-64(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm1,-56(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm2,-48(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm3,-40(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm4,-32(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm5,-24(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm6,-16(%rbp)\n\t&quot;
-+    &quot;movsd      %xmm7, -8(%rbp)\n\t&quot;
-+    &quot;leaq       -64(%rbp),%r8\n\t&quot;
-+    // rdi has the 'self' pointer already
-+    &quot;movl       %eax,%esi\n\t&quot;
-+    &quot;leaq       16(%rbp),%rdx\n\t&quot;
-+    &quot;call       <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">PrepareAndDispatch at plt</A>\n\t&quot;
-+    &quot;leave\n\t&quot;
-+    &quot;ret\n\t&quot;
-+    &quot;.size      SharedStub,.-SharedStub&quot;);
-+
-+#define SENTINEL_ENTRY(n) \
-+nsresult nsXPTCStubBase::Sentinel##n() \
-+{ \
-+    NS_ASSERTION(0,&quot;nsXPTCStubBase::Sentinel called&quot;); \
-+    return NS_ERROR_NOT_IMPLEMENTED; \
-+}
-+
-+#include &quot;xptcstubsdef.inc&quot;
-+
-+#else
-+#error &quot;can't find a compiler to use&quot;
-+#endif /* __GNUC__ */

Deleted: trunk/rpms/thunderbird/mozilla-1.6-gtk2xtbin.patch
===================================================================
--- trunk/rpms/thunderbird/mozilla-1.6-gtk2xtbin.patch	2004-07-27 16:02:28 UTC (rev 1774)
+++ trunk/rpms/thunderbird/mozilla-1.6-gtk2xtbin.patch	2004-07-27 16:51:29 UTC (rev 1775)
@@ -1,19 +0,0 @@
---- widget/src/gtkxtbin/gtk2xtbin.c.orig	2002-12-14 23:03:56.000000000 +0100
-+++ widget/src/gtkxtbin/gtk2xtbin.c	2004-01-17 01:06:58.000000000 +0100
-@@ -511,7 +511,7 @@
-                    int width ) 
- {
-   int           n;
--  Arg           args[5];
-+  Arg           args[6];
-   Widget        child_widget;
-   Widget        top_widget;
- 
-@@ -540,6 +540,7 @@
-   XtSetArg(args[n], XtNvisual,   xtclient-&gt;xtvisual ); n++;
-   XtSetArg(args[n], XtNdepth,    xtclient-&gt;xtdepth ); n++;
-   XtSetArg(args[n], XtNcolormap, xtclient-&gt;xtcolormap ); n++;
-+  XtSetArg(args[n], XtNborderWidth, 0); n++;
-   XtSetValues(child_widget, args, n);
- 
-   XSync(xtclient-&gt;xtdisplay, FALSE);

Deleted: trunk/rpms/thunderbird/mozilla-xremote.patch
===================================================================
--- trunk/rpms/thunderbird/mozilla-xremote.patch	2004-07-27 16:02:28 UTC (rev 1774)
+++ trunk/rpms/thunderbird/mozilla-xremote.patch	2004-07-27 16:51:29 UTC (rev 1775)
@@ -1,973 +0,0 @@
-? toolkit/components/build/dependentLibs.h
-? toolkit/components/passwordmgr/resources/content/contents.rdf
-? toolkit/components/passwordmgr/resources/locale/contents.rdf
-? toolkit/content/contents-platform.rdf
-? toolkit/content/contents-region.rdf
-? toolkit/content/contents.rdf
-? toolkit/locale/contents-platform.rdf
-? toolkit/locale/contents-region.rdf
-? toolkit/locale/contents.rdf
-? toolkit/mozapps/contents-content.rdf
-? toolkit/mozapps/contents-locale.rdf
-? toolkit/mozapps/downloads/src/nsHelperAppDlg.js
-? xpfe/appshell/src/dependentLibs.h
-? xpfe/components/build/dependentLibs.h
-? xpfe/components/find/src/dependentLibs.h
-? xpfe/global/buildconfig.html
-? widget/src/gtk2/dependentLibs.h
-? widget/src/xremoteclient/dependentLibs.h
-Index: configure.in
-===================================================================
-RCS file: /cvsroot/mozilla/configure.in,v
-retrieving revision 1.1324
-diff -u -r1.1324 configure.in
---- configure.in	10 Mar 2004 01:31:23 -0000	1.1324
-+++ configure.in	12 Mar 2004 21:22:18 -0000
-@@ -3370,6 +3370,7 @@
- 
- AC_SUBST(MOZ_STANDALONE_COMPOSER)
- AC_SUBST(MOZ_XUL_APP)
-+AC_DEFINE_UNQUOTED(MOZ_APP_NAME, &quot;$MOZ_APP_NAME&quot;)
- 
- dnl ========================================================
- dnl = FreeType2
-Index: toolkit/xre/nsAppRunner.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/toolkit/xre/nsAppRunner.cpp,v
-retrieving revision 1.25
-diff -u -r1.25 nsAppRunner.cpp
---- toolkit/xre/nsAppRunner.cpp	4 Mar 2004 22:59:50 -0000	1.25
-+++ toolkit/xre/nsAppRunner.cpp	12 Mar 2004 21:22:18 -0000
-@@ -53,6 +53,7 @@
- #include &quot;plevent.h&quot;
- #include &quot;prmem.h&quot;
- #include &quot;prnetdb.h&quot;
-+#include &quot;prenv.h&quot;
- 
- #include &quot;nsCOMPtr.h&quot;
- #include &quot;nsIAppShell.h&quot;
-@@ -1259,7 +1260,7 @@
-   nsCOMPtr&lt;nsIXRemoteService&gt; remoteService;
-   remoteService = do_GetService(NS_IXREMOTESERVICE_CONTRACTID);
-   if (remoteService)
--    remoteService-&gt;Startup();
-+    remoteService-&gt;Startup(MOZ_APP_NAME);
- #endif /* MOZ_ENABLE_XREMOTE */
- 
-   // remove the nativeApp as an XPCOM autoreg observer
-@@ -1425,7 +1426,7 @@
-       *aArgUsed = PR_TRUE;
-       // check to make sure there's another arg
-       if (argc-1 == i) {
--        PR_fprintf(PR_STDERR, &quot;-remote requires an argument\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: -remote requires an argument\n&quot;);
-         return 1;
-       }
-       // try to get the X remote client
-@@ -1436,19 +1437,30 @@
-       // try to init - connects to the X server and stuff
-       rv = client-&gt;Init();
-       if (NS_FAILED(rv)) {
--        PR_fprintf(PR_STDERR, &quot;Failed to connect to X server.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: Failed to connect to X server.\n&quot;);
-         return 1;
-       }
-       PRBool success = PR_FALSE;
--      rv = client-&gt;SendCommand(argv[i+1], &amp;success);
-+      char *logname = PR_GetEnv(&quot;LOGNAME&quot;);
-+      char *response = NULL;
-+      rv = client-&gt;SendCommand(MOZ_APP_NAME, logname, NULL, argv[i+1],
-+                               &amp;response, &amp;success);
-       // did the command fail?
-       if (NS_FAILED(rv)) {
--        PR_fprintf(PR_STDERR, &quot;Failed to send command.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: Failed to send command: &quot;);
-+        if (response) {
-+          PR_fprintf(PR_STDERR, &quot;%s\n&quot;, response);
-+          free(response);
-+        }
-+        else {
-+          PR_fprintf(PR_STDERR, &quot;No response included.\n&quot;);
-+        }
-+
-         return 1;
-       }
-       // was there a window not running?
-       if (!success) {
--        PR_fprintf(PR_STDERR, &quot;No running window found.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: No running window found.\n&quot;);
-         return 2;
-       }
-       client-&gt;Shutdown();
-Index: xpfe/bootstrap/nsAppRunner.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/xpfe/bootstrap/nsAppRunner.cpp,v
-retrieving revision 1.410
-diff -u -r1.410 nsAppRunner.cpp
---- xpfe/bootstrap/nsAppRunner.cpp	8 Mar 2004 23:48:39 -0000	1.410
-+++ xpfe/bootstrap/nsAppRunner.cpp	12 Mar 2004 21:22:19 -0000
-@@ -1275,7 +1275,7 @@
-   nsCOMPtr&lt;nsIXRemoteService&gt; remoteService;
-   remoteService = do_GetService(NS_IXREMOTESERVICE_CONTRACTID);
-   if (remoteService)
--    remoteService-&gt;Startup();
-+    remoteService-&gt;Startup(MOZ_APP_NAME);
- #endif /* MOZ_ENABLE_XREMOTE */
- 
-   // remove the nativeApp as an XPCOM autoreg observer
-@@ -1422,7 +1422,7 @@
-       *aArgUsed = PR_TRUE;
-       // check to make sure there's another arg
-       if (argc-1 == i) {
--        PR_fprintf(PR_STDERR, &quot;-remote requires an argument\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: -remote requires an argument\n&quot;);
-         return 1;
-       }
-       // try to get the X remote client
-@@ -1433,19 +1433,30 @@
-       // try to init - connects to the X server and stuff
-       rv = client-&gt;Init();
-       if (NS_FAILED(rv)) {
--        PR_fprintf(PR_STDERR, &quot;Failed to connect to X server.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: Failed to connect to X server.\n&quot;);
-         return 1;
-       }
-       PRBool success = PR_FALSE;
--      rv = client-&gt;SendCommand(argv[i+1], &amp;success);
-+      char *logname = PR_GetEnv(&quot;LOGNAME&quot;);
-+      char *response = NULL;
-+      rv = client-&gt;SendCommand(MOZ_APP_NAME, logname, NULL, argv[i+1],
-+                               &amp;response, &amp;success);
-       // did the command fail?
-       if (NS_FAILED(rv)) {
--        PR_fprintf(PR_STDERR, &quot;Failed to send command.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: Failed to send command: &quot;);
-+        if (response) {
-+          PR_fprintf(PR_STDERR, &quot;%s\n&quot;, response);
-+          free(response);
-+        }
-+        else {
-+          PR_fprintf(PR_STDERR, &quot;No response included.\n&quot;);
-+        }
-+
-         return 1;
-       }
-       // was there a window not running?
-       if (!success) {
--        PR_fprintf(PR_STDERR, &quot;No running window found.\n&quot;);
-+        PR_fprintf(PR_STDERR, &quot;Error: No running window found.\n&quot;);
-         return 2;
-       }
-       client-&gt;Shutdown();
-Index: xpfe/components/xremote/public/nsIXRemoteService.idl
-===================================================================
-RCS file: /cvsroot/mozilla/xpfe/components/xremote/public/nsIXRemoteService.idl,v
-retrieving revision 1.2
-diff -u -r1.2 nsIXRemoteService.idl
---- xpfe/components/xremote/public/nsIXRemoteService.idl	5 Sep 2001 21:48:14 -0000	1.2
-+++ xpfe/components/xremote/public/nsIXRemoteService.idl	12 Mar 2004 21:22:19 -0000
-@@ -30,8 +30,12 @@
- interface nsIXRemoteService : nsISupports {
- 
-   // this is called once the browser starts up so that we can create a
--  // dummy window to respond to requests on
--  [noscript] void startup      ();
-+  // dummy window to respond to requests on.
-+  //
-+  // @param aProgram This is the name of the program that will be
-+  // advertised to clients.  This is so we can seperate the various
-+  // Mozilla products.
-+  [noscript] void startup      (in string aProgram);
- 
-   // this is called right before shutdown so we can destroy the window
-   // that we are receving requests on
-Index: xpfe/components/xremote/src/Makefile.in
-===================================================================
-RCS file: /cvsroot/mozilla/xpfe/components/xremote/src/Makefile.in,v
-retrieving revision 1.10
-diff -u -r1.10 Makefile.in
---- xpfe/components/xremote/src/Makefile.in	7 Jan 2004 13:36:58 -0000	1.10
-+++ xpfe/components/xremote/src/Makefile.in	12 Mar 2004 21:22:19 -0000
-@@ -46,6 +46,7 @@
- 		  appshell \
- 		  rdf \
- 		  exthandler \
-+		  profile \
- 		  $(NULL)
- 
- CPPSRCS		= \
-Index: xpfe/components/xremote/src/XRemoteService.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/xpfe/components/xremote/src/XRemoteService.cpp,v
-retrieving revision 1.33
-diff -u -r1.33 XRemoteService.cpp
---- xpfe/components/xremote/src/XRemoteService.cpp	10 Feb 2004 00:18:51 -0000	1.33
-+++ xpfe/components/xremote/src/XRemoteService.cpp	12 Mar 2004 21:22:19 -0000
-@@ -49,6 +49,7 @@
- #include &lt;nsIWindowMediator.h&gt;
- #include &lt;nsCExternalHandlerService.h&gt;
- #include &lt;nsIExternalProtocolService.h&gt;
-+#include &lt;nsIProfile.h&gt;
- 
- NS_DEFINE_CID(kWindowCID, NS_WINDOW_CID);
- 
-@@ -74,13 +75,28 @@
- NS_IMPL_ISUPPORTS2(XRemoteService, nsIXRemoteService, nsIObserver)
- 
- NS_IMETHODIMP
--XRemoteService::Startup(void)
-+XRemoteService::Startup(const char *aProgram)
- {
-   // We have to destroy the proxy window before the event loop stops running.
-   nsCOMPtr&lt;nsIObserverService&gt; obsServ =
-     do_GetService(&quot;@mozilla.org/observer-service;1&quot;);
-   obsServ-&gt;AddObserver(this, &quot;quit-application&quot;, PR_FALSE);
- 
-+  mProgram.Assign(aProgram);
-+
-+  // Get the current profile name and save it.
-+
-+  nsresult rv;
-+  nsCOMPtr&lt;nsIProfile&gt; profileMgr;
-+  profileMgr = do_GetService(NS_PROFILE_CONTRACTID, &amp;rv);
-+  if (NS_SUCCEEDED(rv) &amp;&amp; profileMgr) {
-+    PRUnichar *name;
-+    rv = profileMgr-&gt;GetCurrentProfile(&amp;name);
-+    if (NS_SUCCEEDED(rv) &amp;&amp; name) {
-+      mProfile = NS_LossyConvertUCS2toASCII(nsDependentString(name));
-+    }
-+  }
-+
-   mRunning = PR_TRUE;
-   if (mNumWindows == 0)
-     CreateProxyWindow();
-@@ -385,7 +401,8 @@
-   }
- 
-   nsresult rv;
--  rv = widgetHelper-&gt;EnableXRemoteCommands(mainWidget);
-+  rv = widgetHelper-&gt;EnableXRemoteCommands(mainWidget, mProfile,
-+					   mProgram);
-   if (NS_FAILED(rv)) {
-     NS_WARNING(&quot;failed to enable x remote commands for widget&quot;);
-     return rv;
-@@ -475,7 +492,8 @@
-     return;
-   }
- 
--  rv = widgetHelper-&gt;EnableXRemoteCommands(mProxyWindow);
-+  rv = widgetHelper-&gt;EnableXRemoteCommands(mProxyWindow, mProfile.get(),
-+					   mProgram.get());
-   if (NS_FAILED(rv)) {
-     NS_WARNING(&quot;failed to enable x remote commands for proxy window&quot;);
-     return;
-Index: xpfe/components/xremote/src/XRemoteService.h
-===================================================================
-RCS file: /cvsroot/mozilla/xpfe/components/xremote/src/XRemoteService.h,v
-retrieving revision 1.8
-diff -u -r1.8 XRemoteService.h
---- xpfe/components/xremote/src/XRemoteService.h	21 Nov 2003 00:09:45 -0000	1.8
-+++ xpfe/components/xremote/src/XRemoteService.h	12 Mar 2004 21:22:19 -0000
-@@ -104,4 +104,9 @@
-   // have we been started up from the main loop yet?
-   PRBool   mRunning;
- 
-+  // Name of our program
-+  nsXPIDLCString mProgram;
-+
-+  // Name of the profile that's in use.
-+  nsXPIDLCString mProfile;
- };
-Index: widget/public/nsIXRemoteClient.idl
-===================================================================
-RCS file: /cvsroot/mozilla/widget/public/nsIXRemoteClient.idl,v
-retrieving revision 1.1
-diff -u -r1.1 nsIXRemoteClient.idl
---- widget/public/nsIXRemoteClient.idl	20 Oct 2000 05:09:06 -0000	1.1
-+++ widget/public/nsIXRemoteClient.idl	12 Mar 2004 21:22:19 -0000
-@@ -31,8 +31,34 @@
-   /**
-    * Sends a command to a running instance.  If it returns false then
-    * there is no running instance.
-+   *
-+   * @param aProgram This is the preferred program that we want to use
-+   * for this particular command.
-+   *
-+   * @param aNoProgramFallback This boolean attribute tells the client
-+   * code that if the preferred program isn't found that it should
-+   * fall not send the command to another server.
-+   *
-+   * @param aUsername This allows someone to only talk to an instance
-+   * of the server that's running under a particular username.  If
-+   * this isn't specified here it's pulled from the LOGNAME
-+   * environmental variable if it's set.
-+
-+   * @param aProfile This allows you to specify a particular server
-+   * running under a named profile.  If it is not specified the
-+   * profile is not checked.
-+
-+   * @param aCommand This is the command that is passed to the server.
-+   * Please see the additional information located at:
-+   * <A HREF="http://www.mozilla.org/unix/remote.html">http://www.mozilla.org/unix/remote.html</A>
-+   *
-+   * @param aResponse If there is a response, it will be here.  This
-+   * includes error messages.  The string is allocated using stdlib
-+   * string functions, so free it with free().
-   */
--  boolean sendCommand(in string aCommand);
-+  boolean sendCommand(in string aProgram, in string aUsername,
-+		      in string aProfile, in string aCommand,
-+		      out string aResponse);
- 
-   /**
-    * Shuts down the client
-Index: widget/public/nsIXRemoteWidgetHelper.h
-===================================================================
-RCS file: /cvsroot/mozilla/widget/public/nsIXRemoteWidgetHelper.h,v
-retrieving revision 1.1
-diff -u -r1.1 nsIXRemoteWidgetHelper.h
---- widget/public/nsIXRemoteWidgetHelper.h	4 Sep 2001 22:59:39 -0000	1.1
-+++ widget/public/nsIXRemoteWidgetHelper.h	12 Mar 2004 21:22:19 -0000
-@@ -32,7 +32,9 @@
-  public:
-   NS_DEFINE_STATIC_IID_ACCESSOR(NS_IXREMOTEWIDGETHELPER_IID)
- 
--  NS_IMETHOD EnableXRemoteCommands(nsIWidget *aWidget) = 0;
-+  NS_IMETHOD EnableXRemoteCommands(nsIWidget *aWidget,
-+				   const char *aProfile,
-+				   const char *aProgram) = 0;
- 
- };
- 
-Index: widget/src/gtk2/nsGtkMozRemoteHelper.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/widget/src/gtk2/nsGtkMozRemoteHelper.cpp,v
-retrieving revision 1.3
-diff -u -r1.3 nsGtkMozRemoteHelper.cpp
---- widget/src/gtk2/nsGtkMozRemoteHelper.cpp	8 Jan 2003 22:58:07 -0000	1.3
-+++ widget/src/gtk2/nsGtkMozRemoteHelper.cpp	12 Mar 2004 21:22:19 -0000
-@@ -35,18 +35,24 @@
- #define MOZILLA_COMMAND_PROP   &quot;_MOZILLA_COMMAND&quot;
- #define MOZILLA_RESPONSE_PROP  &quot;_MOZILLA_RESPONSE&quot;
- #define MOZILLA_USER_PROP      &quot;_MOZILLA_USER&quot;
-+#define MOZILLA_PROFILE_PROP   &quot;_MOZILLA_PROFILE&quot;
-+#define MOZILLA_PROFILE_PROP   &quot;_MOZILLA_PROFILE&quot;
-+#define MOZILLA_PROGRAM_PROP   &quot;_MOZILLA_PROGRAM&quot;
- 
- Atom nsGtkMozRemoteHelper::sMozVersionAtom  = 0;
- Atom nsGtkMozRemoteHelper::sMozLockAtom     = 0;
- Atom nsGtkMozRemoteHelper::sMozCommandAtom  = 0;
- Atom nsGtkMozRemoteHelper::sMozResponseAtom = 0;
- Atom nsGtkMozRemoteHelper::sMozUserAtom     = 0;
-+Atom nsGtkMozRemoteHelper::sMozProfileAtom  = 0;
-+Atom nsGtkMozRemoteHelper::sMozProgramAtom  = 0;
- 
- // XXX get this dynamically
- static const char sRemoteVersion[]   = &quot;5.0&quot;;
- 
- void
--nsGtkMozRemoteHelper::SetupVersion(GdkWindow *aWindow)
-+nsGtkMozRemoteHelper::SetupVersion(GdkWindow *aWindow, const char *aProfile,
-+				   const char *aProgram)
- {
-   Window window;
-   unsigned char *data = (unsigned char *)sRemoteVersion;
-@@ -68,6 +74,20 @@
- 		    8, PropModeReplace, data, strlen(logname));
-   }
- 
-+  // set our profile name and program name, if available.
-+  if (aProfile) {
-+    data = (unsigned char *)aProfile;
-+
-+    XChangeProperty(GDK_DISPLAY(), window, sMozProfileAtom, XA_STRING,
-+		    8, PropModeReplace, data, strlen(aProfile));
-+  }
-+
-+  if (aProgram) {
-+    data = (unsigned char *)aProgram;
-+
-+    XChangeProperty(GDK_DISPLAY(), window, sMozProgramAtom, XA_STRING,
-+		    8, PropModeReplace, data, strlen(aProgram));
-+  }
- }
- 
- gboolean
-@@ -177,6 +197,10 @@
- 				   False);
-   if (!sMozUserAtom)
-     sMozUserAtom = XInternAtom(GDK_DISPLAY(), MOZILLA_USER_PROP, False);
-+  if (!sMozProfileAtom)
-+    sMozProfileAtom = XInternAtom(GDK_DISPLAY(), MOZILLA_PROFILE_PROP, False);
-+  if (!sMozProgramAtom)
-+    sMozProgramAtom = XInternAtom(GDK_DISPLAY(), MOZILLA_PROGRAM_PROP, False);
- 
- }
- 
-@@ -196,7 +220,9 @@
- NS_IMPL_ISUPPORTS1(nsGtkXRemoteWidgetHelper, nsIXRemoteWidgetHelper)
- 
- NS_IMETHODIMP
--nsGtkXRemoteWidgetHelper::EnableXRemoteCommands(nsIWidget *aWidget)
-+nsGtkXRemoteWidgetHelper::EnableXRemoteCommands(nsIWidget *aWidget,
-+						const char *aProfile,
-+						const char *aProgram)
- {
-   // find the native gdk window
-   GdkWindow *window = NS_STATIC_CAST(GdkWindow *,
-@@ -216,7 +242,7 @@
-   }
- 
-   // ok, found the toplevel window - set up the version information
--  nsGtkMozRemoteHelper::SetupVersion(window);
-+  nsGtkMozRemoteHelper::SetupVersion(window, aProfile, aProgram);
-   
-   return NS_OK;
- }
-Index: widget/src/gtk2/nsGtkMozRemoteHelper.h
-===================================================================
-RCS file: /cvsroot/mozilla/widget/src/gtk2/nsGtkMozRemoteHelper.h,v
-retrieving revision 1.1
-diff -u -r1.1 nsGtkMozRemoteHelper.h
---- widget/src/gtk2/nsGtkMozRemoteHelper.h	12 May 2002 06:48:18 -0000	1.1
-+++ widget/src/gtk2/nsGtkMozRemoteHelper.h	12 Mar 2004 21:22:19 -0000
-@@ -35,7 +35,9 @@
-   virtual ~nsGtkMozRemoteHelper();
- 
-   // interaction from the outside world
--  static        void SetupVersion         (GdkWindow *aWindow);
-+  static        void SetupVersion         (GdkWindow *aWindow,
-+					   const char *aProfile,
-+					   const char *aProgram);
-   static    gboolean HandlePropertyChange (GtkWidget *aWidget,
-                                            GdkEventProperty *aEvent,
-                                            nsIWidget *ansIWidget);
-@@ -50,6 +52,8 @@
-   static        Atom sMozCommandAtom;
-   static        Atom sMozResponseAtom;
-   static        Atom sMozUserAtom;
-+  static        Atom sMozProfileAtom;
-+  static        Atom sMozProgramAtom;
- 
- };
- 
-@@ -66,7 +70,9 @@
- 
-   NS_DECL_ISUPPORTS
- 
--  NS_IMETHOD EnableXRemoteCommands(nsIWidget *aWidget);
-+  NS_IMETHOD EnableXRemoteCommands(nsIWidget *aWidget,
-+				   const char *aProfile,
-+				   const char *aProgram);
- };
- 
- #endif /* __nsGtkMozRemoteHelper_h__ */
-Index: widget/src/xremoteclient/XRemoteClient.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/widget/src/xremoteclient/XRemoteClient.cpp,v
-retrieving revision 1.13
-diff -u -r1.13 XRemoteClient.cpp
---- widget/src/xremoteclient/XRemoteClient.cpp	21 Nov 2003 00:09:45 -0000	1.13
-+++ widget/src/xremoteclient/XRemoteClient.cpp	12 Mar 2004 21:22:19 -0000
-@@ -44,6 +44,8 @@
- #define MOZILLA_COMMAND_PROP   &quot;_MOZILLA_COMMAND&quot;
- #define MOZILLA_RESPONSE_PROP  &quot;_MOZILLA_RESPONSE&quot;
- #define MOZILLA_USER_PROP      &quot;_MOZILLA_USER&quot;
-+#define MOZILLA_PROFILE_PROP   &quot;_MOZILLA_PROFILE&quot;
-+#define MOZILLA_PROGRAM_PROP   &quot;_MOZILLA_PROGRAM&quot;
- 
- static PRLogModuleInfo *sRemoteLm = NULL;
- 
-@@ -92,7 +94,9 @@
-   mMozCommandAtom  = XInternAtom(mDisplay, MOZILLA_COMMAND_PROP, False);
-   mMozResponseAtom = XInternAtom(mDisplay, MOZILLA_RESPONSE_PROP, False);
-   mMozWMStateAtom  = XInternAtom(mDisplay, &quot;WM_STATE&quot;, False);
--  mMozUserAtom      = XInternAtom(mDisplay, MOZILLA_USER_PROP, False);
-+  mMozUserAtom     = XInternAtom(mDisplay, MOZILLA_USER_PROP, False);
-+  mMozProfileAtom  = XInternAtom(mDisplay, MOZILLA_PROFILE_PROP, False);
-+  mMozProgramAtom  = XInternAtom(mDisplay, MOZILLA_PROGRAM_PROP, False);
- 
-   mInitialized = PR_TRUE;
- 
-@@ -118,113 +122,45 @@
- }
- 
- NS_IMETHODIMP
--XRemoteClient::SendCommand (const char *aCommand, PRBool *aWindowFound)
-+XRemoteClient::SendCommand (const char *aProgram, const char *aUsername,
-+			    const char *aProfile, const char *aCommand,
-+			    char **aResponse, PRBool *aWindowFound)
- {
-   PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;XRemoteClient::SendCommand&quot;));
- 
--  Window root = RootWindowOfScreen(DefaultScreenOfDisplay(mDisplay));
--  Window root2, parent, *kids;
--  unsigned int nkids;
--  int i;
--
-   *aWindowFound = PR_FALSE;
--  
--  if (!XQueryTree(mDisplay, root, &amp;root2, &amp;parent, &amp;kids, &amp;nkids)) {
--    PR_LOG(sRemoteLm, PR_LOG_DEBUG,
--	   (&quot;XQueryTree failed in XRemoteClient::SendCommand&quot;));
--    return NS_OK;
--  }
- 
--  if (!(kids &amp;&amp; nkids)) {
--    PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;root window has no children&quot;));
--    return NS_OK;
--  }
-+  Window w = FindBestWindow(aProgram, aUsername, aProfile);
- 
-   nsresult rv = NS_OK;
--  for (i=nkids-1; i &gt;= 0; i--) {
--    Atom type;
--    int format;
--    unsigned long nitems, bytesafter;
--    unsigned char *data_return = 0;
--    Window w, result = 0;
--    w = kids[i];
--    // find the inner window with WM_STATE on it
--    w = CheckWindow(w);
--
--    int status = XGetWindowProperty(mDisplay, w, mMozVersionAtom,
--				    0, (65536 / sizeof (long)),
--				    False, XA_STRING,
--				    &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
--				    &amp;data_return);
--
--    if (!data_return)
--      continue;
--
--    XFree(data_return);
--    data_return = 0;
--
--    if (status == Success &amp;&amp; type != None) {
--      // Check to see if it has the user atom on that window.  If there
--      // is then we need to make sure that it matches what we have.
--      char *logname;
--      logname = PR_GetEnv(&quot;LOGNAME&quot;);
--
--      if (logname) {
--	status = XGetWindowProperty(mDisplay, w, mMozUserAtom,
--				    0, (65536 / sizeof(long)),
--				    False, XA_STRING,
--				    &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
--				    &amp;data_return);
--
--	// if there's a username compare it with what we have
--	if (data_return) {
--
--	  // if the IDs are equal then this is the window we want.  if
--	  // they aren't fall through to the next loop iteration.
--	  if (!strcmp(logname, (const char *)data_return))
--	    result = w;
--
--	  XFree(data_return);
--	}
--      }
- 
--      // ok, this is the one we want since there's no username attribute on
--      // it.
--      else {
--	result = w;
--      }
--
--      if (result) {
--        // ok, let the caller know that we at least found a window.
--        *aWindowFound = PR_TRUE;
--
--        // make sure we get the right events on that window
--        XSelectInput(mDisplay, result,
--                     (PropertyChangeMask|StructureNotifyMask));
-+  if (w) {
-+    // ok, let the caller know that we at least found a window.
-+    *aWindowFound = PR_TRUE;
-+
-+    // make sure we get the right events on that window
-+    XSelectInput(mDisplay, w,
-+		 (PropertyChangeMask|StructureNotifyMask));
-         
--        PRBool destroyed = PR_FALSE;
-+    PRBool destroyed = PR_FALSE;
- 
--        // get the lock on the window
--        rv = GetLock(result, &amp;destroyed);
-+    // get the lock on the window
-+    rv = GetLock(w, &amp;destroyed);
-+
-+    if (NS_SUCCEEDED(rv)) {
-+      // send our command
-+      rv = DoSendCommand(w, aCommand, aResponse, &amp;destroyed);
-+
-+      // if the window was destroyed, don't bother trying to free the
-+      // lock.
-+      if (!destroyed)
-+	FreeLock(w); // doesn't really matter what this returns
- 
--        if (NS_SUCCEEDED(rv)) {
--          // send our command
--          rv = DoSendCommand(result, aCommand, &amp;destroyed);
--
--          // if the window was destroyed, don't bother trying to free the
--          // lock.
--          if (!destroyed)
--            FreeLock(result); // doesn't really matter what this returns
--
--          // if accepted then we're done...
--          if (NS_SUCCEEDED(rv))
--            break;
--        }
--      }
-     }
-   }
- 
-   PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;SendCommand returning 0x%x\n&quot;, rv));
-+
-   return rv;
- }
- 
-@@ -416,6 +352,142 @@
-   return NS_OK;
- }
- 
-+Window
-+XRemoteClient::FindBestWindow(const char *aProgram, const char *aUsername,
-+			      const char *aProfile)
-+{
-+  Window root = RootWindowOfScreen(DefaultScreenOfDisplay(mDisplay));
-+  Window bestWindow = 0;
-+  Window root2, parent, *kids;
-+  unsigned int nkids;
-+  int i;
-+
-+  // Get a list of the children of the root window, walk the list
-+  // looking for the best window that fits the criteria.
-+  if (!XQueryTree(mDisplay, root, &amp;root2, &amp;parent, &amp;kids, &amp;nkids)) {
-+    PR_LOG(sRemoteLm, PR_LOG_DEBUG,
-+	   (&quot;XQueryTree failed in XRemoteClient::FindBestWindow&quot;));
-+    return 0;
-+  }
-+
-+  if (!(kids &amp;&amp; nkids)) {
-+    PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;root window has no children&quot;));
-+    return 0;
-+  }
-+
-+  // We'll walk the list of windows looking for a window that best
-+  // fits the criteria here.
-+
-+  for (i=nkids-1; i &gt;= 0; i--) {
-+    Atom type;
-+    int format;
-+    unsigned long nitems, bytesafter;
-+    unsigned char *data_return = 0;
-+    Window w;
-+    w = kids[i];
-+    // find the inner window with WM_STATE on it
-+    w = CheckWindow(w);
-+
-+    int status = XGetWindowProperty(mDisplay, w, mMozVersionAtom,
-+				    0, (65536 / sizeof (long)),
-+				    False, XA_STRING,
-+				    &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
-+				    &amp;data_return);
-+
-+    if (!data_return)
-+      continue;
-+
-+    XFree(data_return);
-+    data_return = 0;
-+
-+    if (status != Success || type == None)
-+      continue;
-+
-+    // If someone passed in a program name, check it against this one
-+    // unless it's &quot;any&quot; in which case, we don't care.  If someone did
-+    // pass in a program name and this window doesn't support that
-+    // protocol, we don't include it in our list.
-+    if (aProgram &amp;&amp; strcmp(aProgram, &quot;any&quot;)) {
-+      status = XGetWindowProperty(mDisplay, w, mMozProgramAtom,
-+				  0, (65536 / sizeof(long)),
-+				  False, XA_STRING,
-+				  &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
-+				  &amp;data_return);
-+
-+      // If the return name is not the same as what someone passed in,
-+      // we don't want this window.
-+      if (data_return) {
-+	if (strcmp(aProgram, (const char *)data_return)) {
-+	  XFree(data_return);
-+	  continue;
-+	}
-+
-+	// This is actually the success condition.
-+	XFree(data_return);
-+      }
-+      else {
-+	// Doesn't support the protocol, even though the user
-+	// requested it.  So we're not going to use this window.
-+	continue;
-+      }
-+    }
-+
-+    // Check to see if it has the user atom on that window.  If there
-+    // is then we need to make sure that it matches what we have.
-+    const char *username = PR_GetEnv(&quot;LOGNAME&quot;);
-+    if (aUsername) {
-+      username = aUsername;
-+    }
-+
-+    if (username) {
-+      status = XGetWindowProperty(mDisplay, w, mMozUserAtom,
-+				  0, (65536 / sizeof(long)),
-+				  False, XA_STRING,
-+				  &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
-+				  &amp;data_return);
-+
-+      // if there's a username compare it with what we have
-+      if (data_return) {
-+	// If the IDs aren't equal, we don't want this window.
-+	if (strcmp(username, (const char *)data_return)) {
-+	  XFree(data_return);
-+	  continue;
-+	}
-+
-+	XFree(data_return);
-+      }
-+    }
-+
-+    // Check to see if there's a profile name on this window.  If
-+    // there is, then we need to make sure it matches what someone
-+    // passed in.
-+    if (aProfile) {
-+      status = XGetWindowProperty(mDisplay, w, mMozProfileAtom,
-+				  0, (65536 / sizeof(long)),
-+				  False, XA_STRING,
-+				  &amp;type, &amp;format, &amp;nitems, &amp;bytesafter,
-+				  &amp;data_return);
-+
-+      // If there's a username compare it with what we have
-+      if (data_return) {
-+	// If the profiles aren't equal, we don't want this window.
-+	if (strcmp(aProfile, (const char *)data_return)) {
-+	  XFree(data_return);
-+	  continue;
-+	}
-+
-+	XFree(data_return);
-+      }
-+    }
-+
-+    // If we got this far, this is the best window so far.  It passed
-+    // all the tests.
-+    bestWindow = w;
-+  }
-+
-+  return bestWindow;
-+}
-+
- nsresult
- XRemoteClient::FreeLock(Window aWindow)
- {
-@@ -459,7 +531,7 @@
- 
- nsresult
- XRemoteClient::DoSendCommand(Window aWindow, const char *aCommand,
--			     PRBool *aDestroyed)
-+			     char **aResponse, PRBool *aDestroyed)
- {
-   PRBool done = PR_FALSE;
-   PRBool accepted = PR_FALSE;
-@@ -482,6 +554,7 @@
-       PR_LOG(sRemoteLm, PR_LOG_DEBUG,
- 	     (&quot;window 0x%x was destroyed.\n&quot;,
- 	      (unsigned int) aWindow));
-+      *aResponse = strdup(&quot;Window was destroyed while reading response.&quot;);
-       *aDestroyed = PR_TRUE;
-       goto DONE;
-     }
-@@ -506,6 +579,7 @@
- 	       (&quot;failed reading &quot; MOZILLA_RESPONSE_PROP
- 		&quot; from window 0x%0x.\n&quot;,
- 		(unsigned int) aWindow));
-+	*aResponse = strdup(&quot;Internal error reading response from window.&quot;);
- 	done = PR_TRUE;
-       }
-       else if (!data || strlen((char *) data) &lt; 5) {
-@@ -513,6 +587,7 @@
- 	       (&quot;invalid data on &quot; MOZILLA_RESPONSE_PROP
- 		&quot; property of window 0x%0x.\n&quot;,
- 		(unsigned int) aWindow));
-+	*aResponse = strdup(&quot;Server returned invalid data in response.&quot;);
- 	done = PR_TRUE;
-       }
-       else if (*data == '1') {	/* positive preliminary reply */
-@@ -522,12 +597,14 @@
-       }
- 
-       else if (!strncmp ((char *)data, &quot;200&quot;, 3)) { /* positive completion */
-+	*aResponse = strdup((char *)data);
- 	accepted = PR_TRUE;
- 	done = PR_TRUE;
-       }
- 
-       else if (*data == '2') {	/* positive completion */
- 	PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;%s\n&quot;, data + 4));
-+	*aResponse = strdup((char *)data);
- 	accepted = PR_TRUE;
- 	done = PR_TRUE;
-       }
-@@ -537,12 +614,14 @@
- 	       (&quot;internal error: &quot;
- 		&quot;server wants more information?  (%s)\n&quot;,
- 		data));
-+	*aResponse = strdup((char *)data);
- 	done = PR_TRUE;
-       }
- 
-       else if (*data == '4' ||	/* transient negative completion */
- 	       *data == '5') {	/* permanent negative completion */
- 	PR_LOG(sRemoteLm, PR_LOG_DEBUG, (&quot;%s\n&quot;, data + 4));
-+	*aResponse = strdup((char *)data);
- 	done = PR_TRUE;
-       }
- 
-@@ -551,6 +630,7 @@
- 	       (&quot;unrecognised &quot; MOZILLA_RESPONSE_PROP
- 		&quot; from window 0x%x: %s\n&quot;,
- 		(unsigned int) aWindow, data));
-+	*aResponse = strdup((char *)data);
- 	done = PR_TRUE;
-       }
- 
-Index: widget/src/xremoteclient/XRemoteClient.h
-===================================================================
-RCS file: /cvsroot/mozilla/widget/src/xremoteclient/XRemoteClient.h,v
-retrieving revision 1.6
-diff -u -r1.6 XRemoteClient.h
---- widget/src/xremoteclient/XRemoteClient.h	21 Nov 2003 00:09:45 -0000	1.6
-+++ widget/src/xremoteclient/XRemoteClient.h	12 Mar 2004 21:22:19 -0000
-@@ -46,8 +46,11 @@
-   Window         CheckChildren    (Window aWindow);
-   nsresult       GetLock          (Window aWindow, PRBool *aDestroyed);
-   nsresult       FreeLock         (Window aWindow);
-+  Window         FindBestWindow   (const char *aProgram, const char *aUsername,
-+				   const char *aProfile);
-   nsresult       DoSendCommand    (Window aWindow,
- 				   const char *aCommand,
-+				   char **aResponse,
- 				   PRBool *aDestroyed);
- 
-   Display       *mDisplay;
-@@ -58,6 +61,8 @@
-   Atom           mMozResponseAtom;
-   Atom           mMozWMStateAtom;
-   Atom           mMozUserAtom;
-+  Atom           mMozProfileAtom;
-+  Atom           mMozProgramAtom;
- 
-   char          *mLockData;
- 
-Index: widget/src/xremoteclient/mozilla-xremote-client.cpp
-===================================================================
-RCS file: /cvsroot/mozilla/widget/src/xremoteclient/mozilla-xremote-client.cpp,v
-retrieving revision 1.2
-diff -u -r1.2 mozilla-xremote-client.cpp
---- widget/src/xremoteclient/mozilla-xremote-client.cpp	12 Dec 2003 23:02:11 -0000	1.2
-+++ widget/src/xremoteclient/mozilla-xremote-client.cpp	12 Mar 2004 21:22:19 -0000
-@@ -34,18 +34,52 @@
-  * ***** END LICENSE BLOCK ***** */
- 
- #include &lt;stdio.h&gt;
-+#include &lt;stdlib.h&gt;
-+#include &lt;plgetopt.h&gt;
- #include &quot;XRemoteClient.h&quot;
- 
-+void print_usage(void);
-+
- int main(int argc, char **argv)
- {
-   nsresult rv;
-   XRemoteClient client;
-+  char *browser = NULL;
-+  char *profile = NULL;
-+  char *username = NULL;
-+  char *command = NULL;
- 
--  if (argc != 2) {
--    fprintf(stderr, &quot;Usage: mozilla-xremote-client [COMMAND]\n&quot;);
-+  if (argc &lt; 2) {
-+    print_usage();
-     return 4;
-   }
- 
-+  PLOptStatus os;
-+  PLOptState *opt = PL_CreateOptState(argc, argv, &quot;hb:u:p:&quot;);
-+  while (PL_OPT_EOL != (os = PL_GetNextOpt(opt))) {
-+    if (PL_OPT_BAD == os) {
-+      print_usage();
-+      return 4;
-+    }
-+
-+    switch (opt-&gt;option) {
-+    case 'h':
-+      print_usage();
-+      return 4;
-+      break;
-+    case 'b':
-+      browser = strdup(opt-&gt;value);
-+      break;
-+    case 'p':
-+      profile = strdup(opt-&gt;value);
-+      break;
-+    case 0:
-+      command = strdup(opt-&gt;value);      
-+    default:
-+      break;
-+    }
-+  }
-+
-   rv = client.Init();
-   // failed to connect to the X server
-   if (NS_FAILED(rv))
-@@ -53,16 +87,36 @@
- 
-   // send the command - it doesn't get any easier than this
-   PRBool success = PR_FALSE;
--  rv = client.SendCommand(argv[1], &amp;success);
-+  char *error = NULL;
-+  rv = client.SendCommand(browser, username, profile, command,
-+			  &amp;error, &amp;success);
- 
-   // failed to send command
--  if (NS_FAILED(rv))
-+  if (NS_FAILED(rv)) {
-+    fprintf(stderr, &quot;%s: Error: Failed to send command: &quot;, argv[0]);
-+    if (error) {
-+      fprintf(stderr, &quot;%s\n&quot;, error);
-+      free(error);
-+    }
-+    else {
-+      fprintf(stderr, &quot;No error string reported..\n&quot;);
-+    }
-+
-     return 3;
-+  }
- 
-   // no running window found
--  if (!success)
-+  if (!success) {
-+    fprintf(stderr, &quot;%s: Error: Failed to find a running server.\n&quot;, argv[0]);
-     return 2;
-+  }
- 
-   // else, everything is fine.
-   return 0;
-+}
-+
-+void print_usage(void) {
-+  fprintf(stderr, &quot;Usage: mozilla-xremote-client [-b firefox|thunderbird|mozilla|any]\n&quot;);
-+  fprintf(stderr, &quot;                              [-u &lt;username&gt;]\n&quot;);
-+  fprintf(stderr, &quot;                              [-p &lt;profile&gt;] COMMAND\n&quot;);
- }

Added: trunk/rpms/thunderbird/thunderbird-0.7.2-gcc34.patch
===================================================================
--- trunk/rpms/thunderbird/thunderbird-0.7.2-gcc34.patch	2004-07-27 16:02:28 UTC (rev 1774)
+++ trunk/rpms/thunderbird/thunderbird-0.7.2-gcc34.patch	2004-07-27 16:51:29 UTC (rev 1775)
@@ -0,0 +1,11 @@
+--- mozilla/xpinstall/src/nsSoftwareUpdate.cpp.orig	2004-05-22 10:02:23.000000000 +0200
++++ mozilla/xpinstall/src/nsSoftwareUpdate.cpp	2004-07-27 17:12:42.666752904 +0200
+@@ -512,7 +512,7 @@ NS_GENERIC_FACTORY_SINGLETON_CONSTRUCTOR
+                                          nsSoftwareUpdate::GetInstance)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallTrigger)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallVersion)
+-NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager);
++NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsSoftwareUpdateNameSet)
+ 
+ //----------------------------------------------------------------------

Deleted: trunk/rpms/thunderbird/thunderbird-icon.png
===================================================================
(Binary files differ)

Modified: trunk/rpms/thunderbird/thunderbird.spec
===================================================================
--- trunk/rpms/thunderbird/thunderbird.spec	2004-07-27 16:02:28 UTC (rev 1774)
+++ trunk/rpms/thunderbird/thunderbird.spec	2004-07-27 16:51:29 UTC (rev 1775)
@@ -4,89 +4,76 @@
 %{?dist: %{expand: %%define %dist 1}}
 
 %{?rh7:%define _without_freedesktop 1}
+%{?rh7:%define _without_gtk2 1}
 %{?el2:%define _without_freedesktop 1}
+%{?el2:%define _without_gtk2 1}
 
 Summary: Mozilla Thunderbird mail/news client
 Name: thunderbird
-Version: 0.6
+Version: 0.7.2
 Release: 1
-License: GPL
+License: MPL/GPL
 Group: Applications/Internet
 URL: <A HREF="http://www.mozilla.org/projects/thunderbird/">http://www.mozilla.org/projects/thunderbird/</A>
 
 Packager: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
 Vendor: Dag Apt Repository, <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
 
-Source: <A HREF="http://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/%{version">http://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/%{version</A>}/thunderbird-source-%{version}.tar.bz2
-Source1: <A HREF="http://downloads.mozdev.org/enigmail/src/ipc-1.0.5.tar.gz">http://downloads.mozdev.org/enigmail/src/ipc-1.0.5.tar.gz</A>
-Source2: <A HREF="http://downloads.mozdev.org/enigmail/src/enigmail-0.84.tar.gz">http://downloads.mozdev.org/enigmail/src/enigmail-0.84.tar.gz</A>
-Source3: thunderbird-icon.png
+Source: <A HREF="http://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/%{version">http://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/%{version</A>}/thunderbird-%{version}-source.tar.bz2
+Source1: <A HREF="http://downloads.mozdev.org/enigmail/src/ipc-1.0.7.tar.gz">http://downloads.mozdev.org/enigmail/src/ipc-1.0.7.tar.gz</A>
+Source2: <A HREF="http://downloads.mozdev.org/enigmail/src/enigmail-0.85.0.tar.gz">http://downloads.mozdev.org/enigmail/src/enigmail-0.85.0.tar.gz</A>
+Patch: thunderbird-0.7.2-gcc34.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 
-BuildRequires: XFree86-devel, zlib-devel, zip, perl
+BuildRequires: XFree86-devel, zlib-devel, zip
 BuildRequires: gtk+-devel, libpng-devel, libmng-devel, libjpeg-devel
-BuildRequires: libIDL-devel, ORBit-devel
-BuildRequires: vim-enhanced, csh, gcc-c++
+BuildRequires: ORBit-devel, vim-enhanced, csh, gcc-c++
 %{!?_without_freedesktop:BuildRequires: desktop-file-utils}
-%{?fc1:BuildRequires: gtk2-devel}
-%{?el3:BuildRequires: gtk2-devel}
-%{?rh9:BuildRequires: gtk2-devel}
-%{?rh8:BuildRequires: gtk2-devel}
-%{?rh7:BuildRequires: gtk+-devel}
-%{?el2:BuildRequires: gtk+-devel}
-%{?rh6:BuildRequires: gtk+-devel}
-%{?yd3:BuildRequires: gtk2-devel}
+%{!?_without_gtk2:BuildRequires: gtk2-devel, libIDL-devel, gnome-vfs2-devel}
+%{?_without_gtk2:BuildRequires: gtk+-devel}
 
 Obsoletes: phoenix, MozillaThunderbird, mozilla-thunderbird
+Provides: mailclient
 
 %description
 Mozilla Thunderbird is a redesign of the Mozilla mail component.
 
 %prep
-%setup -n mozilla
+%setup -q -n mozilla
 %setup -T -D -a1 -n mozilla/extensions
 %setup -T -D -a2 -n mozilla/extensions
+# This is to get back into the main mozilla directory
 %setup -T -D -n mozilla
+%patch -p1
 
 ### FIXME: Shouldn't the default thunderbird config be part of original source ?
 %{__cat} &lt;&lt;EOF &gt;.mozconfig
 export MOZ_THUNDERBIRD=&quot;1&quot;
 mk_add_options MOZ_THUNDERBIRD=&quot;1&quot;
-ac_add_options --with-system-jpeg
-ac_add_options --with-system-zlib
-ac_add_options --with-system-png
-ac_add_options --with-system-mng
-ac_add_options --with-pthreads
-ac_add_options --disable-tests
+ac_add_options --x-libraries=&quot;%{_prefix}/X11R6/%{_lib}&quot;
 ac_add_options --disable-debug
-ac_add_options --disable-mathml
+#ac_add_options --disable-freetype2
 ac_add_options --disable-installer
-ac_add_options --disable-activex
-ac_add_options --disable-activex-scripting
-ac_add_options --disable-oji
-ac_add_options --disable-necko-disk-cache
+ac_add_options --disable-jsd
 ac_add_options --disable-profilesharing
+ac_add_options --disable-tests
+ac_add_options --enable-crypto
+#ac_add_options --enable-extensions=&quot;cookie,gnomevfs,inspector,negotiateauth,p3p,pref,spellcheck,transformiix,typeaheadfind,universalchardet,wallet,webservices,xmlextras,xml-rpc&quot;
+ac_add_options --enable-extensions
+#ac_add_options --enable-image-decoders=&quot;png,gif,jpeg,bmp&quot;
+#ac_add_options --enable-necko-protocols=&quot;http,file,jar,viewsource,res,data&quot;
+ac_add_options --enable-official-branding
 ac_add_options --enable-optimize=&quot;%{optflags}&quot;
-ac_add_options --enable-crypto
-ac_add_options --enable-strip
-ac_add_options --enable-strip-libs
-ac_add_options --enable-reorder
-ac_add_options --enable-xinerama
-ac_add_options --enable-extensions=&quot;wallet,spellcheck,xmlextras&quot;
-ac_add_options --enable-necko-protocols=&quot;http,file,jar,viewsource,res,data&quot;
-ac_add_options --enable-image-decoders=&quot;png,gif,jpeg,bmp&quot;
-%{?fc1:ac_add_options --enable-xft}
-%{?fc1:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
-%{?el3:ac_add_options --enable-xft}
-%{?el3:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
-%{?rh9:ac_add_options --enable-xft}
-%{?rh9:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
-%{?rh8:ac_add_options --enable-xft}
-%{?rh8:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
-%{?rh7:ac_add_options --disable-xft}
-%{?rh6:ac_add_options --disable-xft}
-%{?yd3:ac_add_options --enable-xft}
-%{?yd3:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
+#ac_add_options --enable-strip
+ac_add_options --with-pthreads
+ac_add_options --with-system-jpeg
+ac_add_options --with-system-png
+ac_add_options --with-system-zlib
+%{?_without_gtk2:ac_add_options --enable-default-toolkit=&quot;gtk&quot;}
+%{?_without_gtk2:ac_add_options --disable-freetype2}
+%{!?_without_gtk2:ac_add_options --enable-default-toolkit=&quot;gtk2&quot;}
+%{!?_without_gtk2:ac_add_options --enable-xft}
+%{!?_without_gtk2:ac_add_options --enable-xinerama}
 EOF
 
 %{__cat} &lt;&lt;EOF &gt;%{name}.desktop
@@ -94,25 +81,23 @@
 Name=Thunderbird Email
 Comment=Lightweight Mozilla-based mail client
 Exec=thunderbird
-Icon=thunderbird.png
+Icon=thunderbird.xpm
 Terminal=false
 Type=Application
-StartupNotify=true
+StartupNotify=false
 Categories=Application;Network;
 EOF
 
-%{__cat} &lt;&lt;'EOF' &gt;%{name}.sh
+%{__cat} &lt;&lt;'EOF' &gt;thunderbird.sh
 #!/bin/sh
 
 ### Written by Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
 ### Please send suggestions and fixes to me.
 
-ulimit -c 0
+MOZILLA_FIVE_HOME=&quot;%{_libdir}/thunderbird&quot;
+MOZ_PROGRAM=&quot;$MOZILLA_FIVE_HOME/thunderbird&quot;
 
-MOZ_PROGRAM=&quot;%{_libdir}/thunderbird/thunderbird-bin&quot;
-
-MOZILLA_FIVE_HOME=&quot;%{_libdir}/thunderbird&quot;
-LD_LIBRARY_PATH=&quot;$MOZILLA_FIVE_HOME:$MOZILLA_FIVE_HOME/plugins:$LD_LIBRARY_PATH&quot;
+LD_LIBRARY_PATH=&quot;$MOZILLA_FIVE_HOME:$MOZILLA_FIVE_HOME/plugins${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}&quot;
 export MOZILLA_FIVE_HOME LD_LIBRARY_PATH
 
 MOZARGS=&quot;&quot;
@@ -121,61 +106,88 @@
 	MOZARGS=&quot;-UILocale $MOZLOCALE&quot;
 fi
 
-$MOZ_PROGRAM -remote 'ping()' &amp;&gt;/dev/null
+$MOZ_PROGRAM -a thunderbird -remote 'ping()' &amp;&gt;/dev/null
 RUNNING=$?
+if [ $? -eq 2 ]; then RUNNING=0; fi
 
-case &quot;$1&quot; in
-  -mail|-email)
-	if [ $RUNNING -eq 0 ]; then
-		exec $MOZ_PROGRAM -remote &quot;mailto($2)&quot; $MOZARGS ${2+&quot;$@&quot;}
-	else
-		exec $MOZ_PROGRAM -compose &quot;to=$2&quot; $MOZARGS ${2+&quot;$@&quot;}
-	fi;;
-  -compose|-editor)
-	if [ $RUNNING -eq 0 ]; then
-		ADDRESS=&quot;$(echo $2 | sed 's|.*to=||;s|,.*||')&quot;
-		exec $MOZ_PROGRAM -remote &quot;mailto($ADDRESS)&quot; $MOZARGS ${2+&quot;$@&quot;}
-	else
-		exec $MOZ_PROGRAM -compose $MOZARGS ${1+&quot;$@&quot;}
-	fi;;
-  -remote)
-	exec $MOZ_PROGRAM -remote &quot;$2&quot; $MOZARGS ${2+&quot;$@&quot;};;
-  -profile|-profile-manager)
-	exec $MOZ_PROGRAM $MOZARGS $@ &amp;;;
-  -*);;
-  '');;
-  *)
-	if [ $RUNNING -eq 0 ]; then
-		$MOZ_PROGRAM -remote &quot;xfeDoCommand(openInbox)&quot; $MOZARGS ${1+&quot;$@&quot;} &amp;&amp; exit 0
-	else
-		$MOZ_PROGRAM $MOZARGS ${1+&quot;$@&quot;} &amp;&amp; exit 0
-	fi;;
-esac
+REMOTE=0
+while [ &quot;$1&quot; ]; do
+	case &quot;$1&quot; in
+	  -mail|-email)
+		if [ $RUNNING -eq 0 -a $REMOTE -ne 1 ]; then
+			MOZARGS=&quot;-remote xfeDoCommand(openInbox) $MOZARGS&quot;
+			REMOTE=1
+		fi;;
+	  -compose|-editor)
+		if [ $RUNNING -eq 0 -a $REMOTE -ne 1 ]; then
+			MOZARGS=&quot;-remote xfeDoCommand(composeMessage) $MOZARGS&quot;
+			REMOTE=1
+		fi;;
+	  -register)
+		if [ -x &quot;/usr/X11R6/bin/Xvfb&quot; ]; then
+			export HOME=&quot;$(mktemp -d /tmp/thunderbird-rpm.$$)&quot;
+			mkdir -p $HOME/.mozilla/thunderbird/default/
+			cp -rf $MOZILLA_FIVE_HOME/defaults/profile/* $HOME/.mozilla/thunderbird/default/
+			echo -e &quot;[General]\nStartWithLastProfile=1\n\n[Profile0]\nName=default\nIsRelative=1\nPath=default&quot; &gt;$HOME/.mozilla/thunderbird/profiles.ini
+			/usr/X11R6/bin/Xvfb :69 -nolisten tcp -ac -terminate &amp;
+			DISPLAY=:69 $MOZILLA_FIVE_HOME/thunderbird -a thunderbird -install-global-extension -install-global-theme
+			rm -rf $HOME
+			exit 0
+		else
+			echo &quot;/usr/X11R6/bin/Xvfb cannot be executed. Please run firefox once as root.&quot; &gt;&amp;2
+			exit 1
+		fi;;
+	  -remote)
+		if [ $REMOTE -ne 1 ]; then
+			MOZARGS=&quot;-remote $2 $MOZARGS&quot;
+			REMOTE=1
+		fi
+		shift;;
+	  -profile|-profile-manager)
+		MOZARGS=&quot;$MOZARGS -profilemanager&quot;
+		REMOTE=1
+		;;
+	  -*)
+		MOZARGS=&quot;$MOZARGS $1&quot;
+		;;
+	  *)
+		if [ $RUNNING -eq 0 -a $REMOTE -ne 1 ]; then
+			MOZARGS=&quot;-remote \&quot;xfeDoCommand(openInbox)\&quot; $MOZARGS&quot;
+			REMOTE=1
+		else
+			MOZARGS=&quot;$MOZARGS ${1+&quot;$@&quot;}&quot;
+		fi;;
+	esac
+	shift
+done
 
-if [ $RUNNING -eq 0 ]; then
-	exec $MOZ_PROGRAM -remote &quot;xfeDoCommand (openInbox)&quot; $MOZARGS $@
+if [ $RUNNING -eq 0 -a $REMOTE -ne 1 ]; then
+	exec $MOZ_PROGRAM -a thunderbird -remote &quot;xfeDoCommand (openInbox)&quot; $MOZARGS
 else
-	exec $MOZ_PROGRAM $MOZARGS $@ &amp;
+	exec $MOZ_PROGRAM -a thunderbird $MOZARGS &amp;
 fi;
 EOF
 
 %build
+export MOZ_APP_NAME=&quot;thunderbird&quot;
 export MOZ_THUNDERBIRD=&quot;1&quot;
+export MOZILLA_OFFICIAL=&quot;1&quot;
+export BUILD_OFFICIAL=&quot;1&quot;
 export CFLAGS=&quot;%{optflags}&quot;
 export CXXFLAGS=&quot;%{optflags}&quot;
-%{__make} -f client.mk export
+%{__make} -f client.mk depend
 %{__make} %{?_smp_mflags} -f client.mk libs
 
 export LANG=&quot;en_US&quot;
-cd extensions/ipc
+pushd extensions/ipc
 ./makemake
 %{__make} %{?_smp_mflags}
-cd -
+popd
 
-cd extensions/enigmail
+pushd extensions/enigmail
 ./makemake
 %{__make} %{?_smp_mflags}
-cd -
+popd
 
 %install
 %{__rm} -rf %{buildroot}
@@ -187,39 +199,47 @@
 	MOZ_PKG_APPNAME=&quot;thunderbird&quot; \
 	MOZILLA_BIN=&quot;\$(DIST)/bin/thunderbird-bin&quot;
 
-%{__install} -m0755 %{name}.sh %{buildroot}%{_bindir}/thunderbird
+%{__install} -m0755 thunderbird.sh %{buildroot}%{_bindir}/thunderbird
+%{__install} -D -m0644 other-licenses/branding/thunderbird/mozicon50.xpm %{buildroot}%{_datadir}/pixmaps/thunderbird.xpm
 
-tar -xzv -C %{buildroot}%{_libdir} -f dist/thunderbird-*-linux-gnu.tar.gz
+%{__tar} -xzv -C %{buildroot}%{_libdir} -f dist/thunderbird-*-linux-gnu.tar.gz
 
-%{__install} -m0644 %{SOURCE3} %{buildroot}%{_datadir}/pixmaps/thunderbird.png
-
-%if %{dfi}
-	%{__install} -d -m0755 %{buildroot}%{_datadir}/gnome/apps/Internet/
-	%{__install} -m0644 %{name}.desktop %{buildroot}%{_datadir}/gnome/apps/Internet/
+%if %{?_without_freedesktop:1}0
+	%{__install} -D -m0644 thunderbird.desktop %{buildroot}%{_datadir}/gnome/apps/Internet/thunderbird.desktop
 %else
 	%{__install} -d -m0755 %{buildroot}%{_datadir}/applications/
 	desktop-file-install --vendor net                  \
 		--add-category X-Red-Hat-Base              \
 		--dir %{buildroot}%{_datadir}/applications \
-		%{name}.desktop
+		thunderbird.desktop
 %endif
 
+%post
+/sbin/ldconfig 2&gt;/dev/null
+%{_bindir}/thunderbird -register &amp;&gt;/dev/null 2&gt;&amp;1 || :
+%{_bindir}/update-desktop-database %{_datadir}/applications &amp;&gt;/dev/null || :
+
+%postun
+/sbin/ldconfig 2&gt;/dev/null
+%{_bindir}/update-desktop-database %{_datadir}/applications &amp;&gt;/dev/null || :
+
 %clean
 %{__rm} -rf %{buildroot}
 
 %files
 %defattr(-, root, root, 0755)
 %doc LEGAL LICENSE README.txt
-%{_bindir}/*
+%{_bindir}/thunderbird
 %{_libdir}/thunderbird/
-%{_datadir}/pixmaps/*
-%if %{dfi}
-	%{_datadir}/gnome/apps/Internet/*.desktop
-%else
-	%{_datadir}/applications/*.desktop
-%endif
+%{_datadir}/pixmaps/thunderbird.xpm
+%{?_without_freedesktop:%{_datadir}/gnome/apps/Internet/thunderbird.desktop}
+%{!?_without_freedesktop:%{_datadir}/applications/net-thunderbird.desktop}
 
 %changelog
+* Tue Jul 27 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.7.2-0
+- Update to 0.7.2.
+- Copy all of Dag's changes to the latest Firefox package.
+
 * Wed Jun  2 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.6-1
 - Update to 0.6.
 - Removed all patches since they seem to have been applied upstream.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000583.html">[SVN] r1774 - in trunk/rpms: dvgrab firefox kino php-mmcache	php-pecl-mailparse videolan-client
</A></li>
	<LI>Next message: <A HREF="000585.html">[SVN] r1776 - in trunk/rpms: . hddtemp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#584">[ date ]</a>
              <a href="thread.html#584">[ thread ]</a>
              <a href="subject.html#584">[ subject ]</a>
              <a href="author.html#584">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
