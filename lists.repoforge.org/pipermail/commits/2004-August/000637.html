<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r1831 - trunk/rpms/firefox
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1831%20-%20trunk/rpms/firefox&In-Reply-To=%3C20040802222554.1411317F74%40web22.us.megagiga.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000636.html">
   <LINK REL="Next"  HREF="000638.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r1831 - trunk/rpms/firefox</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1831%20-%20trunk/rpms/firefox&In-Reply-To=%3C20040802222554.1411317F74%40web22.us.megagiga.com%3E"
       TITLE="[SVN] r1831 - trunk/rpms/firefox">svn-commits at rpmforge.net
       </A><BR>
    <I>Tue Aug  3 00:25:54 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000636.html">[SVN] r1830 - in trunk/rpms: perl-Apache-Session perl-AppConfig perl-Array-RefElem perl-Authen-PAM perl-Authen-SASL perl-Authen-Smb perl-CSS-Tiny perl-Carp-Clan perl-Chemistry-File-MDLMol perl-Config-General perl-Config-Tiny perl-Convert-IBM390 perl-Crypt-CAST5 perl-Crypt-Enigma perl-Crypt-License perl-Crypt-OpenSSL-Bignum perl-Crypt-OpenSSL-DSA perl-Crypt-OpenSSL-RSA perl-Crypt-RC6 perl-Crypt-Rijndael perl-Crypt-Serpent perl-Crypt-Twofish2 perl-Crypt-Vigenere perl-Cwd perl-Data-Dump perl-Data-DumpXML perl-Data-ShowTable perl-DateTime-Event-Chinese perl-DateTime-Event-Cron perl-DateTime-Event-Easter perl-DateTime-Event-ICal perl-DateTime-Event-Lunar perl-DateTime-Event-NameDay perl-DateTime-Event-Random perl-DateTime-Event-Recurrence perl-DateTime-Event-SolarTerm perl-DateTime-Event-Sunrise perl-Devel-Trace perl-Digest-BubbleBabble perl-Digest-MD2 perl-Digest-Nilsimsa perl-Email-MIME-Attachment-Stripper perl-Expect perl-ExtUtils-CBuilder perl-ExtUtils-ParseXS perl-Ex tUtils-PerlPP perl-FCGI perl-File-NCopy perl-File-Slurp perl-GD-Graph3d perl-Gnome2-Vte perl-Graph-SocialMap perl-Graphics-ColorNames perl-Graphics-ColorPicker perl-Gtk2-TrayIcon perl-HTML-Clean perl-HTML-FillInForm perl-HTML-SimpleParse perl-Haul perl-IO-Tty perl-IO-Zlib perl-IPC-Run perl-Image-Base perl-Image-Button perl-Image-Size perl-Image-Xbm perl-Image-Xpm perl-Inline-BC perl-Inline-Python perl-Log-Dispatch perl-Log-Dispatch-FileRotate perl-Log-Log4perl perl-MD5 perl-MIME-Lite perl-MIME-Types perl-MKDoc-XML perl-MLDBM-Sync perl-MP3-Info perl-MP3-M3U-Parser perl-Mail-Alias perl-Mail-Sender perl-Mail-Sendmail perl-Module-Build perl-Module-CoreList perl-Module-Starter perl-Msgcat perl-Net-CIDR perl-Net-DAAP-Client perl-Net-DAAP-DMAP perl-Net-DAAP-Server perl-Net-DAV-Server perl-Net-DMAP-Server perl-Net-DNS-Codes perl-Net-DNS-SEC perl-Net-DNS-ToolKit perl-Net-DPAP-Client perl-Net-DPAP-Server perl-Net-Daemon perl-Net-Domain-TLD perl-Net-Google perl-Net-IANA-PortNumbers per l-Net-IP perl-Net-Jabber perl-Net-NBName perl-Net-Rendezvous perl-Net-Rendezvous-Publish perl-Net-SNMP-HostInfo perl-Net-Telnet perl-Net-WhoisNG perl-Net-WhoisNG-Person perl-Net-XWhois perl-PAR-Dist perl-PPI perl-Params-Validate perl-Parse-FixedLength perl-PerlIO-gzip perl-PlRPC perl-Pod-Coverage perl-Pod-Escapes perl-Pod-Simple perl-Python-Bytecode perl-SOAP-Clean perl-SOAP-DateTime perl-SOAP-WSDL perl-SVG-Metadata perl-SVN-Churn perl-SVN-Log perl-SVN-Log-Index perl-SVN-Mirror perl-SVN-Push perl-SVN-Web perl-Scraper perl-Set-IntSpan perl-String-Ediff perl-String-ShellQuote perl-Template-Plugin-YAML perl-Term-Clui perl-Term-ReadLine-Gnu perl-Test-Builder-Tester perl-Test-Manifest perl-Test-MockObject perl-Test-Pod perl-Text-Delimited perl-Text-Template perl-Tidy perl-Tie-IxHash perl-Tie-TextDir perl-WSDL-Generator perl-WWW-Search-Ebay perl-X11-SendEvent perl-XML-RPC perl-XML-RSS-Parser perl-XML-RSS-SimpleGen perl-XML-RSS-Timing perl-XML-RSS-TimingBot perl-XML-RSS-TimingBotDB I perl-XML-RegExp perl-XML-Simple perl-XML-Stream perl-XML-UM perl-XML-Validator-Schema perl-XML-Writer perl-XML-XPath perl-XML-XQL perl-XML-XSLT perl-YAML perl-YAML-Active perl-YAML-ConfigFile perl-YAML-LoadFileCached perl-YAML-MLDBM perl-YAML-Parser-Syck perl-ldap
</A></li>
        <LI>Next message: <A HREF="000638.html">[SVN] r1832 - trunk/rpms/firefox
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#637">[ date ]</a>
              <a href="thread.html#637">[ thread ]</a>
              <a href="subject.html#637">[ subject ]</a>
              <a href="author.html#637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dude
Date: 2004-08-03 00:25:52 +0200 (Tue, 03 Aug 2004)
New Revision: 1831

Added:
   trunk/rpms/firefox/firefox-0.9.2-extensions.patch
   trunk/rpms/firefox/firefox-0.9.2-gcc34.patch
   trunk/rpms/firefox/firefox.png
   trunk/rpms/firefox/mozilla-default-plugin-less-annoying.patch
Removed:
   trunk/rpms/firefox/firefox-gcc34.patch
Modified:
   trunk/rpms/firefox/firefox.spec
Log:
Further fixes and improvements, quite mature now.


Added: trunk/rpms/firefox/firefox-0.9.2-extensions.patch
===================================================================
--- trunk/rpms/firefox/firefox-0.9.2-extensions.patch	2004-08-02 22:09:23 UTC (rev 1830)
+++ trunk/rpms/firefox/firefox-0.9.2-extensions.patch	2004-08-02 22:25:52 UTC (rev 1831)
@@ -0,0 +1,153 @@
+Index: toolkit/mozapps/extensions/public/nsIExtensionManager.idl
+===================================================================
+RCS file: /cvsroot/mozilla/toolkit/mozapps/extensions/public/nsIExtensionManager.idl,v
+retrieving revision 1.2.6.5
+diff -p -u -8 -r1.2.6.5 nsIExtensionManager.idl
+--- toolkit/mozapps/extensions/public/nsIExtensionManager.idl	8 Jun 2004 10:09:55 -0000	1.2.6.5
++++ toolkit/mozapps/extensions/public/nsIExtensionManager.idl	13 Jul 2004 10:14:33 -0000
+@@ -58,16 +58,18 @@ interface nsIExtensionManager : nsISuppo
+ 
+   /** 
+    * Returns true if mismatches were found and the app needs to restart. 
+    */
+   boolean checkForMismatches();
+ 
+   void handleCommandLineArgs();
+ 
++  void register();
++
+   // Installing Extensions
+   const unsigned long FLAG_INSTALL_PROFILE = 0x01;
+   const unsigned long FLAG_INSTALL_GLOBAL  = 0x02;
+ 
+   void installExtension(in nsIFile aXPIFile, in unsigned long aFlags);
+   void uninstallExtension(in string aExtensionID);
+   void enableExtension(in string aExtensionID);
+   void disableExtension(in string aExtensionID);
+Index: toolkit/mozapps/extensions/src/nsExtensionManager.js.in
+===================================================================
+RCS file: /cvsroot/mozilla/toolkit/mozapps/extensions/src/nsExtensionManager.js.in,v
+retrieving revision 1.5.6.38
+diff -p -u -8 -r1.5.6.38 nsExtensionManager.js.in
+--- toolkit/mozapps/extensions/src/nsExtensionManager.js.in	13 Jul 2004 08:08:35 -0000	1.5.6.38
++++ toolkit/mozapps/extensions/src/nsExtensionManager.js.in	13 Jul 2004 10:14:38 -0000
+@@ -102,17 +102,16 @@ function getDirNoCreate(aKey, aSubDirs)
+ {
+   return getDirInternal(aKey, aSubDirs, false);
+ }
+ 
+ function getDirInternal(aKey, aSubDirs, aCreate)
+ {
+   var fileLocator = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]
+                               .getService(Components.interfaces.nsIProperties);
+-  
+   var dir = fileLocator.get(aKey, Components.interfaces.nsIFile);
+   for (var i = 0; i &lt; aSubDirs.length; ++i) {
+     dir.append(aSubDirs[i]);
+     if (aCreate &amp;&amp; !dir.exists())
+       dir.create(Components.interfaces.nsIFile.DIRECTORY_TYPE, 0755);
+   }
+   return dir;
+ }
+@@ -1443,16 +1442,17 @@ function nsExtensionManager()
+ 
+   ensureExtensionsFiles(false);
+ }
+ 
+ nsExtensionManager.prototype = {
+   _extInstaller     : null,
+   _extUninstaller   : null,
+   _extEnabler       : null,
++  _started          : false,
+   
+   /////////////////////////////////////////////////////////////////////////////
+   // nsIObserver
+   observe: function (aSubject, aTopic, aData)
+   {
+     switch (aTopic) {
+     case &quot;quit-application-requested&quot;:
+       if (this._downloadCount &gt; 0) {
+@@ -1489,16 +1489,18 @@ nsExtensionManager.prototype = {
+         PRBool.data = result;
+       }
+       break;  
+     }
+   },
+   
+   start: function (aIsDirty)
+   {
++    this._started = true;
++    
+     var needsRestart = false;
+   
+     ensureExtensionsFiles(true);
+     
+     // Somehow the component list went away, and for that reason the new one
+     // generated by this function is going to result in a different compreg.
+     // We must force a restart.
+     var componentList = getFile(KEY_PROFILEDIR, [FILE_COMPONENT_MANIFEST]);
+@@ -1637,16 +1639,33 @@ nsExtensionManager.prototype = {
+     var unlocked = cmdLineSvc.getCmdLineValue(&quot;-unlock-item&quot;);
+     if (unlocked) {
+       this._ensureDS();
+       this._ds.lockUnlockItem(unlocked, false);
+     }
+     
+     this._finishOperations();
+   },
++  
++  register: function ()
++  {
++    if (!this._started) {
++      // Loads the datasource and installs any pre-configured items.
++      this._ds = new nsExtensionsDataSource();
++      this._ds.loadExtensions(false);
++      
++      // Write bin/extensions/Extensions.rdf
++      //       bin/extensions/installed-extensions-processed.txt
++      (new nsInstalledExtensionReader(this)).read();
++
++      // Write bin/components.ini
++      var manifest = getFile(KEY_APPDIR, [FILE_COMPONENT_MANIFEST]);
++      this._writeProfileFile(manifest, this._getComponentsDir, false);
++    }
++  },
+ 
+   _cancelDownloads: function ()
+   {
+     var os = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]
+                         .getService(Components.interfaces.nsIObserverService);
+     for (var i = 0; i &lt; this._transactions.length; ++i)
+       os.notifyObservers(this._transactions[i], &quot;xpinstall-progress&quot;, &quot;cancel&quot;);
+     os.removeObserver(this, &quot;offline-requested&quot;);
+Index: toolkit/xre/nsAppRunner.cpp
+===================================================================
+RCS file: /cvsroot/mozilla/toolkit/xre/nsAppRunner.cpp,v
+retrieving revision 1.27.2.1.4.32
+diff -p -u -8 -r1.27.2.1.4.32 nsAppRunner.cpp
+--- toolkit/xre/nsAppRunner.cpp	7 Jul 2004 21:39:06 -0000	1.27.2.1.4.32
++++ toolkit/xre/nsAppRunner.cpp	13 Jul 2004 10:14:43 -0000
+@@ -1703,16 +1703,22 @@ int xre_main(int argc, char* argv[], con
+     NS_ENSURE_SUCCESS(rv, 1);
+ 
+     {
+       nsCOMPtr&lt;nsIChromeRegistry&gt; chromeReg
+         (do_GetService(&quot;@mozilla.org/chrome/chrome-registry;1&quot;));
+       NS_ENSURE_TRUE(chromeReg, 1);
+ 
+       chromeReg-&gt;CheckForNewChrome();
++
++      nsCOMPtr&lt;nsIExtensionManager&gt; em
++        (do_GetService(&quot;@mozilla.org/extensions/manager;1&quot;));
++      NS_ENSURE_TRUE(em, 1);
++
++      em-&gt;Register();
+     }
+     return 0;
+   }
+ 
+ #if defined(MOZ_WIDGET_GTK) || defined(MOZ_WIDGET_GTK2)
+   // setup for private colormap.  Ideally we'd like to do this
+   // in nsAppShell::Create, but we need to get in before gtk
+   // has been initialized to make sure everything is running
+

Added: trunk/rpms/firefox/firefox-0.9.2-gcc34.patch
===================================================================
--- trunk/rpms/firefox/firefox-0.9.2-gcc34.patch	2004-08-02 22:09:23 UTC (rev 1830)
+++ trunk/rpms/firefox/firefox-0.9.2-gcc34.patch	2004-08-02 22:25:52 UTC (rev 1831)
@@ -0,0 +1,11 @@
+--- mozilla/xpinstall/src/nsSoftwareUpdate.cpp.orig	2004-06-16 12:58:28.236052698 +0300
++++ mozilla/xpinstall/src/nsSoftwareUpdate.cpp	2004-06-16 12:58:33.812430303 +0300
+@@ -512,7 +512,7 @@
+                                          nsSoftwareUpdate::GetInstance)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallTrigger)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallVersion)
+-NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager);
++NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager)
+ NS_GENERIC_FACTORY_CONSTRUCTOR(nsSoftwareUpdateNameSet)
+ 
+ //----------------------------------------------------------------------

Deleted: trunk/rpms/firefox/firefox-gcc34.patch
===================================================================
--- trunk/rpms/firefox/firefox-gcc34.patch	2004-08-02 22:09:23 UTC (rev 1830)
+++ trunk/rpms/firefox/firefox-gcc34.patch	2004-08-02 22:25:52 UTC (rev 1831)
@@ -1,11 +0,0 @@
---- mozilla/xpinstall/src/nsSoftwareUpdate.cpp.orig	2004-06-16 12:58:28.236052698 +0300
-+++ mozilla/xpinstall/src/nsSoftwareUpdate.cpp	2004-06-16 12:58:33.812430303 +0300
-@@ -512,7 +512,7 @@
-                                          nsSoftwareUpdate::GetInstance)
- NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallTrigger)
- NS_GENERIC_FACTORY_CONSTRUCTOR(nsInstallVersion)
--NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager);
-+NS_GENERIC_FACTORY_CONSTRUCTOR(nsXPInstallManager)
- NS_GENERIC_FACTORY_CONSTRUCTOR(nsSoftwareUpdateNameSet)
- 
- //----------------------------------------------------------------------

Added: trunk/rpms/firefox/firefox.png
===================================================================
(Binary files differ)


Property changes on: trunk/rpms/firefox/firefox.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/rpms/firefox/firefox.spec
===================================================================
--- trunk/rpms/firefox/firefox.spec	2004-08-02 22:09:23 UTC (rev 1830)
+++ trunk/rpms/firefox/firefox.spec	2004-08-02 22:25:52 UTC (rev 1831)
@@ -11,26 +11,25 @@
 Summary: Mozilla Firefox web browser
 Name: firefox
 Version: 0.9.2
-Release: 4
+Release: 5
 License: MPL/LGPL
 Group: Applications/Internet
 URL: <A HREF="http://www.mozilla.org/projects/firefox/">http://www.mozilla.org/projects/firefox/</A>
 
-Packager: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
-Vendor: Dag Apt Repository, <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
-
 Source: <A HREF="http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/%{version">http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/%{version</A>}/firefox-%{version}-source.tar.bz2
 Source1: firefox-rebuild-databases.pl.in
-Patch1: firefox-gcc34.patch
+Source2: firefox.png
+Patch0: firefox-0.9.2-gcc34.patch
+Patch1: firefox-0.9.2-extensions.patch
+Patch2: mozilla-default-plugin-less-annoying.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 
-BuildRequires: XFree86-devel, zlib-devel, zip, gzip, perl
+BuildRequires: XFree86-devel, zlib-devel, zip
 BuildRequires: libpng-devel, libjpeg-devel
 BuildRequires: ORBit-devel, gcc-c++, krb5-devel
 %{!?_without_freedesktop:BuildRequires: desktop-file-utils}
 %{!?_without_gtk2:BuildRequires: gtk2-devel, libIDL-devel, gnome-vfs2-devel}
 %{?_without_gtk2:BuildRequires: gtk+-devel}
-Requires(post): /usr/X11R6/bin/Xvfb
 
 Obsoletes: phoenix, MozillaFirebird, mozilla-firebird, mozilla-firefox
 Provides: webclient
@@ -41,7 +40,9 @@
 
 %prep
 %setup -n mozilla
-%patch1 -p1
+%patch0 -p1 -b .gcc34
+%patch1 -p0 -b .extensions
+%patch2 -p1 -b .plugin
 
 %{__cat} &lt;&lt;EOF &gt;bookmarks.html
 &lt;!DOCTYPE NETSCAPE-Bookmark-file-1&gt;
@@ -67,9 +68,9 @@
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>&quot;&gt;Dag RPM Repository&lt;/A&gt;
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://dries.studentenweb.org/apt/">http://dries.studentenweb.org/apt/</A>&quot;&gt;Dries RPM Repository&lt;/A&gt;
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&quot;&gt;FreshRPMS&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://newrpms.sunsite.dk/">http://newrpms.sunsite.dk/</A>&quot;&gt;NewRPMS&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://newrpms.sunsite.dk/">http://newrpms.sunsite.dk/</A>&quot;&gt;NewRPMS&lt;/A&gt;
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://rpm.pbone.net/">http://rpm.pbone.net/</A>&quot;&gt;RPM PBone search&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.rpmseek.com/">http://www.rpmseek.com/</A>&quot;&gt;RPMSeek search&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.rpmseek.com/">http://www.rpmseek.com/</A>&quot;&gt;RPMSeek search&lt;/A&gt;
     &lt;/DL&gt;&lt;p&gt;
     &lt;DT&gt;&lt;H3&gt;News&lt;/H3&gt;
     &lt;DL&gt;&lt;p&gt;
@@ -90,12 +91,12 @@
     &lt;/DL&gt;&lt;p&gt;
     &lt;DT&gt;&lt;H3&gt;Firefox Web Browser&lt;/H3&gt;
     &lt;DL&gt;&lt;p&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://texturizer.net/firefox/">http://texturizer.net/firefox/</A>&quot;&gt;Firefox Help&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.mozillazine.org/forums/?c=4">http://www.mozillazine.org/forums/?c=4</A>&quot;&gt;Firefox Forum&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://plugindoc.mozdev.org/faqs/">http://plugindoc.mozdev.org/faqs/</A>&quot;&gt;Firefox Plugin FAQ&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.mozilla.org/projects/firefox/">http://www.mozilla.org/projects/firefox/</A>&quot;&gt;Firefox Website&lt;/A&gt;
-	&lt;DT&gt;&lt;a HREF=&quot;<A HREF="http://texturizer.net/firefox/extensions.html">http://texturizer.net/firefox/extensions.html</A>&quot;&gt;Firefox Extensions&lt;/A&gt;
-	&lt;DT&gt;&lt;a HREF=&quot;<A HREF="http://texturizer.net/firefox/themes.html">http://texturizer.net/firefox/themes.html</A>&quot;&gt;Firefox Themes&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://texturizer.net/firefox/">http://texturizer.net/firefox/</A>&quot;&gt;Firefox Help&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.mozillazine.org/forums/?c=4">http://www.mozillazine.org/forums/?c=4</A>&quot;&gt;Firefox Forum&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://plugindoc.mozdev.org/faqs/">http://plugindoc.mozdev.org/faqs/</A>&quot;&gt;Firefox Plugin FAQ&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.mozilla.org/projects/firefox/">http://www.mozilla.org/projects/firefox/</A>&quot;&gt;Firefox Website&lt;/A&gt;
+        &lt;DT&gt;&lt;a HREF=&quot;<A HREF="http://texturizer.net/firefox/extensions.html">http://texturizer.net/firefox/extensions.html</A>&quot;&gt;Firefox Extensions&lt;/A&gt;
+        &lt;DT&gt;&lt;a HREF=&quot;<A HREF="http://texturizer.net/firefox/themes.html">http://texturizer.net/firefox/themes.html</A>&quot;&gt;Firefox Themes&lt;/A&gt;
     &lt;/DL&gt;&lt;p&gt;
     &lt;HR&gt;
     &lt;DT&gt;&lt;H3&gt;Quick Searches&lt;/H3&gt;
@@ -106,9 +107,9 @@
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://dictionary.reference.com/search?q=%s">http://dictionary.reference.com/search?q=%s</A>&quot; SHORTCUTURL=&quot;dict&quot;&gt;Dictionary.com Quicksearch&lt;/A&gt;
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.webster.com/cgi-bin/dictionary?va=%s">http://www.webster.com/cgi-bin/dictionary?va=%s</A>&quot; SHORTCUTURL=&quot;webster&quot;&gt;Dictionary Quicksearch&lt;/A&gt;
         &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://www.google.com/search?&amp;q=stocks:%s">http://www.google.com/search?&amp;q=stocks:%s</A>&quot; SHORTCUTURL=&quot;quot&quot;&gt;Stock Symbol Quicksearch&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://freshmeat.net/search?q=%s">http://freshmeat.net/search?q=%s</A>&quot; SHORTCUTURL=&quot;freshmeat&quot;&gt;Freshmeat Quicksearch&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://us.imdb.com/Find?select=All&amp;for=%s">http://us.imdb.com/Find?select=All&amp;for=%s</A>&quot; SHORTCUTURL=&quot;movie&quot;&gt;Movies Quicksearch&lt;/A&gt;
-	&lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://be2.php.net/manual-lookup.php?pattern=%s">http://be2.php.net/manual-lookup.php?pattern=%s</A>&quot; SHORTCUTURL=&quot;php&quot;&gt;PHP Documentation Quicksearch&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://freshmeat.net/search?q=%s">http://freshmeat.net/search?q=%s</A>&quot; SHORTCUTURL=&quot;freshmeat&quot;&gt;Freshmeat Quicksearch&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://us.imdb.com/Find?select=All&amp;for=%s">http://us.imdb.com/Find?select=All&amp;for=%s</A>&quot; SHORTCUTURL=&quot;movie&quot;&gt;Movies Quicksearch&lt;/A&gt;
+        &lt;DT&gt;&lt;A HREF=&quot;<A HREF="http://be2.php.net/manual-lookup.php?pattern=%s">http://be2.php.net/manual-lookup.php?pattern=%s</A>&quot; SHORTCUTURL=&quot;php&quot;&gt;PHP Documentation Quicksearch&lt;/A&gt;
     &lt;/DL&gt;&lt;p&gt;
     &lt;HR&gt;
 &lt;/DL&gt;&lt;p&gt;
@@ -148,7 +149,7 @@
 Name=Firefox Web Browser
 Comment=Browse the Internet
 Exec=firefox
-Icon=firefox.xpm
+Icon=firefox.png
 Terminal=false
 Type=Application
 StartupNotify=false
@@ -172,13 +173,11 @@
 
 MOZARGS=&quot;&quot;
 MOZLOCALE=&quot;$(echo $LANG | sed 's|_\([^.]*\).*|-\1|g')&quot;
-if [ -f &quot;$MOZILLA_FIVE_HOME/chrome/$MOZLOCALE.jar&quot; ]; then
-	MOZARGS=&quot;-UILocale $MOZLOCALE&quot;
-fi
+[ -f &quot;$MOZILLA_FIVE_HOME/chrome/$MOZLOCALE.jar&quot; ] &amp;&amp; MOZARGS=&quot;-UILocale $MOZLOCALE&quot;
 
 $MOZ_PROGRAM -a firefox -remote 'ping()' &amp;&gt;/dev/null
 RUNNING=$?
-if [ $? -eq 2 ]; then RUNNING=0; fi
+[ $? -eq 2 ] &amp;&amp; RUNNING=0
 
 REMOTE=0
 while [ &quot;$1&quot; ]; do
@@ -193,20 +192,6 @@
 #			MOZARGS=&quot;-remote xfeDoCommand(composeMessage) $MOZARGS&quot;
 #			REMOTE=1
 #		fi;;
-	  -register)
-		if [ -x &quot;/usr/X11R6/bin/Xvfb&quot; ]; then
-			export HOME=&quot;$(mktemp -d /tmp/firefox-rpm.$$)&quot;
-			mkdir -p $HOME/.mozilla/firefox/default/
-			cp -rf $MOZILLA_FIVE_HOME/defaults/profile/* $HOME/.mozilla/firefox/default/
-			echo -e &quot;[General]\nStartWithLastProfile=1\n\n[Profile0]\nName=default\nIsRelative=1\nPath=default&quot; &gt;$HOME/.mozilla/firefox/profiles.ini
-			/usr/X11R6/bin/Xvfb :69 -nolisten tcp -ac -terminate &amp;
-			DISPLAY=:69 $MOZILLA_FIVE_HOME/firefox-bin -a firefox -install-global-extension -install-global-theme
-			rm -rf $HOME
-			exit 0
-		else
-			echo &quot;/usr/X11R6/bin/Xvfb cannot be executed. Please run firefox once as root.&quot; &gt;&amp;2
-			exit 1
-		fi;;
 	  -remote)
 		if [ $REMOTE -ne 1 ]; then
 			MOZARGS=&quot;-remote $2 $MOZARGS&quot;
@@ -258,7 +243,7 @@
 	MOZILLA_BIN=&quot;\$(DIST)/bin/firefox-bin&quot;
 
 %{__install} -D -m0755 firefox.sh %{buildroot}%{_bindir}/firefox
-%{__install} -D -m0644 other-licenses/branding/firefox/mozicon50.xpm %{buildroot}%{_datadir}/pixmaps/firefox.xpm
+%{__install} -D -m0644 %{SOURCE2} %{buildroot}%{_datadir}/pixmaps/firefox.png
 
 %{__tar} -xvz -C %{buildroot}%{_libdir} -f dist/firefox-*-linux-gnu.tar.gz
 
@@ -274,11 +259,11 @@
 fi
 
 %if %{?_without_freedesktop:1}0
-        %{__install} -D -m0644 firefox.desktop %{buildroot}%{_datadir}/gnome/apps/Internet/firefox.desktop
+	%{__install} -D -m0644 firefox.desktop %{buildroot}%{_datadir}/gnome/apps/Internet/firefox.desktop
 %else
-        %{__install} -d -m0755 %{buildroot}%{_datadir}/applications/
-	desktop-file-install --vendor net                  \
-		--add-category X-Red-Hat-Base              \
+	%{__install} -d -m0755 %{buildroot}%{_datadir}/applications/
+	desktop-file-install --vendor net \
+		--add-category X-Red-Hat-Base \
 		--dir %{buildroot}%{_datadir}/applications \
 		firefox.desktop
 %endif
@@ -306,14 +291,19 @@
 %doc LEGAL LICENSE README.txt
 %{_bindir}/firefox
 %{_libdir}/firefox/
-%{_datadir}/pixmaps/firefox.xpm
+%{_datadir}/pixmaps/firefox.png
 %{?_without_freedesktop:%{_datadir}/gnome/apps/Internet/firefox.desktop}
 %{!?_without_freedesktop:%{_datadir}/applications/net-firefox.desktop}
 
 %changelog
+* Fri Jul 30 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.9.2-5
+- Revert included xpm icon to an add-on png that looks nicer.
+
 * Tue Jul 27 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.9.2-4
 - Fixed register by calling firefox instead of firefox-bin.
 - Added krb5/gssapi support.
+- Included the upstream -register patch.
+- Included the mozilla &quot;less annoying&quot; plugin patch.
 - Removed unneeded configure options (unexisting or defaults).
 - Removed unneeded exports and defines.
 - Other minor cleanups.

Added: trunk/rpms/firefox/mozilla-default-plugin-less-annoying.patch
===================================================================
--- trunk/rpms/firefox/mozilla-default-plugin-less-annoying.patch	2004-08-02 22:09:23 UTC (rev 1830)
+++ trunk/rpms/firefox/mozilla-default-plugin-less-annoying.patch	2004-08-02 22:25:52 UTC (rev 1831)
@@ -0,0 +1,62 @@
+--- mozilla/modules/plugin/samples/default/unix/npshell.c.foo	Tue May  7 14:18:45 2002
++++ mozilla/modules/plugin/samples/default/unix/npshell.c	Tue May  7 14:49:55 2002
+@@ -224,7 +224,7 @@
+       This-&gt;depth = ws_info-&gt;depth;
+       This-&gt;colormap = ws_info-&gt;colormap;
+       makePixmap(This);
+-      makeWidget(This);
++      /* makeWidget(This); */
+     }
+     return NPERR_NO_ERROR;
+ }
+--- mozilla/modules/plugin/samples/default/unix/nullplugin.c.foo	Tue May  7 14:18:45 2002
++++ mozilla/modules/plugin/samples/default/unix/nullplugin.c	Tue May  7 14:48:33 2002
+@@ -70,6 +70,8 @@
+ 
+     gtk_object_remove_data(GTK_OBJECT(button), DIALOGID);
+ 
++#if 0
++
+     if (This-&gt;pluginsFileUrl != NULL)
+     {
+         /* Get the JavaScript command string */
+@@ -110,6 +112,7 @@
+             NPN_MemFree(url);
+         }
+     }
++#endif
+     destroyWidget(This);
+ }
+ 
+@@ -265,14 +268,14 @@
+                    GTK_DIALOG(dialogWindow)-&gt;action_area);
+     gtk_object_set_data(GTK_OBJECT(okButton), DIALOGID, dialogWindow);
+ 
+-    cancelButton= AddWidget(gtk_button_new_with_label (CANCEL_BUTTON), 
+-                   GTK_DIALOG(dialogWindow)-&gt;action_area);
++    /*    cancelButton= AddWidget(gtk_button_new_with_label (CANCEL_BUTTON), 
++          GTK_DIALOG(dialogWindow)-&gt;action_area); */
+ 
+     gtk_signal_connect (GTK_OBJECT(okButton),  &quot;clicked&quot;,
+                         GTK_SIGNAL_FUNC(DialogOKClicked), This);
+ 
+-    gtk_signal_connect (GTK_OBJECT(cancelButton),  &quot;clicked&quot;,
+-                        GTK_SIGNAL_FUNC(DialogCancelClicked), This);
++    /*    gtk_signal_connect (GTK_OBJECT(cancelButton),  &quot;clicked&quot;,
++          GTK_SIGNAL_FUNC(DialogCancelClicked), This); */
+ 
+     /* hookup to when the dialog is destroyed */
+     gtk_signal_connect(GTK_OBJECT(dialogWindow), &quot;destroy&quot;,
+--- mozilla/modules/plugin/samples/default/unix/nullplugin.h.foo	Tue May  7 14:46:48 2002
++++ mozilla/modules/plugin/samples/default/unix/nullplugin.h	Tue May  7 14:47:08 2002
+@@ -53,9 +53,7 @@
+ #define JVM_MINETYPE        &quot;application/x-java-vm&quot;
+ #define MESSAGE &quot;\
+ This page contains information of a type (%s) that can\n\
+-only be viewed with the appropriate Plug-in.\n\
+-\n\
+-Click OK to download Plugin.&quot;
++only be viewed with the appropriate Plug-in.&quot;
+ 
+ #define GET 1
+ #define REFRESH 2


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000636.html">[SVN] r1830 - in trunk/rpms: perl-Apache-Session perl-AppConfig perl-Array-RefElem perl-Authen-PAM perl-Authen-SASL perl-Authen-Smb perl-CSS-Tiny perl-Carp-Clan perl-Chemistry-File-MDLMol perl-Config-General perl-Config-Tiny perl-Convert-IBM390 perl-Crypt-CAST5 perl-Crypt-Enigma perl-Crypt-License perl-Crypt-OpenSSL-Bignum perl-Crypt-OpenSSL-DSA perl-Crypt-OpenSSL-RSA perl-Crypt-RC6 perl-Crypt-Rijndael perl-Crypt-Serpent perl-Crypt-Twofish2 perl-Crypt-Vigenere perl-Cwd perl-Data-Dump perl-Data-DumpXML perl-Data-ShowTable perl-DateTime-Event-Chinese perl-DateTime-Event-Cron perl-DateTime-Event-Easter perl-DateTime-Event-ICal perl-DateTime-Event-Lunar perl-DateTime-Event-NameDay perl-DateTime-Event-Random perl-DateTime-Event-Recurrence perl-DateTime-Event-SolarTerm perl-DateTime-Event-Sunrise perl-Devel-Trace perl-Digest-BubbleBabble perl-Digest-MD2 perl-Digest-Nilsimsa perl-Email-MIME-Attachment-Stripper perl-Expect perl-ExtUtils-CBuilder perl-ExtUtils-ParseXS perl-Ex tUtils-PerlPP perl-FCGI perl-File-NCopy perl-File-Slurp perl-GD-Graph3d perl-Gnome2-Vte perl-Graph-SocialMap perl-Graphics-ColorNames perl-Graphics-ColorPicker perl-Gtk2-TrayIcon perl-HTML-Clean perl-HTML-FillInForm perl-HTML-SimpleParse perl-Haul perl-IO-Tty perl-IO-Zlib perl-IPC-Run perl-Image-Base perl-Image-Button perl-Image-Size perl-Image-Xbm perl-Image-Xpm perl-Inline-BC perl-Inline-Python perl-Log-Dispatch perl-Log-Dispatch-FileRotate perl-Log-Log4perl perl-MD5 perl-MIME-Lite perl-MIME-Types perl-MKDoc-XML perl-MLDBM-Sync perl-MP3-Info perl-MP3-M3U-Parser perl-Mail-Alias perl-Mail-Sender perl-Mail-Sendmail perl-Module-Build perl-Module-CoreList perl-Module-Starter perl-Msgcat perl-Net-CIDR perl-Net-DAAP-Client perl-Net-DAAP-DMAP perl-Net-DAAP-Server perl-Net-DAV-Server perl-Net-DMAP-Server perl-Net-DNS-Codes perl-Net-DNS-SEC perl-Net-DNS-ToolKit perl-Net-DPAP-Client perl-Net-DPAP-Server perl-Net-Daemon perl-Net-Domain-TLD perl-Net-Google perl-Net-IANA-PortNumbers per l-Net-IP perl-Net-Jabber perl-Net-NBName perl-Net-Rendezvous perl-Net-Rendezvous-Publish perl-Net-SNMP-HostInfo perl-Net-Telnet perl-Net-WhoisNG perl-Net-WhoisNG-Person perl-Net-XWhois perl-PAR-Dist perl-PPI perl-Params-Validate perl-Parse-FixedLength perl-PerlIO-gzip perl-PlRPC perl-Pod-Coverage perl-Pod-Escapes perl-Pod-Simple perl-Python-Bytecode perl-SOAP-Clean perl-SOAP-DateTime perl-SOAP-WSDL perl-SVG-Metadata perl-SVN-Churn perl-SVN-Log perl-SVN-Log-Index perl-SVN-Mirror perl-SVN-Push perl-SVN-Web perl-Scraper perl-Set-IntSpan perl-String-Ediff perl-String-ShellQuote perl-Template-Plugin-YAML perl-Term-Clui perl-Term-ReadLine-Gnu perl-Test-Builder-Tester perl-Test-Manifest perl-Test-MockObject perl-Test-Pod perl-Text-Delimited perl-Text-Template perl-Tidy perl-Tie-IxHash perl-Tie-TextDir perl-WSDL-Generator perl-WWW-Search-Ebay perl-X11-SendEvent perl-XML-RPC perl-XML-RSS-Parser perl-XML-RSS-SimpleGen perl-XML-RSS-Timing perl-XML-RSS-TimingBot perl-XML-RSS-TimingBotDB I perl-XML-RegExp perl-XML-Simple perl-XML-Stream perl-XML-UM perl-XML-Validator-Schema perl-XML-Writer perl-XML-XPath perl-XML-XQL perl-XML-XSLT perl-YAML perl-YAML-Active perl-YAML-ConfigFile perl-YAML-LoadFileCached perl-YAML-MLDBM perl-YAML-Parser-Syck perl-ldap
</A></li>
	<LI>Next message: <A HREF="000638.html">[SVN] r1832 - trunk/rpms/firefox
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#637">[ date ]</a>
              <a href="thread.html#637">[ thread ]</a>
              <a href="subject.html#637">[ subject ]</a>
              <a href="author.html#637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
