<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r1371 - in trunk/rpms: . kernel-module-ipw2100	kernel-module-pwcx kernel-module-qc-usb
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1371%20-%20in%20trunk/rpms%3A%20.%20kernel-module-ipw2100%0A%09kernel-module-pwcx%20kernel-module-qc-usb&In-Reply-To=%3C20040618101435.BD1771FCAA%40server01.nl.egwn.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000179.html">
   <LINK REL="Next"  HREF="000181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r1371 - in trunk/rpms: . kernel-module-ipw2100	kernel-module-pwcx kernel-module-qc-usb</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1371%20-%20in%20trunk/rpms%3A%20.%20kernel-module-ipw2100%0A%09kernel-module-pwcx%20kernel-module-qc-usb&In-Reply-To=%3C20040618101435.BD1771FCAA%40server01.nl.egwn.net%3E"
       TITLE="[SVN] r1371 - in trunk/rpms: . kernel-module-ipw2100	kernel-module-pwcx kernel-module-qc-usb">svn-commits at rpmforge.net
       </A><BR>
    <I>Fri Jun 18 12:14:35 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000179.html">[SVN] r1370 - in trunk/rpms: . perl-Digest-MD2
</A></li>
        <LI>Next message: <A HREF="000181.html">[SVN] r1372 - in trunk/rpms: . perl-Authen-Smb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#180">[ date ]</a>
              <a href="thread.html#180">[ thread ]</a>
              <a href="subject.html#180">[ subject ]</a>
              <a href="author.html#180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dude
Date: 2004-06-18 12:14:33 +0200 (Fri, 18 Jun 2004)
New Revision: 1371

Added:
   trunk/rpms/kernel-module-pwcx/
   trunk/rpms/kernel-module-pwcx/kernel-module-pwcx.spec
   trunk/rpms/kernel-module-pwcx/pwcx.autotools.patch
   trunk/rpms/kernel-module-qc-usb/dag-kernel-module-qc-usb.spec
   trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec
   trunk/rpms/kernel-module-qc-usb/qc-usb.autotools.patch
Removed:
   trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec
Modified:
   trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec
Log:
New kernel modules and minor changes.


Modified: trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec
===================================================================
--- trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec	2004-06-18 10:14:33 UTC (rev 1371)
@@ -22,7 +22,10 @@
 %define basedeveldir %{_libdir}/kernel-module-devel-%{krel}
 %define develdir %{basedeveldir}/kernel%{ktype}-%{krel}.%{_target_cpu}.rpm
 
+# Do we want to put the module into &quot;updates&quot; (don't define for &quot;no&quot;)
+#define updates /updates
 
+
 Summary: Driver for Intel&#174; PRO/Wireless 2100 network adaptors
 Name: kernel-module-ipw2100
 Version: 0.46_3
@@ -40,7 +43,7 @@
 BuildRequires: kernel-source = %{krel}
 BuildRequires: kernel-module-hostap-%{krel}
 %endif
-BuildRequires:	autoconf, automake
+BuildRequires: autoconf, automake
 
 %description
 This package contains a kernel module for the Intel&#174; PRO/Wireless 2100
@@ -74,15 +77,12 @@
 
 
 %build
+sh autogen.sh || :
 %if %{post26}
-# For post 2.6 kernels
-sh autogen.sh || :
 %configure \
     --with-linuxdir=&quot;%{develdir}&quot; \
     --disable-legacy-fw-load
 %else
-# For pre 2.6 kernels
-sh autogen.sh || :
 %configure \
     --with-rpm-target=&quot;%{_target_cpu}&quot; \
     --with-kernel-release=&quot;%{kernel}&quot; \
@@ -93,7 +93,7 @@
 
 %install
 %{__rm} -rf %{buildroot}
-%makeinstall modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}&quot;
+%makeinstall modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}%{?updates}&quot;
 
 
 %clean
@@ -109,7 +109,7 @@
 
 %files %{kernel}
 %defattr(-, root, root, 0755)
-/lib/modules/%{kernel}/kernel/drivers/net/wireless/ipw2100.*o
+/lib/modules/%{kernel}%{?updates}/kernel/drivers/net/wireless/ipw2100.*o
 
 
 %changelog

Added: trunk/rpms/kernel-module-pwcx/kernel-module-pwcx.spec
===================================================================
--- trunk/rpms/kernel-module-pwcx/kernel-module-pwcx.spec	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-pwcx/kernel-module-pwcx.spec	2004-06-18 10:14:33 UTC (rev 1371)
@@ -0,0 +1,121 @@
+# $Id$
+# Authority: matthias
+
+# What kernel are we building for?
+%{!?kernel: %define kernel %(uname -r)}
+# Get the correct kernel package release by stripping kernel modifiers
+%define krel %(echo %{kernel} | sed -e s/smp//g -)
+# Get a type modifier for the kernel, (null) or -smp
+%if %(echo %{kernel} | grep -c smp)
+    %{expand:%%define ktype -smp}
+%else
+    %define ktype %{nil}
+%endif
+
+# What kernel &quot;flavor&quot; are we building for ?
+%{expand:%%define post26 %(echo %{kernel} | grep &quot;^2\.[0-4]\.&quot; &gt;/dev/null &amp;&amp; echo 0 || echo 1)}
+
+# Don't build debuginfo packages for kernel modules
+%define debug_package %{nil}
+
+# Where the kernel build tree lives for post 2.6
+%define basedeveldir %{_libdir}/kernel-module-devel-%{krel}
+%define develdir %{basedeveldir}/kernel%{ktype}-%{krel}.%{_target_cpu}.rpm
+
+# Do we want to put the module into &quot;updates&quot; (don't define for &quot;no&quot;)
+%if %{post26}
+%define updates /updates
+%endif
+
+
+Summary: Driver for Philips pwc-based webcams
+Name: kernel-module-pwcx
+Version: 9.0
+Release: 0.beta2
+License: GPL with proprietary code
+Group: System Environment/Kernel
+URL: <A HREF="http://www.smcc.demon.nl/webcam/">http://www.smcc.demon.nl/webcam/</A>
+Source: <A HREF="http://www.smcc.demon.nl/webcam/pwcx-%{version">http://www.smcc.demon.nl/webcam/pwcx-%{version</A>}-beta-2.tar.gz
+Patch: pwcx.autotools.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+%if %{post26}
+BuildRequires: kernel-module-devel-%{krel}
+%else
+BuildRequires: kernel-source = %{krel}
+%endif
+BuildRequires: autoconf, automake
+
+%description
+This package contains a kernel module for the Philips USB webcams.
+
+To rebuild this package you should use :
+--define &quot;kernel &lt;uname -r output&gt;&quot;
+--target &lt;arch&gt;
+
+
+%package %{kernel}
+Summary: Driver for Philips pwc-based webcams
+Group: System Environment/Kernel
+Provides: %{name} = %{version}-%{release}, kernel-module
+Requires(post): modutils
+Requires(postun): modutils
+Requires: /boot/vmlinuz-%{kernel}
+
+%description %{kernel}
+This package contains a kernel module for the Philips USB webcams.
+
+
+%prep
+%setup -q -n pwcx-9.0-beta-2
+%patch -p2
+
+
+%build
+sh autogen.sh || :
+%if %{post26}
+%configure \
+    --with-linuxdir=&quot;%{develdir}&quot;
+%else
+%configure \
+    --with-rpm-target=&quot;%{_target_cpu}&quot; \
+    --with-kernel-release=&quot;%{kernel}&quot; \
+    --with-linuxdir=&quot;/usr/src/linux-%{krel}&quot;
+%endif
+%{__make} %{?_smp_mflags}
+
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}%{?updates}&quot;
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%post %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+%postun %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+
+%files %{kernel}
+%defattr(-, root, root, 0755)
+/lib/modules/%{kernel}%{?updates}/kernel/drivers/usb/media/pwc.*o
+/lib/modules/%{kernel}%{?updates}/kernel/drivers/usb/media/pwcx.*o
+
+
+%changelog
+* Thu Jun 17 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 9.0-0.beta2
+- Takeover the spec.
+
+* Tue Jun 15 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 9.0-0.0.beta.2.fdr.3: move to updates since a recent FC2 update kernel
+  reinstated pwc.ko
+
+* Fri Jun 04 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 9.0-0.0.beta.2.fdr.2: now works for 2.4 and 2.6
+
+* Mon May 24 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 9.0-0.0.beta.2.fdr.1: initial package


Property changes on: trunk/rpms/kernel-module-pwcx/kernel-module-pwcx.spec
___________________________________________________________________
Name: svn:keywords
   + Id HeadURL

Added: trunk/rpms/kernel-module-pwcx/pwcx.autotools.patch
===================================================================
--- trunk/rpms/kernel-module-pwcx/pwcx.autotools.patch	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-pwcx/pwcx.autotools.patch	2004-06-18 10:14:33 UTC (rev 1371)
@@ -0,0 +1,1006 @@
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/autogen.sh
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/autogen.sh	2004-05-24 11:06:07.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/autogen.sh	2004-05-24 11:07:20.000000000 +0200
+@@ -0,0 +1,6 @@
++#!/bin/bash
++set -x
++aclocal -I m4 || exit 1
++autoconf || exit 1
++automake -a --foreign || exit 1
++./configure $@
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/configure.ac
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/configure.ac	2004-05-24 11:06:10.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/configure.ac	2004-06-04 16:55:28.140963744 +0200
+@@ -0,0 +1,33 @@
++AC_INIT(2.6.4/pwc.h)
++
++AM_INIT_AUTOMAKE(pwc, 9.0-beta-2)
++
++dnl pick up ACLOCAL flags
++ACLOCAL_AMFLAGS=&quot;\${ACLOCAL_FLAGS} -I m4&quot;
++AC_SUBST(ACLOCAL_AMFLAGS)
++
++dnl do all checks
++AS_LINUX
++
++dnl generate modtool
++AS_LINUX_MODTOOL
++
++dnl to do proper versioning, we need to know if we have pre-2.4 style
++dnl kernel or post-2.6
++AC_MSG_CHECKING([for kernel style])
++case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++  2.[[67]])
++    AC_MSG_RESULT([post-2.6])
++    POST_2_6=yes
++    ;;
++  2.[[01234]])
++    AC_MSG_RESULT([pre-2.6])
++    POST_2_6=no
++    ;;
++  *)
++    AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++    ;;
++esac
++AM_CONDITIONAL(POST_2_6, [test &quot;$POST_2_6&quot; = &quot;yes&quot;])
++
++AC_OUTPUT(Makefile 2.6.4/Makefile 2.4.25/Makefile pwcx/Makefile)
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/Makefile.am
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/Makefile.am	2004-05-24 11:06:13.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/Makefile.am	2004-06-04 16:54:36.149867592 +0200
+@@ -0,0 +1,17 @@
++if POST_2_6
++2_4_DIR =
++2_6_DIR = 2.6.4
++else
++2_4_DIR = 2.4.25
++2_6_DIR =
++endif
++
++SUBDIRS = $(2_4_DIR) $(2_6_DIR) pwcx
++
++EXTRA_DIST = \
++  m4/as-linux.m4 \
++  m4/as-modtool.m4
++
++DISTCHECK_CONFIGURE_FLAGS = --with-modulesdir=`mktemp -d`
++
++DISTCLEANFILES = modtool
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/m4/as-linux.m4
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/m4/as-linux.m4	2004-05-24 11:06:26.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/m4/as-linux.m4	2004-06-04 16:39:09.510738152 +0200
+@@ -0,0 +1,704 @@
++dnl as-linux.m4 0.2.1
++
++dnl autostars m4 macro for detecting a Linux source tree (or
++dnl equivalent) for compiling modules.
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-linux.m4,v 1.18 2004/06/03 16:35:58 thomasvs Exp $
++
++dnl AS_LINUX()
++dnl
++dnl this macro adds the options
++dnl --with-linuxdir        to specify a kernel build tree location
++dnl --with-linuxconfig     to specify a kernel .config file
++dnl --with-kernel-release  to specify an alternative uname -r
++dnl --with-machine         to specify an alternative uname -m
++dnl --with-rpm-target      to specify to match the given rpm --target option
++dnl --with-extraversion    to specify an EXTRAVERSION override
++dnl --with-modulesdir      to specify the base install location of modules
++dnl --with-modulesdeveldir to specify the base install location of build stuff
++
++dnl this macro defines:
++dnl LINUX_DIR
++dnl   The directory where the Linux source resides.
++dnl CONFIG_FILE
++dnl   The Linux config file
++dnl LINUX_ARCH
++dnl   $(ARCH) in kernel Makefiles
++dnl LINUX_AFLAGS
++dnl   $(AFLAGS) in kernel Makefiles
++dnl LINUX_LDFLAGS
++dnl   Linker flags used by Linux
++dnl LINUX_ARFLAGS
++dnl   Archiver flags used by Linux
++dnl LINUX_CROSS_COMPILE
++dnl   Cross-compiler prefix, if any. (example: &quot;powerpc-linux-&quot;)
++dnl LINUX_KERNELRELEASE
++dnl   Kernel release name (2.4.5-pre4-ac5-rmk), $(KERNELRELEASE) in
++dnl   Linux Makefiles.
++dnl LINUX_CFLAGS
++dnl   CFLAGS used by Linux.  Includes both $CFLAGS and $MODFLAGS from
++dnl   kernel Makefiles. Also includes warnings and optimization.
++dnl LINUX_CC
++dnl   Compiler used by Linux.
++dnl LINUX_LD
++dnl   Path to linker (possibly with options) used by Linux.
++dnl LINUX_AS
++dnl   Assembler used by Linux.
++dnl LINUX_MODULE_EXT
++dnl   Module extension (.o or .ko)
++dnl LINUX_MODPOST
++dnl   path to modpost script
++dnl LINUX_SMP
++dnl   set to yes if the kernel is SMP
++dnl modulesdir
++dnl   base install path for kernel modules
++dnl modulesdeveldir
++dnl   base install path for kernel module development files
++dnl 
++dnl End of search list.
++
++dnl main entry point
++dnl checks the version, and figures out all flags to use to make modules.
++AC_DEFUN([AS_LINUX],
++[
++	dnl check if user supplied a uname -r, and if not use the running one
++	AS_LINUX_KERNEL_RELEASE()
++	dnl check if user supplied a uname -m, and if not use the running one
++	AS_LINUX_MACHINE() 	 
++	dnl check if the user supplied an rpm target arch
++	dnl override the LINUX_MACHINE value if he did
++	AS_LINUX_RPM_TARGET($LINUX_KERNEL_RELEASE) 	 
++  	 
++	dnl find the kernel source tree for the given uname -r 	 
++	AS_LINUX_DIR($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied an EXTRAVERSION, and if not get from uname -r
++	AS_LINUX_EXTRAVERSION($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied a config file; if not, guess a good one
++	AS_LINUX_CONFIG($LINUX_DIR, $LINUX_KERNEL_RELEASE, $LINUX_MACHINE) 	 
++	dnl check if we're building on pre-FC2 Red Hat/Fedora,
++	dnl and add some flags if we are 	 
++	AS_CHECK_REDHAT_PRE_FC2() 	 
++	dnl check if we're building SMP, and set LINUX_SMP if we are
++	AS_CHECK_SMP()
++	dnl check for where to install modules
++	AS_LINUX_MODULESDIR($LINUX_KERNEL_RELEASE)
++	dnl check for where to install module development files
++	AS_LINUX_MODULESDEVELDIR($LINUX_DIR)
++	dnl check for the MAJOR/MINOR version of Linux 	 
++	AS_LINUX_VERSION_MAJOR_MINOR($LINUX_DIR)
++
++	dnl now call the correct macro to get compiler flags
++	dnl the versioned AS_LINUX macros just use the global variables
++	dnl this could be cleaned up later on if we feel like it
++	case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++		2.6)
++			AS_LINUX_2_6()
++			;;
++		2.[[01234]])
++			AS_LINUX_2_4()
++			;;
++		*)
++			AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++			;;
++	esac
++])
++
++
++dnl check if we can find a source dir for the Linux kernel
++dnl defines LINUX_DIR to the absolute location of a usable kernel source tree
++AC_DEFUN([AS_LINUX_DIR],
++[
++	AC_ARG_WITH([linuxdir],
++		[AC_HELP_STRING([--with-linuxdir=DIR],
++			[specify path to Linux source directory])],
++		[LINUX_DIR=&quot;${withval}&quot;],
++		[LINUX_DIR=default])
++
++	if test &quot;${LINUX_DIR}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_DIR([${LINUX_DIR}], , AC_MSG_ERROR([Linux dir not found]) )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/lib/modules/`uname -r`/build&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;../linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/usr/src/linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([Linux source directory not found])
++	fi
++
++	AC_SUBST(LINUX_DIR)
++])
++
++dnl check if the given candidate path for a linux source tree is usable
++AC_DEFUN([AS_TRY_LINUX_DIR],
++	[AC_MSG_CHECKING(for Linux in $1)
++
++	if test -f &quot;$1/Makefile&quot; ; then
++		result=yes
++		$2
++	else
++		result=&quot;not found&quot;
++		$3
++	fi
++
++	AC_MSG_RESULT($result)
++])
++
++dnl allow for specifying a kernel release (uname -r) to build for
++dnl use uname -r of running one if not specified
++dnl store result in LINUX_KERNEL_RELEASE
++AC_DEFUN([AS_LINUX_KERNEL_RELEASE],
++[
++	AC_ARG_WITH([kernel-release],
++		[AC_HELP_STRING([--with-kernel-release=RELEASE],
++			[specify the &quot;uname -r&quot;-value to build for])],
++		[LINUX_KERNEL_RELEASE=&quot;${withval}&quot;],
++		[LINUX_KERNEL_RELEASE=`uname -r`])
++        if test &quot;x$LINUX_KERNEL_RELEASE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_KERNEL_RELEASE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_KERNEL_RELEASE as the uname -r value])
++])
++
++dnl allow for specifying a machine (uname -m) to build for
++dnl use uname -, of running one if not specified
++dnl store result in LINUX_MACHINE
++AC_DEFUN([AS_LINUX_MACHINE],
++[
++	AC_ARG_WITH([machine],
++		[AC_HELP_STRING([--with-machine=MACHINE],
++			[specify the &quot;uname -m&quot;-value to build for])],
++		[LINUX_MACHINE=&quot;${withval}&quot;],
++		[LINUX_MACHINE=`uname -m`])
++        if test &quot;x$LINUX_MACHINE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_MACHINE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_MACHINE as the uname -m value])
++])
++dnl allow for specifying an rpm target arch
++dnl if none specified, try to guess one from running rpm querying for
++dnl the kernel with the uname -r
++dnl this is so configure without arguments works out of the box
++dnl FIXME: investigate if uname -p is a correct guess for this, and if
++dnl we should have a flag for specifying it instead
++
++dnl this macro possibly overrides LINUX_MACHINE
++
++dnl first argument is the kernel release building for
++AC_DEFUN([AS_LINUX_RPM_TARGET],
++[
++	RELEASE=$1
++	AC_ARG_WITH([rpm-target],
++		[AC_HELP_STRING([--with-rpm-target=TARGET],
++			[specify the target arch to build for])],
++		[LINUX_RPM_TARGET=&quot;${withval}&quot;],
++		[LINUX_RPM_TARGET=])
++	if test &quot;x$LINUX_RPM_TARGET&quot; = &quot;x&quot;
++	then
++		dnl if we have rpm, try to guess the target of the kernel
++		dnl we want to build for using rpm
++		AC_PATH_PROG(RPM, rpm, yes, no)
++		if test &quot;x$RPM&quot; = &quot;xyes&quot;
++		then
++			if rpm -q kernel-$RELEASE &gt; /dev/null
++			then
++				LINUX_RPM_TARGET=`rpm -q --queryformat %{arch} kernel-$RELEASE`
++			else
++				AC_MSG_NOTICE([Cannot guess target arch, consider setting it using --with-rpm-target])
++			fi
++		fi
++	fi
++
++	dnl now override LINUX_MACHINE if LINUX_RPM_TARGET is set
++	if test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;
++	then
++		dnl override LINUX_MACHINE based on this
++		dnl FIXME: add other possible Red Hat/Fedora/rpm targets here
++		LINUX_MACHINE=
++		case &quot;$LINUX_RPM_TARGET&quot; in
++			i?86) LINUX_MACHINE=i386;;
++			athlon) LINUX_MACHINE=i386;;
++			x86_64) LINUX_MACHINE=x86_64;;
++		esac
++		if test &quot;x$LINUX_MACHINE&quot; = &quot;x&quot;
++		then
++		AC_MSG_ERROR(Could not guess uname -m value from target $LINUX_RPM_TARGET)
++		fi
++	fi
++])
++
++
++dnl allow for specifying an override for EXTRAVERSION
++dnl if none specified, make it from the passed-in KERNEL_RELEASE (uname -r)
++dnl resulting value is stored in LINUX_EXTRAVERSION
++dnl first argument is the uname -r string to use as a fallback
++AC_DEFUN([AS_LINUX_EXTRAVERSION],
++[
++	KERNEL_RELEASE=[$1]
++	dnl extract the default by getting everything after first -
++	LINUX_EXTRAVERSION=&quot;-`echo $KERNEL_RELEASE | cut -d- -f 2-`&quot;
++	AC_ARG_WITH([extraversion],
++		[AC_HELP_STRING([--with-extraversion=FILE],
++			[specify override for kernel EXTRAVERSION])],
++		[LINUX_EXTRAVERSION=&quot;${withval}&quot;],)
++])
++
++
++dnl check if we can find a config file for the Linux kernel
++dnl defines LINUX_CONFIG to the absolute location of a usable
++dnl kernel source config file
++
++dnl for rpm distros, it can try and guess the correct config file by
++dnl checking the global LINUX_RPM_TARGET variable set somewhere else
++dnl (FIXME: move this to an argument instead ?)
++
++dnl first argument is LINUX_DIR to check for possible configs
++dnl second argument is kernel-release (uname -r)
++dnl third argument is machine (uname -m)
++
++AC_DEFUN([AS_LINUX_CONFIG],
++[
++	LINUX_DIR=[$1]
++	KERNEL_RELEASE=[$2]
++	MACHINE=[$3]
++	AC_ARG_WITH([linuxconfig],
++		[AC_HELP_STRING([--with-linuxconfig=FILE],
++			[specify path to Linux configuration file])],
++		[LINUX_CONFIG=&quot;${withval}&quot;],
++		[LINUX_CONFIG=default])
++
++	dnl if a file got specified, try it as a linux config file
++	if test &quot;${LINUX_CONFIG}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_CONFIG($LINUX_CONFIG, $MACHINE,
++                                    ,, AC_MSG_ERROR([Linux config not found]) )
++	fi
++
++        dnl if no file specified, first check for the regular .config file
++        dnl in LINUX_DIR created by manual configuration
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		file=&quot;$LINUX_DIR/.config&quot;;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++        dnl second, try to guess what config file to use for the current kernel
++	dnl FIXME: the possible arch is from rpmbuild --target, and is
++	dnl different from the value of ARCH (Makefile) or MACHINE (uname -m)
++	dnl so we should have a redhat flag to specify the target to find
++	dnl the correct config file
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; &amp;&amp; test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;; then
++		dnl Red Hat stores configuration files for their built kernels
++		dnl named kernel-(version)-(arch)(extra).config
++		dnl where arch is athlon, i386, i586, i686, x86_64
++		dnl and (extra) is empty or -smp, -BOOT, -bigmem
++		dnl haven't seen combinations of extra yet as of FC1
++		KVERSION=`echo $KERNEL_RELEASE | cut -d- -f1`
++		extra=
++		echo $KERNEL_RELEASE | grep smp &amp;&amp; EXTRA=&quot;-smp&quot;
++		echo $KERNEL_RELEASE | grep bigmem &amp;&amp; EXTRA=&quot;-bigmem&quot;
++		echo $KERNEL_RELEASE | grep BOOT &amp;&amp; EXTRA=&quot;-BOOT&quot;
++		file=&quot;$LINUX_DIR/configs/kernel-$KVERSION-$LINUX_RPM_TARGET$EXTRA.config&quot;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([
++The kernel source tree at ${LINUX_DIR} is not configured,
++and no configuration files in config/ matching your kernel were found.
++Fix before continuing or specify a config file using --with-configfile.])
++	fi
++
++	AC_SUBST(LINUX_CONFIG)
++])
++
++dnl check if the given candidate config file is usable
++dnl FIXME: it would be nice if it could check if it matches the
++dnl given machine (uname -m)
++AC_DEFUN([AS_TRY_LINUX_CONFIG],
++[
++	CFG=[$1]
++	MACHINE=[$2]
++	AC_MSG_CHECKING($CFG)
++
++	if test -f &quot;$CFG&quot; ; then
++		result=yes
++		ifelse([$3], , :, [$3])
++	else
++		result=&quot;not found&quot;
++		ifelse([$4], , :, [$4])
++	fi
++	AC_MSG_RESULT($result)
++])
++
++dnl check if RED_HAT_LINUX_KERNEL is defined
++dnl pre-FC2 RH/Fedora defines this in linux/rhconfig.h
++dnl included from linux/version.h
++dnl if this is present, a few extra defines need to be present to make sure
++dnl symbol versioning is correct
++dnl uses LINUX_DIR to find rhconfig.h
++AC_DEFUN([AS_CHECK_REDHAT_PRE_FC2],
++[
++	AC_MSG_CHECKING(Pre-FC2 Red Hat/Fedora kernel)
++        HAVE_REDHAT_KERNEL=false
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux&quot;
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++#define __BOOT_KERNEL_H_
++#include &quot;rhconfig.h&quot;
++int code = RED_HAT_LINUX_KERNEL;
++	]),
++        AC_MSG_RESULT(found); HAVE_REDHAT_KERNEL=true,
++        AC_MSG_RESULT(not found))
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++
++	dnl check for Red Hat define flags to use - see /sbin/mkkerneldoth
++
++	dnl initialize the booleans we want to detect
++	ENTERPRISE='0'
++	SMP='0'
++	UP='0'
++	BIGMEM='0'
++	HUGEMEM='0'
++
++	dnl get variables from the currently running kernel as default 
++	KERNEL_TYPE=`uname -r | sed 's_^.*\(smp\|enterprise\|bigmem\|hugemem\)$_\1_;t;s_.*__;'`
++	KERNEL_RELEASE=`uname -r | sed 's|smp\|enterprise\|bigmem\|hugemem||g'`
++	KERNEL_ARCH=`uname -m`
++
++	dnl check the config file and override KERNEL_ARCH
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M386, KERNEL_ARCH=i386)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M586, KERNEL_ARCH=i586)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M686, KERNEL_ARCH=i686)
++	dnl for some reason the i686 bigmem config file has PENTIUM
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MPENTIUMIII, KERNEL_ARCH=i686)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MK7, KERNEL_ARCH=athlon)
++
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, KERNEL_TYPE=smp)
++	dnl bigmem is also smp, so this check is done after smp to override
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_HIGHMEM64G, KERNEL_TYPE=bigmem)
++
++	dnl FIXME: need to check hugemem and enterprise config files, which
++	dnl aren't provided in Fedora Core 1 !
++
++	case &quot;$KERNEL_TYPE&quot; in
++		smp) SMP='1';;
++		enterprise) ENTERPRISE='1';;
++		bigmem) BIGMEM='1';;
++		hugemem) HUGEMEM='1';;
++		*) UP='1';;
++	esac
++	REDHAT_CFLAGS=&quot;-D__BOOT_KERNEL_H_ -D__MODULE_KERNEL_$KERNEL_ARCH=1&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_ENTERPRISE=$ENTERPRISE&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_UP=$UP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_SMP=$SMP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_BIGMEM=$BIGMEM&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_HUGEMEM=$HUGEMEM&quot;
++
++	LINUX_REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS&quot;
++
++	AC_SUBST(LINUX_KERNEL_TYPE, &quot;$KERNEL_TYPE&quot;)
++])
++
++dnl check if we're building on SMP
++dnl set LINUX_SMP to yes if we are
++AC_DEFUN([AS_CHECK_SMP],
++[
++	LINUX_SMP=&quot;no&quot;
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, LINUX_SMP=&quot;yes&quot;)
++	AC_SUBST(LINUX_SMP)
++])
++
++dnl add an argument to specify/override the module install path
++dnl if nothing specified, it will be /lib/modules/(kernelrel)
++AC_DEFUN([AS_LINUX_MODULESDIR],
++[
++	KERNEL_RELEASE=[$1]
++	AC_ARG_WITH([modulesdir],
++		[AC_HELP_STRING([--with-modulesdir=DIR],
++			[specify path to kernel-specific modules install directory])],
++		[MODULESDIR=&quot;${withval}&quot;],
++		[MODULESDIR=default])
++
++	if test &quot;${MODULESDIR}&quot; = &quot;default&quot; ; then
++		MODULESDIR=&quot;/lib/modules/${KERNEL_RELEASE}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdir, $MODULESDIR)
++	AC_MSG_NOTICE([Putting kernel modules under ${MODULESDIR}])
++])
++
++dnl add an argument to specify/override the module devel install path
++dnl if nothing specified, it will be the passed in LINUXDIR)
++AC_DEFUN([AS_LINUX_MODULESDEVELDIR],
++[
++	LINUXDIR=[$1]
++	AC_ARG_WITH([modulesdeveldir],
++		[AC_HELP_STRING([--with-modulesdeveldir=DIR],
++			[specify path to kernel-specific module development install directory])],
++		[MODULESDEVELDIR=&quot;${withval}&quot;],
++		[MODULESDEVELDIR=default])
++
++	if test &quot;${MODULESDEVELDIR}&quot; = &quot;default&quot; ; then
++		MODULESDEVELDIR=&quot;${LINUXDIR}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdeveldir, $MODULESDEVELDIR)
++	AC_MSG_NOTICE([Putting kernel module development files under ${MODULESDEVELDIR}])
++])
++
++AC_DEFUN([AS_LINUX_2_6],
++[
++	AC_MSG_CHECKING(for Linux CFLAGS)
++
++	{
++	  tmpdir=`(umask 077 &amp;&amp; mktemp -d -q &quot;./confstatXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
++	  test -n &quot;$tmpdir&quot; &amp;&amp; test -d &quot;$tmpdir&quot;
++	} ||
++	{
++	  tmpdir=./confstat$$-$RANDOM
++	  (umask 077 &amp;&amp; mkdir $tmpdir)
++	} ||
++	{
++	  echo &quot;$me: cannot create a temporary directory in .&quot; &gt;&amp;2
++	  { (exit 1); exit 1; }
++	}
++
++	tmpdir=`pwd`/$tmpdir
++
++	cat &gt;${tmpdir}/Makefile &lt;&lt;EOF
++obj-m += fake.o
++
++\$(obj)/fake.c: flags
++	touch \$(obj)/fake.c
++
++.PHONY: flags
++flags:
++	echo LINUX_ARCH=\&quot;\$(ARCH)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's,include,&quot;\$(LINUXDIR)/include&quot;,g'&gt;&gt;\$(obj)/flags
++	echo LINUX_LDFLAGS=\&quot;\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS=\&quot;\$(CFLAGS) \$(CPPFLAGS)\&quot; | sed 's,Iinclude,I\$(LINUXDIR)/include,g' &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS_MODULE=\&quot;\$(CFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CC=\&quot;\$(CC)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS) \$(LDFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AS=\&quot;\$(AS)\&quot; &gt;&gt;\$(obj)/flags
++EOF
++
++	echo ${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	. ${tmpdir}/flags
++	rm -rf ${tmpdir}
++
++	LINUX_MODULE_EXT=&quot;.ko&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_CFLAGS_MODULE&quot;
++	LINUX_MODPOST=&quot;$LINUX_DIR/scripts/modpost&quot;
++
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++	AC_SUBST(LINUX_MODPOST)
++
++	AC_MSG_RESULT([$LINUX_CFLAGS])
++])
++
++dnl checks kernel's Makefile for make variables for Linux 2.4
++dnl adds LINUX_REDHAT_CFLAGS if non-empty
++AC_DEFUN([AS_LINUX_2_4],
++[
++	AC_MSG_CHECKING(for Linux 2.4 make flags)
++	dnl we try to figure out the CFLAGS by invoking the Makefile on
++        dnl a test dir
++        dnl we use the correct config file by substituting the MAKEFILES
++        dnl Makefile variable, which originally points to .config
++
++	if [[ ! -e &quot;${LINUX_DIR}/.hdepend&quot; ]];then
++		AC_MSG_ERROR([
++You need to run 'make dep' on the kernel source before continuing.])
++	fi
++
++        if test &quot;x$LINUX_EXTRAVERSION&quot; == &quot;x&quot;; then
++          EX=
++        else
++          EX=&quot;EXTRAVERSION=$LINUX_EXTRAVERSION&quot;
++        fi
++
++        POPDIR=`(pwd)`
++        cd ${LINUX_DIR}
++        TMPFILE=`mktemp /tmp/linux.XXXXXXXX` || exit 1
++	# combine the kernel's Makefile,
++	# sedded to use our proposed config file,
++	# sedded to use our proposed machine value,
++	# with the extra target we add here, to get cflags
++	# we do not want entering/leaving info on distcheck so we run with -s
++	( cat Makefile | sed &quot;s|\.config|${LINUX_CONFIG}|g&quot; | sed &quot;s|shell uname -m|shell echo ${LINUX_MACHINE}|g&quot; &amp;&amp; cat &lt;&lt;EOF ) | make -s -f - get_cflags $EX &gt; ${TMPFILE}
++get_cflags:
++	@echo LINUX_ARCH=\&quot;\$(ARCH)\&quot;
++	@echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_LDFLAGS=\&quot;\&quot;
++	@echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot;
++	@echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot;
++	@echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot;
++	@echo LINUX_CFLAGS=\&quot;\$(CFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_MODFLAGS=\&quot;\$(MODFLAGS)\&quot;
++	@echo LINUX_CC=\&quot;\$(CC)\&quot;
++	@echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS)\&quot;
++	@echo LINUX_AS=\&quot;\$(AS)\&quot;
++EOF
++        . ${TMPFILE}
++        rm -rf ${TMPFILE}
++        cd $POPDIR
++
++        LINUX_MODULE_EXT=&quot;.o&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_MODFLAGS&quot;
++
++	dnl if we have REDHAT_CFLAGS, put them in LINUX_CFLAGS
++	if test &quot;x$REDHAT_CFLAGS&quot; != &quot;x&quot;;
++	then
++		LINUX_CFLAGS=&quot;$LINUX_CFLAGS $REDHAT_CFLAGS&quot;
++	fi
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++
++	AC_MSG_RESULT([ok])
++
++	AC_MSG_CHECKING(for Linux 2.4 CFLAGS)
++	AC_MSG_RESULT($LINUX_CFLAGS)
++	AC_MSG_CHECKING(for Linux 2.4 LDFLAGS)
++	AC_MSG_RESULT($LINUX_LDFLAGS)
++])
++
++AC_DEFUN([AS_CHECK_LINUX_CONFIG_OPTION],
++[
++	AC_MSG_CHECKING([Linux config option $1])
++
++	if grep '^$1=y$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=yes
++		$2
++	else if grep '^$1=m$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=module
++		$3
++	else
++		result=no
++		$4
++	fi
++	fi
++
++	AC_MSG_RESULT([$result])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION_MODULE],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes -o &quot;${$1}&quot; = module])
++])
++
++dnl check for the major/minor version of the Linux source by checking
++dnl the headers
++dnl first argument is the linux directory
++dnl sets LINUX_VERSION_MAJOR and LINUX_VERSION_MINOR
++AC_DEFUN([AS_LINUX_VERSION_MAJOR_MINOR],
++[
++	LINUX_DIR=[$1]
++	AC_MSG_CHECKING([Linux major/minor version])
++
++	if [[ ! -f &quot;${LINUX_DIR}/include/linux/version.h&quot; ]];then
++		AC_MSG_ERROR([The header file include/linux/version.h does not exist.
++For 2.6 kernels, it can be generated by running 'make prepare' in
++the kernel source directory.])
++	fi
++        dnl the next set of tests is for figuring out version major/minor
++        dnl we make sure we have the right version.h by faking out CFLAGS
++	dnl since we want to avoid including linux/version.h and acidentally
++	dnl pick up /usr/include/linux
++	dnl we still add ${LINUX_DIR}/include so the Red Hat version can pick
++	dnl up linux/rhversion.h
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux -I${LINUX_DIR}/include&quot;
++        dnl make sure we find version.h and it contains LINUX_VERSION_CODE
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++int code = LINUX_VERSION_CODE;
++]),
++ :, AC_MSG_ERROR([${LINUX_DIR}/include/linux/version.h does not contain LINUX_VERSION_CODE]))
++
++
++        dnl figure out the linux kernel version major and minor
++        dnl using the LINUX_VERSION_CODE defined in include/linux/version.h
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MAJOR(code) ((code) &gt;&gt; 16)
++],[
++  return KERNEL_VERSION_MAJOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MAJOR=0, 
++		LINUX_VERSION_MAJOR=$?)
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MINOR(code) (((code) &gt;&gt; 8) % (2 &lt;&lt; 8))
++],[
++  return KERNEL_VERSION_MINOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MINOR=0, 
++		LINUX_VERSION_MINOR=$?)
++        AC_MSG_RESULT($LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR)
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++])
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/m4/as-modtool.m4
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/m4/as-modtool.m4	2004-05-24 11:06:29.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/m4/as-modtool.m4	2004-06-04 16:39:11.236475800 +0200
+@@ -0,0 +1,147 @@
++dnl as-modtool.m4 0.0.1
++dnl autostars m4 macro for building modtool, a linker for Linux kernel
++dnl modules
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-modtool.m4,v 1.12 2004/06/03 15:20:11 thomasvs Exp $
++
++dnl AS_LINUX_MODTOOL()
++dnl
++dnl this macro defines:
++dnl moduledir
++dnl modulePROGRAMS_INSTALL
++dnl modulePROGRAMS_UNINSTALL
++dnl
++dnl End of search list.
++
++dnl
++dnl FIXME:
++dnl  How do you specify that the building of modtool should go to the
++dnl  end of the configure script?
++dnl
++
++dnl SYMVERS_INCLUDES can be used to add additional .symvers files to the
++dnl modpost step
++
++AC_DEFUN([AS_LINUX_MODTOOL],
++[
++	AC_PATH_PROG(STRIP, strip)
++	AC_PATH_PROG([DEPMOD], [depmod], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++	AC_PATH_PROG([GENKSYMS], [genksyms], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++
++	if test &quot;x$LINUX_SMP&quot; = &quot;xyes&quot;
++	then
++		GENKSYMS=&quot;$GENKSYMS -p smp_&quot;
++	fi
++	dnl this can be overridden in Makefile.am
++	dnl FIXME: it'd be nice if we could specify different target_PROGRAMS
++	dnl and different targetdir
++	moduledir=&quot;\$(modulesdir)/\$(PACKAGE)&quot;
++	modulePROGRAMS_INSTALL=&quot;\$(top_builddir)/modtool --install&quot;
++	modulePROGRAMS_UNINSTALL=&quot;\$(top_builddir)/modtool --uninstall&quot;
++	AC_SUBST(moduledir)
++	AC_SUBST(modulePROGRAMS_INSTALL)
++
++	LINUX_VERSION=`echo $LINUX_KERNELRELEASE | cut -d- -f1`
++
++	AC_MSG_NOTICE(creating modtool)
++	cat &gt;modtool &lt;&lt;EOF
++#!/bin/sh
++
++set -e
++
++LINUX_LD=&quot;$LINUX_LD&quot;
++LINUX_MODPOST=&quot;$LINUX_MODPOST&quot;
++LINUX_VERSION=&quot;$LINUX_VERSION&quot;
++GENKSYMS=&quot;$GENKSYMS&quot;
++CC=&quot;$LINUX_CC&quot;
++INSTALL=&quot;$INSTALL&quot;
++LINUX_MODULE_EXT=&quot;$LINUX_MODULE_EXT&quot;
++STRIP=&quot;$STRIP&quot;
++CFLAGS=&quot;$CFLAGS $LINUX_CFLAGS&quot;
++LINUX_DIR=&quot;$LINUX_DIR&quot;
++
++mode=\$[1]
++shift
++
++case \$mode in
++--link)
++	# we accept -i (symvers) and -o (target) as options
++	# at least -o (target) needs to be specified
++	SYMVERS_INCLUDES=&quot;&quot;
++	done=false
++	while test ! -z &quot;\$[0]&quot; -a &quot;\$done&quot; = &quot;false&quot;
++	do
++		case \$[1] in
++		-i)
++                        SYMVERS_INCLUDES=&quot;\$SYMVERS_INCLUDES \$[2]&quot;
++                        shift 2
++                        ;;
++                -o)
++                        target=\$(echo \$[2] | sed s/.ko$//)
++                        shift 2
++                        ;;
++                *)
++                        done=true
++                        ;;
++                esac
++        done
++
++	mkdir -p .mods
++	if test &quot;\$LINUX_MODULE_EXT&quot; = .ko ; then
++
++		\$LINUX_LD -r -o .mods/\$target.o \$[*]
++
++		cat \$LINUX_DIR/Module.symvers \$SYMVERS_INCLUDES &gt;.mods/symvers.tmp
++
++		\$LINUX_MODPOST -o .mods/\$target.o.symvers.tmp -i .mods/symvers.tmp .mods/\$target.o
++
++		grep .mods/\$target .mods/\$target.o.symvers.tmp &gt;.mods/\$target.o.symvers || true
++
++		rm -f .mods/\$target.o.symvers.tmp .mods/symvers.tmp
++		
++		\$CC \$CFLAGS -DKBUILD_MODNAME=\$target -c -o .mods/\$target.mod.o .mods/\$target.mod.c
++
++		\$LINUX_LD -r -o \$target.ko .mods/\$target.mod.o .mods/\$target.o
++		set +x
++	else
++		echo \$LINUX_LD -r -o \$target.ko \$[*]
++		\$LINUX_LD -r -o \$target.ko \$[*]
++                                                                      
++		if test &quot;x\$SOURCES&quot; != &quot;x&quot;
++		then
++			echo &quot;\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver&quot;
++			\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver
++		fi
++
++	fi
++
++	;;
++--install)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo \$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$STRIP -g &quot;\$module_dest&quot;
++	;;
++--uninstall)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo uninstall &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	rm -f &quot;\$module_dest&quot;
++	;;
++*)
++	echo Unknown mode \$mode &gt;&amp;2
++	exit 1
++esac
++
++EOF
++	chmod +x modtool
++
++
++])
++
++
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/2.6.4/Makefile.am
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/2.6.4/Makefile.am	2004-05-24 11:08:17.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/2.6.4/Makefile.am	2004-05-24 11:19:15.000000000 +0200
+@@ -0,0 +1,20 @@
++moduledir = $(modulesdir)/kernel/drivers/usb/media
++module_PROGRAMS = pwc.ko
++                                                                                
++pwc_ko_SOURCES = \
++        pwc-if.c pwc-misc.c pwc-ctrl.c pwc-uncompress.c
++pwc_ko_CFLAGS = $(LINUX_CFLAGS)
++pwc_ko_LINK = $(top_builddir)/modtool --link -o $@
++
++noinst_HEADERS = \
++	pwc.h \
++	pwc-ioctl.h \
++	pwc_kiara.h \
++	pwc_nala.h \
++	pwc_timon.h \
++	pwc-uncompress.h
++
++distclean-local:
++	-rm -rf .mods
++
++EXTRA_DIST = ChangeLog philips.txt
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/pwcx/Makefile.am
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/pwcx/Makefile.am	2004-05-24 11:17:28.000000000 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/pwcx/Makefile.am	2004-06-04 17:16:25.895755952 +0200
+@@ -0,0 +1,25 @@
++moduledir = $(modulesdir)/kernel/drivers/usb/media
++module_PROGRAMS = pwcx.ko
++                                                                                
++if POST_2_6
++inc = -I$(top_srcdir)/2.6.4
++SYMVERSFLAGS = -i $(top_builddir)/2.6.4/.mods/pwc.o.symvers
++VERCFLAGS =
++else
++inc = -I$(top_srcdir)/2.4.25
++SYMVERSFLAGS =
++VERCFLAGS = -include $(top_builddir)/2.4.25/.mods/pwc.ver
++endif
++
++pwcx_ko_SOURCES = pwcx-glue.c
++pwcx_ko_CFLAGS = $(LINUX_CFLAGS) $(inc) $(VERCFLAGS) -DCONFIG_USB_PWCX_MODULE
++# LDFLAGS is not the one to use, because the .a has to be *at the end*
++# of the compile line
++pwcx_ko_LDADD =  $(top_srcdir)/x86/libpwcx.a
++
++pwcx_ko_LINK = $(top_builddir)/modtool --link $(SYMVERSFLAGS) -o $@
++
++noinst_HEADERS = pwcx.h
++
++distclean-local:
++	-rm -rf .mods
+Index: kernel-module-pwcx/pwcx-9.0-beta-2/2.4.25/Makefile.am
+--- kernel-module-pwcx~autotools.9.0-beta-2/pwcx-9.0-beta-2/2.4.25/Makefile.am	2004-06-04 16:51:15.694341464 +0200
++++ kernel-module-pwcx/pwcx-9.0-beta-2/2.4.25/Makefile.am	2004-06-04 17:12:25.145355576 +0200
+@@ -0,0 +1,22 @@
++moduledir = $(modulesdir)/kernel/drivers/usb/media
++module_PROGRAMS = pwc.ko
++                                                                                
++pwc_ko_SOURCES = \
++        pwc-if.c pwc-misc.c pwc-ctrl.c pwc-uncompress.c
++# -DEXPORT_SYMTAB is for pwc-uncompress.c which uses EXPORT_SYMBOL*
++pwc_ko_CFLAGS = $(LINUX_CFLAGS) -DEXPORT_SYMTAB
++# the SOURCES= makes sure we get a pwc.ver file
++pwc_ko_LINK = SOURCES=pwc-uncompress.c $(top_builddir)/modtool --link -o $@
++
++noinst_HEADERS = \
++	pwc.h \
++	pwc-ioctl.h \
++	pwc_kiara.h \
++	pwc_nala.h \
++	pwc_timon.h \
++	pwc-uncompress.h
++
++distclean-local:
++	-rm -rf .mods
++
++EXTRA_DIST = ChangeLog philips.txt

Copied: trunk/rpms/kernel-module-qc-usb/dag-kernel-module-qc-usb.spec (from rev 1357, trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec)


Property changes on: trunk/rpms/kernel-module-qc-usb/dag-kernel-module-qc-usb.spec
___________________________________________________________________
Name: svn:keywords
   + Id HeadURL

Deleted: trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec
===================================================================
--- trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec	2004-06-18 10:14:33 UTC (rev 1371)
@@ -1,156 +0,0 @@
-# $Id$
-
-# Authority: dag
-# Upstream: &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">tuukkat at ee.oulu.fi</A>&gt;
-
-# Archs: i686 i586 i386 athlon
-# Distcc: 0
-# Soapbox: 0
-# BuildAsRoot: 1
-
-%define _libmoddir /lib/modules
-
-%{!?kernel:%define kernel %(rpm -q kernel-source --qf '%{RPMTAG_VERSION}-%{RPMTAG_RELEASE}' | tail -1)}
-
-%define kversion %(echo &quot;%{kernel}&quot; | sed -e 's|-.*||')
-%define krelease %(echo &quot;%{kernel}&quot; | sed -e 's|.*-||')
-
-%define real_name qc-usb
-%define real_release 1
-
-%define moduledir /kernel/drivers/usb/qc-usb
-%define modules quickcam.o
-
-Summary: Linux QuickCam USB Drivers
-Name: kernel-module-qc-usb
-Version: 0.5.1
-Release: %{real_release}_%{kversion}_%{krelease}
-License: GPL
-Group: System Environment/Kernel
-URL: <A HREF="http://www.ee.oulu.fi/~tuukkat/quickcam/quickcam.html">http://www.ee.oulu.fi/~tuukkat/quickcam/quickcam.html</A>
-
-Packager: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
-Vendor: Dag Apt Repository, <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
-
-Source: <A HREF="http://www.ee.oulu.fi/~tuukkat/quickcam/qc-usb-%{version">http://www.ee.oulu.fi/~tuukkat/quickcam/qc-usb-%{version</A>}.tar.gz
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-
-
-BuildRequires: kernel-source
-
-Requires: /boot/vmlinuz-%{kversion}-%{krelease}
-Requires: qcset
-
-Obsoletes: %{real_name}, kernel-%{real_name}
-Provides: %{real_name}, kernel-%{real_name}
-Provides: kernel-modules
-
-%description
-Linux QuickCam USB drivers.
-
-These drivers are built for kernel %{kversion}-%{krelease}
-and architecture %{_target_cpu}.
-They might work with newer/older kernels.
-
-%package -n kernel-smp-module-qc-usb
-Summary: Linux QuickCam USB Drivers for SMP kernels
-Group: System Environment/Kernel
-Release: %{real_release}_%{kversion}_%{krelease}
-
-Requires: /boot/vmlinuz-%{kversion}-%{krelease}smp
-Requires: qcset
-
-Obsoletes: %{real_name}, kernel-%{real_name}
-Provides: %{real_name}, kernel-%{real_name}
-Provides: kernel-modules
-
-%description -n kernel-smp-module-qc-usb
-Linux QuickCam USB drivers for SMP kernels.
-
-These drivers are built for kernel %{kversion}-%{krelease}smp
-and architecture %{_target_cpu}.
-They might work with newer/older kernels.
-
-%package -n qcset
-Summary: Linux QuickCam USB utilities
-Release: %{real_release}
-Group: System Environment/Base
-
-%description -n qcset
-Utility to configure the QuickCam USB settings.
-
-%prep
-%setup -n %{real_name}-%{version}
-
-%build
-%{__rm} -rf %{buildroot}
-echo -e &quot;\nDriver version: %{version}\nKernel version: %{kversion}-%{krelease}\n&quot;
-
-### Prepare UP kernel.
-cd %{_usrsrc}/linux-%{kversion}-%{krelease}
-%{__make} -s distclean &amp;&gt;/dev/null
-%{__cp} -f configs/kernel-%{kversion}-%{_target_cpu}.config .config
-%{__make} -s symlinks oldconfig dep EXTRAVERSION=&quot;-%{krelease}&quot; &amp;&gt;/dev/null
-cd -
-
-### Make UP module.
-%{__make} %{?_smp_mflags} clean all \
-	MODULE_DIR=&quot;%{_libmoddir}/%{kversion}-%{krelease}&quot;
-%{__install} -d -m0755 %{buildroot}%{_libmoddir}/%{kversion}-%{krelease}%{moduledir}
-%{__install} -m0644 %{modules} %{buildroot}%{_libmoddir}/%{kversion}-%{krelease}%{moduledir}
-
-### Prepare SMP kernel.
-cd %{_usrsrc}/linux-%{kversion}-%{krelease}
-%{__make} -s distclean &amp;&gt;/dev/null
-%{__cp} -f configs/kernel-%{kversion}-%{_target_cpu}-smp.config .config
-%{__make} -s symlinks oldconfig dep EXTRAVERSION=&quot;-%{krelease}smp&quot; &amp;&gt;/dev/null
-cd -
-
-### Make SMP module.
-%{__make} %{?_smp_mflags} clean all \
-	MODULE_DIR=&quot;%{_libmoddir}/%{kversion}-%{krelease}&quot;
-%{__install} -d -m0755 %{buildroot}%{_libmoddir}/%{kversion}-%{krelease}smp%{moduledir}
-%{__install} -m0644 %{modules} %{buildroot}%{_libmoddir}/%{kversion}-%{krelease}smp%{moduledir}
-
-%install
-### Install utilities.
-%{__install} -d -m0755 %{buildroot}%{_bindir}
-%{__install} -m0755 qcset %{buildroot}%{_bindir}
-
-%post
-/sbin/depmod -ae %{kversion}-%{krelease} || :
-
-%postun
-/sbin/depmod -ae %{kversion}-%{krelease} || :
-
-%post -n kernel-smp-module-qc-usb
-/sbin/depmod -ae %{kversion}-%{krelease}smp || :
-
-%postun -n kernel-smp-module-qc-usb
-/sbin/depmod -ae %{kversion}-%{krelease}smp || :
-
-%clean
-%{__rm} -rf %{buildroot}
-
-%files
-%defattr(-, root, root, 0755)
-%{_libmoddir}/%{kversion}-%{krelease}%{moduledir}/
-
-%files -n kernel-smp-module-qc-usb
-%defattr(-, root, root, 0755)
-%{_libmoddir}/%{kversion}-%{krelease}smp%{moduledir}/
-
-%files -n qcset
-%defattr(-, root, root, 0755)
-%doc APPLICATIONS COPYING FAQ README README.qce TODO qcweb-info.txt
-%{_bindir}/qcset
-
-%changelog
-* Thu Mar 11 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.1-1
-- Fixed the longstanding smp kernel bug. (Bert de Bruijn)
-
-* Wed Sep 17 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.1-0
-- User contributed package. (Bert de Bruijn)
-
-* Tue Sep 16 2003 Bert de Bruijn &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">bert at debruijn.be</A>&gt; - 0.5.1-0
-- Initial package.

Added: trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec
===================================================================
--- trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec	2004-06-18 10:14:33 UTC (rev 1371)
@@ -0,0 +1,116 @@
+# $Id$
+# Authority: matthias
+
+# What kernel are we building for?
+%{!?kernel: %define kernel %(uname -r)}
+# Get the correct kernel package release by stripping kernel modifiers
+%define krel %(echo %{kernel} | sed -e s/smp//g -)
+# Get a type modifier for the kernel, (null) or -smp
+%if %(echo %{kernel} | grep -c smp)
+    %{expand:%%define ktype -smp}
+%else
+    %define ktype %{nil}
+%endif
+
+# What kernel &quot;flavor&quot; are we building for ?
+%{expand:%%define post26 %(echo %{kernel} | grep &quot;^2\.[0-4]\.&quot; &gt;/dev/null &amp;&amp; echo 0 || echo 1)}
+
+# Don't build debuginfo packages for kernel modules
+%define debug_package %{nil}
+
+# Where the kernel build tree lives for post 2.6
+%define basedeveldir %{_libdir}/kernel-module-devel-%{krel}
+%define develdir %{basedeveldir}/kernel%{ktype}-%{krel}.%{_target_cpu}.rpm
+
+# Do we want to put the module into &quot;updates&quot; (don't define for &quot;no&quot;)
+#define updates /updates
+
+
+Summary: Driver for Logitech QuickCam webcams using qc-usb
+Name: kernel-module-qc-usb
+Version: 0.6.0
+Release: 0
+License: GPL
+Group: System Environment/Kernel
+URL: <A HREF="http://qce-ga.sourceforge.net/">http://qce-ga.sourceforge.net/</A>
+Source: <A HREF="http://dl.sf.net/qce-ga/qc-usb-%{version">http://dl.sf.net/qce-ga/qc-usb-%{version</A>}.tar.gz
+Patch: qc-usb.autotools.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+%if %{post26}
+BuildRequires: kernel-module-devel-%{krel}
+%else
+BuildRequires: kernel-source = %{krel}
+%endif
+BuildRequires: autoconf, automake
+
+%description
+This package contains a kernel module for the qc-usb Logitech QuickCam USB
+driver.
+
+To rebuild this package you should use :
+--define &quot;kernel &lt;uname -r output&gt;&quot;
+--target &lt;arch&gt;
+
+
+%package %{kernel}
+Summary: Driver for Logitech QuickCam webcams using qc-usb
+Group: System Environment/Kernel
+Provides: %{name} = %{version}-%{release}, kernel-module
+Requires(post): modutils
+Requires(postun): modutils
+Requires: /boot/vmlinuz-%{kernel}
+
+%description %{kernel}
+This package contains a kernel module for the qc-usb Logitech QuickCam USB
+driver.
+
+
+%prep
+%setup -q -n qc-usb-%{version}
+%patch -p2
+
+
+%build
+sh autogen.sh || :
+%if %{post26}
+%configure \
+    --with-linuxdir=&quot;%{develdir}&quot;
+%else
+%configure \
+    --with-rpm-target=&quot;%{_target_cpu}&quot; \
+    --with-kernel-release=&quot;%{kernel}&quot; \
+    --with-linuxdir=&quot;/usr/src/linux-%{krel}&quot;
+%endif
+%{__make} %{?_smp_mflags}
+
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}%{?updates}&quot;
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%post %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+%postun %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+
+%files %{kernel}
+%defattr(-, root, root, 0755)
+/lib/modules/%{kernel}%{?updates}/kernel/drivers/video/quickcam.*o
+
+
+%changelog
+* Thu Jun 17 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 0.6.0-0
+- Takeover the spec.
+
+* Wed Jun 16 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.6.0-0.fdr.2: updated for both 2.4 and 2.6
+
+* Sun Feb 29 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- Initial package


Property changes on: trunk/rpms/kernel-module-qc-usb/kernel-module-qc-usb.spec
___________________________________________________________________
Name: svn:keywords
   + Id HeadURL

Added: trunk/rpms/kernel-module-qc-usb/qc-usb.autotools.patch
===================================================================
--- trunk/rpms/kernel-module-qc-usb/qc-usb.autotools.patch	2004-06-17 22:14:01 UTC (rev 1370)
+++ trunk/rpms/kernel-module-qc-usb/qc-usb.autotools.patch	2004-06-18 10:14:33 UTC (rev 1371)
@@ -0,0 +1,915 @@
+Index: kernel-module-qc-usb/qc-usb-0.6.0/testquickcam/Makefile.am
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/testquickcam/Makefile.am	2004-05-21 22:46:41.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/testquickcam/Makefile.am	2004-05-21 22:48:23.000000000 +0200
+@@ -0,0 +1,4 @@
++noinst_PROGRAMS = testquickcam
++
++testquickcam_SOURCES = testquickcam.c
++noinst_HEADERS = testquickcam.h
+Index: kernel-module-qc-usb/qc-usb-0.6.0/Makefile.am
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/Makefile.am	2004-05-21 22:46:41.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/Makefile.am	2004-06-16 11:19:22.570951736 +0200
+@@ -0,0 +1,20 @@
++SUBDIRS = testquickcam
++
++bin_PROGRAMS = qcset
++
++noinst_HEADERS = quickcam.h qc-memory.h
++
++moduledir = $(modulesdir)/kernel/drivers/video
++module_PROGRAMS = quickcam.ko
++
++# we are building from this package and not included in kernel
++quickcam_ko_CFLAGS = $(LINUX_CFLAGS) -DNOKERNEL
++quickcam_ko_SOURCES = \
++	qc-driver.c qc-formats.c qc-mjpeg.c qc-hdcs.c \
++	qc-pb0100.c qc-vv6410.c qc-memory.c
++quickcam_ko_LINK = $(top_builddir)/modtool --link -o $@
++                                                                                
++distclean-local:
++	-rm -rf .mods
++
++qcset_SOURCES = qcset.c
+Index: kernel-module-qc-usb/qc-usb-0.6.0/m4/as-linux.m4
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/m4/as-linux.m4	2004-05-21 22:46:41.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/m4/as-linux.m4	2004-06-16 11:09:16.305118152 +0200
+@@ -0,0 +1,704 @@
++dnl as-linux.m4 0.2.1
++
++dnl autostars m4 macro for detecting a Linux source tree (or
++dnl equivalent) for compiling modules.
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-linux.m4,v 1.18 2004/06/03 16:35:58 thomasvs Exp $
++
++dnl AS_LINUX()
++dnl
++dnl this macro adds the options
++dnl --with-linuxdir        to specify a kernel build tree location
++dnl --with-linuxconfig     to specify a kernel .config file
++dnl --with-kernel-release  to specify an alternative uname -r
++dnl --with-machine         to specify an alternative uname -m
++dnl --with-rpm-target      to specify to match the given rpm --target option
++dnl --with-extraversion    to specify an EXTRAVERSION override
++dnl --with-modulesdir      to specify the base install location of modules
++dnl --with-modulesdeveldir to specify the base install location of build stuff
++
++dnl this macro defines:
++dnl LINUX_DIR
++dnl   The directory where the Linux source resides.
++dnl CONFIG_FILE
++dnl   The Linux config file
++dnl LINUX_ARCH
++dnl   $(ARCH) in kernel Makefiles
++dnl LINUX_AFLAGS
++dnl   $(AFLAGS) in kernel Makefiles
++dnl LINUX_LDFLAGS
++dnl   Linker flags used by Linux
++dnl LINUX_ARFLAGS
++dnl   Archiver flags used by Linux
++dnl LINUX_CROSS_COMPILE
++dnl   Cross-compiler prefix, if any. (example: &quot;powerpc-linux-&quot;)
++dnl LINUX_KERNELRELEASE
++dnl   Kernel release name (2.4.5-pre4-ac5-rmk), $(KERNELRELEASE) in
++dnl   Linux Makefiles.
++dnl LINUX_CFLAGS
++dnl   CFLAGS used by Linux.  Includes both $CFLAGS and $MODFLAGS from
++dnl   kernel Makefiles. Also includes warnings and optimization.
++dnl LINUX_CC
++dnl   Compiler used by Linux.
++dnl LINUX_LD
++dnl   Path to linker (possibly with options) used by Linux.
++dnl LINUX_AS
++dnl   Assembler used by Linux.
++dnl LINUX_MODULE_EXT
++dnl   Module extension (.o or .ko)
++dnl LINUX_MODPOST
++dnl   path to modpost script
++dnl LINUX_SMP
++dnl   set to yes if the kernel is SMP
++dnl modulesdir
++dnl   base install path for kernel modules
++dnl modulesdeveldir
++dnl   base install path for kernel module development files
++dnl 
++dnl End of search list.
++
++dnl main entry point
++dnl checks the version, and figures out all flags to use to make modules.
++AC_DEFUN([AS_LINUX],
++[
++	dnl check if user supplied a uname -r, and if not use the running one
++	AS_LINUX_KERNEL_RELEASE()
++	dnl check if user supplied a uname -m, and if not use the running one
++	AS_LINUX_MACHINE() 	 
++	dnl check if the user supplied an rpm target arch
++	dnl override the LINUX_MACHINE value if he did
++	AS_LINUX_RPM_TARGET($LINUX_KERNEL_RELEASE) 	 
++  	 
++	dnl find the kernel source tree for the given uname -r 	 
++	AS_LINUX_DIR($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied an EXTRAVERSION, and if not get from uname -r
++	AS_LINUX_EXTRAVERSION($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied a config file; if not, guess a good one
++	AS_LINUX_CONFIG($LINUX_DIR, $LINUX_KERNEL_RELEASE, $LINUX_MACHINE) 	 
++	dnl check if we're building on pre-FC2 Red Hat/Fedora,
++	dnl and add some flags if we are 	 
++	AS_CHECK_REDHAT_PRE_FC2() 	 
++	dnl check if we're building SMP, and set LINUX_SMP if we are
++	AS_CHECK_SMP()
++	dnl check for where to install modules
++	AS_LINUX_MODULESDIR($LINUX_KERNEL_RELEASE)
++	dnl check for where to install module development files
++	AS_LINUX_MODULESDEVELDIR($LINUX_DIR)
++	dnl check for the MAJOR/MINOR version of Linux 	 
++	AS_LINUX_VERSION_MAJOR_MINOR($LINUX_DIR)
++
++	dnl now call the correct macro to get compiler flags
++	dnl the versioned AS_LINUX macros just use the global variables
++	dnl this could be cleaned up later on if we feel like it
++	case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++		2.6)
++			AS_LINUX_2_6()
++			;;
++		2.[[01234]])
++			AS_LINUX_2_4()
++			;;
++		*)
++			AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++			;;
++	esac
++])
++
++
++dnl check if we can find a source dir for the Linux kernel
++dnl defines LINUX_DIR to the absolute location of a usable kernel source tree
++AC_DEFUN([AS_LINUX_DIR],
++[
++	AC_ARG_WITH([linuxdir],
++		[AC_HELP_STRING([--with-linuxdir=DIR],
++			[specify path to Linux source directory])],
++		[LINUX_DIR=&quot;${withval}&quot;],
++		[LINUX_DIR=default])
++
++	if test &quot;${LINUX_DIR}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_DIR([${LINUX_DIR}], , AC_MSG_ERROR([Linux dir not found]) )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/lib/modules/`uname -r`/build&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;../linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/usr/src/linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([Linux source directory not found])
++	fi
++
++	AC_SUBST(LINUX_DIR)
++])
++
++dnl check if the given candidate path for a linux source tree is usable
++AC_DEFUN([AS_TRY_LINUX_DIR],
++	[AC_MSG_CHECKING(for Linux in $1)
++
++	if test -f &quot;$1/Makefile&quot; ; then
++		result=yes
++		$2
++	else
++		result=&quot;not found&quot;
++		$3
++	fi
++
++	AC_MSG_RESULT($result)
++])
++
++dnl allow for specifying a kernel release (uname -r) to build for
++dnl use uname -r of running one if not specified
++dnl store result in LINUX_KERNEL_RELEASE
++AC_DEFUN([AS_LINUX_KERNEL_RELEASE],
++[
++	AC_ARG_WITH([kernel-release],
++		[AC_HELP_STRING([--with-kernel-release=RELEASE],
++			[specify the &quot;uname -r&quot;-value to build for])],
++		[LINUX_KERNEL_RELEASE=&quot;${withval}&quot;],
++		[LINUX_KERNEL_RELEASE=`uname -r`])
++        if test &quot;x$LINUX_KERNEL_RELEASE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_KERNEL_RELEASE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_KERNEL_RELEASE as the uname -r value])
++])
++
++dnl allow for specifying a machine (uname -m) to build for
++dnl use uname -, of running one if not specified
++dnl store result in LINUX_MACHINE
++AC_DEFUN([AS_LINUX_MACHINE],
++[
++	AC_ARG_WITH([machine],
++		[AC_HELP_STRING([--with-machine=MACHINE],
++			[specify the &quot;uname -m&quot;-value to build for])],
++		[LINUX_MACHINE=&quot;${withval}&quot;],
++		[LINUX_MACHINE=`uname -m`])
++        if test &quot;x$LINUX_MACHINE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_MACHINE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_MACHINE as the uname -m value])
++])
++dnl allow for specifying an rpm target arch
++dnl if none specified, try to guess one from running rpm querying for
++dnl the kernel with the uname -r
++dnl this is so configure without arguments works out of the box
++dnl FIXME: investigate if uname -p is a correct guess for this, and if
++dnl we should have a flag for specifying it instead
++
++dnl this macro possibly overrides LINUX_MACHINE
++
++dnl first argument is the kernel release building for
++AC_DEFUN([AS_LINUX_RPM_TARGET],
++[
++	RELEASE=$1
++	AC_ARG_WITH([rpm-target],
++		[AC_HELP_STRING([--with-rpm-target=TARGET],
++			[specify the target arch to build for])],
++		[LINUX_RPM_TARGET=&quot;${withval}&quot;],
++		[LINUX_RPM_TARGET=])
++	if test &quot;x$LINUX_RPM_TARGET&quot; = &quot;x&quot;
++	then
++		dnl if we have rpm, try to guess the target of the kernel
++		dnl we want to build for using rpm
++		AC_PATH_PROG(RPM, rpm, yes, no)
++		if test &quot;x$RPM&quot; = &quot;xyes&quot;
++		then
++			if rpm -q kernel-$RELEASE &gt; /dev/null
++			then
++				LINUX_RPM_TARGET=`rpm -q --queryformat %{arch} kernel-$RELEASE`
++			else
++				AC_MSG_NOTICE([Cannot guess target arch, consider setting it using --with-rpm-target])
++			fi
++		fi
++	fi
++
++	dnl now override LINUX_MACHINE if LINUX_RPM_TARGET is set
++	if test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;
++	then
++		dnl override LINUX_MACHINE based on this
++		dnl FIXME: add other possible Red Hat/Fedora/rpm targets here
++		LINUX_MACHINE=
++		case &quot;$LINUX_RPM_TARGET&quot; in
++			i?86) LINUX_MACHINE=i386;;
++			athlon) LINUX_MACHINE=i386;;
++			x86_64) LINUX_MACHINE=x86_64;;
++		esac
++		if test &quot;x$LINUX_MACHINE&quot; = &quot;x&quot;
++		then
++		AC_MSG_ERROR(Could not guess uname -m value from target $LINUX_RPM_TARGET)
++		fi
++	fi
++])
++
++
++dnl allow for specifying an override for EXTRAVERSION
++dnl if none specified, make it from the passed-in KERNEL_RELEASE (uname -r)
++dnl resulting value is stored in LINUX_EXTRAVERSION
++dnl first argument is the uname -r string to use as a fallback
++AC_DEFUN([AS_LINUX_EXTRAVERSION],
++[
++	KERNEL_RELEASE=[$1]
++	dnl extract the default by getting everything after first -
++	LINUX_EXTRAVERSION=&quot;-`echo $KERNEL_RELEASE | cut -d- -f 2-`&quot;
++	AC_ARG_WITH([extraversion],
++		[AC_HELP_STRING([--with-extraversion=FILE],
++			[specify override for kernel EXTRAVERSION])],
++		[LINUX_EXTRAVERSION=&quot;${withval}&quot;],)
++])
++
++
++dnl check if we can find a config file for the Linux kernel
++dnl defines LINUX_CONFIG to the absolute location of a usable
++dnl kernel source config file
++
++dnl for rpm distros, it can try and guess the correct config file by
++dnl checking the global LINUX_RPM_TARGET variable set somewhere else
++dnl (FIXME: move this to an argument instead ?)
++
++dnl first argument is LINUX_DIR to check for possible configs
++dnl second argument is kernel-release (uname -r)
++dnl third argument is machine (uname -m)
++
++AC_DEFUN([AS_LINUX_CONFIG],
++[
++	LINUX_DIR=[$1]
++	KERNEL_RELEASE=[$2]
++	MACHINE=[$3]
++	AC_ARG_WITH([linuxconfig],
++		[AC_HELP_STRING([--with-linuxconfig=FILE],
++			[specify path to Linux configuration file])],
++		[LINUX_CONFIG=&quot;${withval}&quot;],
++		[LINUX_CONFIG=default])
++
++	dnl if a file got specified, try it as a linux config file
++	if test &quot;${LINUX_CONFIG}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_CONFIG($LINUX_CONFIG, $MACHINE,
++                                    ,, AC_MSG_ERROR([Linux config not found]) )
++	fi
++
++        dnl if no file specified, first check for the regular .config file
++        dnl in LINUX_DIR created by manual configuration
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		file=&quot;$LINUX_DIR/.config&quot;;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++        dnl second, try to guess what config file to use for the current kernel
++	dnl FIXME: the possible arch is from rpmbuild --target, and is
++	dnl different from the value of ARCH (Makefile) or MACHINE (uname -m)
++	dnl so we should have a redhat flag to specify the target to find
++	dnl the correct config file
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; &amp;&amp; test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;; then
++		dnl Red Hat stores configuration files for their built kernels
++		dnl named kernel-(version)-(arch)(extra).config
++		dnl where arch is athlon, i386, i586, i686, x86_64
++		dnl and (extra) is empty or -smp, -BOOT, -bigmem
++		dnl haven't seen combinations of extra yet as of FC1
++		KVERSION=`echo $KERNEL_RELEASE | cut -d- -f1`
++		extra=
++		echo $KERNEL_RELEASE | grep smp &amp;&amp; EXTRA=&quot;-smp&quot;
++		echo $KERNEL_RELEASE | grep bigmem &amp;&amp; EXTRA=&quot;-bigmem&quot;
++		echo $KERNEL_RELEASE | grep BOOT &amp;&amp; EXTRA=&quot;-BOOT&quot;
++		file=&quot;$LINUX_DIR/configs/kernel-$KVERSION-$LINUX_RPM_TARGET$EXTRA.config&quot;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([
++The kernel source tree at ${LINUX_DIR} is not configured,
++and no configuration files in config/ matching your kernel were found.
++Fix before continuing or specify a config file using --with-configfile.])
++	fi
++
++	AC_SUBST(LINUX_CONFIG)
++])
++
++dnl check if the given candidate config file is usable
++dnl FIXME: it would be nice if it could check if it matches the
++dnl given machine (uname -m)
++AC_DEFUN([AS_TRY_LINUX_CONFIG],
++[
++	CFG=[$1]
++	MACHINE=[$2]
++	AC_MSG_CHECKING($CFG)
++
++	if test -f &quot;$CFG&quot; ; then
++		result=yes
++		ifelse([$3], , :, [$3])
++	else
++		result=&quot;not found&quot;
++		ifelse([$4], , :, [$4])
++	fi
++	AC_MSG_RESULT($result)
++])
++
++dnl check if RED_HAT_LINUX_KERNEL is defined
++dnl pre-FC2 RH/Fedora defines this in linux/rhconfig.h
++dnl included from linux/version.h
++dnl if this is present, a few extra defines need to be present to make sure
++dnl symbol versioning is correct
++dnl uses LINUX_DIR to find rhconfig.h
++AC_DEFUN([AS_CHECK_REDHAT_PRE_FC2],
++[
++	AC_MSG_CHECKING(Pre-FC2 Red Hat/Fedora kernel)
++        HAVE_REDHAT_KERNEL=false
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux&quot;
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++#define __BOOT_KERNEL_H_
++#include &quot;rhconfig.h&quot;
++int code = RED_HAT_LINUX_KERNEL;
++	]),
++        AC_MSG_RESULT(found); HAVE_REDHAT_KERNEL=true,
++        AC_MSG_RESULT(not found))
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++
++	dnl check for Red Hat define flags to use - see /sbin/mkkerneldoth
++
++	dnl initialize the booleans we want to detect
++	ENTERPRISE='0'
++	SMP='0'
++	UP='0'
++	BIGMEM='0'
++	HUGEMEM='0'
++
++	dnl get variables from the currently running kernel as default 
++	KERNEL_TYPE=`uname -r | sed 's_^.*\(smp\|enterprise\|bigmem\|hugemem\)$_\1_;t;s_.*__;'`
++	KERNEL_RELEASE=`uname -r | sed 's|smp\|enterprise\|bigmem\|hugemem||g'`
++	KERNEL_ARCH=`uname -m`
++
++	dnl check the config file and override KERNEL_ARCH
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M386, KERNEL_ARCH=i386)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M586, KERNEL_ARCH=i586)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M686, KERNEL_ARCH=i686)
++	dnl for some reason the i686 bigmem config file has PENTIUM
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MPENTIUMIII, KERNEL_ARCH=i686)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MK7, KERNEL_ARCH=athlon)
++
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, KERNEL_TYPE=smp)
++	dnl bigmem is also smp, so this check is done after smp to override
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_HIGHMEM64G, KERNEL_TYPE=bigmem)
++
++	dnl FIXME: need to check hugemem and enterprise config files, which
++	dnl aren't provided in Fedora Core 1 !
++
++	case &quot;$KERNEL_TYPE&quot; in
++		smp) SMP='1';;
++		enterprise) ENTERPRISE='1';;
++		bigmem) BIGMEM='1';;
++		hugemem) HUGEMEM='1';;
++		*) UP='1';;
++	esac
++	REDHAT_CFLAGS=&quot;-D__BOOT_KERNEL_H_ -D__MODULE_KERNEL_$KERNEL_ARCH=1&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_ENTERPRISE=$ENTERPRISE&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_UP=$UP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_SMP=$SMP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_BIGMEM=$BIGMEM&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_HUGEMEM=$HUGEMEM&quot;
++
++	LINUX_REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS&quot;
++
++	AC_SUBST(LINUX_KERNEL_TYPE, &quot;$KERNEL_TYPE&quot;)
++])
++
++dnl check if we're building on SMP
++dnl set LINUX_SMP to yes if we are
++AC_DEFUN([AS_CHECK_SMP],
++[
++	LINUX_SMP=&quot;no&quot;
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, LINUX_SMP=&quot;yes&quot;)
++	AC_SUBST(LINUX_SMP)
++])
++
++dnl add an argument to specify/override the module install path
++dnl if nothing specified, it will be /lib/modules/(kernelrel)
++AC_DEFUN([AS_LINUX_MODULESDIR],
++[
++	KERNEL_RELEASE=[$1]
++	AC_ARG_WITH([modulesdir],
++		[AC_HELP_STRING([--with-modulesdir=DIR],
++			[specify path to kernel-specific modules install directory])],
++		[MODULESDIR=&quot;${withval}&quot;],
++		[MODULESDIR=default])
++
++	if test &quot;${MODULESDIR}&quot; = &quot;default&quot; ; then
++		MODULESDIR=&quot;/lib/modules/${KERNEL_RELEASE}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdir, $MODULESDIR)
++	AC_MSG_NOTICE([Putting kernel modules under ${MODULESDIR}])
++])
++
++dnl add an argument to specify/override the module devel install path
++dnl if nothing specified, it will be the passed in LINUXDIR)
++AC_DEFUN([AS_LINUX_MODULESDEVELDIR],
++[
++	LINUXDIR=[$1]
++	AC_ARG_WITH([modulesdeveldir],
++		[AC_HELP_STRING([--with-modulesdeveldir=DIR],
++			[specify path to kernel-specific module development install directory])],
++		[MODULESDEVELDIR=&quot;${withval}&quot;],
++		[MODULESDEVELDIR=default])
++
++	if test &quot;${MODULESDEVELDIR}&quot; = &quot;default&quot; ; then
++		MODULESDEVELDIR=&quot;${LINUXDIR}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdeveldir, $MODULESDEVELDIR)
++	AC_MSG_NOTICE([Putting kernel module development files under ${MODULESDEVELDIR}])
++])
++
++AC_DEFUN([AS_LINUX_2_6],
++[
++	AC_MSG_CHECKING(for Linux CFLAGS)
++
++	{
++	  tmpdir=`(umask 077 &amp;&amp; mktemp -d -q &quot;./confstatXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
++	  test -n &quot;$tmpdir&quot; &amp;&amp; test -d &quot;$tmpdir&quot;
++	} ||
++	{
++	  tmpdir=./confstat$$-$RANDOM
++	  (umask 077 &amp;&amp; mkdir $tmpdir)
++	} ||
++	{
++	  echo &quot;$me: cannot create a temporary directory in .&quot; &gt;&amp;2
++	  { (exit 1); exit 1; }
++	}
++
++	tmpdir=`pwd`/$tmpdir
++
++	cat &gt;${tmpdir}/Makefile &lt;&lt;EOF
++obj-m += fake.o
++
++\$(obj)/fake.c: flags
++	touch \$(obj)/fake.c
++
++.PHONY: flags
++flags:
++	echo LINUX_ARCH=\&quot;\$(ARCH)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's,include,&quot;\$(LINUXDIR)/include&quot;,g'&gt;&gt;\$(obj)/flags
++	echo LINUX_LDFLAGS=\&quot;\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS=\&quot;\$(CFLAGS) \$(CPPFLAGS)\&quot; | sed 's,Iinclude,I\$(LINUXDIR)/include,g' &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS_MODULE=\&quot;\$(CFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CC=\&quot;\$(CC)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS) \$(LDFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AS=\&quot;\$(AS)\&quot; &gt;&gt;\$(obj)/flags
++EOF
++
++	echo ${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	. ${tmpdir}/flags
++	rm -rf ${tmpdir}
++
++	LINUX_MODULE_EXT=&quot;.ko&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_CFLAGS_MODULE&quot;
++	LINUX_MODPOST=&quot;$LINUX_DIR/scripts/modpost&quot;
++
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++	AC_SUBST(LINUX_MODPOST)
++
++	AC_MSG_RESULT([$LINUX_CFLAGS])
++])
++
++dnl checks kernel's Makefile for make variables for Linux 2.4
++dnl adds LINUX_REDHAT_CFLAGS if non-empty
++AC_DEFUN([AS_LINUX_2_4],
++[
++	AC_MSG_CHECKING(for Linux 2.4 make flags)
++	dnl we try to figure out the CFLAGS by invoking the Makefile on
++        dnl a test dir
++        dnl we use the correct config file by substituting the MAKEFILES
++        dnl Makefile variable, which originally points to .config
++
++	if [[ ! -e &quot;${LINUX_DIR}/.hdepend&quot; ]];then
++		AC_MSG_ERROR([
++You need to run 'make dep' on the kernel source before continuing.])
++	fi
++
++        if test &quot;x$LINUX_EXTRAVERSION&quot; == &quot;x&quot;; then
++          EX=
++        else
++          EX=&quot;EXTRAVERSION=$LINUX_EXTRAVERSION&quot;
++        fi
++
++        POPDIR=`(pwd)`
++        cd ${LINUX_DIR}
++        TMPFILE=`mktemp /tmp/linux.XXXXXXXX` || exit 1
++	# combine the kernel's Makefile,
++	# sedded to use our proposed config file,
++	# sedded to use our proposed machine value,
++	# with the extra target we add here, to get cflags
++	# we do not want entering/leaving info on distcheck so we run with -s
++	( cat Makefile | sed &quot;s|\.config|${LINUX_CONFIG}|g&quot; | sed &quot;s|shell uname -m|shell echo ${LINUX_MACHINE}|g&quot; &amp;&amp; cat &lt;&lt;EOF ) | make -s -f - get_cflags $EX &gt; ${TMPFILE}
++get_cflags:
++	@echo LINUX_ARCH=\&quot;\$(ARCH)\&quot;
++	@echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_LDFLAGS=\&quot;\&quot;
++	@echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot;
++	@echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot;
++	@echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot;
++	@echo LINUX_CFLAGS=\&quot;\$(CFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_MODFLAGS=\&quot;\$(MODFLAGS)\&quot;
++	@echo LINUX_CC=\&quot;\$(CC)\&quot;
++	@echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS)\&quot;
++	@echo LINUX_AS=\&quot;\$(AS)\&quot;
++EOF
++        . ${TMPFILE}
++        rm -rf ${TMPFILE}
++        cd $POPDIR
++
++        LINUX_MODULE_EXT=&quot;.o&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_MODFLAGS&quot;
++
++	dnl if we have REDHAT_CFLAGS, put them in LINUX_CFLAGS
++	if test &quot;x$REDHAT_CFLAGS&quot; != &quot;x&quot;;
++	then
++		LINUX_CFLAGS=&quot;$LINUX_CFLAGS $REDHAT_CFLAGS&quot;
++	fi
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++
++	AC_MSG_RESULT([ok])
++
++	AC_MSG_CHECKING(for Linux 2.4 CFLAGS)
++	AC_MSG_RESULT($LINUX_CFLAGS)
++	AC_MSG_CHECKING(for Linux 2.4 LDFLAGS)
++	AC_MSG_RESULT($LINUX_LDFLAGS)
++])
++
++AC_DEFUN([AS_CHECK_LINUX_CONFIG_OPTION],
++[
++	AC_MSG_CHECKING([Linux config option $1])
++
++	if grep '^$1=y$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=yes
++		$2
++	else if grep '^$1=m$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=module
++		$3
++	else
++		result=no
++		$4
++	fi
++	fi
++
++	AC_MSG_RESULT([$result])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION_MODULE],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes -o &quot;${$1}&quot; = module])
++])
++
++dnl check for the major/minor version of the Linux source by checking
++dnl the headers
++dnl first argument is the linux directory
++dnl sets LINUX_VERSION_MAJOR and LINUX_VERSION_MINOR
++AC_DEFUN([AS_LINUX_VERSION_MAJOR_MINOR],
++[
++	LINUX_DIR=[$1]
++	AC_MSG_CHECKING([Linux major/minor version])
++
++	if [[ ! -f &quot;${LINUX_DIR}/include/linux/version.h&quot; ]];then
++		AC_MSG_ERROR([The header file include/linux/version.h does not exist.
++For 2.6 kernels, it can be generated by running 'make prepare' in
++the kernel source directory.])
++	fi
++        dnl the next set of tests is for figuring out version major/minor
++        dnl we make sure we have the right version.h by faking out CFLAGS
++	dnl since we want to avoid including linux/version.h and acidentally
++	dnl pick up /usr/include/linux
++	dnl we still add ${LINUX_DIR}/include so the Red Hat version can pick
++	dnl up linux/rhversion.h
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux -I${LINUX_DIR}/include&quot;
++        dnl make sure we find version.h and it contains LINUX_VERSION_CODE
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++int code = LINUX_VERSION_CODE;
++]),
++ :, AC_MSG_ERROR([${LINUX_DIR}/include/linux/version.h does not contain LINUX_VERSION_CODE]))
++
++
++        dnl figure out the linux kernel version major and minor
++        dnl using the LINUX_VERSION_CODE defined in include/linux/version.h
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MAJOR(code) ((code) &gt;&gt; 16)
++],[
++  return KERNEL_VERSION_MAJOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MAJOR=0, 
++		LINUX_VERSION_MAJOR=$?)
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MINOR(code) (((code) &gt;&gt; 8) % (2 &lt;&lt; 8))
++],[
++  return KERNEL_VERSION_MINOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MINOR=0, 
++		LINUX_VERSION_MINOR=$?)
++        AC_MSG_RESULT($LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR)
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++])
+Index: kernel-module-qc-usb/qc-usb-0.6.0/configure.ac
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/configure.ac	2004-05-21 22:46:41.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/configure.ac	2004-05-21 22:58:27.000000000 +0200
+@@ -0,0 +1,10 @@
++AC_INIT(qc-driver.c)
++
++AM_INIT_AUTOMAKE(qc-usb, 0.5.1)
++dnl AM_CONFIG_HEADER(config.h)
++
++dnl look for Linux kernel source
++AS_LINUX
++AS_LINUX_MODTOOL
++
++AC_OUTPUT(Makefile testquickcam/Makefile)
+Index: kernel-module-qc-usb/qc-usb-0.6.0/autogen.sh
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/autogen.sh	2004-05-21 22:46:42.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/autogen.sh	2004-05-21 22:48:23.000000000 +0200
+@@ -0,0 +1,6 @@
++#!/bin/bash
++set -x
++aclocal -I m4 || exit 1
++autoconf || exit 1
++automake -a --foreign || exit 1
++./configure $@
+Index: kernel-module-qc-usb/qc-usb-0.6.0/m4/as-modtool.m4
+--- kernel-module-qc-usb~autotools/qc-usb-0.6.0/m4/as-modtool.m4	2004-05-21 22:49:36.000000000 +0200
++++ kernel-module-qc-usb/qc-usb-0.6.0/m4/as-modtool.m4	2004-06-16 11:09:18.123841664 +0200
+@@ -0,0 +1,147 @@
++dnl as-modtool.m4 0.0.1
++dnl autostars m4 macro for building modtool, a linker for Linux kernel
++dnl modules
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-modtool.m4,v 1.12 2004/06/03 15:20:11 thomasvs Exp $
++
++dnl AS_LINUX_MODTOOL()
++dnl
++dnl this macro defines:
++dnl moduledir
++dnl modulePROGRAMS_INSTALL
++dnl modulePROGRAMS_UNINSTALL
++dnl
++dnl End of search list.
++
++dnl
++dnl FIXME:
++dnl  How do you specify that the building of modtool should go to the
++dnl  end of the configure script?
++dnl
++
++dnl SYMVERS_INCLUDES can be used to add additional .symvers files to the
++dnl modpost step
++
++AC_DEFUN([AS_LINUX_MODTOOL],
++[
++	AC_PATH_PROG(STRIP, strip)
++	AC_PATH_PROG([DEPMOD], [depmod], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++	AC_PATH_PROG([GENKSYMS], [genksyms], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++
++	if test &quot;x$LINUX_SMP&quot; = &quot;xyes&quot;
++	then
++		GENKSYMS=&quot;$GENKSYMS -p smp_&quot;
++	fi
++	dnl this can be overridden in Makefile.am
++	dnl FIXME: it'd be nice if we could specify different target_PROGRAMS
++	dnl and different targetdir
++	moduledir=&quot;\$(modulesdir)/\$(PACKAGE)&quot;
++	modulePROGRAMS_INSTALL=&quot;\$(top_builddir)/modtool --install&quot;
++	modulePROGRAMS_UNINSTALL=&quot;\$(top_builddir)/modtool --uninstall&quot;
++	AC_SUBST(moduledir)
++	AC_SUBST(modulePROGRAMS_INSTALL)
++
++	LINUX_VERSION=`echo $LINUX_KERNELRELEASE | cut -d- -f1`
++
++	AC_MSG_NOTICE(creating modtool)
++	cat &gt;modtool &lt;&lt;EOF
++#!/bin/sh
++
++set -e
++
++LINUX_LD=&quot;$LINUX_LD&quot;
++LINUX_MODPOST=&quot;$LINUX_MODPOST&quot;
++LINUX_VERSION=&quot;$LINUX_VERSION&quot;
++GENKSYMS=&quot;$GENKSYMS&quot;
++CC=&quot;$LINUX_CC&quot;
++INSTALL=&quot;$INSTALL&quot;
++LINUX_MODULE_EXT=&quot;$LINUX_MODULE_EXT&quot;
++STRIP=&quot;$STRIP&quot;
++CFLAGS=&quot;$CFLAGS $LINUX_CFLAGS&quot;
++LINUX_DIR=&quot;$LINUX_DIR&quot;
++
++mode=\$[1]
++shift
++
++case \$mode in
++--link)
++	# we accept -i (symvers) and -o (target) as options
++	# at least -o (target) needs to be specified
++	SYMVERS_INCLUDES=&quot;&quot;
++	done=false
++	while test ! -z &quot;\$[0]&quot; -a &quot;\$done&quot; = &quot;false&quot;
++	do
++		case \$[1] in
++		-i)
++                        SYMVERS_INCLUDES=&quot;\$SYMVERS_INCLUDES \$[2]&quot;
++                        shift 2
++                        ;;
++                -o)
++                        target=\$(echo \$[2] | sed s/.ko$//)
++                        shift 2
++                        ;;
++                *)
++                        done=true
++                        ;;
++                esac
++        done
++
++	mkdir -p .mods
++	if test &quot;\$LINUX_MODULE_EXT&quot; = .ko ; then
++
++		\$LINUX_LD -r -o .mods/\$target.o \$[*]
++
++		cat \$LINUX_DIR/Module.symvers \$SYMVERS_INCLUDES &gt;.mods/symvers.tmp
++
++		\$LINUX_MODPOST -o .mods/\$target.o.symvers.tmp -i .mods/symvers.tmp .mods/\$target.o
++
++		grep .mods/\$target .mods/\$target.o.symvers.tmp &gt;.mods/\$target.o.symvers || true
++
++		rm -f .mods/\$target.o.symvers.tmp .mods/symvers.tmp
++		
++		\$CC \$CFLAGS -DKBUILD_MODNAME=\$target -c -o .mods/\$target.mod.o .mods/\$target.mod.c
++
++		\$LINUX_LD -r -o \$target.ko .mods/\$target.mod.o .mods/\$target.o
++		set +x
++	else
++		echo \$LINUX_LD -r -o \$target.ko \$[*]
++		\$LINUX_LD -r -o \$target.ko \$[*]
++                                                                      
++		if test &quot;x\$SOURCES&quot; != &quot;x&quot;
++		then
++			echo &quot;\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver&quot;
++			\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver
++		fi
++
++	fi
++
++	;;
++--install)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo \$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$STRIP -g &quot;\$module_dest&quot;
++	;;
++--uninstall)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo uninstall &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	rm -f &quot;\$module_dest&quot;
++	;;
++*)
++	echo Unknown mode \$mode &gt;&amp;2
++	exit 1
++esac
++
++EOF
++	chmod +x modtool
++
++
++])
++
++


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000179.html">[SVN] r1370 - in trunk/rpms: . perl-Digest-MD2
</A></li>
	<LI>Next message: <A HREF="000181.html">[SVN] r1372 - in trunk/rpms: . perl-Authen-Smb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#180">[ date ]</a>
              <a href="thread.html#180">[ thread ]</a>
              <a href="subject.html#180">[ subject ]</a>
              <a href="author.html#180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
