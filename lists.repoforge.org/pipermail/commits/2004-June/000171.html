<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r1362 - in trunk/rpms: . kernel-module-hostap	kernel-module-ipw2100
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1362%20-%20in%20trunk/rpms%3A%20.%20kernel-module-hostap%0A%09kernel-module-ipw2100&In-Reply-To=%3C20040617135637.777E71FCAA%40server01.nl.egwn.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000170.html">
   <LINK REL="Next"  HREF="000172.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r1362 - in trunk/rpms: . kernel-module-hostap	kernel-module-ipw2100</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1362%20-%20in%20trunk/rpms%3A%20.%20kernel-module-hostap%0A%09kernel-module-ipw2100&In-Reply-To=%3C20040617135637.777E71FCAA%40server01.nl.egwn.net%3E"
       TITLE="[SVN] r1362 - in trunk/rpms: . kernel-module-hostap	kernel-module-ipw2100">svn-commits at rpmforge.net
       </A><BR>
    <I>Thu Jun 17 15:56:37 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000170.html">[SVN] r1361 - trunk/rpms/sylpheed
</A></li>
        <LI>Next message: <A HREF="000172.html">[SVN] r1363 - in trunk/rpms: . perl-Apache-Session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#171">[ date ]</a>
              <a href="thread.html#171">[ thread ]</a>
              <a href="subject.html#171">[ subject ]</a>
              <a href="author.html#171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dude
Date: 2004-06-17 15:56:35 +0200 (Thu, 17 Jun 2004)
New Revision: 1362

Added:
   trunk/rpms/kernel-module-hostap/
   trunk/rpms/kernel-module-hostap/hostap-autotools.patch
   trunk/rpms/kernel-module-hostap/hostap-compat.patch
   trunk/rpms/kernel-module-hostap/hostap-download.patch
   trunk/rpms/kernel-module-hostap/hostap-makefile.patch
   trunk/rpms/kernel-module-hostap/kernel-module-hostap.spec
   trunk/rpms/kernel-module-ipw2100/
   trunk/rpms/kernel-module-ipw2100/ipw2100.autotools.patch
   trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec
Log:
Added for testing (it works), until naming decision is final.


Added: trunk/rpms/kernel-module-hostap/hostap-autotools.patch
===================================================================
--- trunk/rpms/kernel-module-hostap/hostap-autotools.patch	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-hostap/hostap-autotools.patch	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,997 @@
+Index: kernel-module-hostap/hostap-driver-0.1.3/configure.ac
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/configure.ac	2004-05-22 23:12:25.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/configure.ac	2004-06-03 15:58:51.446136336 +0200
+@@ -0,0 +1,40 @@
++AC_INIT(driver/modules/hostap.c)
++
++AM_INIT_AUTOMAKE(hostap-driver-patched, 0.1.3)
++
++dnl pick up ACLOCAL flags
++ACLOCAL_AMFLAGS=&quot;\${ACLOCAL_FLAGS} -I m4&quot;
++AC_SUBST(ACLOCAL_AMFLAGS)
++
++dnl do all checks
++AS_LINUX
++
++dnl to do proper versioning, we need to know if we have pre-2.4 style
++dnl kernel or post-2.6
++AC_MSG_CHECKING([for correct way to include symbol versions])
++case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++  2.[[67]])
++    dnl we have to modtool include a .symvers symbol file
++    AC_MSG_RESULT([post-2.6 .symvers modtool include])
++    SYMVERS_MODE=&quot;symvers&quot;
++    ;;
++  2.[[01234]])
++    dnl we have to source include a .ver include file
++    AC_MSG_RESULT([pre-2.6 .ver compile include])
++    SYMVERS_MODE=&quot;ver&quot;
++    ;;
++  *)
++    AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++    ;;
++esac
++AM_CONDITIONAL(SYMVERS_MODE, [test &quot;$SYMVERS_MODE&quot; = &quot;symvers&quot;])
++
++dnl generate modtool
++AS_LINUX_MODTOOL
++
++AC_OUTPUT([
++Makefile
++driver/Makefile
++driver/modules/Makefile
++driver/etc/Makefile
++])
+Index: kernel-module-hostap/hostap-driver-0.1.3/autogen.sh
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/autogen.sh	2004-05-22 23:12:29.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/autogen.sh	2004-05-22 23:13:27.000000000 +0200
+@@ -0,0 +1,6 @@
++#!/bin/bash
++set -x
++aclocal -I m4 || exit 1
++autoconf || exit 1
++automake -a --foreign || exit 1
++./configure $@
+Index: kernel-module-hostap/hostap-driver-0.1.3/m4/as-linux.m4
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/m4/as-linux.m4	2004-05-22 23:12:33.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/m4/as-linux.m4	2004-06-03 18:36:50.960031000 +0200
+@@ -0,0 +1,704 @@
++dnl as-linux.m4 0.2.1
++
++dnl autostars m4 macro for detecting a Linux source tree (or
++dnl equivalent) for compiling modules.
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-linux.m4,v 1.18 2004/06/03 16:35:58 thomasvs Exp $
++
++dnl AS_LINUX()
++dnl
++dnl this macro adds the options
++dnl --with-linuxdir        to specify a kernel build tree location
++dnl --with-linuxconfig     to specify a kernel .config file
++dnl --with-kernel-release  to specify an alternative uname -r
++dnl --with-machine         to specify an alternative uname -m
++dnl --with-rpm-target      to specify to match the given rpm --target option
++dnl --with-extraversion    to specify an EXTRAVERSION override
++dnl --with-modulesdir      to specify the base install location of modules
++dnl --with-modulesdeveldir to specify the base install location of build stuff
++
++dnl this macro defines:
++dnl LINUX_DIR
++dnl   The directory where the Linux source resides.
++dnl CONFIG_FILE
++dnl   The Linux config file
++dnl LINUX_ARCH
++dnl   $(ARCH) in kernel Makefiles
++dnl LINUX_AFLAGS
++dnl   $(AFLAGS) in kernel Makefiles
++dnl LINUX_LDFLAGS
++dnl   Linker flags used by Linux
++dnl LINUX_ARFLAGS
++dnl   Archiver flags used by Linux
++dnl LINUX_CROSS_COMPILE
++dnl   Cross-compiler prefix, if any. (example: &quot;powerpc-linux-&quot;)
++dnl LINUX_KERNELRELEASE
++dnl   Kernel release name (2.4.5-pre4-ac5-rmk), $(KERNELRELEASE) in
++dnl   Linux Makefiles.
++dnl LINUX_CFLAGS
++dnl   CFLAGS used by Linux.  Includes both $CFLAGS and $MODFLAGS from
++dnl   kernel Makefiles. Also includes warnings and optimization.
++dnl LINUX_CC
++dnl   Compiler used by Linux.
++dnl LINUX_LD
++dnl   Path to linker (possibly with options) used by Linux.
++dnl LINUX_AS
++dnl   Assembler used by Linux.
++dnl LINUX_MODULE_EXT
++dnl   Module extension (.o or .ko)
++dnl LINUX_MODPOST
++dnl   path to modpost script
++dnl LINUX_SMP
++dnl   set to yes if the kernel is SMP
++dnl modulesdir
++dnl   base install path for kernel modules
++dnl modulesdeveldir
++dnl   base install path for kernel module development files
++dnl 
++dnl End of search list.
++
++dnl main entry point
++dnl checks the version, and figures out all flags to use to make modules.
++AC_DEFUN([AS_LINUX],
++[
++	dnl check if user supplied a uname -r, and if not use the running one
++	AS_LINUX_KERNEL_RELEASE()
++	dnl check if user supplied a uname -m, and if not use the running one
++	AS_LINUX_MACHINE() 	 
++	dnl check if the user supplied an rpm target arch
++	dnl override the LINUX_MACHINE value if he did
++	AS_LINUX_RPM_TARGET($LINUX_KERNEL_RELEASE) 	 
++  	 
++	dnl find the kernel source tree for the given uname -r 	 
++	AS_LINUX_DIR($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied an EXTRAVERSION, and if not get from uname -r
++	AS_LINUX_EXTRAVERSION($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied a config file; if not, guess a good one
++	AS_LINUX_CONFIG($LINUX_DIR, $LINUX_KERNEL_RELEASE, $LINUX_MACHINE) 	 
++	dnl check if we're building on pre-FC2 Red Hat/Fedora,
++	dnl and add some flags if we are 	 
++	AS_CHECK_REDHAT_PRE_FC2() 	 
++	dnl check if we're building SMP, and set LINUX_SMP if we are
++	AS_CHECK_SMP()
++	dnl check for where to install modules
++	AS_LINUX_MODULESDIR($LINUX_KERNEL_RELEASE)
++	dnl check for where to install module development files
++	AS_LINUX_MODULESDEVELDIR($LINUX_DIR)
++	dnl check for the MAJOR/MINOR version of Linux 	 
++	AS_LINUX_VERSION_MAJOR_MINOR($LINUX_DIR)
++
++	dnl now call the correct macro to get compiler flags
++	dnl the versioned AS_LINUX macros just use the global variables
++	dnl this could be cleaned up later on if we feel like it
++	case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++		2.6)
++			AS_LINUX_2_6()
++			;;
++		2.[[01234]])
++			AS_LINUX_2_4()
++			;;
++		*)
++			AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++			;;
++	esac
++])
++
++
++dnl check if we can find a source dir for the Linux kernel
++dnl defines LINUX_DIR to the absolute location of a usable kernel source tree
++AC_DEFUN([AS_LINUX_DIR],
++[
++	AC_ARG_WITH([linuxdir],
++		[AC_HELP_STRING([--with-linuxdir=DIR],
++			[specify path to Linux source directory])],
++		[LINUX_DIR=&quot;${withval}&quot;],
++		[LINUX_DIR=default])
++
++	if test &quot;${LINUX_DIR}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_DIR([${LINUX_DIR}], , AC_MSG_ERROR([Linux dir not found]) )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/lib/modules/`uname -r`/build&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;../linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/usr/src/linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([Linux source directory not found])
++	fi
++
++	AC_SUBST(LINUX_DIR)
++])
++
++dnl check if the given candidate path for a linux source tree is usable
++AC_DEFUN([AS_TRY_LINUX_DIR],
++	[AC_MSG_CHECKING(for Linux in $1)
++
++	if test -f &quot;$1/Makefile&quot; ; then
++		result=yes
++		$2
++	else
++		result=&quot;not found&quot;
++		$3
++	fi
++
++	AC_MSG_RESULT($result)
++])
++
++dnl allow for specifying a kernel release (uname -r) to build for
++dnl use uname -r of running one if not specified
++dnl store result in LINUX_KERNEL_RELEASE
++AC_DEFUN([AS_LINUX_KERNEL_RELEASE],
++[
++	AC_ARG_WITH([kernel-release],
++		[AC_HELP_STRING([--with-kernel-release=RELEASE],
++			[specify the &quot;uname -r&quot;-value to build for])],
++		[LINUX_KERNEL_RELEASE=&quot;${withval}&quot;],
++		[LINUX_KERNEL_RELEASE=`uname -r`])
++        if test &quot;x$LINUX_KERNEL_RELEASE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_KERNEL_RELEASE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_KERNEL_RELEASE as the uname -r value])
++])
++
++dnl allow for specifying a machine (uname -m) to build for
++dnl use uname -, of running one if not specified
++dnl store result in LINUX_MACHINE
++AC_DEFUN([AS_LINUX_MACHINE],
++[
++	AC_ARG_WITH([machine],
++		[AC_HELP_STRING([--with-machine=MACHINE],
++			[specify the &quot;uname -m&quot;-value to build for])],
++		[LINUX_MACHINE=&quot;${withval}&quot;],
++		[LINUX_MACHINE=`uname -m`])
++        if test &quot;x$LINUX_MACHINE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_MACHINE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_MACHINE as the uname -m value])
++])
++dnl allow for specifying an rpm target arch
++dnl if none specified, try to guess one from running rpm querying for
++dnl the kernel with the uname -r
++dnl this is so configure without arguments works out of the box
++dnl FIXME: investigate if uname -p is a correct guess for this, and if
++dnl we should have a flag for specifying it instead
++
++dnl this macro possibly overrides LINUX_MACHINE
++
++dnl first argument is the kernel release building for
++AC_DEFUN([AS_LINUX_RPM_TARGET],
++[
++	RELEASE=$1
++	AC_ARG_WITH([rpm-target],
++		[AC_HELP_STRING([--with-rpm-target=TARGET],
++			[specify the target arch to build for])],
++		[LINUX_RPM_TARGET=&quot;${withval}&quot;],
++		[LINUX_RPM_TARGET=])
++	if test &quot;x$LINUX_RPM_TARGET&quot; = &quot;x&quot;
++	then
++		dnl if we have rpm, try to guess the target of the kernel
++		dnl we want to build for using rpm
++		AC_PATH_PROG(RPM, rpm, yes, no)
++		if test &quot;x$RPM&quot; = &quot;xyes&quot;
++		then
++			if rpm -q kernel-$RELEASE &gt; /dev/null
++			then
++				LINUX_RPM_TARGET=`rpm -q --queryformat %{arch} kernel-$RELEASE`
++			else
++				AC_MSG_NOTICE([Cannot guess target arch, consider setting it using --with-rpm-target])
++			fi
++		fi
++	fi
++
++	dnl now override LINUX_MACHINE if LINUX_RPM_TARGET is set
++	if test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;
++	then
++		dnl override LINUX_MACHINE based on this
++		dnl FIXME: add other possible Red Hat/Fedora/rpm targets here
++		LINUX_MACHINE=
++		case &quot;$LINUX_RPM_TARGET&quot; in
++			i?86) LINUX_MACHINE=i386;;
++			athlon) LINUX_MACHINE=i386;;
++			x86_64) LINUX_MACHINE=x86_64;;
++		esac
++		if test &quot;x$LINUX_MACHINE&quot; = &quot;x&quot;
++		then
++		AC_MSG_ERROR(Could not guess uname -m value from target $LINUX_RPM_TARGET)
++		fi
++	fi
++])
++
++
++dnl allow for specifying an override for EXTRAVERSION
++dnl if none specified, make it from the passed-in KERNEL_RELEASE (uname -r)
++dnl resulting value is stored in LINUX_EXTRAVERSION
++dnl first argument is the uname -r string to use as a fallback
++AC_DEFUN([AS_LINUX_EXTRAVERSION],
++[
++	KERNEL_RELEASE=[$1]
++	dnl extract the default by getting everything after first -
++	LINUX_EXTRAVERSION=&quot;-`echo $KERNEL_RELEASE | cut -d- -f 2-`&quot;
++	AC_ARG_WITH([extraversion],
++		[AC_HELP_STRING([--with-extraversion=FILE],
++			[specify override for kernel EXTRAVERSION])],
++		[LINUX_EXTRAVERSION=&quot;${withval}&quot;],)
++])
++
++
++dnl check if we can find a config file for the Linux kernel
++dnl defines LINUX_CONFIG to the absolute location of a usable
++dnl kernel source config file
++
++dnl for rpm distros, it can try and guess the correct config file by
++dnl checking the global LINUX_RPM_TARGET variable set somewhere else
++dnl (FIXME: move this to an argument instead ?)
++
++dnl first argument is LINUX_DIR to check for possible configs
++dnl second argument is kernel-release (uname -r)
++dnl third argument is machine (uname -m)
++
++AC_DEFUN([AS_LINUX_CONFIG],
++[
++	LINUX_DIR=[$1]
++	KERNEL_RELEASE=[$2]
++	MACHINE=[$3]
++	AC_ARG_WITH([linuxconfig],
++		[AC_HELP_STRING([--with-linuxconfig=FILE],
++			[specify path to Linux configuration file])],
++		[LINUX_CONFIG=&quot;${withval}&quot;],
++		[LINUX_CONFIG=default])
++
++	dnl if a file got specified, try it as a linux config file
++	if test &quot;${LINUX_CONFIG}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_CONFIG($LINUX_CONFIG, $MACHINE,
++                                    ,, AC_MSG_ERROR([Linux config not found]) )
++	fi
++
++        dnl if no file specified, first check for the regular .config file
++        dnl in LINUX_DIR created by manual configuration
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		file=&quot;$LINUX_DIR/.config&quot;;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++        dnl second, try to guess what config file to use for the current kernel
++	dnl FIXME: the possible arch is from rpmbuild --target, and is
++	dnl different from the value of ARCH (Makefile) or MACHINE (uname -m)
++	dnl so we should have a redhat flag to specify the target to find
++	dnl the correct config file
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; &amp;&amp; test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;; then
++		dnl Red Hat stores configuration files for their built kernels
++		dnl named kernel-(version)-(arch)(extra).config
++		dnl where arch is athlon, i386, i586, i686, x86_64
++		dnl and (extra) is empty or -smp, -BOOT, -bigmem
++		dnl haven't seen combinations of extra yet as of FC1
++		KVERSION=`echo $KERNEL_RELEASE | cut -d- -f1`
++		extra=
++		echo $KERNEL_RELEASE | grep smp &amp;&amp; EXTRA=&quot;-smp&quot;
++		echo $KERNEL_RELEASE | grep bigmem &amp;&amp; EXTRA=&quot;-bigmem&quot;
++		echo $KERNEL_RELEASE | grep BOOT &amp;&amp; EXTRA=&quot;-BOOT&quot;
++		file=&quot;$LINUX_DIR/configs/kernel-$KVERSION-$LINUX_RPM_TARGET$EXTRA.config&quot;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([
++The kernel source tree at ${LINUX_DIR} is not configured,
++and no configuration files in config/ matching your kernel were found.
++Fix before continuing or specify a config file using --with-configfile.])
++	fi
++
++	AC_SUBST(LINUX_CONFIG)
++])
++
++dnl check if the given candidate config file is usable
++dnl FIXME: it would be nice if it could check if it matches the
++dnl given machine (uname -m)
++AC_DEFUN([AS_TRY_LINUX_CONFIG],
++[
++	CFG=[$1]
++	MACHINE=[$2]
++	AC_MSG_CHECKING($CFG)
++
++	if test -f &quot;$CFG&quot; ; then
++		result=yes
++		ifelse([$3], , :, [$3])
++	else
++		result=&quot;not found&quot;
++		ifelse([$4], , :, [$4])
++	fi
++	AC_MSG_RESULT($result)
++])
++
++dnl check if RED_HAT_LINUX_KERNEL is defined
++dnl pre-FC2 RH/Fedora defines this in linux/rhconfig.h
++dnl included from linux/version.h
++dnl if this is present, a few extra defines need to be present to make sure
++dnl symbol versioning is correct
++dnl uses LINUX_DIR to find rhconfig.h
++AC_DEFUN([AS_CHECK_REDHAT_PRE_FC2],
++[
++	AC_MSG_CHECKING(Pre-FC2 Red Hat/Fedora kernel)
++        HAVE_REDHAT_KERNEL=false
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux&quot;
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++#define __BOOT_KERNEL_H_
++#include &quot;rhconfig.h&quot;
++int code = RED_HAT_LINUX_KERNEL;
++	]),
++        AC_MSG_RESULT(found); HAVE_REDHAT_KERNEL=true,
++        AC_MSG_RESULT(not found))
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++
++	dnl check for Red Hat define flags to use - see /sbin/mkkerneldoth
++
++	dnl initialize the booleans we want to detect
++	ENTERPRISE='0'
++	SMP='0'
++	UP='0'
++	BIGMEM='0'
++	HUGEMEM='0'
++
++	dnl get variables from the currently running kernel as default 
++	KERNEL_TYPE=`uname -r | sed 's_^.*\(smp\|enterprise\|bigmem\|hugemem\)$_\1_;t;s_.*__;'`
++	KERNEL_RELEASE=`uname -r | sed 's|smp\|enterprise\|bigmem\|hugemem||g'`
++	KERNEL_ARCH=`uname -m`
++
++	dnl check the config file and override KERNEL_ARCH
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M386, KERNEL_ARCH=i386)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M586, KERNEL_ARCH=i586)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M686, KERNEL_ARCH=i686)
++	dnl for some reason the i686 bigmem config file has PENTIUM
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MPENTIUMIII, KERNEL_ARCH=i686)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MK7, KERNEL_ARCH=athlon)
++
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, KERNEL_TYPE=smp)
++	dnl bigmem is also smp, so this check is done after smp to override
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_HIGHMEM64G, KERNEL_TYPE=bigmem)
++
++	dnl FIXME: need to check hugemem and enterprise config files, which
++	dnl aren't provided in Fedora Core 1 !
++
++	case &quot;$KERNEL_TYPE&quot; in
++		smp) SMP='1';;
++		enterprise) ENTERPRISE='1';;
++		bigmem) BIGMEM='1';;
++		hugemem) HUGEMEM='1';;
++		*) UP='1';;
++	esac
++	REDHAT_CFLAGS=&quot;-D__BOOT_KERNEL_H_ -D__MODULE_KERNEL_$KERNEL_ARCH=1&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_ENTERPRISE=$ENTERPRISE&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_UP=$UP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_SMP=$SMP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_BIGMEM=$BIGMEM&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_HUGEMEM=$HUGEMEM&quot;
++
++	LINUX_REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS&quot;
++
++	AC_SUBST(LINUX_KERNEL_TYPE, &quot;$KERNEL_TYPE&quot;)
++])
++
++dnl check if we're building on SMP
++dnl set LINUX_SMP to yes if we are
++AC_DEFUN([AS_CHECK_SMP],
++[
++	LINUX_SMP=&quot;no&quot;
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, LINUX_SMP=&quot;yes&quot;)
++	AC_SUBST(LINUX_SMP)
++])
++
++dnl add an argument to specify/override the module install path
++dnl if nothing specified, it will be /lib/modules/(kernelrel)
++AC_DEFUN([AS_LINUX_MODULESDIR],
++[
++	KERNEL_RELEASE=[$1]
++	AC_ARG_WITH([modulesdir],
++		[AC_HELP_STRING([--with-modulesdir=DIR],
++			[specify path to kernel-specific modules install directory])],
++		[MODULESDIR=&quot;${withval}&quot;],
++		[MODULESDIR=default])
++
++	if test &quot;${MODULESDIR}&quot; = &quot;default&quot; ; then
++		MODULESDIR=&quot;/lib/modules/${KERNEL_RELEASE}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdir, $MODULESDIR)
++	AC_MSG_NOTICE([Putting kernel modules under ${MODULESDIR}])
++])
++
++dnl add an argument to specify/override the module devel install path
++dnl if nothing specified, it will be the passed in LINUXDIR)
++AC_DEFUN([AS_LINUX_MODULESDEVELDIR],
++[
++	LINUXDIR=[$1]
++	AC_ARG_WITH([modulesdeveldir],
++		[AC_HELP_STRING([--with-modulesdeveldir=DIR],
++			[specify path to kernel-specific module development install directory])],
++		[MODULESDEVELDIR=&quot;${withval}&quot;],
++		[MODULESDEVELDIR=default])
++
++	if test &quot;${MODULESDEVELDIR}&quot; = &quot;default&quot; ; then
++		MODULESDEVELDIR=&quot;${LINUXDIR}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdeveldir, $MODULESDEVELDIR)
++	AC_MSG_NOTICE([Putting kernel module development files under ${MODULESDEVELDIR}])
++])
++
++AC_DEFUN([AS_LINUX_2_6],
++[
++	AC_MSG_CHECKING(for Linux CFLAGS)
++
++	{
++	  tmpdir=`(umask 077 &amp;&amp; mktemp -d -q &quot;./confstatXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
++	  test -n &quot;$tmpdir&quot; &amp;&amp; test -d &quot;$tmpdir&quot;
++	} ||
++	{
++	  tmpdir=./confstat$$-$RANDOM
++	  (umask 077 &amp;&amp; mkdir $tmpdir)
++	} ||
++	{
++	  echo &quot;$me: cannot create a temporary directory in .&quot; &gt;&amp;2
++	  { (exit 1); exit 1; }
++	}
++
++	tmpdir=`pwd`/$tmpdir
++
++	cat &gt;${tmpdir}/Makefile &lt;&lt;EOF
++obj-m += fake.o
++
++\$(obj)/fake.c: flags
++	touch \$(obj)/fake.c
++
++.PHONY: flags
++flags:
++	echo LINUX_ARCH=\&quot;\$(ARCH)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's,include,&quot;\$(LINUXDIR)/include&quot;,g'&gt;&gt;\$(obj)/flags
++	echo LINUX_LDFLAGS=\&quot;\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS=\&quot;\$(CFLAGS) \$(CPPFLAGS)\&quot; | sed 's,Iinclude,I\$(LINUXDIR)/include,g' &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS_MODULE=\&quot;\$(CFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CC=\&quot;\$(CC)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS) \$(LDFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AS=\&quot;\$(AS)\&quot; &gt;&gt;\$(obj)/flags
++EOF
++
++	echo ${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	. ${tmpdir}/flags
++	rm -rf ${tmpdir}
++
++	LINUX_MODULE_EXT=&quot;.ko&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_CFLAGS_MODULE&quot;
++	LINUX_MODPOST=&quot;$LINUX_DIR/scripts/modpost&quot;
++
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++	AC_SUBST(LINUX_MODPOST)
++
++	AC_MSG_RESULT([$LINUX_CFLAGS])
++])
++
++dnl checks kernel's Makefile for make variables for Linux 2.4
++dnl adds LINUX_REDHAT_CFLAGS if non-empty
++AC_DEFUN([AS_LINUX_2_4],
++[
++	AC_MSG_CHECKING(for Linux 2.4 make flags)
++	dnl we try to figure out the CFLAGS by invoking the Makefile on
++        dnl a test dir
++        dnl we use the correct config file by substituting the MAKEFILES
++        dnl Makefile variable, which originally points to .config
++
++	if [[ ! -e &quot;${LINUX_DIR}/.hdepend&quot; ]];then
++		AC_MSG_ERROR([
++You need to run 'make dep' on the kernel source before continuing.])
++	fi
++
++        if test &quot;x$LINUX_EXTRAVERSION&quot; == &quot;x&quot;; then
++          EX=
++        else
++          EX=&quot;EXTRAVERSION=$LINUX_EXTRAVERSION&quot;
++        fi
++
++        POPDIR=`(pwd)`
++        cd ${LINUX_DIR}
++        TMPFILE=`mktemp /tmp/linux.XXXXXXXX` || exit 1
++	# combine the kernel's Makefile,
++	# sedded to use our proposed config file,
++	# sedded to use our proposed machine value,
++	# with the extra target we add here, to get cflags
++	# we do not want entering/leaving info on distcheck so we run with -s
++	( cat Makefile | sed &quot;s|\.config|${LINUX_CONFIG}|g&quot; | sed &quot;s|shell uname -m|shell echo ${LINUX_MACHINE}|g&quot; &amp;&amp; cat &lt;&lt;EOF ) | make -s -f - get_cflags $EX &gt; ${TMPFILE}
++get_cflags:
++	@echo LINUX_ARCH=\&quot;\$(ARCH)\&quot;
++	@echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_LDFLAGS=\&quot;\&quot;
++	@echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot;
++	@echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot;
++	@echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot;
++	@echo LINUX_CFLAGS=\&quot;\$(CFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_MODFLAGS=\&quot;\$(MODFLAGS)\&quot;
++	@echo LINUX_CC=\&quot;\$(CC)\&quot;
++	@echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS)\&quot;
++	@echo LINUX_AS=\&quot;\$(AS)\&quot;
++EOF
++        . ${TMPFILE}
++        rm -rf ${TMPFILE}
++        cd $POPDIR
++
++        LINUX_MODULE_EXT=&quot;.o&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_MODFLAGS&quot;
++
++	dnl if we have REDHAT_CFLAGS, put them in LINUX_CFLAGS
++	if test &quot;x$REDHAT_CFLAGS&quot; != &quot;x&quot;;
++	then
++		LINUX_CFLAGS=&quot;$LINUX_CFLAGS $REDHAT_CFLAGS&quot;
++	fi
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++
++	AC_MSG_RESULT([ok])
++
++	AC_MSG_CHECKING(for Linux 2.4 CFLAGS)
++	AC_MSG_RESULT($LINUX_CFLAGS)
++	AC_MSG_CHECKING(for Linux 2.4 LDFLAGS)
++	AC_MSG_RESULT($LINUX_LDFLAGS)
++])
++
++AC_DEFUN([AS_CHECK_LINUX_CONFIG_OPTION],
++[
++	AC_MSG_CHECKING([Linux config option $1])
++
++	if grep '^$1=y$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=yes
++		$2
++	else if grep '^$1=m$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=module
++		$3
++	else
++		result=no
++		$4
++	fi
++	fi
++
++	AC_MSG_RESULT([$result])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION_MODULE],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes -o &quot;${$1}&quot; = module])
++])
++
++dnl check for the major/minor version of the Linux source by checking
++dnl the headers
++dnl first argument is the linux directory
++dnl sets LINUX_VERSION_MAJOR and LINUX_VERSION_MINOR
++AC_DEFUN([AS_LINUX_VERSION_MAJOR_MINOR],
++[
++	LINUX_DIR=[$1]
++	AC_MSG_CHECKING([Linux major/minor version])
++
++	if [[ ! -f &quot;${LINUX_DIR}/include/linux/version.h&quot; ]];then
++		AC_MSG_ERROR([The header file include/linux/version.h does not exist.
++For 2.6 kernels, it can be generated by running 'make prepare' in
++the kernel source directory.])
++	fi
++        dnl the next set of tests is for figuring out version major/minor
++        dnl we make sure we have the right version.h by faking out CFLAGS
++	dnl since we want to avoid including linux/version.h and acidentally
++	dnl pick up /usr/include/linux
++	dnl we still add ${LINUX_DIR}/include so the Red Hat version can pick
++	dnl up linux/rhversion.h
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux -I${LINUX_DIR}/include&quot;
++        dnl make sure we find version.h and it contains LINUX_VERSION_CODE
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++int code = LINUX_VERSION_CODE;
++]),
++ :, AC_MSG_ERROR([${LINUX_DIR}/include/linux/version.h does not contain LINUX_VERSION_CODE]))
++
++
++        dnl figure out the linux kernel version major and minor
++        dnl using the LINUX_VERSION_CODE defined in include/linux/version.h
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MAJOR(code) ((code) &gt;&gt; 16)
++],[
++  return KERNEL_VERSION_MAJOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MAJOR=0, 
++		LINUX_VERSION_MAJOR=$?)
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MINOR(code) (((code) &gt;&gt; 8) % (2 &lt;&lt; 8))
++],[
++  return KERNEL_VERSION_MINOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MINOR=0, 
++		LINUX_VERSION_MINOR=$?)
++        AC_MSG_RESULT($LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR)
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++])
+Index: kernel-module-hostap/hostap-driver-0.1.3/m4/as-modtool.m4
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/m4/as-modtool.m4	2004-05-22 23:12:38.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/m4/as-modtool.m4	2004-06-03 18:40:41.858929000 +0200
+@@ -0,0 +1,147 @@
++dnl as-modtool.m4 0.0.1
++dnl autostars m4 macro for building modtool, a linker for Linux kernel
++dnl modules
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-modtool.m4,v 1.12 2004/06/03 15:20:11 thomasvs Exp $
++
++dnl AS_LINUX_MODTOOL()
++dnl
++dnl this macro defines:
++dnl moduledir
++dnl modulePROGRAMS_INSTALL
++dnl modulePROGRAMS_UNINSTALL
++dnl
++dnl End of search list.
++
++dnl
++dnl FIXME:
++dnl  How do you specify that the building of modtool should go to the
++dnl  end of the configure script?
++dnl
++
++dnl SYMVERS_INCLUDES can be used to add additional .symvers files to the
++dnl modpost step
++
++AC_DEFUN([AS_LINUX_MODTOOL],
++[
++	AC_PATH_PROG(STRIP, strip)
++	AC_PATH_PROG([DEPMOD], [depmod], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++	AC_PATH_PROG([GENKSYMS], [genksyms], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++
++	if test &quot;x$LINUX_SMP&quot; = &quot;xyes&quot;
++	then
++		GENKSYMS=&quot;$GENKSYMS -p smp_&quot;
++	fi
++	dnl this can be overridden in Makefile.am
++	dnl FIXME: it'd be nice if we could specify different target_PROGRAMS
++	dnl and different targetdir
++	moduledir=&quot;\$(modulesdir)/\$(PACKAGE)&quot;
++	modulePROGRAMS_INSTALL=&quot;\$(top_builddir)/modtool --install&quot;
++	modulePROGRAMS_UNINSTALL=&quot;\$(top_builddir)/modtool --uninstall&quot;
++	AC_SUBST(moduledir)
++	AC_SUBST(modulePROGRAMS_INSTALL)
++
++	LINUX_VERSION=`echo $LINUX_KERNELRELEASE | cut -d- -f1`
++
++	AC_MSG_NOTICE(creating modtool)
++	cat &gt;modtool &lt;&lt;EOF
++#!/bin/sh
++
++set -e
++
++LINUX_LD=&quot;$LINUX_LD&quot;
++LINUX_MODPOST=&quot;$LINUX_MODPOST&quot;
++LINUX_VERSION=&quot;$LINUX_VERSION&quot;
++GENKSYMS=&quot;$GENKSYMS&quot;
++CC=&quot;$LINUX_CC&quot;
++INSTALL=&quot;$INSTALL&quot;
++LINUX_MODULE_EXT=&quot;$LINUX_MODULE_EXT&quot;
++STRIP=&quot;$STRIP&quot;
++CFLAGS=&quot;$CFLAGS $LINUX_CFLAGS&quot;
++LINUX_DIR=&quot;$LINUX_DIR&quot;
++
++mode=\$[1]
++shift
++
++case \$mode in
++--link)
++	# we accept -i (symvers) and -o (target) as options
++	# at least -o (target) needs to be specified
++	SYMVERS_INCLUDES=&quot;&quot;
++	done=false
++	while test ! -z &quot;\$[0]&quot; -a &quot;\$done&quot; = &quot;false&quot;
++	do
++		case \$[1] in
++		-i)
++                        SYMVERS_INCLUDES=&quot;\$SYMVERS_INCLUDES \$[2]&quot;
++                        shift 2
++                        ;;
++                -o)
++                        target=\$(echo \$[2] | sed s/.ko$//)
++                        shift 2
++                        ;;
++                *)
++                        done=true
++                        ;;
++                esac
++        done
++
++	mkdir -p .mods
++	if test &quot;\$LINUX_MODULE_EXT&quot; = .ko ; then
++
++		\$LINUX_LD -r -o .mods/\$target.o \$[*]
++
++		cat \$LINUX_DIR/Module.symvers \$SYMVERS_INCLUDES &gt;.mods/symvers.tmp
++
++		\$LINUX_MODPOST -o .mods/\$target.o.symvers.tmp -i .mods/symvers.tmp .mods/\$target.o
++
++		grep .mods/\$target .mods/\$target.o.symvers.tmp &gt;.mods/\$target.o.symvers || true
++
++		rm -f .mods/\$target.o.symvers.tmp .mods/symvers.tmp
++		
++		\$CC \$CFLAGS -DKBUILD_MODNAME=\$target -c -o .mods/\$target.mod.o .mods/\$target.mod.c
++
++		\$LINUX_LD -r -o \$target.ko .mods/\$target.mod.o .mods/\$target.o
++		set +x
++	else
++		echo \$LINUX_LD -r -o \$target.ko \$[*]
++		\$LINUX_LD -r -o \$target.ko \$[*]
++                                                                      
++		if test &quot;x\$SOURCES&quot; != &quot;x&quot;
++		then
++			echo &quot;\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver&quot;
++			\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver
++		fi
++
++	fi
++
++	;;
++--install)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo \$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$STRIP -g &quot;\$module_dest&quot;
++	;;
++--uninstall)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo uninstall &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	rm -f &quot;\$module_dest&quot;
++	;;
++*)
++	echo Unknown mode \$mode &gt;&amp;2
++	exit 1
++esac
++
++EOF
++	chmod +x modtool
++
++
++])
++
++
+Index: kernel-module-hostap/hostap-driver-0.1.3/Makefile.am
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/Makefile.am	2004-05-22 23:12:46.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/Makefile.am	2004-05-22 23:13:27.000000000 +0200
+@@ -0,0 +1,5 @@
++SUBDIRS = driver
++
++DISTCHECK_CONFIGURE_FLAGS = --with-modulesdir=`mktemp -d` --with-modulesdeveldir=`mktemp -d`
++
++DISTCLEANFILES = modtool
+Index: kernel-module-hostap/hostap-driver-0.1.3/driver/Makefile.am
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/driver/Makefile.am	2004-05-22 23:12:50.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/driver/Makefile.am	2004-05-22 23:13:27.000000000 +0200
+@@ -0,0 +1 @@
++SUBDIRS = modules etc
+Index: kernel-module-hostap/hostap-driver-0.1.3/driver/modules/Makefile.am
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/driver/modules/Makefile.am	2004-05-22 23:12:55.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/driver/modules/Makefile.am	2004-06-03 18:31:35.656964528 +0200
+@@ -0,0 +1,57 @@
++moduledir = $(modulesdir)/kernel/drivers/net/wireless
++module_PROGRAMS = hostap.ko hostap_cs.ko hostap_crypt_wep.ko hostap_pci.ko hostap_plx.ko
++
++hostapincludedir = $(modulesdeveldir)/include/modules/hostap
++hostapinclude_HEADERS = hostap_crypt.h
++
++# for 2.6, install the .symvers files
++if SYMVERS_MODE
++symversdir = $(modulesdeveldir)
++symvers_DATA = \
++	.mods/hostap.o.symvers \
++	.mods/hostap_crypt_wep.o.symvers \
++	.mods/hostap_cs.o.symvers \
++	.mods/hostap_pci.o.symvers \
++	.mods/hostap_plx.o.symvers
++else
++verdir = $(modulesdeveldir)/include/linux/modules
++ver_DATA = .mods/hostap.ver
++endif
++
++# some .c files are currently #include'd
++# when that changes, add them to _SOURCES instead
++noinst_HEADERS = \
++	hostap_ap.c hostap_info.c hostap_ioctl.c hostap_proc.c \
++	hostap_crypt.c hostap_80211_rx.c \
++	hostap_hw.c \
++	hostap_80211.h hostap_common.h hostap_config.h \
++	hostap.h hostap_wlan.h hostap_ap.h hostap_compat.h  \
++	hostap_wext.h
++
++hostap_ko_SOURCES = \
++	hostap.c
++hostap_ko_CFLAGS = $(LINUX_CFLAGS)
++hostap_ko_LINK = SOURCES=$(hostap_ko_SOURCES) $(top_builddir)/modtool --link -o $@
++
++hostap_cs_ko_SOURCES = \
++	hostap_cs.c
++hostap_cs_ko_CFLAGS = $(LINUX_CFLAGS)
++hostap_cs_ko_LINK = $(top_builddir)/modtool --link -i .mods/hostap.o.symvers -o $@
++
++hostap_crypt_wep_ko_SOURCES = \
++	hostap_crypt_wep.c
++hostap_crypt_wep_ko_CFLAGS = $(LINUX_CFLAGS)
++hostap_crypt_wep_ko_LINK = $(top_builddir)/modtool --link -o $@
++
++hostap_pci_ko_SOURCES = \
++	hostap_pci.c
++hostap_pci_ko_CFLAGS = $(LINUX_CFLAGS)
++hostap_pci_ko_LINK = $(top_builddir)/modtool --link -i .mods/hostap.o.symvers -o $@
++
++hostap_plx_ko_SOURCES = \
++	hostap_plx.c
++hostap_plx_ko_CFLAGS = $(LINUX_CFLAGS)
++hostap_plx_ko_LINK = $(top_builddir)/modtool --link -i .mods/hostap.o.symvers -o $@
++
++distclean-local:
++	-rm -rf .mods
+Index: kernel-module-hostap/hostap-driver-0.1.3/driver/etc/modules/Makefile.am
+Index: kernel-module-hostap/hostap-driver-0.1.3/driver/etc/Makefile.am
+--- kernel-module-hostap~autotools.0.1.3/hostap-driver-0.1.3/driver/etc/Makefile.am	2004-05-22 23:39:36.000000000 +0200
++++ kernel-module-hostap/hostap-driver-0.1.3/driver/etc/Makefile.am	2004-05-22 23:13:27.000000000 +0200
+@@ -0,0 +1,4 @@
++confdir = $(sysconfdir)/pcmcia
++conf_DATA = hostap_cs.conf
++
++EXTRA_DIST = $(conf_DATA)

Added: trunk/rpms/kernel-module-hostap/hostap-compat.patch
===================================================================
--- trunk/rpms/kernel-module-hostap/hostap-compat.patch	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-hostap/hostap-compat.patch	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,11 @@
+--- hostap-driver-0.1.2/driver/modules/hostap_compat.h.orig	2003-10-11 12:11:56.000000000 -0500
++++ hostap-driver-0.1.2/driver/modules/hostap_compat.h	2003-11-17 15:36:03.000000000 -0600
+@@ -175,7 +175,7 @@
+ #endif /* WIRELESS_EXT &gt; 12 */
+ 
+ 
+-#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,23))
++#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,22))
+ struct net_device;
+ static inline void free_netdev(struct net_device *dev)
+ {

Added: trunk/rpms/kernel-module-hostap/hostap-download.patch
===================================================================
--- trunk/rpms/kernel-module-hostap/hostap-download.patch	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-hostap/hostap-download.patch	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,19 @@
+--- hostap-driver-0.1.2/driver/modules/hostap_config.h.orig	2003-11-02 21:40:26.000000000 -0600
++++ hostap-driver-0.1.2/driver/modules/hostap_config.h	2003-11-17 16:31:34.000000000 -0600
+@@ -47,6 +47,7 @@
+ #define PRISM2_DOWNLOAD_SUPPORT
+ #endif
+ 
++#define PRISM2_DOWNLOAD_SUPPORT
+ #ifdef PRISM2_DOWNLOAD_SUPPORT
+ /* Allow writing firmware images into flash, i.e., to non-volatile storage.
+  * Before you enable this option, you should make absolutely sure that you are
+@@ -54,7 +55,7 @@
+  * In addition, please note that it is possible to kill your card with
+  * non-volatile download if you are using incorrect image. This feature has not
+  * been fully tested, so please be careful with it. */
+-/* #define PRISM2_NON_VOLATILE_DOWNLOAD */
++#define PRISM2_NON_VOLATILE_DOWNLOAD
+ #endif /* PRISM2_DOWNLOAD_SUPPORT */
+ 
+ /* Include wireless extensions sub-ioctl support even if wireless extensions

Added: trunk/rpms/kernel-module-hostap/hostap-makefile.patch
===================================================================
--- trunk/rpms/kernel-module-hostap/hostap-makefile.patch	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-hostap/hostap-makefile.patch	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,46 @@
+--- Makefile.orig	2003-08-03 13:50:09.000000000 -0500
++++ Makefile	2003-10-30 17:25:32.000000000 -0600
+@@ -17,7 +17,9 @@
+ CC=gcc
+ CFLAGS=-O2 -D__KERNEL__ -DMODULE -Wall -g -c $(EXTRA_CFLAGS)
+ 
+-include $(KERNEL_PATH)/.config
++KERNEL_CONFIG=$(KERNEL_PATH)/.config
++
++include $(KERNEL_CONFIG)
+ 
+ INCLUDES=-I$(KERNEL_PATH)/include
+ ifdef PCMCIA_PATH
+@@ -217,12 +219,14 @@
+ 	@if [ -r $(MODPATH)/kernel/drivers/net/wireless/hostap_crypt.ko ]; then \
+ 		echo &quot;You may need to remove old $(MODPATH)/kernel/drivers/net/wireless/hostap_crypt.ko&quot;; \
+ 	fi
++ifndef DESTDIR
+ 	@if [ -f &quot;/boot/System.map-$(KERNELRELEASE)&quot; ] || [ &quot;$(CURRENTKV)&quot; = &quot;$(KERNELRELEASE)&quot; ]; then \
+ 		echo &quot;*** Running depmod...&quot;; \
+ 		/sbin/depmod -ae; \
+ 	else \
+ 		echo &quot;*** I won't run depmod because I can't find an appropriate System.map file or you are not running the same kernel as the one you are building against. Please run it manually when the conditions are correct...&quot;; \
+ 	fi
++endif
+ 
+ install_hostap: $(MSRC)/hostap.o
+ 	@echo &quot;Installing hostap.o to $(MODPATH_PCI)&quot;
+@@ -258,13 +262,17 @@
+ 	@echo &quot;Installing $(MODULE_PLX) to $(MODPATH_PLX)&quot;
+ 	mkdir -p $(MODPATH_PLX)
+ 	cp -f $(MSRC)/$(MODULE_PLX) $(MODPATH_PLX)
++ifndef DESTDIR
+ 	/sbin/depmod -ae
++endif
+ 
+ install_pci: install_check install_crypt install_hostap
+ 	@echo &quot;Installing $(MODULE_PCI) to $(MODPATH_PCI)&quot;
+ 	mkdir -p $(MODPATH_PCI)
+ 	cp -f $(MSRC)/$(MODULE_PCI) $(MODPATH_PCI)
++ifndef DESTDIR
+ 	/sbin/depmod -ae
++endif
+ 
+ uninstall:
+ 	find $(MODPATH) -name &quot;hostap*&quot; | xargs rm -f

Added: trunk/rpms/kernel-module-hostap/kernel-module-hostap.spec
===================================================================
--- trunk/rpms/kernel-module-hostap/kernel-module-hostap.spec	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-hostap/kernel-module-hostap.spec	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,250 @@
+# $Id$
+# Authority: matthias
+
+# What kernel are we building for?
+%{!?kernel: %define kernel %(uname -r)}
+# Get the correct kernel package release by stripping kernel modifiers
+%define krel %(echo %{kernel} | sed -e s/smp//g -)
+# Get a type modifier for the kernel, (null) or -smp
+%if %(echo %{kernel} | grep -c smp)
+    %{expand:%%define ktype -smp}
+%else
+    %define ktype %{nil}
+%endif
+
+# What kernel &quot;flavor&quot; are we building for ?
+%{expand:%%define post26 %(echo %{kernel} | grep &quot;^2\.[0-4]\.&quot; &gt;/dev/null &amp;&amp; echo 0 || echo 1)}
+
+# Don't build debuginfo packages for kernel modules
+%define debug_package %{nil}
+
+# Don't have build fail when i386 modules aren't packaged
+%define _unpackaged_files_terminate_build 0
+
+# Where the kernel build tree lives for post 2.6
+%define basedeveldir %{_libdir}/kernel-module-devel-%{krel}
+                                                                                
+
+Summary: Driver for Intersil Prism2/2.5/3 802.11b wireless cards
+Name: kernel-module-hostap
+Version: 0.1.3
+Release: 0
+License: GPL
+Group: System Environment/Kernel
+URL: <A HREF="http://hostap.epitest.fi/">http://hostap.epitest.fi/</A>
+Source: <A HREF="http://hostap.epitest.fi/releases/hostap-driver-%{version">http://hostap.epitest.fi/releases/hostap-driver-%{version</A>}.tar.gz
+Patch0: hostap-makefile.patch
+Patch1: hostap-compat.patch
+Patch2: hostap-download.patch
+Patch3: hostap-autotools.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+%if %{post26}
+BuildRequires: kernel-module-devel-%{krel}
+%else
+BuildRequires: kernel-source = %{krel}
+%endif
+BuildRequires: autoconf, automake
+
+%description
+This is a Linux driver for wireless LAN cards based on Intersil's
+Prism2/2.5/3 chipset. The driver supports a so called Host AP mode, i.e.,
+it takes care of IEEE 802.11 management functions in the host computer and
+acts as an access point. This does not require any special firmware for the
+wireless LAN card. In addition to this, it has support for normal station
+operations in BSS and possible also in IBSS.
+
+To rebuild this package you should use :
+--define &quot;kernel &lt;uname -r output&gt;&quot;
+--target &lt;arch&gt;
+
+Available rpmbuild rebuild options :
+--without : download (build the driver without firmware download support)
+
+
+%package devel-%{krel}
+Summary: Headers and symbol versions for hostap 
+Group: Development/System
+Provides: %{name} = %{version}-%{release}
+%if %{post26}
+Requires: kernel-module-devel-%{krel}
+%endif
+
+%description devel-%{krel}
+This is a Linux driver for wireless LAN cards based on Intersil's
+Prism2/2.5/3 chipset. The driver supports a so called Host AP mode, i.e.,
+it takes care of IEEE 802.11 management functions in the host computer and
+acts as an access point. This does not require any special firmware for the
+wireless LAN card. In addition to this, it has support for normal station
+operations in BSS and possible also in IBSS.
+
+This package contains headers and symbol versions for all archs and types
+of kernel.
+
+
+%package %{kernel}
+Summary: Driver for Intersil Prism2/2.5/3 802.11b wireless cards
+Group: System Environment/Kernel
+Provides: %{name} = %{version}-%{release}, kernel-module
+Requires(post): modutils
+Requires(postun): modutils
+Requires: /boot/vmlinuz-%{kernel}
+
+%description %{kernel}
+This is a Linux driver for wireless LAN cards based on Intersil's
+Prism2/2.5/3 chipset. The driver supports a so called Host AP mode, i.e.,
+it takes care of IEEE 802.11 management functions in the host computer and
+acts as an access point. This does not require any special firmware for the
+wireless LAN card. In addition to this, it has support for normal station
+operations in BSS and possible also in IBSS.
+
+
+%prep
+%setup -q -n hostap-driver-%{version}
+%patch0 -p0
+%patch1 -p1
+%{!?_without_download:%patch2 -p1}
+%patch3 -p2
+
+
+%if %{post26}
+
+# if &quot;lowest&quot; arch (i.e. i386), build enough times to get all devel stuff
+# if &quot;higher&quot; arch (i.e. i586/i686), just build the module
+%build
+# All build is actually done in install
+
+
+%install
+%{__rm} -rf %{buildroot}
+echo &quot;Post 2.6 build, devel package&quot;
+%ifarch i386
+    %define types &quot;&quot; &quot;-smp&quot;
+    # i386 is last in order to leave the correct files around
+    %define targets i686 i586
+%else
+    %define types &quot;&quot;
+    %define targets %{_target_cpu}
+%endif
+# Build and install as many times as necessary to get all development files
+sh autogen.sh || true
+for type in %{types}
+do 
+    for target in %{targets}
+    do
+        %define develdir %{basedeveldir}/kernel${type}-%{krel}.${target}.rpm
+        %configure --with-linuxdir=&quot;%{develdir}&quot;
+        %{__make} clean
+        %{__make} %{?_smp_mflags}
+        %makeinstall \
+            modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}&quot; \
+            modulesdeveldir=&quot;%{buildroot}%{develdir}&quot;
+  done
+done
+
+
+%else # if %{post26}
+
+%build
+echo &quot;Pre 2.6 build, kernel%{ktype}-%{krel}.%{_target_cpu} package&quot;
+%define develdir /usr/src/linux-%{krel}
+sh autogen.sh || true
+%configure \
+    --with-rpm-target=&quot;%{_target_cpu}&quot; \
+    --with-kernel-release=&quot;%{kernel}&quot; \
+    --with-linuxdir=&quot;%{develdir}&quot;
+%{__make} %{?_smp_mflags}
+
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall \
+    modulesdir=%{buildroot}/lib/modules/%{kernel} \
+    modulesdeveldir=%{buildroot}%{develdir}
+
+%endif # if %{post26}, else
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%post %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+%postun %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+
+# This devel package is only useful for post 2.6
+%if %{post26}
+# Only create devel package for &quot;lowest&quot; archs (i.e. i386 for x86), and make
+# it contain all possible devel files, so exclude &quot;high&quot; archs here
+%ifnarch i586 i686 athlon
+%files devel-%{krel}
+%defattr(-, root, root, 0755)
+%{basedeveldir}/*/*.symvers
+%dir %{basedeveldir}/*/include/modules/hostap
+%{basedeveldir}/*/include/modules/hostap/hostap_crypt.h
+%endif
+%endif
+
+%ifnarch i386
+%files %{kernel}
+%defattr(-, root, root, 0755)
+%doc ChangeLog COPYING README
+%verify(not mtime) %config /etc/pcmcia/hostap_cs.conf
+/lib/modules/%{kernel}/kernel/drivers/net/wireless/hostap*.*o
+# For pre 2.6, we include the .ver files in the devel package directly
+%if !%{post26}
+/usr/src/linux-%{krel}/include/linux/modules/hostap.ver
+/usr/src/linux-%{krel}/include/modules/hostap/hostap_crypt.h
+%endif
+%endif
+
+
+%changelog
+* Wed Jun 16 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.3-0
+- Fork off, yes, I'm nasty and selfish.
+- Changed most conditionals, the only remaining side-effect should be that
+  no i386 kernel module will be built for kernels &lt; 2.6.
+
+* Tue Jun 15 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.1.3-0.fdr.3: never fail on autogen
+
+* Thu Jun 03 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.1.3-0.fdr.2: integrated both pre and post 2.6 builds
+
+* Sat May 22 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.1.3-0.fdr.1: new upstream version
+
+* Sat May 22 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.1.2-0.fdr.6: use our patch system that works with linux 2.6
+
+* Sat Apr 17 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.1.2-0.fdr.5: package hostap.ver so packages can be rebuilt that need it
+
+* Wed Jan 14 2004 Steven Pritchard &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">steve at kspei.com</A>&gt; 0.1.2-0.fdr.4
+- Add &quot;--without download&quot; to the description
+
+* Sat Dec 20 2003 Ville Skytt&#228; &lt;ville.skytta at iki.fi&gt; - 0.1.2-0.fdr.3
+- Really honor --target.
+- New version of kmodhelper.
+
+* Sat Dec 20 2003 Ville Skytt&#228; &lt;ville.skytta at iki.fi&gt; - 0.1.2-0.fdr.2
+- Major specfile simplifications, no more hardcoded kernel variants.
+- Honor --target and kernel CC properly.
+- Run depmod only if installing/uninstalling modules for the running kernel.
+
+* Thu Nov 20 2003 Steven Pritchard &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">steve at kspei.com</A>&gt; 0.1.2-0.fdr.1
+- Second Fedora release candidate
+- Fixed to (hopefully) easily allow building for various kernels
+
+* Wed Nov 19 2003 Steven Pritchard &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">steve at kspei.com</A>&gt; 0.1.2-0.fdr.0.1
+- First Fedora release candidate
+
+* Mon Nov 17 2003 Steven Pritchard &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">steve at kspei.com</A>&gt; 0.1.2
+- Updated to 0.1.2
+
+* Thu Oct 30 2003 Steven Pritchard &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">steve at kspei.com</A>&gt; 0.1.1
+- Initial packaging
+


Property changes on: trunk/rpms/kernel-module-hostap/kernel-module-hostap.spec
___________________________________________________________________
Name: svn:keywords
   + Id HeadURL

Added: trunk/rpms/kernel-module-ipw2100/ipw2100.autotools.patch
===================================================================
--- trunk/rpms/kernel-module-ipw2100/ipw2100.autotools.patch	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-ipw2100/ipw2100.autotools.patch	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,1009 @@
+Index: kernel-module-ipw2100/ipw2100-0.45/configure.ac
+--- kernel-module-ipw2100~autotools.0.45/ipw2100-0.45/configure.ac	2004-05-22 13:40:37.000000000 +0200
++++ kernel-module-ipw2100/ipw2100-0.45/configure.ac	2004-05-22 15:32:23.000000000 +0200
+@@ -0,0 +1,63 @@
++AC_INIT(ipw2100_main.c)
++
++AM_INIT_AUTOMAKE(ipw2100, 0.40)
++dnl AM_CONFIG_HEADER(config.h)
++
++dnl pick up ACLOCAL flags
++ACLOCAL_AMFLAGS=&quot;\${ACLOCAL_FLAGS} -I m4&quot;
++AC_SUBST(ACLOCAL_AMFLAGS)
++
++dnl do all checks
++AS_LINUX
++
++dnl generate modtool
++AS_LINUX_MODTOOL
++
++dnl to do proper versioning, we need to know if we have pre-2.4 style
++dnl kernel or post-2.6
++AC_MSG_CHECKING([for correct way to include symbol versions])
++case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++  2.[[67]])
++    dnl we have to modtool include a .symvers symbol file
++    AC_MSG_RESULT([post-2.6 .symvers modtool include])
++    SYMVERS_MODE=&quot;symvers&quot;
++    ;;
++  2.[[01234]])
++    dnl we have to source include a .ver include file
++    AC_MSG_RESULT([pre-2.6 .ver compile include])
++    SYMVERS_MODE=&quot;ver&quot;
++    ;;
++  *)
++    AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++    ;;
++esac
++AM_CONDITIONAL(SYMVERS_MODE, [test &quot;$SYMVERS_MODE&quot; = &quot;symvers&quot;])
++
++dnl add a parameter to disable legacy loading of firmware
++AC_ARG_ENABLE(legacy-fw-load,
++  AC_HELP_STRING([--disable-legacy-fw-load],
++                 [disable loading of firmware the legacy way]),
++  LEGACY_FW_LOAD=$enableval, LEGACY_FW_LOAD=yes)
++if test &quot;x$LEGACY_FW_LOAD&quot; = &quot;xyes&quot;
++then
++  AC_MSG_NOTICE([Compiling with legacy firmware loading])
++else
++  AC_MSG_NOTICE([Compiling with hotplug firmware loading])
++fi
++AM_CONDITIONAL(LEGACY_FW_LOAD, test &quot;x$LEGACY_FW_LOAD&quot; = &quot;xyes&quot;)
++
++dnl add a parameter to disable WEP
++AC_ARG_ENABLE(wep,
++  AC_HELP_STRING([--disable-wep],
++                 [disable WEP support]),
++  WEP=$enableval, WEP=yes)
++if test &quot;x$WEP&quot; = &quot;xyes&quot;
++then
++  AC_MSG_NOTICE([Compiling with WEP support (which needs hostap)])
++  dnl FIXME: add a check for hostap.ver here ?
++else
++  AC_MSG_NOTICE([Compiling without WEP support])
++fi
++AM_CONDITIONAL(WEP, test &quot;x$WEP&quot; = &quot;xyes&quot;)
++
++AC_OUTPUT(Makefile)
+Index: kernel-module-ipw2100/ipw2100-0.45/autogen.sh
+--- kernel-module-ipw2100~autotools.0.45/ipw2100-0.45/autogen.sh	2004-05-22 13:40:41.000000000 +0200
++++ kernel-module-ipw2100/ipw2100-0.45/autogen.sh	2004-05-22 13:41:31.000000000 +0200
+@@ -0,0 +1,6 @@
++#!/bin/bash
++set -x
++aclocal -I m4 || exit 1
++autoconf || exit 1
++automake -a --foreign || exit 1
++./configure $@
+Index: kernel-module-ipw2100/ipw2100-0.45/Makefile.am
+--- kernel-module-ipw2100~autotools.0.45/ipw2100-0.45/Makefile.am	2004-05-22 13:40:44.000000000 +0200
++++ kernel-module-ipw2100/ipw2100-0.45/Makefile.am	2004-06-04 12:10:09.000000000 +0200
+@@ -0,0 +1,69 @@
++moduledir = $(modulesdir)/kernel/drivers/net/wireless
++module_PROGRAMS = ipw2100.ko
++                                                                                
++# check if we want legacy firmware loading
++if LEGACY_FW_LOAD
++LEGACY_FW_LOAD_CFLAGS = -DCONFIG_IPW2100_LEGACY_FW_LOAD
++else
++LEGACY_FW_LOAD_CFLAGS =
++endif
++
++# check if we want to disable WEP
++# FIXME: maybe we should also check if we're compiling with module versioning
++if WEP
++if SYMVERS_MODE
++# for post-2.6
++WEP_SYMVERSFLAGS = -i $(LINUX_DIR)/hostap.o.symvers
++WEP_CFLAGS =
++else
++# for 2.4
++WEP_SYMVERSFLAGS =
++WEP_CFLAGS = -include linux/modules/hostap.ver
++endif
++else
++WEP_CFLAGS = -DCONFIG_IPW2100_NOWEP
++WEP_SYMVERSFLAGS =
++endif
++
++ipw2100_ko_SOURCES = \
++        ipw2100_main.c \
++        ipw2100_fw.c \
++        ipw2100_wx.c \
++        ieee80211_tx.c \
++        ieee80211_rx.c \
++        ieee80211.c \
++        ieee80211_wx.c
++
++# we are building from this package and not included in kernel
++# we add an include path for builddir/include/modules/hostap
++# we also include the hostap version file since we use module versioning
++ipw2100_ko_CFLAGS = \
++  $(LINUX_CFLAGS) \
++  -I $(LINUX_DIR)/include/modules/hostap \
++  -DNOKERNEL \
++  $(LEGACY_FW_LOAD_CFLAGS) \
++  $(WEP_CFLAGS)
++ipw2100_ko_LINK = $(top_builddir)/modtool --link $(WEP_SYMVERSFLAGS) -o $@
++
++# FIXME: might be good to make hostap install the hostap_crypt header !
++noinst_HEADERS = \
++  ieee80211_crypt.h \
++  ieee80211.h \
++  ipw2100_fw.h \
++  ipw2100.h \
++  ipw2100_hw.h \
++  ipw2100_wx.h \
++  ipwversion.h
++
++EXTRA_DIST = \
++  m4/as-linux.m4 \
++  av5100.c \
++  ieee80211.c \
++  pbe5.c
++
++DISTCHECK_CONFIGURE_FLAGS = --with-modulesdir=`mktemp -d`
++
++DISTCLEANFILES = modtool
++
++distclean-local:
++	-rm -rf .mods
+Index: kernel-module-ipw2100/ipw2100-0.45/m4/as-linux.m4
+--- kernel-module-ipw2100~autotools.0.45/ipw2100-0.45/m4/as-linux.m4	2004-05-22 13:40:58.000000000 +0200
++++ kernel-module-ipw2100/ipw2100-0.45/m4/as-linux.m4	2004-06-04 11:31:16.000000000 +0200
+@@ -0,0 +1,704 @@
++dnl as-linux.m4 0.2.1
++
++dnl autostars m4 macro for detecting a Linux source tree (or
++dnl equivalent) for compiling modules.
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-linux.m4,v 1.18 2004/06/03 16:35:58 thomasvs Exp $
++
++dnl AS_LINUX()
++dnl
++dnl this macro adds the options
++dnl --with-linuxdir        to specify a kernel build tree location
++dnl --with-linuxconfig     to specify a kernel .config file
++dnl --with-kernel-release  to specify an alternative uname -r
++dnl --with-machine         to specify an alternative uname -m
++dnl --with-rpm-target      to specify to match the given rpm --target option
++dnl --with-extraversion    to specify an EXTRAVERSION override
++dnl --with-modulesdir      to specify the base install location of modules
++dnl --with-modulesdeveldir to specify the base install location of build stuff
++
++dnl this macro defines:
++dnl LINUX_DIR
++dnl   The directory where the Linux source resides.
++dnl CONFIG_FILE
++dnl   The Linux config file
++dnl LINUX_ARCH
++dnl   $(ARCH) in kernel Makefiles
++dnl LINUX_AFLAGS
++dnl   $(AFLAGS) in kernel Makefiles
++dnl LINUX_LDFLAGS
++dnl   Linker flags used by Linux
++dnl LINUX_ARFLAGS
++dnl   Archiver flags used by Linux
++dnl LINUX_CROSS_COMPILE
++dnl   Cross-compiler prefix, if any. (example: &quot;powerpc-linux-&quot;)
++dnl LINUX_KERNELRELEASE
++dnl   Kernel release name (2.4.5-pre4-ac5-rmk), $(KERNELRELEASE) in
++dnl   Linux Makefiles.
++dnl LINUX_CFLAGS
++dnl   CFLAGS used by Linux.  Includes both $CFLAGS and $MODFLAGS from
++dnl   kernel Makefiles. Also includes warnings and optimization.
++dnl LINUX_CC
++dnl   Compiler used by Linux.
++dnl LINUX_LD
++dnl   Path to linker (possibly with options) used by Linux.
++dnl LINUX_AS
++dnl   Assembler used by Linux.
++dnl LINUX_MODULE_EXT
++dnl   Module extension (.o or .ko)
++dnl LINUX_MODPOST
++dnl   path to modpost script
++dnl LINUX_SMP
++dnl   set to yes if the kernel is SMP
++dnl modulesdir
++dnl   base install path for kernel modules
++dnl modulesdeveldir
++dnl   base install path for kernel module development files
++dnl 
++dnl End of search list.
++
++dnl main entry point
++dnl checks the version, and figures out all flags to use to make modules.
++AC_DEFUN([AS_LINUX],
++[
++	dnl check if user supplied a uname -r, and if not use the running one
++	AS_LINUX_KERNEL_RELEASE()
++	dnl check if user supplied a uname -m, and if not use the running one
++	AS_LINUX_MACHINE() 	 
++	dnl check if the user supplied an rpm target arch
++	dnl override the LINUX_MACHINE value if he did
++	AS_LINUX_RPM_TARGET($LINUX_KERNEL_RELEASE) 	 
++  	 
++	dnl find the kernel source tree for the given uname -r 	 
++	AS_LINUX_DIR($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied an EXTRAVERSION, and if not get from uname -r
++	AS_LINUX_EXTRAVERSION($LINUX_KERNEL_RELEASE) 	 
++	dnl check if user supplied a config file; if not, guess a good one
++	AS_LINUX_CONFIG($LINUX_DIR, $LINUX_KERNEL_RELEASE, $LINUX_MACHINE) 	 
++	dnl check if we're building on pre-FC2 Red Hat/Fedora,
++	dnl and add some flags if we are 	 
++	AS_CHECK_REDHAT_PRE_FC2() 	 
++	dnl check if we're building SMP, and set LINUX_SMP if we are
++	AS_CHECK_SMP()
++	dnl check for where to install modules
++	AS_LINUX_MODULESDIR($LINUX_KERNEL_RELEASE)
++	dnl check for where to install module development files
++	AS_LINUX_MODULESDEVELDIR($LINUX_DIR)
++	dnl check for the MAJOR/MINOR version of Linux 	 
++	AS_LINUX_VERSION_MAJOR_MINOR($LINUX_DIR)
++
++	dnl now call the correct macro to get compiler flags
++	dnl the versioned AS_LINUX macros just use the global variables
++	dnl this could be cleaned up later on if we feel like it
++	case $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR in
++		2.6)
++			AS_LINUX_2_6()
++			;;
++		2.[[01234]])
++			AS_LINUX_2_4()
++			;;
++		*)
++			AC_MSG_ERROR([Unknown Linux major.minor $LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR])
++			;;
++	esac
++])
++
++
++dnl check if we can find a source dir for the Linux kernel
++dnl defines LINUX_DIR to the absolute location of a usable kernel source tree
++AC_DEFUN([AS_LINUX_DIR],
++[
++	AC_ARG_WITH([linuxdir],
++		[AC_HELP_STRING([--with-linuxdir=DIR],
++			[specify path to Linux source directory])],
++		[LINUX_DIR=&quot;${withval}&quot;],
++		[LINUX_DIR=default])
++
++	if test &quot;${LINUX_DIR}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_DIR([${LINUX_DIR}], , AC_MSG_ERROR([Linux dir not found]) )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/lib/modules/`uname -r`/build&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;../linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		dir=&quot;/usr/src/linux&quot;;
++		AS_TRY_LINUX_DIR([${dir}], [LINUX_DIR=${dir}], )
++	fi
++
++	if test &quot;${LINUX_DIR}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([Linux source directory not found])
++	fi
++
++	AC_SUBST(LINUX_DIR)
++])
++
++dnl check if the given candidate path for a linux source tree is usable
++AC_DEFUN([AS_TRY_LINUX_DIR],
++	[AC_MSG_CHECKING(for Linux in $1)
++
++	if test -f &quot;$1/Makefile&quot; ; then
++		result=yes
++		$2
++	else
++		result=&quot;not found&quot;
++		$3
++	fi
++
++	AC_MSG_RESULT($result)
++])
++
++dnl allow for specifying a kernel release (uname -r) to build for
++dnl use uname -r of running one if not specified
++dnl store result in LINUX_KERNEL_RELEASE
++AC_DEFUN([AS_LINUX_KERNEL_RELEASE],
++[
++	AC_ARG_WITH([kernel-release],
++		[AC_HELP_STRING([--with-kernel-release=RELEASE],
++			[specify the &quot;uname -r&quot;-value to build for])],
++		[LINUX_KERNEL_RELEASE=&quot;${withval}&quot;],
++		[LINUX_KERNEL_RELEASE=`uname -r`])
++        if test &quot;x$LINUX_KERNEL_RELEASE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_KERNEL_RELEASE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_KERNEL_RELEASE as the uname -r value])
++])
++
++dnl allow for specifying a machine (uname -m) to build for
++dnl use uname -, of running one if not specified
++dnl store result in LINUX_MACHINE
++AC_DEFUN([AS_LINUX_MACHINE],
++[
++	AC_ARG_WITH([machine],
++		[AC_HELP_STRING([--with-machine=MACHINE],
++			[specify the &quot;uname -m&quot;-value to build for])],
++		[LINUX_MACHINE=&quot;${withval}&quot;],
++		[LINUX_MACHINE=`uname -m`])
++        if test &quot;x$LINUX_MACHINE&quot; = &quot;xyes&quot;;
++        then
++		LINUX_MACHINE=`uname -r`
++        fi
++        AC_MSG_NOTICE([Using $LINUX_MACHINE as the uname -m value])
++])
++dnl allow for specifying an rpm target arch
++dnl if none specified, try to guess one from running rpm querying for
++dnl the kernel with the uname -r
++dnl this is so configure without arguments works out of the box
++dnl FIXME: investigate if uname -p is a correct guess for this, and if
++dnl we should have a flag for specifying it instead
++
++dnl this macro possibly overrides LINUX_MACHINE
++
++dnl first argument is the kernel release building for
++AC_DEFUN([AS_LINUX_RPM_TARGET],
++[
++	RELEASE=$1
++	AC_ARG_WITH([rpm-target],
++		[AC_HELP_STRING([--with-rpm-target=TARGET],
++			[specify the target arch to build for])],
++		[LINUX_RPM_TARGET=&quot;${withval}&quot;],
++		[LINUX_RPM_TARGET=])
++	if test &quot;x$LINUX_RPM_TARGET&quot; = &quot;x&quot;
++	then
++		dnl if we have rpm, try to guess the target of the kernel
++		dnl we want to build for using rpm
++		AC_PATH_PROG(RPM, rpm, yes, no)
++		if test &quot;x$RPM&quot; = &quot;xyes&quot;
++		then
++			if rpm -q kernel-$RELEASE &gt; /dev/null
++			then
++				LINUX_RPM_TARGET=`rpm -q --queryformat %{arch} kernel-$RELEASE`
++			else
++				AC_MSG_NOTICE([Cannot guess target arch, consider setting it using --with-rpm-target])
++			fi
++		fi
++	fi
++
++	dnl now override LINUX_MACHINE if LINUX_RPM_TARGET is set
++	if test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;
++	then
++		dnl override LINUX_MACHINE based on this
++		dnl FIXME: add other possible Red Hat/Fedora/rpm targets here
++		LINUX_MACHINE=
++		case &quot;$LINUX_RPM_TARGET&quot; in
++			i?86) LINUX_MACHINE=i386;;
++			athlon) LINUX_MACHINE=i386;;
++			x86_64) LINUX_MACHINE=x86_64;;
++		esac
++		if test &quot;x$LINUX_MACHINE&quot; = &quot;x&quot;
++		then
++		AC_MSG_ERROR(Could not guess uname -m value from target $LINUX_RPM_TARGET)
++		fi
++	fi
++])
++
++
++dnl allow for specifying an override for EXTRAVERSION
++dnl if none specified, make it from the passed-in KERNEL_RELEASE (uname -r)
++dnl resulting value is stored in LINUX_EXTRAVERSION
++dnl first argument is the uname -r string to use as a fallback
++AC_DEFUN([AS_LINUX_EXTRAVERSION],
++[
++	KERNEL_RELEASE=[$1]
++	dnl extract the default by getting everything after first -
++	LINUX_EXTRAVERSION=&quot;-`echo $KERNEL_RELEASE | cut -d- -f 2-`&quot;
++	AC_ARG_WITH([extraversion],
++		[AC_HELP_STRING([--with-extraversion=FILE],
++			[specify override for kernel EXTRAVERSION])],
++		[LINUX_EXTRAVERSION=&quot;${withval}&quot;],)
++])
++
++
++dnl check if we can find a config file for the Linux kernel
++dnl defines LINUX_CONFIG to the absolute location of a usable
++dnl kernel source config file
++
++dnl for rpm distros, it can try and guess the correct config file by
++dnl checking the global LINUX_RPM_TARGET variable set somewhere else
++dnl (FIXME: move this to an argument instead ?)
++
++dnl first argument is LINUX_DIR to check for possible configs
++dnl second argument is kernel-release (uname -r)
++dnl third argument is machine (uname -m)
++
++AC_DEFUN([AS_LINUX_CONFIG],
++[
++	LINUX_DIR=[$1]
++	KERNEL_RELEASE=[$2]
++	MACHINE=[$3]
++	AC_ARG_WITH([linuxconfig],
++		[AC_HELP_STRING([--with-linuxconfig=FILE],
++			[specify path to Linux configuration file])],
++		[LINUX_CONFIG=&quot;${withval}&quot;],
++		[LINUX_CONFIG=default])
++
++	dnl if a file got specified, try it as a linux config file
++	if test &quot;${LINUX_CONFIG}&quot; != &quot;default&quot; ; then
++		AS_TRY_LINUX_CONFIG($LINUX_CONFIG, $MACHINE,
++                                    ,, AC_MSG_ERROR([Linux config not found]) )
++	fi
++
++        dnl if no file specified, first check for the regular .config file
++        dnl in LINUX_DIR created by manual configuration
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		file=&quot;$LINUX_DIR/.config&quot;;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++        dnl second, try to guess what config file to use for the current kernel
++	dnl FIXME: the possible arch is from rpmbuild --target, and is
++	dnl different from the value of ARCH (Makefile) or MACHINE (uname -m)
++	dnl so we should have a redhat flag to specify the target to find
++	dnl the correct config file
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; &amp;&amp; test &quot;x$LINUX_RPM_TARGET&quot; != &quot;x&quot;; then
++		dnl Red Hat stores configuration files for their built kernels
++		dnl named kernel-(version)-(arch)(extra).config
++		dnl where arch is athlon, i386, i586, i686, x86_64
++		dnl and (extra) is empty or -smp, -BOOT, -bigmem
++		dnl haven't seen combinations of extra yet as of FC1
++		KVERSION=`echo $KERNEL_RELEASE | cut -d- -f1`
++		extra=
++		echo $KERNEL_RELEASE | grep smp &amp;&amp; EXTRA=&quot;-smp&quot;
++		echo $KERNEL_RELEASE | grep bigmem &amp;&amp; EXTRA=&quot;-bigmem&quot;
++		echo $KERNEL_RELEASE | grep BOOT &amp;&amp; EXTRA=&quot;-BOOT&quot;
++		file=&quot;$LINUX_DIR/configs/kernel-$KVERSION-$LINUX_RPM_TARGET$EXTRA.config&quot;
++		AS_TRY_LINUX_CONFIG($file, $MACHINE,
++		                    [LINUX_CONFIG=${file}], )
++	fi
++	if test &quot;${LINUX_CONFIG}&quot; = &quot;default&quot; ; then
++		AC_MSG_ERROR([
++The kernel source tree at ${LINUX_DIR} is not configured,
++and no configuration files in config/ matching your kernel were found.
++Fix before continuing or specify a config file using --with-configfile.])
++	fi
++
++	AC_SUBST(LINUX_CONFIG)
++])
++
++dnl check if the given candidate config file is usable
++dnl FIXME: it would be nice if it could check if it matches the
++dnl given machine (uname -m)
++AC_DEFUN([AS_TRY_LINUX_CONFIG],
++[
++	CFG=[$1]
++	MACHINE=[$2]
++	AC_MSG_CHECKING($CFG)
++
++	if test -f &quot;$CFG&quot; ; then
++		result=yes
++		ifelse([$3], , :, [$3])
++	else
++		result=&quot;not found&quot;
++		ifelse([$4], , :, [$4])
++	fi
++	AC_MSG_RESULT($result)
++])
++
++dnl check if RED_HAT_LINUX_KERNEL is defined
++dnl pre-FC2 RH/Fedora defines this in linux/rhconfig.h
++dnl included from linux/version.h
++dnl if this is present, a few extra defines need to be present to make sure
++dnl symbol versioning is correct
++dnl uses LINUX_DIR to find rhconfig.h
++AC_DEFUN([AS_CHECK_REDHAT_PRE_FC2],
++[
++	AC_MSG_CHECKING(Pre-FC2 Red Hat/Fedora kernel)
++        HAVE_REDHAT_KERNEL=false
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux&quot;
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++#define __BOOT_KERNEL_H_
++#include &quot;rhconfig.h&quot;
++int code = RED_HAT_LINUX_KERNEL;
++	]),
++        AC_MSG_RESULT(found); HAVE_REDHAT_KERNEL=true,
++        AC_MSG_RESULT(not found))
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++
++	dnl check for Red Hat define flags to use - see /sbin/mkkerneldoth
++
++	dnl initialize the booleans we want to detect
++	ENTERPRISE='0'
++	SMP='0'
++	UP='0'
++	BIGMEM='0'
++	HUGEMEM='0'
++
++	dnl get variables from the currently running kernel as default 
++	KERNEL_TYPE=`uname -r | sed 's_^.*\(smp\|enterprise\|bigmem\|hugemem\)$_\1_;t;s_.*__;'`
++	KERNEL_RELEASE=`uname -r | sed 's|smp\|enterprise\|bigmem\|hugemem||g'`
++	KERNEL_ARCH=`uname -m`
++
++	dnl check the config file and override KERNEL_ARCH
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M386, KERNEL_ARCH=i386)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M586, KERNEL_ARCH=i586)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_M686, KERNEL_ARCH=i686)
++	dnl for some reason the i686 bigmem config file has PENTIUM
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MPENTIUMIII, KERNEL_ARCH=i686)
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_MK7, KERNEL_ARCH=athlon)
++
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, KERNEL_TYPE=smp)
++	dnl bigmem is also smp, so this check is done after smp to override
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_HIGHMEM64G, KERNEL_TYPE=bigmem)
++
++	dnl FIXME: need to check hugemem and enterprise config files, which
++	dnl aren't provided in Fedora Core 1 !
++
++	case &quot;$KERNEL_TYPE&quot; in
++		smp) SMP='1';;
++		enterprise) ENTERPRISE='1';;
++		bigmem) BIGMEM='1';;
++		hugemem) HUGEMEM='1';;
++		*) UP='1';;
++	esac
++	REDHAT_CFLAGS=&quot;-D__BOOT_KERNEL_H_ -D__MODULE_KERNEL_$KERNEL_ARCH=1&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_ENTERPRISE=$ENTERPRISE&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_UP=$UP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_SMP=$SMP&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_BIGMEM=$BIGMEM&quot;
++        REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS -D__BOOT_KERNEL_HUGEMEM=$HUGEMEM&quot;
++
++	LINUX_REDHAT_CFLAGS=&quot;$REDHAT_CFLAGS&quot;
++
++	AC_SUBST(LINUX_KERNEL_TYPE, &quot;$KERNEL_TYPE&quot;)
++])
++
++dnl check if we're building on SMP
++dnl set LINUX_SMP to yes if we are
++AC_DEFUN([AS_CHECK_SMP],
++[
++	LINUX_SMP=&quot;no&quot;
++	dnl check the config file and override KERNEL_TYPE
++        AS_CHECK_LINUX_CONFIG_OPTION(CONFIG_SMP, LINUX_SMP=&quot;yes&quot;)
++	AC_SUBST(LINUX_SMP)
++])
++
++dnl add an argument to specify/override the module install path
++dnl if nothing specified, it will be /lib/modules/(kernelrel)
++AC_DEFUN([AS_LINUX_MODULESDIR],
++[
++	KERNEL_RELEASE=[$1]
++	AC_ARG_WITH([modulesdir],
++		[AC_HELP_STRING([--with-modulesdir=DIR],
++			[specify path to kernel-specific modules install directory])],
++		[MODULESDIR=&quot;${withval}&quot;],
++		[MODULESDIR=default])
++
++	if test &quot;${MODULESDIR}&quot; = &quot;default&quot; ; then
++		MODULESDIR=&quot;/lib/modules/${KERNEL_RELEASE}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdir, $MODULESDIR)
++	AC_MSG_NOTICE([Putting kernel modules under ${MODULESDIR}])
++])
++
++dnl add an argument to specify/override the module devel install path
++dnl if nothing specified, it will be the passed in LINUXDIR)
++AC_DEFUN([AS_LINUX_MODULESDEVELDIR],
++[
++	LINUXDIR=[$1]
++	AC_ARG_WITH([modulesdeveldir],
++		[AC_HELP_STRING([--with-modulesdeveldir=DIR],
++			[specify path to kernel-specific module development install directory])],
++		[MODULESDEVELDIR=&quot;${withval}&quot;],
++		[MODULESDEVELDIR=default])
++
++	if test &quot;${MODULESDEVELDIR}&quot; = &quot;default&quot; ; then
++		MODULESDEVELDIR=&quot;${LINUXDIR}&quot;
++	fi
++	dnl make it available to Makefiles so it can be used in ...dir
++	AC_SUBST(modulesdeveldir, $MODULESDEVELDIR)
++	AC_MSG_NOTICE([Putting kernel module development files under ${MODULESDEVELDIR}])
++])
++
++AC_DEFUN([AS_LINUX_2_6],
++[
++	AC_MSG_CHECKING(for Linux CFLAGS)
++
++	{
++	  tmpdir=`(umask 077 &amp;&amp; mktemp -d -q &quot;./confstatXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
++	  test -n &quot;$tmpdir&quot; &amp;&amp; test -d &quot;$tmpdir&quot;
++	} ||
++	{
++	  tmpdir=./confstat$$-$RANDOM
++	  (umask 077 &amp;&amp; mkdir $tmpdir)
++	} ||
++	{
++	  echo &quot;$me: cannot create a temporary directory in .&quot; &gt;&amp;2
++	  { (exit 1); exit 1; }
++	}
++
++	tmpdir=`pwd`/$tmpdir
++
++	cat &gt;${tmpdir}/Makefile &lt;&lt;EOF
++obj-m += fake.o
++
++\$(obj)/fake.c: flags
++	touch \$(obj)/fake.c
++
++.PHONY: flags
++flags:
++	echo LINUX_ARCH=\&quot;\$(ARCH)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's,include,&quot;\$(LINUXDIR)/include&quot;,g'&gt;&gt;\$(obj)/flags
++	echo LINUX_LDFLAGS=\&quot;\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS=\&quot;\$(CFLAGS) \$(CPPFLAGS)\&quot; | sed 's,Iinclude,I\$(LINUXDIR)/include,g' &gt;&gt;\$(obj)/flags
++	echo LINUX_CFLAGS_MODULE=\&quot;\$(CFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_CC=\&quot;\$(CC)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS) \$(LDFLAGS_MODULE)\&quot; &gt;&gt;\$(obj)/flags
++	echo LINUX_AS=\&quot;\$(AS)\&quot; &gt;&gt;\$(obj)/flags
++EOF
++
++	echo ${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	${MAKE-make} -C ${LINUX_DIR} V=1 SUBDIRS=${tmpdir} LINUXDIR=${LINUX_DIR} MODVERDIR=${tmpdir} modules &gt;&amp;5 2&gt;&amp;5
++	. ${tmpdir}/flags
++	rm -rf ${tmpdir}
++
++	LINUX_MODULE_EXT=&quot;.ko&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_CFLAGS_MODULE&quot;
++	LINUX_MODPOST=&quot;$LINUX_DIR/scripts/modpost&quot;
++
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++	AC_SUBST(LINUX_MODPOST)
++
++	AC_MSG_RESULT([$LINUX_CFLAGS])
++])
++
++dnl checks kernel's Makefile for make variables for Linux 2.4
++dnl adds LINUX_REDHAT_CFLAGS if non-empty
++AC_DEFUN([AS_LINUX_2_4],
++[
++	AC_MSG_CHECKING(for Linux 2.4 make flags)
++	dnl we try to figure out the CFLAGS by invoking the Makefile on
++        dnl a test dir
++        dnl we use the correct config file by substituting the MAKEFILES
++        dnl Makefile variable, which originally points to .config
++
++	if [[ ! -e &quot;${LINUX_DIR}/.hdepend&quot; ]];then
++		AC_MSG_ERROR([
++You need to run 'make dep' on the kernel source before continuing.])
++	fi
++
++        if test &quot;x$LINUX_EXTRAVERSION&quot; == &quot;x&quot;; then
++          EX=
++        else
++          EX=&quot;EXTRAVERSION=$LINUX_EXTRAVERSION&quot;
++        fi
++
++        POPDIR=`(pwd)`
++        cd ${LINUX_DIR}
++        TMPFILE=`mktemp /tmp/linux.XXXXXXXX` || exit 1
++	# combine the kernel's Makefile,
++	# sedded to use our proposed config file,
++	# sedded to use our proposed machine value,
++	# with the extra target we add here, to get cflags
++	# we do not want entering/leaving info on distcheck so we run with -s
++	( cat Makefile | sed &quot;s|\.config|${LINUX_CONFIG}|g&quot; | sed &quot;s|shell uname -m|shell echo ${LINUX_MACHINE}|g&quot; &amp;&amp; cat &lt;&lt;EOF ) | make -s -f - get_cflags $EX &gt; ${TMPFILE}
++get_cflags:
++	@echo LINUX_ARCH=\&quot;\$(ARCH)\&quot;
++	@echo LINUX_AFLAGS=\&quot;\$(AFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_LDFLAGS=\&quot;\&quot;
++	@echo LINUX_ARFLAGS=\&quot;\$(ARFLAGS)\&quot;
++	@echo LINUX_CROSS_COMPILE=\&quot;\$(CROSS_COMPILE)\&quot;
++	@echo LINUX_KERNELRELEASE=\&quot;\$(KERNELRELEASE)\&quot;
++	@echo LINUX_CFLAGS=\&quot;\$(CFLAGS)\&quot; | sed 's_Iinclude_I\&quot;\$(LINUXDIR)/include\&quot;_g'
++	@echo LINUX_MODFLAGS=\&quot;\$(MODFLAGS)\&quot;
++	@echo LINUX_CC=\&quot;\$(CC)\&quot;
++	@echo LINUX_LD=\&quot;\$(LD) \$(LDFLAGS)\&quot;
++	@echo LINUX_AS=\&quot;\$(AS)\&quot;
++EOF
++        . ${TMPFILE}
++        rm -rf ${TMPFILE}
++        cd $POPDIR
++
++        LINUX_MODULE_EXT=&quot;.o&quot;
++
++	LINUX_CFLAGS=&quot;$LINUX_CFLAGS $LINUX_MODFLAGS&quot;
++
++	dnl if we have REDHAT_CFLAGS, put them in LINUX_CFLAGS
++	if test &quot;x$REDHAT_CFLAGS&quot; != &quot;x&quot;;
++	then
++		LINUX_CFLAGS=&quot;$LINUX_CFLAGS $REDHAT_CFLAGS&quot;
++	fi
++	AC_SUBST(LINUX_ARCH)
++	AC_SUBST(LINUX_AFLAGS)
++	AC_SUBST(LINUX_LDFLAGS)
++	AC_SUBST(LINUX_ARFLAGS)
++	AC_SUBST(LINUX_CROSS_COMPILE)
++	AC_SUBST(LINUX_KERNELRELEASE)
++	AC_SUBST(LINUX_CFLAGS)
++	AC_SUBST(LINUX_CC)
++	AC_SUBST(LINUX_LD)
++	AC_SUBST(LINUX_AS)
++	AC_SUBST(LINUX_MODULE_EXT)
++
++	AC_MSG_RESULT([ok])
++
++	AC_MSG_CHECKING(for Linux 2.4 CFLAGS)
++	AC_MSG_RESULT($LINUX_CFLAGS)
++	AC_MSG_CHECKING(for Linux 2.4 LDFLAGS)
++	AC_MSG_RESULT($LINUX_LDFLAGS)
++])
++
++AC_DEFUN([AS_CHECK_LINUX_CONFIG_OPTION],
++[
++	AC_MSG_CHECKING([Linux config option $1])
++
++	if grep '^$1=y$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=yes
++		$2
++	else if grep '^$1=m$' ${LINUX_CONFIG} &gt;/dev/null 2&gt;/dev/null; then
++		result=module
++		$3
++	else
++		result=no
++		$4
++	fi
++	fi
++
++	AC_MSG_RESULT([$result])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes])
++])
++
++AC_DEFUN([AS_LINUX_CONFIG_OPTION_MODULE],
++[
++	AS_CHECK_LINUX_CONFIG_OPTION([$1],
++		[$1=yes],
++		[$1=module],
++		[$1=no])
++
++	AM_CONDITIONAL([$1],[test &quot;${$1}&quot; = yes -o &quot;${$1}&quot; = module])
++])
++
++dnl check for the major/minor version of the Linux source by checking
++dnl the headers
++dnl first argument is the linux directory
++dnl sets LINUX_VERSION_MAJOR and LINUX_VERSION_MINOR
++AC_DEFUN([AS_LINUX_VERSION_MAJOR_MINOR],
++[
++	LINUX_DIR=[$1]
++	AC_MSG_CHECKING([Linux major/minor version])
++
++	if [[ ! -f &quot;${LINUX_DIR}/include/linux/version.h&quot; ]];then
++		AC_MSG_ERROR([The header file include/linux/version.h does not exist.
++For 2.6 kernels, it can be generated by running 'make prepare' in
++the kernel source directory.])
++	fi
++        dnl the next set of tests is for figuring out version major/minor
++        dnl we make sure we have the right version.h by faking out CFLAGS
++	dnl since we want to avoid including linux/version.h and acidentally
++	dnl pick up /usr/include/linux
++	dnl we still add ${LINUX_DIR}/include so the Red Hat version can pick
++	dnl up linux/rhversion.h
++        ac_save_CFLAGS=&quot;$CFLAGS&quot;
++        CFLAGS=&quot;$CFLAGS -I${LINUX_DIR}/include/linux -I${LINUX_DIR}/include&quot;
++        dnl make sure we find version.h and it contains LINUX_VERSION_CODE
++        AC_COMPILE_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++int code = LINUX_VERSION_CODE;
++]),
++ :, AC_MSG_ERROR([${LINUX_DIR}/include/linux/version.h does not contain LINUX_VERSION_CODE]))
++
++
++        dnl figure out the linux kernel version major and minor
++        dnl using the LINUX_VERSION_CODE defined in include/linux/version.h
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MAJOR(code) ((code) &gt;&gt; 16)
++],[
++  return KERNEL_VERSION_MAJOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MAJOR=0, 
++		LINUX_VERSION_MAJOR=$?)
++        AC_RUN_IFELSE(AC_LANG_PROGRAM([
++/* to bypass the /boot/kernel.h inclusion for pre-2.6 Red Hat */
++#define __BOOT_KERNEL_H_
++#include &quot;version.h&quot;
++#define KERNEL_VERSION_MINOR(code) (((code) &gt;&gt; 8) % (2 &lt;&lt; 8))
++],[
++  return KERNEL_VERSION_MINOR(LINUX_VERSION_CODE);
++]),
++		LINUX_VERSION_MINOR=0, 
++		LINUX_VERSION_MINOR=$?)
++        AC_MSG_RESULT($LINUX_VERSION_MAJOR.$LINUX_VERSION_MINOR)
++	dnl restore CFLAGS
++        CFLAGS=&quot;$ac_save_CFLAGS&quot;
++])
+Index: kernel-module-ipw2100/ipw2100-0.45/m4/as-modtool.m4
+--- kernel-module-ipw2100~autotools.0.45/ipw2100-0.45/m4/as-modtool.m4	2004-05-22 13:41:02.000000000 +0200
++++ kernel-module-ipw2100/ipw2100-0.45/m4/as-modtool.m4	2004-06-04 11:31:18.000000000 +0200
+@@ -0,0 +1,147 @@
++dnl as-modtool.m4 0.0.1
++dnl autostars m4 macro for building modtool, a linker for Linux kernel
++dnl modules
++
++dnl David Schleef &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">ds at schleef.org</A>&gt;
++dnl Frank Mori Hess &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fmhess at users.sourceforge.net</A>&gt;
++dnl Thomas Vander Stichele &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">thomas at apestaart.org</A>&gt;
++
++dnl $Id: as-modtool.m4,v 1.12 2004/06/03 15:20:11 thomasvs Exp $
++
++dnl AS_LINUX_MODTOOL()
++dnl
++dnl this macro defines:
++dnl moduledir
++dnl modulePROGRAMS_INSTALL
++dnl modulePROGRAMS_UNINSTALL
++dnl
++dnl End of search list.
++
++dnl
++dnl FIXME:
++dnl  How do you specify that the building of modtool should go to the
++dnl  end of the configure script?
++dnl
++
++dnl SYMVERS_INCLUDES can be used to add additional .symvers files to the
++dnl modpost step
++
++AC_DEFUN([AS_LINUX_MODTOOL],
++[
++	AC_PATH_PROG(STRIP, strip)
++	AC_PATH_PROG([DEPMOD], [depmod], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++	AC_PATH_PROG([GENKSYMS], [genksyms], [no], [$PATH:/sbin:/usr/sbin:/usr/local/sbin])
++
++	if test &quot;x$LINUX_SMP&quot; = &quot;xyes&quot;
++	then
++		GENKSYMS=&quot;$GENKSYMS -p smp_&quot;
++	fi
++	dnl this can be overridden in Makefile.am
++	dnl FIXME: it'd be nice if we could specify different target_PROGRAMS
++	dnl and different targetdir
++	moduledir=&quot;\$(modulesdir)/\$(PACKAGE)&quot;
++	modulePROGRAMS_INSTALL=&quot;\$(top_builddir)/modtool --install&quot;
++	modulePROGRAMS_UNINSTALL=&quot;\$(top_builddir)/modtool --uninstall&quot;
++	AC_SUBST(moduledir)
++	AC_SUBST(modulePROGRAMS_INSTALL)
++
++	LINUX_VERSION=`echo $LINUX_KERNELRELEASE | cut -d- -f1`
++
++	AC_MSG_NOTICE(creating modtool)
++	cat &gt;modtool &lt;&lt;EOF
++#!/bin/sh
++
++set -e
++
++LINUX_LD=&quot;$LINUX_LD&quot;
++LINUX_MODPOST=&quot;$LINUX_MODPOST&quot;
++LINUX_VERSION=&quot;$LINUX_VERSION&quot;
++GENKSYMS=&quot;$GENKSYMS&quot;
++CC=&quot;$LINUX_CC&quot;
++INSTALL=&quot;$INSTALL&quot;
++LINUX_MODULE_EXT=&quot;$LINUX_MODULE_EXT&quot;
++STRIP=&quot;$STRIP&quot;
++CFLAGS=&quot;$CFLAGS $LINUX_CFLAGS&quot;
++LINUX_DIR=&quot;$LINUX_DIR&quot;
++
++mode=\$[1]
++shift
++
++case \$mode in
++--link)
++	# we accept -i (symvers) and -o (target) as options
++	# at least -o (target) needs to be specified
++	SYMVERS_INCLUDES=&quot;&quot;
++	done=false
++	while test ! -z &quot;\$[0]&quot; -a &quot;\$done&quot; = &quot;false&quot;
++	do
++		case \$[1] in
++		-i)
++                        SYMVERS_INCLUDES=&quot;\$SYMVERS_INCLUDES \$[2]&quot;
++                        shift 2
++                        ;;
++                -o)
++                        target=\$(echo \$[2] | sed s/.ko$//)
++                        shift 2
++                        ;;
++                *)
++                        done=true
++                        ;;
++                esac
++        done
++
++	mkdir -p .mods
++	if test &quot;\$LINUX_MODULE_EXT&quot; = .ko ; then
++
++		\$LINUX_LD -r -o .mods/\$target.o \$[*]
++
++		cat \$LINUX_DIR/Module.symvers \$SYMVERS_INCLUDES &gt;.mods/symvers.tmp
++
++		\$LINUX_MODPOST -o .mods/\$target.o.symvers.tmp -i .mods/symvers.tmp .mods/\$target.o
++
++		grep .mods/\$target .mods/\$target.o.symvers.tmp &gt;.mods/\$target.o.symvers || true
++
++		rm -f .mods/\$target.o.symvers.tmp .mods/symvers.tmp
++		
++		\$CC \$CFLAGS -DKBUILD_MODNAME=\$target -c -o .mods/\$target.mod.o .mods/\$target.mod.c
++
++		\$LINUX_LD -r -o \$target.ko .mods/\$target.mod.o .mods/\$target.o
++		set +x
++	else
++		echo \$LINUX_LD -r -o \$target.ko \$[*]
++		\$LINUX_LD -r -o \$target.ko \$[*]
++                                                                      
++		if test &quot;x\$SOURCES&quot; != &quot;x&quot;
++		then
++			echo &quot;\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver&quot;
++			\$CC \$CFLAGS -E -D__GENKSYMS__ \$SOURCES | \$GENKSYMS -k \$LINUX_VERSION &gt; .mods/\$target.ver
++		fi
++
++	fi
++
++	;;
++--install)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo \$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$INSTALL -m644 &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	\$STRIP -g &quot;\$module_dest&quot;
++	;;
++--uninstall)
++	module_src=\$[1]
++	module_dest=\`echo \$[2] | sed &quot;s/\.ko$/\${LINUX_MODULE_EXT}/&quot;\`
++	echo uninstall &quot;\$module_src&quot; &quot;\$module_dest&quot;
++	rm -f &quot;\$module_dest&quot;
++	;;
++*)
++	echo Unknown mode \$mode &gt;&amp;2
++	exit 1
++esac
++
++EOF
++	chmod +x modtool
++
++
++])
++
++

Added: trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec
===================================================================
--- trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec	2004-06-17 10:33:47 UTC (rev 1361)
+++ trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec	2004-06-17 13:56:35 UTC (rev 1362)
@@ -0,0 +1,134 @@
+# $Id$
+# Authority: matthias
+
+# What kernel are we building for?
+%{!?kernel: %define kernel %(uname -r)}
+# Get the correct kernel package release by stripping kernel modifiers
+%define krel %(echo %{kernel} | sed -e s/smp//g -)
+# Get a type modifier for the kernel, (null) or -smp
+%if %(echo %{kernel} | grep -c smp)
+    %{expand:%%define ktype -smp}
+%else
+    %define ktype %{nil}
+%endif
+
+# What kernel &quot;flavor&quot; are we building for ?
+%{expand:%%define post26 %(echo %{kernel} | grep &quot;^2\.[0-4]\.&quot; &gt;/dev/null &amp;&amp; echo 0 || echo 1)}
+
+# Don't build debuginfo packages for kernel modules
+%define debug_package %{nil}
+
+# Where the kernel build tree lives for post 2.6
+%define basedeveldir %{_libdir}/kernel-module-devel-%{krel}
+%define develdir %{basedeveldir}/kernel%{ktype}-%{krel}.%{_target_cpu}.rpm
+
+
+Summary: Driver for Intel&#174; PRO/Wireless 2100 network adaptors
+Name: kernel-module-ipw2100
+Version: 0.46_3
+Release: 0
+License: GPL
+Group: System Environment/Kernel
+URL: <A HREF="http://ipw2100.sourceforge.net/">http://ipw2100.sourceforge.net/</A>
+Source: <A HREF="http://dl.sf.net/ipw2100/ipw2100-%{version">http://dl.sf.net/ipw2100/ipw2100-%{version</A>}.tgz
+Patch: ipw2100.autotools.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+%if %{post26}
+BuildRequires: kernel-module-devel-%{krel}
+BuildRequires: kernel-module-hostap-devel-%{krel}
+%else
+BuildRequires: kernel-source = %{krel}
+BuildRequires: kernel-module-hostap-%{krel}
+%endif
+BuildRequires:	autoconf, automake
+
+%description
+This package contains a kernel module for the Intel&#174; PRO/Wireless 2100
+network adaptors, found for instance in Centrino laptops.
+
+To rebuild this package you should use :
+--define &quot;kernel &lt;uname -r output&gt;&quot;
+--target &lt;arch&gt;
+
+
+%package %{kernel}
+Summary: Driver for Intel&#174; PRO/Wireless 2100 network adaptors
+Group: System Environment/Kernel
+Provides: %{name} = %{version}-%{release}, kernel-module
+Requires(post): modutils
+Requires(postun): modutils
+Requires: /boot/vmlinuz-%{kernel}
+# We require the hostap module
+Requires: kernel-module-hostap-%{krel}
+# And firmware too
+Requires: ipw2100-firmware
+
+%description %{kernel}
+This package contains a kernel module for the Intel&#174; PRO/Wireless 2100
+network adaptors, found for instance in Centrino laptops.
+
+
+%prep
+%setup -q -n ipw2100-%{version}
+%patch -p2
+
+
+%build
+%if %{post26}
+# For post 2.6 kernels
+sh autogen.sh || :
+%configure \
+    --with-linuxdir=&quot;%{develdir}&quot; \
+    --disable-legacy-fw-load
+%else
+# For pre 2.6 kernels
+sh autogen.sh || :
+%configure \
+    --with-rpm-target=&quot;%{_target_cpu}&quot; \
+    --with-kernel-release=&quot;%{kernel}&quot; \
+    --with-linuxdir=&quot;/usr/src/linux-%{krel}&quot;
+%endif
+%{__make} %{?_smp_mflags}
+
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall modulesdir=&quot;%{buildroot}/lib/modules/%{kernel}&quot;
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%post %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+%postun %{kernel}
+depmod -ae -F /boot/System.map-%{kernel} %{kernel} &gt;/dev/null
+
+
+%files %{kernel}
+%defattr(-, root, root, 0755)
+/lib/modules/%{kernel}/kernel/drivers/net/wireless/ipw2100.*o
+
+
+%changelog
+* Thu Jun 17 2004 Matthias Saou &lt;<A HREF="http://freshrpms.net">http://freshrpms.net</A>&gt; 0.46-0
+- Takeover the spec, make changes and update to 0.46_3.
+
+* Tue Jun 15 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.45-0.fdr.4: don't build debug packages
+
+* Fri Jun 04 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.45-0.fdr.3: fix requires
+
+* Fri Jun 04 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- 0.45-0.fdr.2: rebuilt against new hostap build and kernel packages
+- this one works for 2.4 and 2.6
+
+* Sat May 22 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- rebuilt for 0.45 against new hostap build packages
+
+* Thu Apr 15 2004 Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;
+- Initial package
+


Property changes on: trunk/rpms/kernel-module-ipw2100/kernel-module-ipw2100.spec
___________________________________________________________________
Name: svn:keywords
   + Id HeadURL


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000170.html">[SVN] r1361 - trunk/rpms/sylpheed
</A></li>
	<LI>Next message: <A HREF="000172.html">[SVN] r1363 - in trunk/rpms: . perl-Apache-Session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#171">[ date ]</a>
              <a href="thread.html#171">[ thread ]</a>
              <a href="subject.html#171">[ subject ]</a>
              <a href="author.html#171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
