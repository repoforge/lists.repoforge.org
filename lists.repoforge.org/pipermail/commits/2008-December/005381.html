<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r6582 - in trunk/tools/dstat: . docs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6582%20-%20in%20trunk/tools/dstat%3A%20.%20docs&In-Reply-To=%3C200812022117.mB2LH3qG023264%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005380.html">
   <LINK REL="Next"  HREF="005382.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r6582 - in trunk/tools/dstat: . docs</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6582%20-%20in%20trunk/tools/dstat%3A%20.%20docs&In-Reply-To=%3C200812022117.mB2LH3qG023264%40surya.karan.org%3E"
       TITLE="[svn] r6582 - in trunk/tools/dstat: . docs">packagers at lists.rpmforge.net
       </A><BR>
    <I>Tue Dec  2 22:17:03 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="005380.html">[svn] r6581 - trunk/rpms/bitlbee
</A></li>
        <LI>Next message: <A HREF="005382.html">[svn] r6583 - trunk/tools/dstat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5381">[ date ]</a>
              <a href="thread.html#5381">[ thread ]</a>
              <a href="subject.html#5381">[ subject ]</a>
              <a href="author.html#5381">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2008-12-02 21:17:03 +0000 (Tue, 02 Dec 2008)
New Revision: 6582

Modified:
   trunk/tools/dstat/ChangeLog
   trunk/tools/dstat/TODO
   trunk/tools/dstat/docs/dstat.1
   trunk/tools/dstat/docs/dstat.1.txt
   trunk/tools/dstat/dstat
   trunk/tools/dstat/dstat.spec
   trunk/tools/dstat/dstat15
Log:
Ready dstat 0.6.9 release.

Modified: trunk/tools/dstat/ChangeLog
===================================================================
--- trunk/tools/dstat/ChangeLog	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/ChangeLog	2008-12-02 21:17:03 UTC (rev 6582)
@@ -1,14 +1,14 @@
-* 0.6.8svn - ... - release 01/12/2008
+* 0.6.9 - Locarno - release 02/12/2008
 - Input text color is now gray (again)
 - Added external dstat_luster plugin (Brock Palen, Kilian Vavalotti)
 - Validate integer values in /proc/swaps (Bert de Bruijn)
 - Added VMware guest dstat_vmmemctl plugin (Bert de Bruijn)
-- Added internal dstat_fs plugin to show number of open files/inodes
+- Added internal dstat_fs plugin showing number of open files/inodes
 - Added internal dstat_socket plugin to show total number of various sockets
 - Added internal dstat_aio plugin to see number of asynchronous I/O requests
 - Listing modules (-M list) now also lists internal plugins
 - Added internal dstat_vm plugin showing page faults, allocations and frees
-- Added internal dstat_io plugin showing number of completed I/O reuests
+- Added internal dstat_io plugin showing number of completed I/O requests
 
 * 0.6.8 - Buenos Aires - release 12/09/2008
 - Added improved tick patch (Kelly Long)

Modified: trunk/tools/dstat/TODO
===================================================================
--- trunk/tools/dstat/TODO	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/TODO	2008-12-02 21:17:03 UTC (rev 6582)
@@ -55,17 +55,13 @@
 + Comply to PEP8: <A HREF="http://www.python.org/dev/peps/pep-0008/">http://www.python.org/dev/peps/pep-0008/</A>
 
 ### General issues
-+ Timer is not as accurate on 2.6 kernel as on 2.4, possibly scheduling differences
-+ Python 1.5 prints 'L' for long, crashes when int()
 + Implement better (?) protection against counter rollovers (see mail from Sebastien Prud'homme)
 + Plugins currently have to be written in python 1.5 to work for dstat15 (lowest common denominator)
 
 ### Plugin issues
 + plugins that use /proc/pid are reasonably slow
-+ app plugin: takes second argument when finding known interpreter (is wrong when second argument
 + disk plugin: /proc/partitions can have negative numbers, seen on systems with long uptime. dstat handles this except for calculating the very first stat, no work-around possible?
 + proc plugin: (run and blk) does not work on 2.4.24+, to be confirmed
-+ proc plugin: seem to be off-by-one compared to vmstat (some of the time, this is what I get from /proc/stat)
 + swap plugin: (new one) is slower than swapold
 + tcp plugin: is very slow and generates lots of softirqs (on busy systems), to be confirmed
 

Modified: trunk/tools/dstat/docs/dstat.1
===================================================================
--- trunk/tools/dstat/docs/dstat.1	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/docs/dstat.1	2008-12-02 21:17:03 UTC (rev 6582)
@@ -2,7 +2,7 @@
 .\&quot; It was generated using the DocBook XSL Stylesheets (version 1.69.1).
 .\&quot; Instead of manually editing it, you probably should edit the DocBook XML
 .\&quot; source for it and then use the DocBook XSL Stylesheets to regenerate it.
-.TH &quot;DSTAT&quot; &quot;1&quot; &quot;09/12/2008&quot; &quot;&quot; &quot;&quot;
+.TH &quot;DSTAT&quot; &quot;1&quot; &quot;12/02/2008&quot; &quot;&quot; &quot;&quot;
 .\&quot; disable hyphenation
 .nh
 .\&quot; disable justification (adjust text to left margin only)
@@ -34,19 +34,19 @@
 .SH &quot;OPTIONS&quot;
 .TP
 \-c, \-\-cpu
-enable cpu stats
+enable cpu stats (system, user, idle, wait, hardware interrupt, software interrupt)
 .TP
 \-C 0,3,total
 include cpu0, cpu3 and total
 .TP
 \-d, \-\-disk
-enable disk stats
+enable disk stats (read, write)
 .TP
 \-D total,hda
 include hda and total
 .TP
 \-g, \-\-page
-enable page stats
+enable page stats (page in, page out)
 .TP
 \-i, \-\-int
 enable interrupt stats
@@ -55,22 +55,25 @@
 include interrupt 5 and 10
 .TP
 \-l, \-\-load
-enable load stats
+enable load average stats (1 min, 5 mins, 15mins)
 .TP
 \-m, \-\-mem
-enable memory stats
+enable memory stats (used, buffers, cache, free)
 .TP
 \-n, \-\-net
-enable network stats
+enable network stats (receive, send)
 .TP
 \-N eth1,total
 include eth1 and total
 .TP
 \-p, \-\-proc
-enable process stats
+enable process stats (runnable, uninterruptible, new)
 .TP
+\-r, \-\-io
+enable I/O request stats (read, write requests)
+.TP
 \-s, \-\-swap
-enable swap stats
+enable swap stats (used, free)
 .TP
 \-S swap1,total
 include swap1 and total
@@ -82,34 +85,46 @@
 enable time counter (seconds since epoch)
 .TP
 \-y, \-\-sys
-enable system stats
+enable system stats (interrupts, context switches)
 .TP
+\-\-aio
+enable aio stats (asynchronous I/O)
+.TP
+\-\-fs
+enable filesystem stats (open files, inodes)
+.TP
 \-\-ipc
-enable ipc stats
+enable ipc stats (message queue, semaphores, shared memory)
 .TP
 \-\-lock
-enable lock stats
+enable file lock stats (posix, flock, read, write)
 .TP
 \-\-raw
-enable raw stats
+enable raw stats (raw sockets)
 .TP
+\-\-socket
+enable socket stats (total, tcp, udp, raw, ip\-fragments)
+.TP
 \-\-tcp
-enable tcp stats
+enable tcp stats (listen, established, syn, time_wait, close)
 .TP
 \-\-udp
-enable udp stats
+enable udp stats (listen, active)
 .TP
 \-\-unix
-enable unix stats
+enable unix stats (datagram, stream, listen, active)
 .TP
+\-\-vm
+enable vm stats (hard pagefaults, soft pagefaults, allocated, free))
+.TP
 \-M stat1,stat2
-enable internal stats and external plugin stats
+enable internal and external plugin stats
 .TP
 Possible internal stats are
-cpu, cpu24, disk, disk24, disk24old, epoch, int, int24, ipc, load, lock, mem, net, page, page24, proc, raw, swap, swapold, sys, tcp, time, udp, unix
+aio, cpu, cpu24, disk, disk24, disk24old, epoch, fs, int, int24, io, ipc, load, lock, mem, net, page, page24, proc, raw, socket, swap, swapold, sys, tcp, time, udp, unix, vm
 .TP
-Possible external plugin stats can be listed using
-dstat \-M list
+Possible plugin stats can be listed using
+dstat \-\-list
 .TP
 \-a, \-\-all
 equals \-cdngy (default)
@@ -120,6 +135,9 @@
 \-v, \-\-vmstat
 equals \-pmgdsc \-D total
 .TP
+\-\-list
+list the internal and external plugin names
+.TP
 \-\-integer
 show integer values
 .TP
@@ -189,7 +207,7 @@
 Please see the TODO file for known bugs and future plans.
 .sp
 .SH &quot;FILES&quot;
-Paths that may contain external dstat_* plugins:
+Paths that may contain external dstat_*.py plugins:
 .sp
 .sp
 .nf
@@ -249,14 +267,14 @@
 .SS &quot;Other useful info&quot;
 .sp
 .nf
-proc(5)
+collectl(1), proc(5), procinfo(8)
 .fi
 .SH &quot;AUTHOR&quot;
 Written by Dag Wieers [1]\&amp;\<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fIdag at wieers.com</A>\fR
 .sp
 Homepage at [2]\&amp;\<A HREF="fIhttp://dag.wieers.com/home\-made/dstat/\fR">fIhttp://dag.wieers.com/home\-made/dstat/\fR</A>
 .sp
-This manpage was initially written by Andrew Pollock [3]\&amp;\<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fIapollock at debian.org</A>\fR for the Debian GNU/Linux system, and updated by Dag Wieers [1]\&amp;\<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fIdag at wieers.com</A>\fR
+This manpage was initially written by Andrew Pollock [3]\&amp;\<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">fIapollock at debian.org</A>\fR for the Debian GNU/Linux system.
 .sp
 .SH &quot;REFERENCES&quot;
 .TP 3

Modified: trunk/tools/dstat/docs/dstat.1.txt
===================================================================
--- trunk/tools/dstat/docs/dstat.1.txt	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/docs/dstat.1.txt	2008-12-02 21:17:03 UTC (rev 6582)
@@ -1,6 +1,6 @@
 = dstat(1)
 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
-v0.6.4, December 2006
+v0.6.9, December 2006
 
 
 == NAME
@@ -40,19 +40,20 @@
 
 == OPTIONS
 -c, --cpu::
-    enable cpu stats
+    enable cpu stats (system, user, idle, wait, hardware interrupt, software
+    interrupt)
 
 -C 0,3,total::
     include cpu0, cpu3 and total
 
 -d, --disk::
-    enable disk stats
+    enable disk stats (read, write)
 
 -D total,hda::
     include hda and total
 
 -g, --page::
-    enable page stats
+    enable page stats (page in, page out)
 
 -i, --int::
     enable interrupt stats
@@ -61,22 +62,25 @@
     include interrupt 5 and 10
 
 -l, --load::
-    enable load stats
+    enable load average stats (1 min, 5 mins, 15mins)
 
 -m, --mem::
-    enable memory stats
+    enable memory stats (used, buffers, cache, free)
 
 -n, --net::
-    enable network stats
+    enable network stats (receive, send)
 
 -N eth1,total::
     include eth1 and total
 
 -p, --proc::
-    enable process stats
+    enable process stats (runnable, uninterruptible, new)
 
+-r, --io::
+    enable I/O request stats (read, write requests)
+
 -s, --swap::
-    enable swap stats
+    enable swap stats (used, free)
 
 -S swap1,total::
     include swap1 and total
@@ -88,35 +92,48 @@
     enable time counter (seconds since epoch)
 
 -y, --sys::
-    enable system stats
+    enable system stats (interrupts, context switches)
 
+--aio::
+    enable aio stats (asynchronous I/O)
+
+--fs::
+    enable filesystem stats (open files, inodes)
+
 --ipc::
-    enable ipc stats
+    enable ipc stats (message queue, semaphores, shared memory)
 
 --lock::
-    enable lock stats
+    enable file lock stats (posix, flock, read, write)
 
 --raw::
-    enable raw stats
+    enable raw stats (raw sockets)
 
+--socket::
+    enable socket stats (total, tcp, udp, raw, ip-fragments)
+
 --tcp::
-    enable tcp stats
+    enable tcp stats (listen, established, syn, time_wait, close)
 
 --udp::
-    enable udp stats
+    enable udp stats (listen, active)
 
 --unix::
-    enable unix stats
+    enable unix stats (datagram, stream, listen, active)
 
+--vm::
+    enable vm stats (hard pagefaults, soft pagefaults, allocated, free))
+
 -M stat1,stat2::
-    enable internal stats and external plugin stats
+    enable internal and external plugin stats
 
 Possible internal stats are::
-  cpu, cpu24, disk, disk24, disk24old, epoch, int, int24, ipc, load, lock, mem,
-  net, page, page24, proc, raw, swap, swapold, sys, tcp, time, udp, unix
+    aio, cpu, cpu24, disk, disk24, disk24old, epoch, fs, int, int24, io, ipc,
+    load, lock, mem, net, page, page24, proc, raw, socket, swap, swapold,
+    sys, tcp, time, udp, unix, vm
 
-Possible external plugin stats can be listed using::
-  dstat -M list
+Possible plugin stats can be listed using::
+    dstat --list
 
 -a, --all::
     equals -cdngy (default)
@@ -127,6 +144,9 @@
 -v, --vmstat::
     equals -pmgdsc -D total
 
+--list::
+    list the internal and external plugin names
+
 --integer::
     show integer values
 
@@ -201,7 +221,7 @@
 
 
 == FILES
-Paths that may contain external dstat_* plugins:
+Paths that may contain external dstat_*.py plugins:
 
     ~/.dstat/
     ./
@@ -241,7 +261,7 @@
     xdpyinfo(1), xrestop(1)
 
 === Other useful info
-    proc(5)
+    collectl(1), proc(5), procinfo(8)
 
 
 == AUTHOR
@@ -250,5 +270,4 @@
 Homepage at <A HREF="http://dag.wieers.com/home-made/dstat/[">http://dag.wieers.com/home-made/dstat/[</A>]
 
 This manpage was initially written by Andrew Pollock
-mailto:<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">apollock at debian.org</A>[] for the Debian GNU/Linux system, and
-updated by Dag Wieers mailto:<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>[]
+mailto:<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">apollock at debian.org</A>[] for the Debian GNU/Linux system.

Modified: trunk/tools/dstat/dstat
===================================================================
--- trunk/tools/dstat/dstat	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/dstat	2008-12-02 21:17:03 UTC (rev 6582)
@@ -16,7 +16,7 @@
 
 from __future__ import generators
 
-VERSION = '0.6.8svn'
+VERSION = '0.6.9'
 
 def inspath(path):
     if os.path.isdir(path) and path not in sys.path:
@@ -118,9 +118,7 @@
         self.modlist = []
 
         for opt, arg in opts:
-            if opt in ['--aio']:
-                self.modlist.append('aio')
-            elif opt in ['-c', '--cpu']:
+            if opt in ['-c', '--cpu']:
                 self.modlist.append('cpu')
             elif opt in ['-C']:
                 self.cpulist = arg.split(',')
@@ -128,22 +126,14 @@
                 self.modlist.append('disk')
             elif opt in ['-D']:
                 self.disklist = arg.split(',')
-            elif opt in ['--debug']:
-                self.debug = self.debug + 1
-            elif opt in ['--fs', '--filesystem']:
-                self.modlist.append('fs')
             elif opt in ['-g', '--page']:
                 self.modlist.append('page')
             elif opt in ['-i', '--int']:
                 self.modlist.append('int')
             elif opt in ['-I']:
                 self.intlist = arg.split(',')
-            elif opt in ['--ipc']:
-                self.modlist.append('ipc')
             elif opt in ['-l', '--load']:
                 self.modlist.append('load')
-            elif opt in ['--lock']:
-                self.modlist.append('lock')
             elif opt in ['-m', '--mem']:
                 self.modlist.append('mem')
             elif opt in ['-M', '--mods', '--modules']:
@@ -154,30 +144,39 @@
                 self.netlist = arg.split(',')
             elif opt in ['-p', '--proc']:
                 self.modlist.append('proc')
-            elif opt in ['--raw']:
-                self.modlist.append('raw')
             elif opt in ['-r', '--io']:
                 self.modlist.append('io')
-            elif opt in ['--socket']:
-                self.modlist.append('socket')
             elif opt in ['-s', '--swap']:
                 self.modlist.append('swap')
             elif opt in ['-S']:
                 self.swaplist = arg.split(',')
-            elif opt in ['--tcp']:
-                self.modlist.append('tcp')
             elif opt in ['-t', '--time']:
                 self.modlist.append('time')
             elif opt in ['-T', '--epoch']:
                 self.modlist.append('epoch')
+            elif opt in ['-y', '--sys']:
+                self.modlist.append('sys')
+
+            elif opt in ['--aio']:
+                self.modlist.append('aio')
+            elif opt in ['--fs', '--filesystem']:
+                self.modlist.append('fs')
+            elif opt in ['--ipc']:
+                self.modlist.append('ipc')
+            elif opt in ['--lock']:
+                self.modlist.append('lock')
+            elif opt in ['--raw']:
+                self.modlist.append('raw')
+            elif opt in ['--socket']:
+                self.modlist.append('socket')
+            elif opt in ['--tcp']:
+                self.modlist.append('tcp')
             elif opt in ['--udp']:
                 self.modlist.append('udp')
             elif opt in ['--unix']:
                 self.modlist.append('unix')
             elif opt in ['--vm']:
                 self.modlist.append('vm')
-            elif opt in ['-y', '--sys']:
-                self.modlist.append('sys')
 
             elif opt in ['-a', '--all']:
                 self.modlist = self.modlist + [ 'cpu', 'disk', 'net', 'page', 'sys' ]
@@ -186,8 +185,13 @@
             elif opt in ['-f', '--full']:
                 self.full = True
 
+            elif opt in ['--debug']:
+                self.debug = self.debug + 1
             elif opt in ['--integer']:
                 self.integer = True
+            elif opt in ['--list']:
+                listmodules()
+                sys.exit(0)
             elif opt in ['--nocolor']:
                 self.color = False
                 self.update = False
@@ -199,9 +203,6 @@
                 self.output = arg
             elif opt in ['--pidfile']:
                 self.pidfile = arg
-            elif opt in ['--list']:
-                listmodules()
-                sys.exit(0)
             elif opt in ['-h', '--help']:
                 self.usage()
                 self.help()

Modified: trunk/tools/dstat/dstat.spec
===================================================================
--- trunk/tools/dstat/dstat.spec	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/dstat.spec	2008-12-02 21:17:03 UTC (rev 6582)
@@ -9,7 +9,7 @@
 
 Summary: Versatile resource statistics tool
 Name: dstat
-Version: 0.6.8svn
+Version: 0.6.9
 Release: 1
 License: GPL
 Group: System Environment/Base
@@ -59,6 +59,9 @@
 %{_datadir}/dstat/
 
 %changelog
+* Tue Dec 02 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.6.9-1
+- Updated to release 0.6.9.
+
 * Sun Aug 17 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.6.8svn-1
 - Updated to release 0.6.8svn.
 

Modified: trunk/tools/dstat/dstat15
===================================================================
--- trunk/tools/dstat/dstat15	2008-12-02 19:35:23 UTC (rev 6581)
+++ trunk/tools/dstat/dstat15	2008-12-02 21:17:03 UTC (rev 6582)
@@ -16,7 +16,7 @@
 
 #from __future__ import generators
 
-VERSION = '0.6.8svn'
+VERSION = '0.6.9'
 
 def inspath(path):
     if os.path.isdir(path) and path not in sys.path:
@@ -24,7 +24,7 @@
 
 try:
     import sys, os, time, sched, re, string
-    import types, resource, getpass
+    import types, resource, getpass, glob
     inspath('/usr/local/share/dstat/')
     inspath('/usr/share/dstat/')
     inspath(os.path.abspath(os.path.dirname(sys.argv[0])) + '/plugins/')    # binary path + /plugins/
@@ -96,11 +96,13 @@
 
         try:
             import getopt
-            opts, args = getopt.getopt (args, 'acdfghilmno:pstTvyC:D:I:M:N:S:V',
-                ['cpu', 'disk', 'epoch', 'int', 'ipc', 'load', 'lock', 'mem', 'net',
-                'page', 'proc', 'raw', 'swap', 'sys', 'tcp', 'time', 'udp', 'unix',
-                'all', 'debug', 'full', 'help', 'integer', 'mods', 'modules', 'nocolor',
-                'noheaders', 'noupdate', 'output=', 'pidfile=', 'version', 'vmstat'])
+            opts, args = getopt.getopt (args, 'acdfghilmno:prstTvyC:D:I:M:N:S:V',
+                ['aio', 'cpu', 'disk', 'epoch', 'fs', 'filesystem', 'int', 'io', 'ipc',
+                 'load', 'lock', 'mem', 'net', 'page', 'proc', 'raw', 'socket', 'swap',
+                 'sys', 'tcp', 'time', 'udp', 'unix', 'vm',
+                 'all', 'debug', 'full', 'help', 'integer', 'list', 'mods', 'modules',
+                 'nocolor', 'noheaders', 'noupdate', 'output=', 'pidfile=', 'version',
+                 'vmstat'])
         except getopt.error, exc:
             print 'dstat: %s, try dstat -h for a list of all the options' % str(exc)
             sys.exit(1)
@@ -116,20 +118,14 @@
                 self.modlist.append('disk')
             elif opt in ['-D']:
                 self.disklist = string.split(arg, ',')
-            elif opt in ['--debug']:
-                self.debug = self.debug + 1
             elif opt in ['-g', '--page']:
                 self.modlist.append('page')
             elif opt in ['-i', '--int']:
                 self.modlist.append('int')
             elif opt in ['-I']:
                 self.intlist = string.split(arg, ',')
-            elif opt in ['--ipc']:
-                self.modlist.append('ipc')
             elif opt in ['-l', '--load']:
                 self.modlist.append('load')
-            elif opt in ['--lock']:
-                self.modlist.append('lock')
             elif opt in ['-m', '--mem']:
                 self.modlist.append('mem')
             elif opt in ['-M', '--mods', '--modules']:
@@ -140,24 +136,39 @@
                 self.netlist = string.split(arg, ',')
             elif opt in ['-p', '--proc']:
                 self.modlist.append('proc')
-            elif opt in ['--raw']:
-                self.modlist.append('raw')
+            elif opt in ['-r', '--io']:
+                self.modlist.append('io')
             elif opt in ['-s', '--swap']:
                 self.modlist.append('swap')
             elif opt in ['-S']:
                 self.swaplist = string.split(arg, ',')
-            elif opt in ['--tcp']:
-                self.modlist.append('tcp')
             elif opt in ['-t', '--time']:
                 self.modlist.append('time')
             elif opt in ['-T', '--epoch']:
                 self.modlist.append('epoch')
+            elif opt in ['-y', '--sys']:
+                self.modlist.append('sys')
+
+            elif opt in ['--aio']:
+                self.modlist.append('aio')
+            elif opt in ['--fs', '--filesystem']:
+                self.modlist.append('fs')
+            elif opt in ['--ipc']:
+                self.modlist.append('ipc')
+            elif opt in ['--lock']:
+                self.modlist.append('lock')
+            elif opt in ['--raw']:
+                self.modlist.append('raw')
+            elif opt in ['--socket']:
+                self.modlist.append('socket')
+            elif opt in ['--tcp']:
+                self.modlist.append('tcp')
             elif opt in ['--udp']:
                 self.modlist.append('udp')
             elif opt in ['--unix']:
                 self.modlist.append('unix')
-            elif opt in ['-y', '--sys']:
-                self.modlist.append('sys')
+            elif opt in ['--vm']:
+                self.modlist.append('vm')
 
             elif opt in ['-a', '--all']:
                 self.modlist = self.modlist + [ 'cpu', 'disk', 'net', 'page', 'sys' ]
@@ -166,8 +177,13 @@
             elif opt in ['-f', '--full']:
                 self.full = True
 
+            elif opt in ['--debug']:
+                self.debug = self.debug + 1
             elif opt in ['--integer']:
                 self.integer = True
+            elif opt in ['--list']:
+                listmodules()
+                sys.exit(0)
             elif opt in ['--nocolor']:
                 self.color = False
                 self.update = False
@@ -246,21 +262,29 @@
   -n, --net              enable network stats
      -N eth1,total          include eth1 and total
   -p, --proc             enable process stats
+  -r, --io               enable io stats (I/O requests completed)
   -s, --swap             enable swap stats
      -S swap1,total         include swap1 and total
   -t, --time             enable time/date output
   -T, --epoch            enable time counter (seconds since epoch)
   -y, --sys              enable system stats
+
+  --aio                  enable aio stats
+  --fs                   enable fs stats
   --ipc                  enable ipc stats
   --lock                 enable lock stats
   --raw                  enable raw stats
+  --socket               enable socket stats
   --tcp                  enable tcp stats
   --udp                  enable udp stats
   --unix                 enable unix stats
+  --vm                   enable vm stats
 
-  -M stat1,stat2         enable external stats
+  -M stat1,stat2         enable external plugins
      --mods stat1,stat2
 
+  --list                 list all internal and external plugins
+
   -a, --all              equals -cdngy (default)
   -f, --full             expand -C, -D, -I, -N and -S discovery lists
   -v, --vmstat           equals -pmgdsc -D total
@@ -278,6 +302,11 @@
 
 ### START STATS DEFINITIONS ###
 class dstat:
+    vars = None
+    name = None
+    nick = None
+    format = ()
+
     ### Initialise default variables
     def init(self, vars=(), len=0):
         if vars:
@@ -290,17 +319,17 @@
                     for i in range(len):
                         self.val[name][i] = self.cn1[name][i] = self.cn2[name][i] = 0
 
-    def open(self, *files):
+    def open(self, *filenames):
         &quot;Open stat file descriptor&quot;
         self.file = []
         self.fd = []
-        for file in files:
-            fd = dopen(file)
+        for filename in filenames:
+            fd = dopen(filename)
             if fd:
-                self.file.append(file)
+                self.file.append(filename)
                 self.fd.append(fd)
-            else:
-                raise Exception, 'Cannot open file %s.' % file
+        if not self.fd:
+            raise Exception, 'Cannot open file %s.' % filename
 
     def readlines(self):
         ret = []
@@ -329,11 +358,11 @@
     def title1(self):
         ret = ansi['darkblue']
         if isinstance(self.name, types.StringType):
-            max = self.statwidth()
-            return ret + string.replace(string.center(self.name[0:max], max), ' ', '-') + ansi['default']
+            maxlen = self.statwidth()
+            return ret + string.replace(string.center(self.name[0:maxlen], maxlen), ' ', '-') + ansi['default']
         for i, name in enumerate(self.name):
-            max = self.width()
-            ret = ret + string.replace(string.center(name[0:max], max), ' ', '-')
+            maxlen = self.width()
+            ret = ret + string.replace(string.center(name[0:maxlen], maxlen), ' ', '-')
             if i + 1 != len(self.name):
                 if op.color:
                     ret = ret + ansi['blue'] + char['dash'] + ansi['darkblue']
@@ -401,7 +430,7 @@
             return True
         raise Exception, 'Unknown problem, please report'
 
-    def discover(self):
+    def discover(self, *objlist):
         return True
 
     def show(self):
@@ -453,6 +482,21 @@
             return ','
         return ''
 
+class dstat_aio(dstat):
+    def __init__(self):
+        self.name = 'async'
+        self.format = ('d', 5, 1000)
+        self.open('/proc/sys/fs/aio-nr')
+        self.nick = ('#aio',)
+        self.vars = ('aio',)
+        self.init(self.vars, 1)
+
+    def extract(self):
+        for line in self.readlines():
+            l = string.split(line)
+            if len(l) &lt; 1: continue
+            self.val['aio'] = long(l[0])
+
 class dstat_cpu(dstat):
     def __init__(self):
         self.format = ('p', 3, 34)
@@ -463,14 +507,14 @@
         self.name = self.name()
         self.init(self.vars + ['total',], 6)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
             if len(l) &lt; 8 or l[0][0:3] != 'cpu': continue
             ret.append(l[0][3:])
         ret.sort()
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def name(self):
@@ -485,17 +529,17 @@
     def vars(self):
         ret = []
         if op.cpulist:
-            list = op.cpulist
+            varlist = op.cpulist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = []
+            varlist = []
             cpu = 0
             while cpu &lt; cpunr:
-                list.append(str(cpu))
+                varlist.append(str(cpu))
                 cpu = cpu + 1
-#           if len(list) &gt; 2: list = list[0:2]
-        for name in list:
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+        for name in varlist:
             if name in self.discover + ['total']:
                 ret.append(name)
         return ret
@@ -512,7 +556,8 @@
                 if sum(self.cn2[name]) &gt; sum(self.cn1[name]):
                     self.val[name][i] = 100.0 * (self.cn2[name][i] - self.cn1[name][i]) / (sum(self.cn2[name]) - sum(self.cn1[name]))
                 else:
-                    print &quot;Error: tick problem detected, this should never happen !&quot;
+                    self.val[name][i] = 0
+#                    print &gt;&gt;sys.stderr, &quot;Error: tick problem detected, this should never happen !&quot;
         if step == op.delay:
             self.cn1.update(self.cn2)
 
@@ -535,30 +580,30 @@
                 ret.append('cpu total')
         return ret
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
             if len(l) != 5 or l[0][0:3] != 'cpu': continue
             ret.append(l[0][3:])
         ret.sort()
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.cpulist:
-            list = op.cpulist
+            varlist = op.cpulist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = []
+            varlist = []
             cpu = 0
             while cpu &lt; cpunr:
-                list.append(str(cpu))
+                varlist.append(str(cpu))
                 cpu = cpu + 1
-#           if len(list) &gt; 2: list = list[0:2]
-        for name in list:
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+        for name in varlist:
             if name in self.discover + ['total']:
                 ret.append(name)
         return ret
@@ -586,7 +631,7 @@
         for name in self.vars: self.name.append('dsk/' + name)
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
@@ -594,23 +639,23 @@
             if l[3:] == ['0',] * 11: continue
             name = l[2]
             ret.append(name)
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.disklist:
-            list = op.disklist
+            varlist = op.disklist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = []
+            varlist = []
             for name in self.discover:
                 if not re.match('(md[0-9]+|dm-[0-9]+)', name):
-                    list.append(name)
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+                    varlist.append(name)
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total'] + op.diskset.keys():
                 ret.append(name)
         return ret
@@ -627,11 +672,11 @@
                 self.cn2['total'] = ( self.cn2['total'][0] + long(l[5]), self.cn2['total'][1] + long(l[9]) )
             if name in self.vars and name != 'total':
                 self.cn2[name] = ( self.cn2[name][0] + long(l[5]), self.cn2[name][1] + long(l[9]) )
-            for set in self.vars:
-                if set in op.diskset.keys():
-                    for disk in op.diskset[set]:
+            for diskset in self.vars:
+                if diskset in op.diskset.keys():
+                    for disk in op.diskset[diskset]:
                         if re.match('^'+disk+'$', name):
-                            self.cn2[set] = ( self.cn2[set][0] + long(l[5]), self.cn2[set][1] + long(l[9]) )
+                            self.cn2[diskset] = ( self.cn2[diskset][0] + long(l[5]), self.cn2[diskset][1] + long(l[9]) )
         for name in self.cn2.keys():
             self.val[name] = (
                 (self.cn2[name][0] - self.cn1[name][0]) * 512.0 / tick,
@@ -653,30 +698,30 @@
         for name in self.vars: self.name.append('dsk/' + sysfs_dev(name))
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
             if len(l) &lt; 15 or l[0] == 'major' or int(l[1]) % 16 != 0: continue
             name = l[3]
             ret.append(name)
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.disklist:
-            list = op.disklist
+            varlist = op.disklist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = []
+            varlist = []
             for name in self.discover:
                 if not re.match('(md[0-9]+|dm-[0-9]+)', name):
-                    list.append(name)
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+                    varlist.append(name)
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total'] + op.diskset.keys():
                 ret.append(name)
         return ret
@@ -691,11 +736,11 @@
                 self.cn2['total'] = ( self.cn2['total'][0] + long(l[6]), self.cn2['total'][1] + long(l[10]) )
             if name in self.vars:
                 self.cn2[name] = ( self.cn2[name][0] + long(l[6]), self.cn2[name][1] + long(l[10]) )
-            for set in self.vars:
-                if set in op.diskset.keys():
-                    for disk in op.diskset[set]:
+            for diskset in self.vars:
+                if diskset in op.diskset.keys():
+                    for disk in op.diskset[diskset]:
                         if re.match('^'+disk+'$', name):
-                            self.cn2[set] = ( self.cn2[set][0] + long(l[6]), self.cn2[set][1] + long(l[10]) )
+                            self.cn2[diskset] = ( self.cn2[diskset][0] + long(l[6]), self.cn2[diskset][1] + long(l[10]) )
         for name in self.cn2.keys():
             self.val[name] = (
                 (self.cn2[name][0] - self.cn1[name][0]) * 512.0 / tick,
@@ -717,7 +762,7 @@
         for name in self.vars: self.name.append('dsk/' + name)
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line, ':')
@@ -732,23 +777,23 @@
                 name = dev(int(l[0]), int(l[1]))
                 ret.append(name)
             break
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.disklist:
-            list = op.disklist
+            varlist = op.disklist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = []
+            varlist = []
             for name in self.discover:
                 if not re.match('(md[0-9]+|dm-[0-9]+)', name):
-                    list.append(name)
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+                    varlist.append(name)
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total'] + op.diskset.keys():
                 ret.append(name)
         return ret
@@ -770,11 +815,11 @@
                     self.cn2['total'] = ( self.cn2['total'][0] + long(l[2]), self.cn2['total'][1] + long(l[3]) )
                 if name in self.vars and name != 'total':
                     self.cn2[name] = ( self.cn2[name][0] + long(l[2]), self.cn2[name][1] + long(l[3]) )
-                for set in self.vars:
-                    if set in op.diskset.keys():
-                        for disk in op.diskset[set]:
+                for diskset in self.vars:
+                    if diskset in op.diskset.keys():
+                        for disk in op.diskset[diskset]:
                             if re.match('^'+disk+'$', name):
-                                self.cn2[set] = ( self.cn2[set][0] + long(l[2]), self.cn2[set][1] + long(l[3]) )
+                                self.cn2[diskset] = ( self.cn2[diskset][0] + long(l[2]), self.cn2[diskset][1] + long(l[3]) )
             break
         for name in self.cn2.keys():
             self.val[name] = (
@@ -802,6 +847,24 @@
 #   def show(self):
 #       return ansi['reset'] + ( '%10.2f' % self.val['epoch'] )
 
+class dstat_fs(dstat):
+    def __init__(self):
+        self.name = 'filesystem'
+        self.format = ('d', 6, 1000)
+        self.nick = ('files', 'inodes')
+        self.vars = self.nick
+        self.init(self.vars, 1)
+
+    def extract(self):
+        for line in dopen('/proc/sys/fs/file-nr').readlines():
+            l = string.split(line)
+            if len(l) &lt; 1: continue
+            self.val['files'] = long(l[0])
+        for line in dopen('/proc/sys/fs/inode-nr').readlines():
+            l = string.split(line)
+            if len(l) &lt; 2: continue
+            self.val['inodes'] = long(l[0]) - long(l[1])
+
 class dstat_int(dstat):
     def __init__(self):
         self.name = 'interrupts'
@@ -826,7 +889,7 @@
                 ret[name] = l1
         return ret
 
-    def discover(self):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
@@ -847,14 +910,14 @@
     def vars(self):
         ret = []
         if op.intlist:
-            list = op.intlist
+            varlist = op.intlist
         else:
-            list = self.discover
-            for name in list:
+            varlist = self.discover
+            for name in varlist:
                 if name in ('0', '1', '2', '8', 'NMI', 'LOC', 'MIS', 'CPU0'):
-                    list.remove(name)
-            if not op.full and len(list) &gt; 3: list = list[-3:]
-        for name in list:
+                    varlist.remove(name)
+            if not op.full and len(varlist) &gt; 3: varlist = varlist[-3:]
+        for name in varlist:
             if name in self.discover + ['total',]:
                 ret.append(name)
             elif string.lower(name) in self.intmap.keys():
@@ -897,7 +960,7 @@
                 ret[name] = l1
         return ret
 
-    def discover(self):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
@@ -919,14 +982,14 @@
     def vars(self):
         ret = []
         if op.intlist:
-            list = op.intlist
+            varlist = op.intlist
         else:
-            list = self.discover
-            for name in list:
+            varlist = self.discover
+            for name in varlist:
                 if name in ('0', '1', '2', '8', 'CPU0', 'ERR', 'LOC', 'MIS', 'NMI'):
-                    list.remove(name)
-            if not op.full and len(list) &gt; 3: list = list[-3:]
-        for name in list:
+                    varlist.remove(name)
+            if not op.full and len(varlist) &gt; 3: varlist = varlist[-3:]
+        for name in varlist:
             if name in self.discover:
                 ret.append(name)
             elif string.lower(name) in self.intmap.keys():
@@ -951,6 +1014,71 @@
         if step == op.delay:
             self.cn1.update(self.cn2)
 
+class dstat_io(dstat):
+    def __init__(self):
+        self.format = ('f', 5, 1000)
+        self.open('/proc/diskstats')
+        self.nick = ('read', 'writ')
+        self.discover = self.discover()
+        self.vars = self.vars()
+        self.name = []
+        for name in self.vars: self.name.append('io/'+name)
+        self.init(self.vars + ['total',], 3)
+
+    def discover(self, *objlist):
+        ret = []
+        for line in self.readlines():
+            l = string.split(line)
+            if len(l) &lt; 13: continue
+            if l[3:] == ['0',] * 11: continue
+            name = l[2]
+            ret.append(name)
+        for item in objlist: ret.append(item)
+        return ret
+
+    def vars(self):
+        ret = []
+        if op.disklist:
+            varlist = op.disklist
+        elif not op.full:
+            varlist = ('total',)
+        else:
+            varlist = []
+            for name in self.discover:
+                if not re.match('(md[0-9]+|dm-[0-9]+)', name):
+                    varlist.append(name)
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
+            if name in self.discover + ['total'] + op.diskset.keys():
+                ret.append(name)
+        return ret
+
+    def extract(self):
+        for name in self.vars: self.cn2[name] = (0, 0)
+        for line in self.readlines():
+            l = line.split()
+            if len(l) &lt; 13: continue
+            if l[3] == '0' and l[7] == '0': continue
+            name = l[2]
+            if l[3:] == ['0',] * 11: continue
+            if not re.match('(md[0-9]+|dm-[0-9]+)', name):
+                self.cn2['total'] = ( self.cn2['total'][0] + long(l[3]), self.cn2['total'][1] + long(l[7]) )
+            if name in self.vars and name != 'total':
+                self.cn2[name] = ( self.cn2[name][0] + long(l[3]), self.cn2[name][1] + long(l[7]) )
+            for diskset in self.vars:
+                if diskset in op.diskset.keys():
+                    for disk in op.diskset[diskset]:
+                        if re.match('^'+disk+'$', name):
+                            self.cn2[diskset] = ( self.cn2[diskset][0] + long(l[3]), self.cn2[diskset][1] + long(l[7]) )
+        for name in self.cn2.keys():
+            self.val[name] = (
+                (self.cn2[name][0] - self.cn1[name][0]) * 1.0 / tick,
+                (self.cn2[name][1] - self.cn1[name][1]) * 1.0 / tick,
+            )
+        if step == op.delay:
+            self.cn1.update(self.cn2)
+
 class dstat_ipc(dstat):
     def __init__(self):
         self.name = 'sysv ipc'
@@ -1032,7 +1160,7 @@
         for name in self.vars: self.name.append('net/' + name)
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(string.replace(line, ':', ' '))
@@ -1042,20 +1170,20 @@
             if name not in ('lo', 'face'):
                 ret.append(name)
         ret.sort()
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.netlist:
-            list = op.netlist
+            varlist = op.netlist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = self.discover
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+            varlist = self.discover
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total', 'lo']:
                 ret.append(name)
         return ret
@@ -1156,9 +1284,9 @@
 class dstat_raw(dstat):
     def __init__(self):
         self.name = 'raw'
-        self.format = ('f', 3, 10)
+        self.format = ('d', 3, 100)
         self.open('/proc/net/raw')
-        self.nick = ('soc',)
+        self.nick = ('raw',)
         self.vars = ('sockets',)
         self.init(self.vars, 1)
 
@@ -1170,6 +1298,22 @@
         ### Cannot use len() on generator
 #        self.val['sockets'] = len(self.readlines()) - 1
 
+class dstat_socket(dstat):
+    def __init__(self):
+        self.name = 'sockets'
+        self.format = ('d', 3, 100)
+        self.open('/proc/net/sockstat')
+        self.nick = ('tot', 'tcp', 'udp', 'raw', 'frg')
+        self.vars = ('sockets:', 'TCP:', 'UDP:', 'RAW:', 'FRAG:')
+        self.init(self.vars, 1)
+
+    def extract(self):
+        for line in self.readlines():
+            l = string.split(line)
+            if len(l) &lt; 3: continue
+            self.val[l[0]] = long(l[2])
+        self.val['other'] = self.val['sockets:'] - self.val['TCP:'] - self.val['UDP:'] - self.val['RAW:'] - self.val['FRAG:']
+
 class dstat_swap(dstat):
     def __init__(self):
         self.name = 'swap'
@@ -1182,29 +1326,34 @@
         for name in self.vars: self.name.append('swp/'+improve(name))
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
         for line in self.readlines():
             l = string.split(line)
             if len(l) &lt; 5: continue
             if l[0] == 'Filename': continue
+            try:
+                int(l[2])
+                int(l[3])
+            except:
+                continue
 #           ret.append(improve(l[0]))
             ret.append(l[0])
         ret.sort()
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.swaplist:
-            list = op.swaplist
+            varlist = op.swaplist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = self.discover
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+            varlist = self.discover
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total']:
                 ret.append(name)
         return ret
@@ -1315,7 +1464,7 @@
 class dstat_udp(dstat):
     def __init__(self):
         self.name = 'udp'
-        self.format = ('f', 3, 100)
+        self.format = ('d', 3, 100)
         self.open('/proc/net/udp', '/proc/net/udp6')
         self.nick = ('lis', 'act')
         self.vars = ('listen', 'established')
@@ -1331,9 +1480,9 @@
 class dstat_unix(dstat):
     def __init__(self):
         self.name = 'unix sockets'
-        self.format = ('d', 4, 100)
+        self.format = ('d', 3, 100)
         self.open('/proc/net/unix')
-        self.nick = ('dgrm', 'strm', 'lis', 'act')
+        self.nick = ('dgm', 'str', 'lis', 'act')
         self.vars = ('datagram', 'stream', 'listen', 'established')
         self.init(self.vars, 1)
 
@@ -1350,6 +1499,26 @@
                 elif l[5] == '03':
                     self.val['established'] = self.val['established'] + 1
 
+class dstat_vm(dstat):
+    def __init__(self):
+        self.name = 'virtual memory'
+        self.format = ('d', 5, 1000)
+        self.open('/proc/vmstat')
+        self.nick = ('majpf', 'minpf', 'alloc', 'free')
+        self.vars = ('pgmajfault', 'pgfault', 'pgalloc_normal', 'pgfree')
+        self.init(self.vars, 1)
+
+    def extract(self):
+        for line in self.readlines():
+            l = string.split(line)
+            if len(l) &lt; 2: continue
+            if l[0] not in self.vars: continue
+            self.cn2[l[0]] = long(l[1])
+        for name in self.vars:
+            self.val[name] = (self.cn2[name] - self.cn1[name]) * 1.0 / tick
+        if step == op.delay:
+            self.cn1.update(self.cn2)
+
 ### END STATS DEFINITIONS ###
 
 ansi = {
@@ -1423,32 +1592,32 @@
             if l[0] == 'btime':
                 return time.time() - long(l[1])
 
-def improve(str):
+def improve(devname):
     &quot;Improve a device name&quot;
-    if str.startswith('/dev/mapper/'):
-        str = string.split(str, '/')[3]
-    elif str.startswith('/dev/'):
-        str = string.split(str, '/')[2]
-    return str
+    if devname.startswith('/dev/mapper/'):
+        devname = string.split(devname, '/')[3]
+    elif devname.startswith('/dev/'):
+        devname = string.split(devname, '/')[2]
+    return devname
 
-def dopen(file):
+def dopen(filename):
     &quot;Open a file for reuse, if already opened, return file descriptor&quot;
     global fds
-    if not os.path.exists(file): return None
+    if not os.path.exists(filename): return None
     if 'fds' not in globals().keys(): fds = {}
     if file not in fds.keys():
-        fds[file] = open(file, 'r', 0)
+        fds[filename] = open(filename, 'r', 0)
     else:
-        fds[file].seek(0)
-    return fds[file]
+        fds[filename].seek(0)
+    return fds[filename]
 
-def dclose(file):
+def dclose(filename):
     &quot;Close an open file and remove file descriptor from list&quot;
     global fds
-    if not 'fds' in globals(): fds = {}
-    if file in fds:
-        fds[file].close()
-        del(fds[file])
+    if not 'fds' in globals().keys(): fds = {}
+    if filename in fds:
+        fds[filename].close()
+        del(fds[filename])
 
 def dpopen(cmd):
     &quot;Open a pipe for reuse, if already opened, return pipes&quot;
@@ -1458,52 +1627,52 @@
         pipes[cmd] = os.popen3(cmd, 't', 0)
     return pipes[cmd]
 
-def readpipe(file, tmout = 0.001):
+def readpipe(fileobj, tmout = 0.001):
     &quot;Read available data from pipe in a non-blocking fashion&quot;
     ret = ''
-    while not select.select([file.fileno()], [], [], tmout)[0]:
+    while not select.select([fileobj.fileno()], [], [], tmout)[0]:
         pass
-    while select.select([file.fileno()], [], [], tmout)[0]:
-        ret = ret + file.read(1)
+    while select.select([fileobj.fileno()], [], [], tmout)[0]:
+        ret = ret + fileobj.read(1)
     return string.split(ret, '\n')
 
-def greppipe(file, str, tmout = 0.001):
+def greppipe(fileobj, str, tmout = 0.001):
     &quot;Grep available data from pipe in a non-blocking fashion&quot;
     ret = ''
-    while not select.select([file.fileno()], [], [], tmout)[0]:
+    while not select.select([fileobj.fileno()], [], [], tmout)[0]:
         pass
-    while select.select([file.fileno()], [], [], tmout)[0]:
-        char = file.read(1)
-        if char != '\n':
-            ret = ret + char
+    while select.select([fileobj.fileno()], [], [], tmout)[0]:
+        character = fileobj.read(1)
+        if character != '\n':
+            ret = ret + character
         elif ret.startswith(str):
             return ret
         else:
             ret = ''
     return None
 
-def matchpipe(file, string, tmout = 0.001):
+def matchpipe(fileobj, string, tmout = 0.001):
     &quot;Match available data from pipe in a non-blocking fashion&quot;
     ret = ''
     regexp = re.compile(string)
-    while not select.select([file.fileno()], [], [], tmout)[0]:
+    while not select.select([fileobj.fileno()], [], [], tmout)[0]:
         pass
-    while select.select([file.fileno()], [], [], tmout)[0]:
-        char = file.read(1)
-        if char != '\n':
-            ret = ret + char
+    while select.select([fileobj.fileno()], [], [], tmout)[0]:
+        character = fileobj.read(1)
+        if character != '\n':
+            ret = ret + character
         elif regexp.match(ret):
             return ret
         else:
             ret = ''
     return None
 
-def dchg(var, max, base):
+def dchg(var, maxlen, base):
     &quot;Convert decimal to string given base and length&quot;
     c = 0
     while True:
         ret = str(int(round(var)))
-        if len(ret) &lt;= max:
+        if len(ret) &lt;= maxlen:
             break
         var = var / base
         c = c + 1
@@ -1511,7 +1680,7 @@
         c = -1
     return ret, c
 
-def fchg(var, max, base):
+def fchg(var, maxlen, base):
     &quot;Convert float to string given base and length&quot;
     c = 0
     while True:
@@ -1519,13 +1688,13 @@
             ret = str('0')
             break
 #       ret = repr(round(var))
-#       ret = repr(long(round(var,max)))
-        ret = str(long(round(var,max)))
-        if len(ret) &lt;= max:
-            i = max - len(ret)
+#       ret = repr(long(round(var,maxlen)))
+        ret = str(long(round(var,maxlen)))
+        if len(ret) &lt;= maxlen:
+            i = maxlen - len(ret)
             while i &gt; 0:
                 ret = ('%.'+str(i)+'f') % var
-                if len(ret) &lt; max and ret != repr(round(var)):
+                if len(ret) &lt; maxlen and ret != repr(round(var)):
                     break
                 i = i - 1
             else:
@@ -1537,33 +1706,33 @@
         c = -1
     return ret, c
 
-def cprintlist(list, format):
+def cprintlist(varlist, format):
     ret = sep = ''
-    for var in list:
+    for var in varlist:
         ret = ret + sep + cprint(var, format)
         sep = ' '
     return ret
 
 def cprint(var, format = ('f', 4, 1000)):
-    c = -1
-    type = format[0]
-    max = format[1]
+    vartype = format[0]
+    maxlen = format[1]
     mp = format[2]
 
     base = 1000
     if mp == 1024:
         base = 1024
 
+    ### Use units when base is exact 1000 or 1024
     unit = False
-    if mp in (1000, 1024) and max &gt;= len(str(base)):
+    if mp in (1000, 1024) and maxlen &gt;= len(str(base)):
         unit = True
-        max = max - 1
+        maxlen = maxlen - 1
 
     if var &lt; 0:
         if unit:
-            return ansi['white'] + ansi['redbg'] + string.rjust('-', max) + ' ' + ansi['default']
+            return ansi['white'] + ansi['redbg'] + string.rjust('-', maxlen) + ' ' + ansi['default']
         else:
-            return ansi['white'] + ansi['redbg'] + string.rjust('-', max) + ansi['default']
+            return ansi['white'] + ansi['redbg'] + string.rjust('-', maxlen) + ansi['default']
 
     if base == 1024:
         units = ('B', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y')
@@ -1575,34 +1744,38 @@
     else:
         colors = ('darkred', 'darkyellow', 'darkgreen', 'darkblue', 'darkmagenta', 'darkcyan', 'silver', 'red', 'green')
 
-    if op.integer and type in ('d', 'p', 'f'):
-        ret, c = dchg(var, max, base)
-    elif type in ('d', 'p'):
-        ret, c = dchg(var, max, base)
-    elif type in ('f'):
-        ret, c = fchg(var, max, base)
-    elif type in ('t'):
-        ret, c = fchg(var, max+1, base)
+    ### Convert value to string given base and field-length
+    if op.integer and vartype in ('d', 'p', 'f'):
+        ret, c = dchg(var, maxlen, base)
+    elif vartype in ('d', 'p'):
+        ret, c = dchg(var, maxlen, base)
+    elif vartype in ('f'):
+        ret, c = fchg(var, maxlen, base)
+    elif vartype in ('t'):
+        ret, c = fchg(var, maxlen+1, base)
     else:
-        ret = str(var)
+        ret, c = str(var), -1
 
+    ### Set the counter color
     if ret == '0':
         color = 'default'
-    elif type in ('d', 'p'):
+    elif vartype in ('d', 'p'):
         color = colors[int(round(var)/mp)%len(colors)]
-    elif type in ('f'):
+    elif vartype in ('f'):
         color = colors[c%len(colors)]
     else:
         color = 'default'
 
-    if type in ('s',):
-        ret = ansi['default'] + string.ljust(ret, max)
+    ### Justify value to left if string
+    if vartype in ('s',):
+        ret = ansi['default'] + string.ljust(ret, maxlen)
     else:
-        ret = ansi[color] + string.rjust(ret, max)
+        ret = ansi[color] + string.rjust(ret, maxlen)
 
+    ### Add unit to output
     if unit:
         if c != -1 and round(var) != 0:
-            ret = ret + units[c]
+            ret = ret + ansi['default'] + units[c]
         else:
             ret = ret + ' '
 
@@ -1629,11 +1802,11 @@
 def info(level, str):
     &quot;Output info message&quot;
 #   if level &lt;= op.verbose:
-    print str
+    print &gt;&gt;sys.stderr, str
 
 def die(ret, str):
     &quot;Print error and exit with errorcode&quot;
-    print str
+    print &gt;&gt;sys.stderr, str
     exit(ret)
 
 def getenv(key):
@@ -1645,8 +1818,6 @@
     &quot;Initialise terminal&quot;
     global termsize
 
-    termsize = None, None
-
     ### Unbuffered sys.stdout
 #    sys.stdout = os.fdopen(1, 'w', 0)
 
@@ -1693,7 +1864,7 @@
             if curses.tigetnum('colors') &lt; 0:
                 return False
         except:
-            print 'Color support is disabled, python-curses is not installed.'
+            print &gt;&gt;sys.stderr, 'Color support is disabled, python-curses is not installed.'
             return False
     return color
 
@@ -1774,9 +1945,9 @@
 #   &quot;Return the mountpoint of a mounted device/file&quot;
 #   for entry in dopen('/etc/mtab').readlines():
 #       if entry:
-#           list = string.split(entry)
-#           if dev == list[0]:
-#               return list[1]
+#           devlist = string.split(entry)
+#           if dev == devlist[0]:
+#               return devlist[1]
 
 def readfile(file):
     ret = ''
@@ -1789,18 +1960,32 @@
     sys.exit(ret)
 
 def listmodules():
-    import glob
     rows, cols = gettermsize()
+    print 'internal:\n\t',
+    remod = re.compile('dstat_(.+)$')
+    modlist = []
+    for filename in globals():
+        if filename.startswith('dstat_'):
+            modlist.append(remod.match(filename).groups()[0])
+    modlist.sort()
+    cols2 = cols - 8
+    for mod in modlist:
+        cols2 = cols2 - len(mod) - 2
+        if cols2 &lt;= 0:
+            print '\n\t',
+            cols2 = cols - len(mod) - 10
+        print mod + ',',
+    print
     remod = re.compile('.+/dstat_(.+).py$')
     for path in sys.path:
-        list = []
-        for file in glob.glob(path + '/dstat_*.py'):
-            list.append(remod.match(file).groups()[0])
-        if not list: continue
-        list.sort()
+        modlist = []
+        for filename in glob.glob(path + '/dstat_*.py'):
+            modlist.append(remod.match(filename).groups()[0])
+        if not modlist: continue
+        modlist.sort()
         cols2 = cols - 8
         print '%s:\n\t' % os.path.abspath(path),
-        for mod in list:
+        for mod in modlist:
             cols2 = cols2 - len(mod) - 2
             if cols2 &lt;= 0:
                 print '\n\t',
@@ -1820,6 +2005,9 @@
     user = getpass.getuser()
     hostname = string.split(os.uname()[1], '.')[0]
 
+    ### Disable line-wrapping (does not work ?)
+    sys.stdout.write('\033[7l')
+
     ### Write term-title
     if sys.stdout.isatty():
         shell = getenv('XTERM_SHELL')
@@ -1850,7 +2038,7 @@
             pidfile.write(str(os.getpid()))
             pidfile.close()
         except Exception, e:
-            print 'Failed to create pidfile %s' % op.pidfile, e
+            print &gt;&gt;sys.stderr, 'Failed to create pidfile %s' % op.pidfile, e
             op.pidfile = False
 
     ### Empty ansi database if no colors are requested
@@ -1881,7 +2069,7 @@
             try:
                 if 'dstat_'+mod not in globals().keys():
                     import imp
-                    file, pathname, description = imp.find_module('dstat_'+mod)
+                    filename, pathname, description = imp.find_module('dstat_'+mod)
 
                     ### Try loading python plugin
                     if description[0] == '.py':
@@ -1898,7 +2086,7 @@
 #                        print o.__module__
 #                        print o.name
                     else:
-                        print 'Module %s is of unknown type.' % mod
+                        print &gt;&gt;sys.stderr, 'Module %s is of unknown type.' % mod
 
                     ### Remove defect stat objects and calculate line length
                     if not o.check():
@@ -1908,9 +2096,9 @@
 #                print o.__module__
             except Exception, e:
                 if mod == mods[-1]:
-                    print 'Module %s failed to load. (%s)' % (mod, e)
+                    print &gt;&gt;sys.stderr, 'Module %s failed to load. (%s)' % (mod, e)
                 elif op.debug:
-                    print 'Module %s failed to load, trying another. (%s)' % (mod, e)
+                    print &gt;&gt;sys.stderr, 'Module %s failed to load, trying another. (%s)' % (mod, e)
                 if op.debug &gt;= 3:
                     raise
 #                tb = sys.exc_info()[2]
@@ -1985,7 +2173,7 @@
 
         ### FIXME: Make this part smarter
         if sys.stdout.isatty():
-            oldrows, oldcols = rows, cols
+            oldcols = cols
             rows, cols = gettermsize()
 
             ### Trim object list to what is visible on screen
@@ -2018,7 +2206,7 @@
         ### Display header
         if showheader:
             if loop == 0 and totlist != vislist:
-                print 'Terminal width too small, trimming output.'
+                print &gt;&gt;sys.stderr, 'Terminal width too small, trimming output.'
             showheader = False
             showtitle(1, totlist, vislist, ansi['darkblue'] + char['space'], ansi['darkblue'] + char['gt'])
             showtitle(2, totlist, vislist, ansi['gray'] + char['pipe'], ansi['darkblue'] + char['gt'])
@@ -2061,6 +2249,9 @@
             sys.stdout.write(' '+ansi['redbg']+ansi['white']+'missed '+str(missed+1)+' ticks')
             missed = 0
 
+        ### Additional input in gray
+        sys.stdout.write(ansi['gray'])
+
         ### Finish the line
         if not op.update:
             sys.stdout.write('\n')


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005380.html">[svn] r6581 - trunk/rpms/bitlbee
</A></li>
	<LI>Next message: <A HREF="005382.html">[svn] r6583 - trunk/tools/dstat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5381">[ date ]</a>
              <a href="thread.html#5381">[ thread ]</a>
              <a href="subject.html#5381">[ subject ]</a>
              <a href="author.html#5381">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
