<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r3434 - in trunk/tools/pydar2: dries etc/yum pydar scripts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3434%20-%20in%20trunk/tools/pydar2%3A%20dries%20etc/yum%20pydar%20scripts&In-Reply-To=%3C20050726203607.B683931803A%40pooch.vmhosting.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002235.html">
   <LINK REL="Next"  HREF="002237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r3434 - in trunk/tools/pydar2: dries etc/yum pydar scripts</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3434%20-%20in%20trunk/tools/pydar2%3A%20dries%20etc/yum%20pydar%20scripts&In-Reply-To=%3C20050726203607.B683931803A%40pooch.vmhosting.org%3E"
       TITLE="[svn] r3434 - in trunk/tools/pydar2: dries etc/yum pydar scripts">packagers at lists.rpmforge.net
       </A><BR>
    <I>Tue Jul 26 22:36:07 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002235.html">[svn] r3433 - trunk/rpms/python-chm
</A></li>
        <LI>Next message: <A HREF="002237.html">[svn] r3435 - trunk/rpms/python-elementtree
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2236">[ date ]</a>
              <a href="thread.html#2236">[ thread ]</a>
              <a href="subject.html#2236">[ subject ]</a>
              <a href="author.html#2236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dries
Date: 2005-07-26 22:36:05 +0200 (Tue, 26 Jul 2005)
New Revision: 3434

Modified:
   trunk/tools/pydar2/dries/index-part.html
   trunk/tools/pydar2/etc/yum/fc3-i386.conf
   trunk/tools/pydar2/etc/yum/fc4-i386.conf
   trunk/tools/pydar2/pydar/mastercommand.py
   trunk/tools/pydar2/pydar/postgresqlstorage.py
   trunk/tools/pydar2/pydar/specfiletags.py
   trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py
   trunk/tools/pydar2/scripts/rpmforgedriesrepo.py
   trunk/tools/pydar2/scripts/rpmforgesite.py
Log:
update..  possible to generate list of new and updated rpms

Modified: trunk/tools/pydar2/dries/index-part.html
===================================================================
--- trunk/tools/pydar2/dries/index-part.html	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/dries/index-part.html	2005-07-26 20:36:05 UTC (rev 3434)
@@ -22,6 +22,10 @@
 &lt;/ul&gt;
 Currently there are NUMBERSPECFILES spec files in the &lt;a href=&quot;<A HREF="http://svn.rpmforge.net/svn/trunk/">http://svn.rpmforge.net/svn/trunk/</A>&quot;&gt;subversion repository of RPMforge&lt;/a&gt;.
 &lt;/p&gt;
+&lt;p&gt;
+Please note that the rpms are no longer available on this server. Please
+update your configuration so ftp.belnet.be or apt.sw.be is used.
+&lt;/p&gt;
 &lt;h2&gt;What now?&lt;/h2&gt;
 &lt;p&gt;
 &lt;ul&gt;

Modified: trunk/tools/pydar2/etc/yum/fc3-i386.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/fc3-i386.conf	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/etc/yum/fc3-i386.conf	2005-07-26 20:36:05 UTC (rev 3434)
@@ -13,26 +13,24 @@
 [core]
 name=Fedora Linux core
 baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/3/i386/os/">http://ftp.belnet.be/linux/fedora/linux/3/i386/os/</A>
-#gpgcheck=0
+gpgcheck=0
 
 [updates]
 name=Fedora Linux updates
 baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/">http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/</A>
-#gpgcheck=0
+gpgcheck=0
 
 [dries]
 name=Extra Fedora rpms dries
 baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>
-#gpgcheck=0
+gpgcheck=0
 
-# not needed during development of pydar2
-#[freshrpms]
-#name=Fedora Linux freshrpms
-#baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms">http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms</A>
-##gpgcheck=0
+[freshrpms]
+name=Fedora Linux freshrpms
+baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms">http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms</A>
+gpgcheck=0
 
-# not needed during development of pydar2
-#[dag] 
-#name=Dag RPM Repository for Fedora Core
-#baseurl=<A HREF="http://apt.sw.be/fedora/3/en/i386/dag">http://apt.sw.be/fedora/3/en/i386/dag</A>
-##gpgcheck=0
+[dag] 
+name=Dag RPM Repository for Fedora Core
+baseurl=<A HREF="http://apt.sw.be/fedora/3/en/i386/dag">http://apt.sw.be/fedora/3/en/i386/dag</A>
+gpgcheck=0

Modified: trunk/tools/pydar2/etc/yum/fc4-i386.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/fc4-i386.conf	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/etc/yum/fc4-i386.conf	2005-07-26 20:36:05 UTC (rev 3434)
@@ -12,20 +12,30 @@
 
 [os]
 name=Fedora Linux core
-baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/">http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/</A>
+#baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/">http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/</A>
+baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/4/i386/core">http://ayo.freshrpms.net/fedora/linux/4/i386/core</A>
 gpgcheck=0
 
 [updates]
 name=Fedora Linux updates
-baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/">http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/</A>
+#baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/">http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/</A>
+baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/4/i386/updates">http://ayo.freshrpms.net/fedora/linux/4/i386/updates</A>
 gpgcheck=0
 
+[freshrpms]
+name=Fedora Linux freshrpms
+baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/4/i386/freshrpms">http://ayo.freshrpms.net/fedora/linux/4/i386/freshrpms</A>
+gpgcheck=0
+
+
 [dries]
 name=Extra Fedora rpms dries
-baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/</A>
+#baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/</A>
+baseurl=<A HREF="http://apt.sw.be/dries/fedora/linux/4/i386/dries/RPMS">http://apt.sw.be/dries/fedora/linux/4/i386/dries/RPMS</A>
 gpgcheck=0
 
 [extras]
 name=Fedora Extras $releasever - $basearch
-baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/">http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/</A>
+#baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/">http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/</A>
+baseurl=<A HREF="http://ftp.freshrpms.net/pub/fedora/linux/extras/4/i386/">http://ftp.freshrpms.net/pub/fedora/linux/extras/4/i386/</A>
 gpgcheck=0

Modified: trunk/tools/pydar2/pydar/mastercommand.py
===================================================================
--- trunk/tools/pydar2/pydar/mastercommand.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/pydar/mastercommand.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -162,3 +162,14 @@
   
     def setId(self,id):
         self.__commandId = id
+
+    # this returns an array!
+    def getSpecFileOriginalBuildReqs(self):
+        self.__cat.debug(&quot;start&quot;)
+        # create a tags object based on the spec file and the defines
+        specFile = self.getBuildDir() +  &quot;/&quot; + self.getSpecFileShortFileName()
+        self.__cat.debug(&quot;specFile: &quot; + specFile)
+        sft = SpecFileTags(specFile,self.getDefines())
+        br = sft.getOriginalBuildRequires()
+        self.__cat.debug(&quot;br: &quot; + str(br))
+        return br

Modified: trunk/tools/pydar2/pydar/postgresqlstorage.py
===================================================================
--- trunk/tools/pydar2/pydar/postgresqlstorage.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/pydar/postgresqlstorage.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -59,6 +59,23 @@
         self.__releaseConnection(conn)
         return retval
         
+    def getMostRecentBuilds(self, targetName):
+        retval = []
+        conn = self.__getConnection()
+        cursor = conn.cursor()
+        sql = &quot;select min(tf.addtimestamp)::date as mintimestamp, tf.filename, tf.name, tf.distroarchtag from pydar2_target_files tf, pydar2_targets targ, pydar2_specfile_version v, pydar2_specfile_tags tname, pydar2_distroarch distro where tf.version = v.version and tname.versionid=v.id and tname.name='NAME' and tname.value=tf.name and tname.distroid=distro.id and distro.distroarchtag=tf.distroarchtag and tf.targetid=targ.id and targ.name='&quot; + targetName + &quot;' group by tf.filename, tf.name, tf.distroarchtag order by mintimestamp asc, tf.name asc, tf.filename asc, tf.distroarchtag asc&quot;
+        cursor.execute(sql)
+        for row in cursor.fetchall():
+            temphash = {}
+            temphash['timestamp'] = row[0] # mintimestamp, first occurrence of this rpm with this version/release for this distroarchtag
+            temphash['filename'] = row[1] # filename, for example:  aget/aget-0.200-5.1.el3.rf.i386.rpm
+            temphash['name'] = row[2] # short name: for example aget
+            temphash['distroarchtag'] = row[3] # distroarchtag
+            retval.append(temphash)
+        cursor.close()
+        self.__releaseConnection(conn)
+        return retval
+        
     def getNameOfMostRecentVersion(self, specFileId):
         retval = None
         conn = self.__getConnection()

Modified: trunk/tools/pydar2/pydar/specfiletags.py
===================================================================
--- trunk/tools/pydar2/pydar/specfiletags.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/pydar/specfiletags.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -36,13 +36,12 @@
     def __init__(self, specfile, defineargs):
         TagsFile.__init__(self,defineargs, &quot; --specfile &quot;, specfile)
 
-    # returns an array of names of rpms to install
-    def getBuildRequires(self):
+    def getOriginalBuildRequirements(self):
         commandpart = &quot;&quot;
         f = open(self.filename, 'r')
         line = f.readline()
-        while line != '' and string.find(line,&quot;%description&quot;) &lt; 0:
-            if string.find(string.lower(line),'buildrequires') &gt;= 0:
+        while line != '' and string.find(line,&quot;%files&quot;) &lt; 0:
+            if string.find(string.lower(line),'buildrequires') &gt;= 0 and string.find(string.lower(line),'#') != 0:
                 l = line.strip()
                 commandpart = commandpart + &quot;, &quot; + l
             line = f.readline()
@@ -56,13 +55,20 @@
         result = re.sub(reobj,&quot;&quot;,result)
         self.cat.debug(&quot;result2=&quot; + result)
         buildreqsarr = string.split(result,',')
+        print &quot;buildreqsarr=&quot; + str(buildreqsarr)
+        return buildreqsarr
+
+    # returns an array of names of rpms to install, this is a cleaned up version of the original buildrequirements
+    def getBuildRequires(self):
         finalbuildreqs = []
-        print &quot;buildreqsarr=&quot; + str(buildreqsarr)
+        buildreqsarr = self.getOriginalBuildRequirements()
         for br in buildreqsarr:
             # remove leading spaces
             br = re.sub('^ *','',br)
             # remove everything from the first space
             br = re.sub(' .*','',br)
+            if string.find(br, '/usr/bin/python') &gt;= 0:
+                br = &quot;python&quot;
             # remove all buildreqs which contain a '/' or a '('
             if string.find(br,'/') &lt; 0 and string.find(br,'(') &lt; 0 and br != &quot;&quot;:
                 finalbuildreqs.append(br)

Modified: trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -41,9 +41,15 @@
         print &quot;spec file without authority, ignoring&quot;
         return False
     else:
-        if string.find(authority, &quot;axel&quot;) &gt; 0:
+        if string.find(&quot; &quot; + authority, &quot;axel&quot;) &gt; 0:
             return False
+        if string.find(&quot; &quot; + authority, &quot;axel&quot;) &gt; 0:
+            return False
     ignoreList = []
+    ignoreList.append('galeon.spec') # difficult spec file: uses rpm -q
+    ignoreList.append('freetype')
+    ignoreList.append('gtksourceview.spec')
+    ignoreList.append('libgsf')
     ignoreList.append('avidemux.spec')
     ignoreList.append('distcc')
     ignoreList.append('gnomba.spec') # todo fix, it hangs the buildsystem at the moment

Modified: trunk/tools/pydar2/scripts/rpmforgedriesrepo.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgedriesrepo.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/scripts/rpmforgedriesrepo.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -64,7 +64,7 @@
     ext = __distroArchTagToReleaseExt(command.getDistroArchTag())
     contents = re.sub(re.compile('^%changelog\n(.*)\n',re.MULTILINE), r'%changelog\n\1 #' + str(command.getVersion())  +  r'\n',contents) 
     contents = re.sub(re.compile('^Release: (.*?)\n',re.MULTILINE), r'Release: \1.' + ext + r'\n',contents) 
-    contents = re.sub(re.compile('&gt;= %\(rpm -q --qf(.*?)\n',re.MULTILINE), r'', contents)
+    contents = re.sub(re.compile('&gt;= %\(rpm -q --qf(.*?)\n',re.MULTILINE), r'\n', contents)
     mo = re.search(re.compile('^# Authority:(.*)\n',re.MULTILINE), contents)
     packager = ''
     if mo!= None:

Modified: trunk/tools/pydar2/scripts/rpmforgesite.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgesite.py	2005-07-26 20:23:34 UTC (rev 3433)
+++ trunk/tools/pydar2/scripts/rpmforgesite.py	2005-07-26 20:36:05 UTC (rev 3434)
@@ -58,23 +58,23 @@
         self.__storage = storagefactory.StorageFactory.getStorage()
         self.__rpmlists = []
         addPaths = ['redhat/el4/en/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;el4-i386-dries&quot;, &quot;el4 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>&quot;, [&quot;el4.rf&quot;], &quot;Red Hat Enterprise Linux 4 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;el4-i386-dries&quot;, &quot;el4 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>&quot;, [&quot;el4.rf&quot;], &quot;Red Hat Enterprise Linux 4 for i386&quot;, addPaths))
         addPaths = ['redhat/el3/en/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;el3-i386-dries&quot;, &quot;el3 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>&quot;, [&quot;el3.rf&quot;], &quot;Red Hat Enterprise Linux 3 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;el3-i386-dries&quot;, &quot;el3 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>&quot;, [&quot;el3.rf&quot;], &quot;Red Hat Enterprise Linux 3 for i386&quot;, addPaths))
         addPaths = ['fedora/fc3/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;fc3-i386-dries&quot;, &quot;fc3 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>&quot;, [&quot;fc3.rf&quot;, &quot;fc3.dries&quot;], &quot;Fedora Core 3 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc3-i386-dries&quot;, &quot;fc3 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>&quot;, [&quot;fc3.rf&quot;, &quot;fc3.dries&quot;], &quot;Fedora Core 3 for i386&quot;, addPaths))
         addPaths = ['fedora/fc2/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;fc2-i386-dries&quot;, &quot;fc2 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/</A>&quot;, [&quot;fc2.rf&quot;, &quot;fc2.dries&quot;], &quot;Fedora Core 2 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc2-i386-dries&quot;, &quot;fc2 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc2/i386/RPMS.dries/</A>&quot;, [&quot;fc2.rf&quot;, &quot;fc2.dries&quot;], &quot;Fedora Core 2 for i386&quot;, addPaths))
         addPaths = ['fedora/fc1/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;fc1-i386-dries&quot;, &quot;fc1 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/</A>&quot;, [&quot;fc1.rf&quot;, &quot;fc1.dries&quot;], &quot;Fedora Core 1 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc1-i386-dries&quot;, &quot;fc1 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc1/i386/RPMS.dries/</A>&quot;, [&quot;fc1.rf&quot;, &quot;fc1.dries&quot;], &quot;Fedora Core 1 for i386&quot;, addPaths))
         addPaths = ['fedora/fc4/i386']
-        self.__rpmlists.append(DistroArchObject(&quot;fc4-i386-dries&quot;, &quot;fc4 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/</A>&quot;, [&quot;fc4.rf&quot;, &quot;fc4.dries&quot;], &quot;Fedora Core 4 for i386&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc4-i386-dries&quot;, &quot;fc4 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/</A>&quot;, [&quot;fc4.rf&quot;, &quot;fc4.dries&quot;], &quot;Fedora Core 4 for i386&quot;, addPaths))
         addPaths = ['fedora/fc4/x86_64']
-        self.__rpmlists.append(DistroArchObject(&quot;fc4-x86_64-dries&quot;, &quot;fc4 x86_64 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/</A>&quot;, [&quot;fc4.rf&quot;, &quot;fc4.dries&quot;], &quot;Fedora Core 4 for x86_64&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;fc4-x86_64-dries&quot;, &quot;fc4 x86_64 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/</A>&quot;, [&quot;fc4.rf&quot;, &quot;fc4.dries&quot;], &quot;Fedora Core 4 for x86_64&quot;, addPaths))
         addPaths = ['aurora/1.92/sparc']
-        self.__rpmlists.append(DistroArchObject(&quot;au1.92-sparc-dries&quot;, &quot;au1.92 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/</A>&quot;, [&quot;au1.92.rf&quot;, &quot;au1.92.dries&quot;], &quot;Aurora 1.92 for sparc&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;au1.92-sparc-dries&quot;, &quot;au1.92 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.92/sparc/RPMS.dries/</A>&quot;, [&quot;au1.92.rf&quot;, &quot;au1.92.dries&quot;], &quot;Aurora 1.92 for sparc&quot;, addPaths))
         addPaths = ['aurora/1.91/sparc']
-        self.__rpmlists.append(DistroArchObject(&quot;au1.91-sparc-dries&quot;, &quot;au1.91 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/</A>&quot;, [&quot;au1.91.rf&quot;, &quot;au1.91.dries&quot;],&quot;Aurora 1.91 for sparc&quot;, addPaths))
+        #self.__rpmlists.append(DistroArchObject(&quot;au1.91-sparc-dries&quot;, &quot;au1.91 sparc rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/aurora/1.91/sparc/RPMS.dries/</A>&quot;, [&quot;au1.91.rf&quot;, &quot;au1.91.dries&quot;],&quot;Aurora 1.91 for sparc&quot;, addPaths))
         self.__rpmNameToSpecSubDirName = {}
         self.__completeRpmsLists()
         self.__completeSiteValues()
@@ -165,6 +165,7 @@
         self.generateIndexPage()
         self.generateMirrorsPage()
         self.generatePackagesPage()
+        self.generateRecentChangesPage()
         self.generateGPGKeyPage()
         self.clientConfigPage()
         self.pydar2Pages()
@@ -239,6 +240,33 @@
         contents = self.__getFileContents(&quot;dries/mirrors-part.html&quot;)
         self.generateFullPage(contents,[],&quot;mirrors.html&quot;, &quot;Mirrors: Dries RPM Repository&quot;)
         
+    def generateRecentChangesPage(self):
+        contents = &quot;&quot;
+        contents = &quot;&lt;h2&gt;Recent Changes&lt;/h2&gt;&quot;
+        contents = contents + &quot;&lt;p&gt;Please note that an rpm might not be available immediately on all the mirrors.&lt;/p&gt;&quot;
+        arr = self.__storage.getMostRecentBuilds('dries')
+        lastday = &quot;&quot;
+        alreadyseen = []
+        subcontents = &quot;&quot;
+        for hash in arr:
+            day = hash['timestamp']
+            if lastday == &quot;&quot;:
+                lastday = day
+            if day != lastday:
+                subcontents = &quot;&lt;h3&gt;&quot; + day + &quot;&lt;/h3&gt;\n&quot; + subcontents
+            lastday = day
+            filename = hash['filename']
+            name = hash['name']
+            distroarchtag = hash['distroarchtag']
+            suffix = &quot;&quot;
+            if name + &quot;-&quot; + distroarchtag not in alreadyseen:
+                suffix = &quot;, new&quot;
+                alreadyseen.append(name + &quot;-&quot; + distroarchtag)
+            subcontents = filename + &quot; (&quot; + name + &quot; for &quot; + distroarchtag + suffix + &quot;)&lt;br /&gt;&quot; + subcontents
+        if lastday != &quot;&quot;:
+            subcontents = &quot;&lt;h3&gt;&quot; + day + &quot;&lt;/h3&gt;\n&quot; + subcontents
+        contents = contents + subcontents
+        self.generateFullPage(contents,[],&quot;recentchanges.html&quot;, &quot;Updated and new rpms: Dries RPM Repository&quot;)
         
     def generateDistroArchPageRpm(self,distroArch):
         contents = &quot;&quot;
@@ -390,7 +418,8 @@
         menu = menu + &quot;&lt;a href=\&quot;/rpm/clientconfig.html\&quot;&gt;APT/YUM/Smart config&lt;/a&gt;&lt;br /&gt;&quot;
         menu = menu + &quot;&lt;a href=\&quot;/rpm/packages.html\&quot;&gt;List of packages&lt;/a&gt;&lt;br /&gt;&quot;
         menu = menu + &quot;&lt;a href=\&quot;/rpm/RPM-GPG-KEY.dries.html\&quot;&gt;GPG key&lt;/a&gt;&lt;br /&gt;&quot;
-        menu = menu + &quot;&lt;a href=\&quot;/rpm/mirrors.html\&quot;&gt;mirrors&lt;/a&gt;&lt;br /&gt;&quot;
+        menu = menu + &quot;&lt;a href=\&quot;/rpm/mirrors.html\&quot;&gt;Mirrors&lt;/a&gt;&lt;br /&gt;&quot;
+        menu = menu + &quot;&lt;a href=\&quot;/rpm/mirrors.html\&quot;&gt;Recent changes&lt;/a&gt;&lt;br /&gt;&quot;
         menu = menu + &quot;&lt;a href=\&quot;/rpm/pydar2/index.html\&quot;&gt;Pydar2&lt;/a&gt;&lt;br /&gt;&quot;
         menu = menu + &quot;&lt;strong&gt;Rpms:&lt;/strong&gt;&lt;br /&gt;&quot;
         for k in self.__rpmlists:


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002235.html">[svn] r3433 - trunk/rpms/python-chm
</A></li>
	<LI>Next message: <A HREF="002237.html">[svn] r3435 - trunk/rpms/python-elementtree
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2236">[ date ]</a>
              <a href="thread.html#2236">[ thread ]</a>
              <a href="subject.html#2236">[ subject ]</a>
              <a href="author.html#2236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
