<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r3355 - in trunk/tools/pydar2: . dries etc/yum pydar scripts	sql
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3355%20-%20in%20trunk/tools/pydar2%3A%20.%20dries%20etc/yum%20pydar%20scripts%0A%09sql&In-Reply-To=%3C20050704190825.89B63318031%40pooch.vmhosting.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002156.html">
   <LINK REL="Next"  HREF="002158.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r3355 - in trunk/tools/pydar2: . dries etc/yum pydar scripts	sql</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3355%20-%20in%20trunk/tools/pydar2%3A%20.%20dries%20etc/yum%20pydar%20scripts%0A%09sql&In-Reply-To=%3C20050704190825.89B63318031%40pooch.vmhosting.org%3E"
       TITLE="[svn] r3355 - in trunk/tools/pydar2: . dries etc/yum pydar scripts	sql">packagers at lists.rpmforge.net
       </A><BR>
    <I>Mon Jul  4 21:08:25 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002156.html">[svn] r3354 - trunk/rpms/mpg321
</A></li>
        <LI>Next message: <A HREF="002158.html">[svn] r3356 - in trunk/rpms: epylog icewm pydar2 scribus texmacs	windowmaker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2157">[ date ]</a>
              <a href="thread.html#2157">[ thread ]</a>
              <a href="subject.html#2157">[ subject ]</a>
              <a href="author.html#2157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dries
Date: 2005-07-04 21:08:23 +0200 (Mon, 04 Jul 2005)
New Revision: 3355

Added:
   trunk/tools/pydar2/etc/yum/el3-i386.conf
   trunk/tools/pydar2/etc/yum/el4-i386.conf
   trunk/tools/pydar2/etc/yum/fc4-i386.conf
   trunk/tools/pydar2/etc/yum/fc4-x86_64.conf
Modified:
   trunk/tools/pydar2/dries/index-part.html
   trunk/tools/pydar2/pydar-buildserver-master.py
   trunk/tools/pydar2/pydar-master-update.py
   trunk/tools/pydar2/pydar-remote.py
   trunk/tools/pydar2/pydar/commandlist.py
   trunk/tools/pydar2/pydar/config.py
   trunk/tools/pydar2/pydar/filesbasedspecrepository.py
   trunk/tools/pydar2/pydar/postgresqlstorage.py
   trunk/tools/pydar2/pydar/pydarclient.py
   trunk/tools/pydar2/pydar/rights.py
   trunk/tools/pydar2/pydar/specrepositoryspecfile.py
   trunk/tools/pydar2/pydar/tagsfile.py
   trunk/tools/pydar2/pydar/target.py
   trunk/tools/pydar2/pydar/yumbasedbuildroot.py
   trunk/tools/pydar2/scripts/norpmforgetemplatesfilter.py
   trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py
   trunk/tools/pydar2/scripts/rpmforgedriesrepo.py
   trunk/tools/pydar2/scripts/rpmforgesite.py
   trunk/tools/pydar2/sql/master.sql
Log:
update

Modified: trunk/tools/pydar2/dries/index-part.html
===================================================================
--- trunk/tools/pydar2/dries/index-part.html	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/dries/index-part.html	2005-07-04 19:08:23 UTC (rev 3355)
@@ -1,10 +1,10 @@
 &lt;h2&gt;Dries RPM Repository&lt;/h2&gt;
 &lt;p&gt;
-This repository contains rpms for Red Hat Enterprise Linux 4 and 3, for Fedora Core 3, 2 and 1 
+This repository contains rpms for Red Hat Enterprise Linux 4 and 3, for Fedora Core 4, 3, 2 and 1 
 and for Aurora Linux 1.92 and 1.91. The packages for Red Hat Enterprise Linux also work on rebuilds 
 like CentOS and TaoLinux. This repository is part of the RPMforge project which is a 
 collaboration of several packagers. The aim of RPMforge is to provide packages for 
-various RPM-based distributions and a multitude of architectures (x86, AMD64, alpha and sparc) That's why 
+various RPM-based distributions and a multitude of architectures (i386, AMD64, alpha and sparc) That's why 
 you will find so many rpms of Bert, Dag and Matthias on my site: i'm rebuilding all of 
 their spec files for Aurora Linux 1.92 (sparc) for example.&lt;/p&gt;
 &lt;p&gt;

Added: trunk/tools/pydar2/etc/yum/el3-i386.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/el3-i386.conf	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/etc/yum/el3-i386.conf	2005-07-04 19:08:23 UTC (rev 3355)
@@ -0,0 +1,26 @@
+[main]
+cachedir=/var/cache/yum
+#debuglevel=1
+#errorlevel=10
+logfile=/var/log/yum.log
+pkgpolicy=newest
+distroverpkg=redhat-release
+tolerant=1
+exactarch=1
+#gpgcheck=0
+reposdir=noway
+
+[os]
+name=el3
+baseurl=<A HREF="http://yam.localmirror/yam/rhes3-i386/RPMS.os">http://yam.localmirror/yam/rhes3-i386/RPMS.os</A>
+#gpgcheck=0
+
+[dries]
+name=el3 rpms dries
+baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>
+#gpgcheck=0
+
+[dag] 
+name=Dag RPM Repository for el4
+baseurl=<A HREF="http://apt.sw.be/redhat/el3/en/i386/dag">http://apt.sw.be/redhat/el3/en/i386/dag</A>
+#gpgcheck=0


Property changes on: trunk/tools/pydar2/etc/yum/el3-i386.conf
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/pydar2/etc/yum/el4-i386.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/el4-i386.conf	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/etc/yum/el4-i386.conf	2005-07-04 19:08:23 UTC (rev 3355)
@@ -0,0 +1,26 @@
+[main]
+cachedir=/var/cache/yum
+#debuglevel=1
+#errorlevel=10
+logfile=/var/log/yum.log
+pkgpolicy=newest
+distroverpkg=redhat-release
+tolerant=1
+exactarch=1
+#gpgcheck=0
+reposdir=noway
+
+[os]
+name=el4
+baseurl=<A HREF="http://yam.localmirror/yam/rhes4-i386/RPMS.os">http://yam.localmirror/yam/rhes4-i386/RPMS.os</A>
+#gpgcheck=0
+
+[dries]
+name=el4 rpms dries
+baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>
+#gpgcheck=0
+
+[dag] 
+name=Dag RPM Repository for el4
+baseurl=<A HREF="http://apt.sw.be/redhat/el4/en/i386/dag">http://apt.sw.be/redhat/el4/en/i386/dag</A>
+#gpgcheck=0


Property changes on: trunk/tools/pydar2/etc/yum/el4-i386.conf
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/pydar2/etc/yum/fc4-i386.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/fc4-i386.conf	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/etc/yum/fc4-i386.conf	2005-07-04 19:08:23 UTC (rev 3355)
@@ -0,0 +1,31 @@
+[main]
+cachedir=/var/cache/yum
+#debuglevel=1
+#errorlevel=10
+logfile=/var/log/yum.log
+pkgpolicy=newest
+distroverpkg=fedora-release
+tolerant=1
+exactarch=1
+#gpgcheck=0
+reposdir=noway
+
+[os]
+name=Fedora Linux core
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/">http://ftp.belnet.be/linux/fedora/linux/core/4/i386/os/</A>
+gpgcheck=0
+
+[updates]
+name=Fedora Linux updates
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/">http://ftp.belnet.be/linux/fedora/linux/updates/3/i386/</A>
+gpgcheck=0
+
+[dries]
+name=Extra Fedora rpms dries
+baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/i386/RPMS.dries/</A>
+gpgcheck=0
+
+[extras]
+name=Fedora Extras $releasever - $basearch
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/">http://ftp.belnet.be/linux/fedora/linux/extras/4/i386/</A>
+gpgcheck=0


Property changes on: trunk/tools/pydar2/etc/yum/fc4-i386.conf
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/pydar2/etc/yum/fc4-x86_64.conf
===================================================================
--- trunk/tools/pydar2/etc/yum/fc4-x86_64.conf	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/etc/yum/fc4-x86_64.conf	2005-07-04 19:08:23 UTC (rev 3355)
@@ -0,0 +1,44 @@
+[main]
+cachedir=/var/cache/yum
+#debuglevel=1
+#errorlevel=10
+logfile=/var/log/yum.log
+pkgpolicy=newest
+distroverpkg=fedora-release
+tolerant=1
+exactarch=1
+#gpgcheck=0
+reposdir=noway
+
+[os]
+name=Fedora Linux core
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/core/4/x86_64/os/">http://ftp.belnet.be/linux/fedora/linux/core/4/x86_64/os/</A>
+gpgcheck=0
+#baseurl=<A HREF="http://pydar2.vmhosting.org/yam/fc4-x86_64/RPMS.os/">http://pydar2.vmhosting.org/yam/fc4-x86_64/RPMS.os/</A>
+
+[updates]
+name=Fedora Linux updates
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/updates/4/x86_64/">http://ftp.belnet.be/linux/fedora/linux/updates/4/x86_64/</A>
+gpgcheck=0
+
+[dries]
+name=Extra Fedora rpms dries
+baseurl=<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc4/x86_64/RPMS.dries/</A>
+gpgcheck=0
+
+# not needed during development of pydar2
+#[freshrpms]
+#name=Fedora Linux freshrpms
+#baseurl=<A HREF="http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms">http://ayo.freshrpms.net/fedora/linux/3/i386/freshrpms</A>
+##gpgcheck=0
+
+# not needed during development of pydar2
+#[dag]
+#name=Dag RPM Repository for Fedora Core
+#baseurl=<A HREF="http://apt.sw.be/fedora/3/en/i386/dag">http://apt.sw.be/fedora/3/en/i386/dag</A>
+##gpgcheck=0
+
+[extras]
+name=Fedora Extras $releasever - $basearch
+baseurl=<A HREF="http://ftp.belnet.be/linux/fedora/linux/extras/4/x86_64/">http://ftp.belnet.be/linux/fedora/linux/extras/4/x86_64/</A>
+gpgcheck=0


Property changes on: trunk/tools/pydar2/etc/yum/fc4-x86_64.conf
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/tools/pydar2/pydar/commandlist.py
===================================================================
--- trunk/tools/pydar2/pydar/commandlist.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/commandlist.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -16,7 +16,7 @@
 # Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 # Copyright 2004 Dries Verachtert
 
-import config, os, shutil
+import config, os, shutil, base64, time
 import storagefactory
 from mastercommand import MasterCommand
 from log4py import Logger
@@ -41,6 +41,27 @@
         self.__cat.debug(&quot;end&quot;)
         return aCommand
         
+    def addTestCommand(self,commandName,userId,fileContentsEncoded,toEmail,distroArchTag,priority):
+        self.__cat.debug(&quot;start&quot;)
+        # check if a target 'test' and a specrepo 'test' exists
+        testRepo = self.__config.getSpecRepositoryList().getSpecRepositoryByName('test')
+        testTarget = self.__config.getTargetList().getTargetByName('test')
+        if testRepo == None or testTarget == None:
+            self.__cat.warn(&quot;no test target and/or test spec repo&quot;)
+            return None
+        # add this specfile to the specrepo
+        fileContents = base64.decodestring(fileContentsEncoded)
+        # current timestamp should be quite unique for queued test spec files
+        fileName = userId + &quot;test&quot; + str(time.time()) + &quot;.spec&quot;
+        self.__cat.debug(&quot;fileName: &quot; + fileName)
+        # create specfile and write contents
+        f = open(testRepo.getRootDirectory() + &quot;/&quot; + fileName,&quot;w&quot;)
+        f.write(fileContents)
+        f.close()
+        self.__cat.debug(&quot;length, encoded: &quot; + str(len(fileContentsEncoded)) + &quot;, normal: &quot;+ str(len(fileContents)))
+        testRepo.updateFileList()
+        return self.addCommand(&quot;BUILDSPECBYPATH&quot;, userId, testRepo.getName(), &quot;/&quot; + fileName, toEmail, distroArchTag, priority, testTarget.getName())
+    
         
     def __createCommandDir(self,aCommand):
         brr = BuildRootResult(None)
@@ -94,6 +115,7 @@
         
         
     def __checkAndCreateCommand(self,commandName,userId,specRepoName,specFilePath,toEmail,distroArchTag,priority,targetName):
+        self.__cat.debug(&quot;userId:&quot;+str(userId)+&quot;,specRepoName:&quot;+str(specRepoName) + &quot;,specFilePath:&quot; + specFilePath + &quot;,distroArchTag:&quot; + str(distroArchTag))
         if commandName != &quot;BUILDSPECBYPATH&quot;:
             raise Exception(&quot;unknown command name&quot;)
         # the userId is already checked, now check some other values

Modified: trunk/tools/pydar2/pydar/config.py
===================================================================
--- trunk/tools/pydar2/pydar/config.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/config.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -97,6 +97,14 @@
         self.__fullInitMaster()
         return self.__buildmasterport
  
+    def getMaxAutoQueueCount(self):
+        self.__fullInitMaster()
+        return self.__maxautoqueuecount
+    
+    def getCheckSumType(self):
+        self.__fullInitMaster()
+        return self.__checksumtype
+
     def __fullInitMaster(self):
         if Config.__fullInitMasterDone or Config.__withinFullInitMaster:
             return
@@ -111,6 +119,13 @@
         self.__buildmasterhostname = myParser.get('master','buildmasterhostname')
         self.__buildmasterport = myParser.getint('master','buildmasterport')
         self.__dbconnectstring = myParser.get('master','dbconnectstring')
+        self.__maxautoqueuecount = 100
+        if myParser.has_option('master','maxautoqueuecount'):
+            self.__maxautoqueuecount = myParser.get('master','maxautoqueuecount')
+        self.__checksumtype = &quot;SHA&quot;
+        if myParser.has_option('master','checksumtype'):
+            self.__checksumtype = myParser.get('master','checksumtype')
+            
         #
         self.__specreposrootdir=&quot;/var/lib/pydar2/specrepos&quot;
         self.__specRepositoryList = SpecRepositoryList()
@@ -253,7 +268,7 @@
             
         self.__slavedataroot = '/var/lib/pydar2/slavedataroot'
         self.__mastercommandswebsite = '<A HREF="http://pydarmaster">http://pydarmaster</A>'
-        self.__sleeptime = 30
+        self.__sleeptime = 300
         self.__smtpserver = '127.0.0.1'
         __withinFullInitSlave = False
         __fullInitSlaveDone = True

Modified: trunk/tools/pydar2/pydar/filesbasedspecrepository.py
===================================================================
--- trunk/tools/pydar2/pydar/filesbasedspecrepository.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/filesbasedspecrepository.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -35,3 +35,8 @@
         
     def getUpdateCommand(self):
         return &quot;&quot;
+    
+    def getSpecFileVersion(self, specRepoSpecFile):
+        fullPath = self.getRootDirectory() + &quot;/&quot; + specRepoSpecFile.getSubDir() + &quot;/&quot; + specRepoSpecFile.getFileName()
+        self.__cat.debug(&quot;fullPath: &quot; + fullPath)
+        return str(os.path.getmtime(fullPath)) + &quot;-&quot; + str(os.path.getsize(fullPath))

Modified: trunk/tools/pydar2/pydar/postgresqlstorage.py
===================================================================
--- trunk/tools/pydar2/pydar/postgresqlstorage.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/postgresqlstorage.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -76,7 +76,7 @@
         retval = {}
         conn = self.__getConnection()
         cursor = conn.cursor()
-        sql = &quot;select sv.specfileid, max(version) as maxversion from pydar2_specfile_version sv, pydar2_specfile v where sv.specfileid=v.id and v.specrepoid=&quot; + str(specRepository.getId()) + &quot; group by sv.specfileid&quot;
+        sql = &quot;select sv.specfileid, max(version) as maxversion from pydar2_specfile_version sv, pydar2_specfile v where sv.specfileid=v.id and v.specrepoid=&quot; + str(specRepository.getId()) + &quot; group by sv.specfileid order by maxversion desc&quot;
         cursor.execute(sql)
         for row in cursor.fetchall():
             retval[row[0]] = row[1]
@@ -95,6 +95,7 @@
         cursor.close()
         self.__releaseConnection(conn)
         return retval
+    
         
     def updateTargetFile(self, targetObj, fileName, checksum, version, distroarchtag, name):
         self.__cat.debug(&quot;start, fileName:&quot;  + str(fileName) + &quot;,checksum:&quot; + str(checksum) + &quot;,version:&quot; + str(version) + &quot;,distroarchtag:&quot; + str(distroarchtag) + &quot;,name:&quot; + str(name))

Modified: trunk/tools/pydar2/pydar/pydarclient.py
===================================================================
--- trunk/tools/pydar2/pydar/pydarclient.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/pydarclient.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -45,6 +45,11 @@
         retval = myserverclient.buildSpecByPath(userId,password, specRepoName, specFilePath, toEmail, distroArchTag, priority, target)
         return retval
 
+    def testBuildSpecByPath(self,userId, password, fileContents, toEmail, distroArchTag, priority):
+        myserverclient = Server(self.buildmasterurl)
+        retval = myserverclient.testBuildSpecByPath(userId,password, fileContents, toEmail, distroArchTag, priority)
+        return retval
+    
     def callUpdateSiteScript(self,userId,password,specRepoName):
         myserverclient = Server(self.buildmasterurl)
         retval = myserverclient.callUpdateSiteScript(userId,password, specRepoName)

Modified: trunk/tools/pydar2/pydar/rights.py
===================================================================
--- trunk/tools/pydar2/pydar/rights.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/rights.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -35,5 +35,6 @@
     AUTO_QUEUE = &quot;AUTO_QUEUE&quot;
     MOVE_COMMAND_RESULTS =&quot;MOVE_COMMAND_RESULTS&quot;
     UPDATE_TARGET_FILE_LIST = &quot;UPDATE_TARGET_FILE_LIST&quot;
+    TEST_BUILD_SPEC_BY_PATH = &quot;TEST_BUILD_SPEC_BY_PATH&quot;
     
     

Modified: trunk/tools/pydar2/pydar/specrepositoryspecfile.py
===================================================================
--- trunk/tools/pydar2/pydar/specrepositoryspecfile.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/specrepositoryspecfile.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -21,7 +21,8 @@
 
 from log4py import Logger
 from specfiletags import SpecFileTags
-import sha
+import sha, os
+import config
 
 class SpecRepositorySpecFile:
     def __init__(self, specRepository,subDir,fileName):
@@ -49,15 +50,19 @@
         return SpecFileTags(self.getFullPath(), definetags)
         
     def __calculateCheckSum(self):
-        s = sha.new()
         fullFileName = self.getFullPath()
-        f = open(fullFileName, 'r')
-        line = f.readline()
-        while line != '':
-            s.update(line)
+        type = config.Config.getInstance().getCheckSumType()
+        if type == &quot;SHA&quot;:
+            s = sha.new()
+            f = open(fullFileName, 'r')
             line = f.readline()
-        f.close()
-        return s.hexdigest()
+            while line != '':
+                s.update(line)
+                line = f.readline()
+            f.close()
+            return s.hexdigest()
+        else:
+            return str(os.path.getmtime(fullFileName)) + &quot;-&quot; + str(os.path.getsize(fullFileName))
     
     def getSpecRepository(self):
         return self.__specRepository

Modified: trunk/tools/pydar2/pydar/tagsfile.py
===================================================================
--- trunk/tools/pydar2/pydar/tagsfile.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/tagsfile.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -42,7 +42,7 @@
     def getStandardTags(self):
         self.cat.debug(&quot;start&quot;)
         queryformat = self.getQueryFormatString()
-        self.cat.debug(&quot;queryformat=&quot; + str(queryformat))
+        #self.cat.debug(&quot;queryformat=&quot; + str(queryformat))
         commandline = &quot;rpm -q &quot; + self.defineargs + &quot; --queryformat '&quot; + queryformat + &quot;' &quot; + self.addToCommandLine + self.filename
         self.cat.debug(&quot;commandline=&quot; + commandline)
         result = commands.getoutput(commandline)

Modified: trunk/tools/pydar2/pydar/target.py
===================================================================
--- trunk/tools/pydar2/pydar/target.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/target.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -112,6 +112,7 @@
     def __autoQueueByDistroArchTag(self,datag, mailTo, userName, priority, specRepository):
         self.__cat.debug(&quot;start, datag=&quot; + datag)
         self.__reloadAcceptCommandScript()
+        queuecounter = 0
         brr = BuildRootResult(None)
         brr.logDebugLine(&quot;autoQueue log for DistroArchTag:&quot; + str(datag) + &quot;,mailTo:&quot; + str(mailTo) + &quot;,userName:&quot;+ str(userName) + &quot;,priority:&quot; + str(priority) + &quot;,specRepository.name:&quot; + specRepository.getName() + &quot;,target.name:&quot;+ self.getName())
         # create a hash which contains:   specfileid -&gt; version   for each specfile in the specrepository
@@ -119,19 +120,23 @@
         
         specRepoSpecFileIdsToVersions = self.__storage.getSpecFileIdsToVersions(specRepository)
         targetRpmsSpecFileIdsToVersions = self.__storage.getTargetRpmsSpecFileIdsToVersions(self, datag,specRepository)
-        for spid in specRepoSpecFileIdsToVersions.keys():
-            if (spid not in targetRpmsSpecFileIdsToVersions.keys()) or (specRepoSpecFileIdsToVersions[spid] &gt; targetRpmsSpecFileIdsToVersions[spid]):
-                self.autoQueueOne(spid, datag, mailTo, userName, priority, specRepository, brr)
-            else:
-                self.__cat.debug(&quot;not queuing: specFileId=&quot; + str(spid) + &quot;,distroArchTag=&quot; + datag + &quot;,mailto=&quot; + mailTo + &quot;,userName=&quot; + userName + &quot;,priority=&quot; +str(priority) +&quot;,specRepository=&quot; + str(specRepository))
-                targetVersion = &quot;NONE&quot;
-                if spid in targetRpmsSpecFileIdsToVersions.keys():
-                    targetVersion = targetRpmsSpecFileIdsToVersions[spid]
-                specObj = specRepository.getSpecRepositorySpecFileById(spid)
-                pathFromRoot = &quot;NONE&quot;
-                if specObj != None:
-                    pathFromRoot = specObj.getPathFromRoot()
-                brr.logDebugLine(&quot;specRepoSpecId &quot; + str(spid) + &quot; not queued: &quot; + &quot;specRepo version: &quot; + str(specRepoSpecFileIdsToVersions[spid]) + &quot;,targetRpm Version:&quot; + str(targetVersion) + &quot;,path:&quot; + str(pathFromRoot))
+        k = specRepoSpecFileIdsToVersions.keys()
+        k.sort(lambda b, c: - cmp( specRepoSpecFileIdsToVersions[b], specRepoSpecFileIdsToVersions[c]))
+        for spid in k:
+            if queuecounter &lt; config.Config.getInstance().getMaxAutoQueueCount():
+                if (spid not in targetRpmsSpecFileIdsToVersions.keys()) or (specRepoSpecFileIdsToVersions[spid] &gt; targetRpmsSpecFileIdsToVersions[spid]):
+                    if self.autoQueueOne(spid, datag, mailTo, userName, priority, specRepository, brr):
+                        queuecounter = queuecounter + 1
+                else:
+                    self.__cat.debug(&quot;not queuing: specFileId=&quot; + str(spid) + &quot;,distroArchTag=&quot; + datag + &quot;,mailto=&quot; + mailTo + &quot;,userName=&quot; + userName + &quot;,priority=&quot; +str(priority) +&quot;,specRepository=&quot; + str(specRepository))
+                    targetVersion = &quot;NONE&quot;
+                    if spid in targetRpmsSpecFileIdsToVersions.keys():
+                        targetVersion = targetRpmsSpecFileIdsToVersions[spid]
+                    specObj = specRepository.getSpecRepositorySpecFileById(spid)
+                    pathFromRoot = &quot;NONE&quot;
+                    if specObj != None:
+                        pathFromRoot = specObj.getPathFromRoot()
+                    brr.logDebugLine(&quot;specRepoSpecId &quot; + str(spid) + &quot; not queued: &quot; + &quot;specRepo version: &quot; + str(specRepoSpecFileIdsToVersions[spid]) + &quot;,targetRpm Version:&quot; + str(targetVersion) + &quot;,path:&quot; + str(pathFromRoot))
         self.__informClientAfterAutoQueueByDistroArchTag(brr, mailTo, datag)
                 
     def __informClientAfterAutoQueueByDistroArchTag(self, brr, mailTo, datag):
@@ -164,8 +169,10 @@
         if (specObj != None) and self.acceptCommand(testCommand):
             config.Config.getInstance().getCommandList().addCommand(&quot;BUILDSPECBYPATH&quot;,userName,specRepository.getName(),pathFromRoot,mailTo,distroArchTag,priority,self.getName())
             brr.logDebugLine(&quot;accepted: id: &quot; + str(specFileId) + &quot;, path: &quot; + pathFromRoot)
+            return True
         else:
             brr.logDebugLine(&quot;not accepted: id: &quot; + str(specFileId) + &quot;, path: &quot; + pathFromRoot)
+            return False
         
         
     # get some data from an srpm
@@ -176,15 +183,21 @@
             return None
     
     def __getCheckSum(self,fileName):
-        self.__cat.debug(&quot;fileName: &quot; + fileName)
-        s = sha.new()
-        f = open(os.path.join(self.getRpmsDir(), fileName), 'r')
-        line = f.readline()
-        while line != '':
-            s.update(line)
+        #self.__cat.debug(&quot;fileName: &quot; + fileName)
+        fullFileName = os.path.join(self.getRpmsDir(), fileName)
+        type = config.Config.getInstance().getCheckSumType()
+        if type == &quot;SHA&quot;:
+            s = sha.new()
+            f = open(fullFileName, 'r')
             line = f.readline()
-        f.close()
-        return s.hexdigest()
+            while line != '':
+                s.update(line)
+                line = f.readline()
+            f.close()
+            return s.hexdigest()
+        else:
+            # file modification date + size
+            return str(os.path.getmtime(fullFileName)) + &quot;-&quot; + str(os.path.getsize(fullFileName))
     
     # this updates the list of rpms in the database
     # with this list and the list of specrepositoryspecfiles, it is possible to create a todo list

Modified: trunk/tools/pydar2/pydar/yumbasedbuildroot.py
===================================================================
--- trunk/tools/pydar2/pydar/yumbasedbuildroot.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar/yumbasedbuildroot.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -214,9 +214,13 @@
         script = script + &quot;chown -R root.root &quot; + self.rootdir + &quot;/usr/src/redhat\n&quot;
         # the following command first checks if the dependencies are ok
         # ex: --define '_topdir /var/lib/pydar2/roots/yum-fc3-i386/usr/src/redhat'
-        script = script + &quot;(/usr/bin/rpmbuild --define '_topdir &quot; + self.rootdir + &quot;/usr/src/redhat' &quot; + command.getDefines() + &quot; --root=&quot; + self.rootdir + &quot; --nobuild --bs &quot; + self.rootdir + &quot;/usr/src/redhat/SPECS/&quot; + command.getSpecFileShortFileName() + &quot; &amp;&amp; echo \&quot;deps check ok\&quot; &amp;&amp; &quot;
+        script = script + &quot;(echo file: &quot; + command.getSpecFileShortFileName() + &quot;;/usr/bin/rpmbuild --define '_topdir &quot; + self.rootdir + &quot;/usr/src/redhat' &quot; + command.getDefines() + &quot; --root=&quot; + self.rootdir + &quot; --nobuild --bs &quot; + self.rootdir + &quot;/usr/src/redhat/SPECS/&quot; + command.getSpecFileShortFileName() + &quot; &amp;&amp; echo \&quot;deps check ok\&quot; &amp;&amp; &quot;
         # do the real build
-        script = script + &quot;/usr/sbin/chroot &quot; + self.rootdir + &quot; /usr/bin/rpmbuild --nodeps -ba /usr/src/redhat/SPECS/&quot; + command.getSpecFileShortFileName() + &quot; &quot; + command.getDefines() + &quot; ) &gt; &quot; + self.rootdir + &quot;/buildlog.txt 2&gt;&amp;1&quot;
+        # todo: some 'post mortem analysis'
+        # if contains    error: Installed (but unpackaged) file(s) found:    -&gt; print output of a find in the buildroot
+        # if it contains a config.log:     See 'Config.log' for more details.
+        script = script + &quot;/usr/sbin/chroot &quot; + self.rootdir + &quot; /usr/bin/rpmbuild --nodeps -ba /usr/src/redhat/SPECS/&quot; + command.getSpecFileShortFileName() + &quot; &quot; + command.getDefines() + &quot; || &quot;
+        script = script + &quot;(echo ; echo ; echo CONFIG.LOG; echo ; cat &quot; + self.rootdir + &quot;/usr/src/redhat/BUILD/*/*onfig.log; echo ; echo ; echo FILES; echo ; echo ; (cd &quot; + self.rootdir  + &quot;/var/tmp/*-root*/ &amp;&amp; find .))) &gt; &quot; + self.rootdir + &quot;/buildlog.txt 2&gt;&amp;1&quot;
         self.__cat.debug( &quot;script contains: &quot; + script)
         return script
         

Modified: trunk/tools/pydar2/pydar-buildserver-master.py
===================================================================
--- trunk/tools/pydar2/pydar-buildserver-master.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar-buildserver-master.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -128,6 +128,15 @@
         else:
             raise Exception( &quot;UNKNOWN USERID&quot;)
 
+    def testBuildSpecByPath(self, userId,password, fileContents, toEmail, distroArchTag, priority):
+        #self.__cat.debug(&quot;start, userId=&quot; + userId + &quot;,specFileName=&quot; + specFileName + &quot;,toEmail=&quot; + toEmail + &quot;,releaseTag=&quot; + releaseTag + &quot;,machRoot=&quot; + machRoot + &quot;,priority=&quot; + priority)
+        if self.__storage.checkIfValidUserId(userId, password, Rights.TEST_BUILD_SPEC_BY_PATH):
+            self.__config.getCommandList().addTestCommand(&quot;TESTBUILDSPECBYPATH&quot;,userId,fileContents,toEmail,distroArchTag,priority)
+            return &quot;OK&quot;
+        else:
+            raise Exception( &quot;UNKNOWN USERID&quot;)
+
+        
     def updateSpecRepositoriesFileList(self,userId,password, specRepoName):
         self.__cat.debug(&quot;start,userId=&quot; + str(userId))
         if self.__storage.checkIfValidUserId(userId, password, Rights.UPDATE_SPEC_REPOSITORIES_FILE_LIST):

Modified: trunk/tools/pydar2/pydar-master-update.py
===================================================================
--- trunk/tools/pydar2/pydar-master-update.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar-master-update.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -49,7 +49,7 @@
 for line in lines:
     print &quot;line: &quot; + line + &quot;\n&quot;
     (status, output) = commands.getstatusoutput(&quot;/bin/bash -c \&quot;&quot;+line+&quot;\&quot;&quot;)
-    (status, output) = commands.getstatusoutput(&quot;/bin/bash -c \&quot;&quot;+line+&quot;\&quot;&quot;)
+    #(status, output) = commands.getstatusoutput(&quot;/bin/bash -c \&quot;&quot;+line+&quot;\&quot;&quot;)
     print &quot;status: &quot; + str(status)
     print &quot;output: &quot; + output
     

Modified: trunk/tools/pydar2/pydar-remote.py
===================================================================
--- trunk/tools/pydar2/pydar-remote.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/pydar-remote.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -1,6 +1,6 @@
 #!/usr/bin/python
 
-import getopt, os, sys
+import getopt, os, sys, base64
 sys.path.append(&quot;.&quot;)
 sys.path.append(&quot;pydar&quot;)
 sys.path.append(&quot;/usr/share/pydar2/pydar&quot;)
@@ -19,10 +19,13 @@
     def doBuildSpecByPath(self, userId,password, specRepoName, specFilePath, toEmail, distroArchTag, priority, target):
         self.__cat.debug(&quot;specFilePath=&quot; + specFilePath + &quot;,mailto=&quot; + toEmail + &quot;,distroArchTag=&quot; + distroArchTag)
         self.__client.buildSpecByPath(userId, password, specRepoName, specFilePath, toEmail, distroArchTag, priority, target)
+    def doTestBuildSpecByPath(self, userId,password,fileContents, toEmail, distroArchTag, priority):
+        self.__cat.debug(&quot;userId=&quot; + userId + &quot;,mailto=&quot; + toEmail + &quot;,distroArchTag=&quot; + distroArchTag)
+        self.__client.testBuildSpecByPath(userId, password, fileContents, toEmail, distroArchTag, priority)
     def doUpdateSite(self,userId,password,specRepoName):
         self.__client.callUpdateSiteScript(userId,password,specRepoName)
         
-myUsage = &quot;pydar-remote [options] &lt;userid&gt; &lt;specreponame&gt; &lt;specfilepath&gt; &lt;toemail&gt; &lt;distroarchtag&gt; &lt;priority&gt; &lt;taraget&gt;&quot;
+myUsage = &quot;pydar-remote [options] &lt;userid&gt; &lt;specreponame&gt; &lt;specfilepath&gt; &lt;toemail&gt; &lt;distroarchtag&gt; &lt;priority&gt; &lt;target&gt;&quot;
 parser = OptionParser(usage=myUsage)
 parser.add_option(&quot;-c&quot;, &quot;--clientconfig&quot;, default=None, dest=&quot;clientconfig&quot;, help=&quot;specify configuration file&quot;, metavar=&quot;FILE&quot;)
 
@@ -33,8 +36,10 @@
 
 if len(args) &lt; 2 or args[1] == &quot;&quot;:
     print &quot;known commands:&quot;
-    print &quot;    build &lt;userid&gt; &lt;specreponame&gt; &lt;specfilepath&gt; &lt;toemail&gt; &lt;distroarchtag&gt; &lt;priority&gt; &lt;taraget&gt;  rebuild a specfile on the server &quot;
-    print &quot;                and use the specified releasetag and machroot&quot;
+    print &quot;    build &lt;userid&gt; &lt;specreponame&gt; &lt;specfilepath&gt; &lt;toemail&gt; &lt;distroarchtag&gt; &lt;priority&gt; &lt;target&gt;  &quot;
+    print &quot;         rebuild a specfile from a specrepository on the server and use the specified releasetag and machroot&quot;
+    print &quot;    testbuild &lt;userid&gt; &lt;specfilepath&gt; &lt;toemail&gt; &lt;distroarchtag&gt; &lt;priority&gt; &quot;
+    print &quot;         rebuild a spec file from your local disk on the server &quot;
     print &quot;    site &lt;userid&gt; &lt;specreponame&gt;&quot;
     print &quot;                call the script which builds the site&quot;
     sys.exit(1)
@@ -42,5 +47,20 @@
 print &quot;argv len: &quot; + str(len(args))
 if args[0] == &quot;build&quot; and len(args) == 8:
     myClient.doBuildSpecByPath(args[1],password,args[2], args[3], args[4], args[5], args[6], args[7])
+if args[0] == &quot;build&quot; and len(args) != 8:
+    print str(len(args)) + &quot; args for 'build' but expected 8&quot;
+if args[0] == &quot;testbuild&quot; and len(args) == 6:
+    # get the file
+    fileName = args[2]
+    if os.path.exists(fileName):
+        f = open(fileName)
+        fileContents = f.read()
+        f.close()
+        fileContentsEncoded = base64.encodestring(fileContents)
+        myClient.doTestBuildSpecByPath(args[1],password,fileContentsEncoded, args[3], args[4], args[5])
+    else:
+        print fileName + &quot; does not exist&quot;
+if args[0] == &quot;testbuild&quot; and len(args) != 6:
+    print str(len(args)) + &quot; args for 'testbuild' but expected 6&quot;
 if args[0] == &quot;site&quot;:
     myClient.doUpdateSite(args[1],password,args[2])

Modified: trunk/tools/pydar2/scripts/norpmforgetemplatesfilter.py
===================================================================
--- trunk/tools/pydar2/scripts/norpmforgetemplatesfilter.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/scripts/norpmforgetemplatesfilter.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -22,7 +22,7 @@
 # any of the tempate spec files.
 
 def NoRpmforgeTemplatesFilter(specRepoSpecFile):
-    print &quot;called with obj &quot; + str(specRepoSpecFile)
+    #print &quot;called with obj &quot; + str(specRepoSpecFile)
     fn = specRepoSpecFile.getFileName()
     if fn == &quot;_template.spec&quot; or fn == &quot;_template-fr.spec&quot; or fn == &quot;_perl-template.spec&quot;:
         return False

Modified: trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/scripts/rpmforgeacceptcommand.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -32,6 +32,8 @@
     #    return False
     if aCommand.getSpecRepositoryName() != &quot;rpmforge&quot;:
         return False
+    if string.find(&quot; &quot; + aCommand.getSpecFileFileName(), 'rrdtool-1.2.spec') &gt; 0:
+        return False
     #if string.find(aCommand.getSpecFileShortFileName(),&quot;perl-&quot;) &lt; 0:
     #    return False
     authority = aCommand.getAuthority()
@@ -42,18 +44,95 @@
         if string.find(authority, &quot;axel&quot;) &gt; 0:
             return False
     ignoreList = []
-    ignoreList.append('e2fsprogs')
-    ignoreList.append('sendmail')
-    ignoreList.append('sendmail-old')
-    ignoreList.append('e2fsprogs')
-    ignoreList.append('arphound')
-    ignoreList.append('sagasu-1.0.6')
-    ignoreList.append('kernel-module-')
-    ignoreList.append('perl-Net-SMTP')
-    ignoreList.append('xmms-lirc')
+    ignoreList.append('avidemux.spec')
+    ignoreList.append('distcc')
+    ignoreList.append('gnomba.spec') # todo fix, it hangs the buildsystem at the moment
+    ignoreList.append('boa.spec') # todo fix, it hangs the buildsystem at the moment
+    ignoreList.append('e2fsprogs') # system package?
+    ignoreList.append('sendmail') # system package
+    ignoreList.append('sendmail-old') # ?
+    ignoreList.append('arphound') # too much 'void *' stuff in code to write a fix
+    ignoreList.append('sagasu-1.0.6') # there's a newer version
+    ignoreList.append('kernel-module-') 
+    ignoreList.append('perl-Net-SMTP')  # doesn't seem to exist anymore, can't find the source anywhere
+    ignoreList.append('xmms-lirc') 
+    ignoreList.append('syslinux')
+    ignoreList.append('openssh.spec')
+    ignoreList.append('amule') # avoid wxgtk problems
+    ignoreList.append('apt-dag.spec') # 'apt.spec' seems to be more up to date
+    ignoreList.append('bluefish-0.13.spec') # bluefish.spec is newer
+    ignoreList.append('easytag.spec') # easytag2.spec is newer
+    ignoreList.append('epic4-v1.spec') # epic.spec is newer
+    ignoreList.append('epiphany-1.0.spec') # epiphany.spec is newer
+    ignoreList.append('fftw-dag.spec') # fftw.spec has higher release, but no idea if i choose the right one for fc4
+    ignoreList.append('freetds-0.62.1.spec') # freetds.spec is newer
+    ignoreList.append('fslint-1.x.spec') # fslint.spec is newer
+    ignoreList.append('gabber-dag.spec') # gabber.spec also exists, are the same
+    ignoreList.append('gaim.spec') # avoid replacing the gaim of the distro
+    ignoreList.append('gaim-dag.spec') 
+    ignoreList.append('galeon-1.2.x.spec') # galeon.spec is newer
+    ignoreList.append('gambas-dag.spec') # gambas.spec is newer
+    ignoreList.append('gfax-0.5.spec')
+    ignoreList.append('gnomeradio-1.1.spec')
+    ignoreList.append('gpa-dag.spec')
+    ignoreList.append('gpasman-1.2.0.spec')
+    ignoreList.append('gq.spec') # unstable?
+    ignoreList.append('gramps-0.8.1.spec')
+    ignoreList.append('gstreamer') # TODO later
+    ignoreList.append('gtkmm2-dag.spec') # newer in gtkmm2.spec
+    ignoreList.append('gtkmm2-2.0-dag.spec') 
+    ignoreList.append('gtktalog-dag.spec') # gtktalog.spec has higher release
+    ignoreList.append('gurlchecker-0.6.x.spec')
+    ignoreList.append('gv4l-1.0.spec')
+    ignoreList.append('icu-2.4.spec')
+    ignoreList.append('libbonobouimm2-1.3.5-dag.spec')
+    ignoreList.append('libdvbpsi-dag.spec')
+    ignoreList.append('libdvdcss-dag.spec')
+    ignoreList.append('libdvdplay-dag.spec')
+    ignoreList.append('libdvdread-dag.spec')
+    ignoreList.append('libgcrypt.spec')
+    ignoreList.append('libgcrypt-1.1.x.spec')
+    ignoreList.append('libglademm2-dag.spec')
+    ignoreList.append('libnet-1.0.spec')
+    ignoreList.append('libnet-1.1.spec')
+    ignoreList.append('libsigc++-dag.spec')
+    ignoreList.append('lzo-1.04.spec')
+    ignoreList.append('mach-dag.spec') # mach.spec is newer
+    ignoreList.append('mozilla') # not going to replace os package for now
+    ignoreList.append('firefox')
+    ignoreList.append('muine-0.4.spec')
+    ignoreList.append('nagios-1.1.spec')
+    ignoreList.append('nagios-1.2.spec')
+    ignoreList.append('nagios-2.0.spec')
+    ignoreList.append('openvpn-1.4.spec')
+    ignoreList.append('openvpn.spec')
+    ignoreList.append('orbitcpp-0.30.spec')
+    ignoreList.append('paketto-1.x.spec')
+    ignoreList.append('partimage-0.6.spec')
+    ignoreList.append('perl-GD-1.x.spec')
+    ignoreList.append('perl-RPM-Specfile-dag.spec') # without -dag is newer
+    ignoreList.append('revelation-0.3.spec')
+    ignoreList.append('rhythmbox-0.6.spec')
+    ignoreList.append('rpm2html-1.7.spec')
+    ignoreList.append('rrdtool-dag.spec')
+    ignoreList.append('rrdtool.spec')
+    ignoreList.append('rsync') # system package, not yet updated
+    ignoreList.append('snackam-fdw.spec')
+    ignoreList.append('straw-0.21.1.spec')
+    ignoreList.append('subtitleripper-dag.spec')
+    ignoreList.append('subversion')
+    ignoreList.append('swfdec-0.2.2.spec')
+    ignoreList.append('sylpheed-claws-gtk1.spec')
+    ignoreList.append('tcpreplay-1.3.spec')
+    ignoreList.append('texmaker-1.0.1.spec')
+    ignoreList.append('xvidcore-dev.spec')
+    ignoreList.append('yum.spec')
+    ignoreList.append('yum-1.0.spec')
+    
+    
     print &quot;ignorelist ok&quot;
     for i in ignoreList:
-        print &quot;going to check for &quot; + str(i)
+        #print &quot;going to check for &quot; + str(i)
         if string.find(&quot; &quot; + aCommand.getSpecFileFileName(), i) &gt; 0:
             return False
     # also check the architecture

Modified: trunk/tools/pydar2/scripts/rpmforgedriesrepo.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgedriesrepo.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/scripts/rpmforgedriesrepo.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -79,6 +79,9 @@
         if string.find(authority,'koenraad') &gt;= 0:
             packager = 'Koenraad Heijlen &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">vipie at ulyssis.org</A>&gt;'
             found = True
+        if string.find(authority,'leet') &gt;= 0:
+            packager = 'C.Lee Taylor &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">leet at leenx.co.za</A>&gt;'
+            found = True
         if not found:
             packager = 'Dries Verachtert &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dries at ulyssis.org</A>&gt;'
     else:

Modified: trunk/tools/pydar2/scripts/rpmforgesite.py
===================================================================
--- trunk/tools/pydar2/scripts/rpmforgesite.py	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/scripts/rpmforgesite.py	2005-07-04 19:08:23 UTC (rev 3355)
@@ -57,9 +57,9 @@
         self.__siterootdir =  &quot;/tmp/packages/&quot;
         self.__storage = storagefactory.StorageFactory.getStorage()
         self.__rpmlists = []
-        addPaths = ['redhat/el4/i386']
+        addPaths = ['redhat/el4/en/i386']
         self.__rpmlists.append(DistroArchObject(&quot;el4-i386-dries&quot;, &quot;el4 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el4/en/i386/RPMS.dries/</A>&quot;, [&quot;el4.rf&quot;], &quot;Red Hat Enterprise Linux 4 for i386&quot;, addPaths))
-        addPaths = ['redhat/el3/i386']
+        addPaths = ['redhat/el3/en/i386']
         self.__rpmlists.append(DistroArchObject(&quot;el3-i386-dries&quot;, &quot;el3 i386 rpms&quot;,&quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/redhat/el3/en/i386/RPMS.dries/</A>&quot;, [&quot;el3.rf&quot;], &quot;Red Hat Enterprise Linux 3 for i386&quot;, addPaths))
         addPaths = ['fedora/fc3/i386']
         self.__rpmlists.append(DistroArchObject(&quot;fc3-i386-dries&quot;, &quot;fc3 i386 rpms&quot;, &quot;<A HREF="http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/">http://ftp.belnet.be/packages/dries.ulyssis.org/fedora/fc3/i386/RPMS.dries/</A>&quot;, [&quot;fc3.rf&quot;, &quot;fc3.dries&quot;], &quot;Fedora Core 3 for i386&quot;, addPaths))
@@ -101,7 +101,7 @@
         for srsf in self.__specRepo.getSpecRepositorySpecFiles():
             nametospecrepospecfile[srsf.getSubDir()] = srsf
         #firstre = re.compile('&lt;A HREF=&quot;.*\.rpm&lt;\/A&gt;')
-        secondre = re.compile('&lt;A HREF=&quot;(.*\.rpm)&quot;&gt;.*\.rpm&lt;/A&gt;')
+        secondre = re.compile('&lt;A HREF=&quot;(.*\.rpm)&quot;&gt;.*\.rpm&lt;/A&gt; *([0-9]*)-([A-Za-z]*)-([0-9]*) ')
         for listje in self.__rpmlists:
             # ok get the list of rpms and srpms of this list
             f = urllib.urlopen(listje.rpmsUrl)
@@ -483,6 +483,8 @@
         contents = contents + self.__getFileContents(specRepoSpecFile.getFullPath())
         contents = contents + &quot;&lt;/pre&gt;&quot;
         self.generateFullPage(contents, [&quot;Packages&quot;,shortName, shortName + &quot; spec file&quot;], &quot;packages/&quot; + shortName  + &quot;/&quot; + shortName + &quot;-spec.html&quot;, shortName + &quot; spec file : Dries RPM Repository&quot;)
+        htcontents = &quot;RewriteEngine on\n&quot; + 'RewriteRule ^.*spec$ ' + shortName + &quot;-spec.html&quot; + &quot;\n&quot;
+        self.createFile(&quot;packages/&quot; + shortName  + &quot;/.htaccess&quot;, htcontents)
         
     def getDistroNameFromRpmName(self, rpm):
         for distro in self.__rpmlists:

Modified: trunk/tools/pydar2/sql/master.sql
===================================================================
--- trunk/tools/pydar2/sql/master.sql	2005-07-04 17:44:41 UTC (rev 3354)
+++ trunk/tools/pydar2/sql/master.sql	2005-07-04 19:08:23 UTC (rev 3355)
@@ -264,4 +264,5 @@
 insert into pydar2_rights (id, abbrev, description) values (11, 'AUTO_QUEUE', 'auto queue commands');
 insert into pydar2_rights (id, abbrev, description) values (12, 'MOVE_COMMAND_RESULTS', 'move the results of a command');
 insert into pydar2_rights (id, abbrev, description) values (13, 'UPDATE_TARGET_FILE_LIST', 'update the list of rpms of a target');
+insert into pydar2_rights (id, abbrev, description) values (14, 'TEST_BUILD_SPEC_BY_PATH', 'test build a spec file');
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002156.html">[svn] r3354 - trunk/rpms/mpg321
</A></li>
	<LI>Next message: <A HREF="002158.html">[svn] r3356 - in trunk/rpms: epylog icewm pydar2 scribus texmacs	windowmaker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2157">[ date ]</a>
              <a href="thread.html#2157">[ thread ]</a>
              <a href="subject.html#2157">[ subject ]</a>
              <a href="author.html#2157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
