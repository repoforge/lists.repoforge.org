<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r2876 - trunk/tools/dar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2876%20-%20trunk/tools/dar&In-Reply-To=%3C20050211003301.5EF3DF3890%40web22.meg.us2.egwn.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001680.html">
   <LINK REL="Next"  HREF="001682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r2876 - trunk/tools/dar</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r2876%20-%20trunk/tools/dar&In-Reply-To=%3C20050211003301.5EF3DF3890%40web22.meg.us2.egwn.net%3E"
       TITLE="[SVN] r2876 - trunk/tools/dar">svn-commits at rpmforge.net
       </A><BR>
    <I>Fri Feb 11 01:33:01 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001680.html">[SVN] r2875 - trunk/rpms/ipw2200-firmware
</A></li>
        <LI>Next message: <A HREF="001682.html">[SVN] r2877 - trunk/tools/dstat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2005-02-11 01:32:58 +0100 (Fri, 11 Feb 2005)
New Revision: 2876

Modified:
   trunk/tools/dar/ChangeLog
   trunk/tools/dar/dar-build
   trunk/tools/dar/dar-functions
Log:
Updates

Modified: trunk/tools/dar/ChangeLog
===================================================================
--- trunk/tools/dar/ChangeLog	2005-02-09 17:13:41 UTC (rev 2875)
+++ trunk/tools/dar/ChangeLog	2005-02-11 00:32:58 UTC (rev 2876)
@@ -27,6 +27,8 @@
 - dar-sync: Added createrepo metadata generation
 - dar.conf: ROOT now defaults to /dar
 - dar-sync: Added -r switch to specify/skip creating repo metadata
+- dar-build: Revert back to gzip for logfiles
+- dar-sync: Recompress createrepo metadata for rsyncability
 
 Version 0.6.0
 - dar.conf: Removed DISTSMAP, added it to dists specific section

Modified: trunk/tools/dar/dar-build
===================================================================
--- trunk/tools/dar/dar-build	2005-02-09 17:13:41 UTC (rev 2875)
+++ trunk/tools/dar/dar-build	2005-02-11 00:32:58 UTC (rev 2876)
@@ -369,7 +369,8 @@
 				echo &quot;OK for $dist/$arch, file eg. \&quot;$PACKAGEDIR/$app/$RPMFILE\&quot;.&quot;
 
 				if [ &quot;$RETAIN_LOGS&quot; == &quot;yes&quot; ]; then
-					bzip2 -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
+#					bzip2 -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
+					gzip -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
 				fi
 
 				### Clean up current and older logfile
@@ -381,7 +382,8 @@
 			else
 #				log &quot;Failed building package $app for $dist/$arch.&quot; &gt;&gt; &quot;$LOGDIR/dar.log&quot;
 				error &quot;Failed building package $app for $dist/$arch, see log. (RC=$RC)&quot;
-				bzip2 -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
+#				bzip2 -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
+				gzip -9 -f &quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE&quot;
 			fi
 			rm -f &quot;$NEWSPECFILE&quot;
 		done

Modified: trunk/tools/dar/dar-functions
===================================================================
--- trunk/tools/dar/dar-functions	2005-02-09 17:13:41 UTC (rev 2875)
+++ trunk/tools/dar/dar-functions	2005-02-11 00:32:58 UTC (rev 2876)
@@ -402,8 +402,23 @@
 
 function build_repo {
 	local DISTPATH=&quot;$1&quot;
+	local REPODATA=&quot;$FTPDIR/$DISTPATH/$REPO/repodata/&quot;
 
-	createrepo -q $FTPDIR/$DISTPATH/$REPO/
+	createrepo -q &quot;$FTPDIR/$DISTPATH/$REPO&quot;
+	echo &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot; &gt;&quot;$REPODATA/repomd.xml&quot;
+	echo &quot;&lt;repomd xmlns=\&quot;<A HREF="http://linux.duke.edu/metadata/repo\">http://linux.duke.edu/metadata/repo\</A>&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+	for file in other filelists primary; do
+		echo &quot;### Generated by DAR, <A HREF="http://dag.wieers.com/home-made/dar/">http://dag.wieers.com/home-made/dar/</A>&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		echo &quot;  &lt;data type=\&quot;$file\&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		echo &quot;    &lt;location href=\&quot;repodata/$file.xml.gz\&quot;/&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		gunzip &quot;$REPODATA/$file.xml.gz&quot;
+		echo &quot;    &lt;open-checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml&quot; | cut -f1 -d' ')&lt;/open-checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		gzip --rsyncable -9 &quot;$REPODATA/$file.xml&quot;
+    		echo &quot;    &lt;checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml.gz&quot; | cut -f1 -d' ')&lt;/checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		echo &quot;    &lt;timestamp&gt;$(stat -c &quot;%Y&quot; &quot;$REPODATA/$file.xml.gz&quot;)&lt;/timestamp&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+		echo &quot;  &lt;/data&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+	done
+	echo &quot;&lt;/repomd&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
 }
 
 function build_repo_srpms {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001680.html">[SVN] r2875 - trunk/rpms/ipw2200-firmware
</A></li>
	<LI>Next message: <A HREF="001682.html">[SVN] r2877 - trunk/tools/dstat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
