<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r3664 - in trunk/rpms: . udftools
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3664%20-%20in%20trunk/rpms%3A%20.%20udftools&In-Reply-To=%3C20051020111415.E31D231810B%40pooch.vmhosting.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002463.html">
   <LINK REL="Next"  HREF="002465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r3664 - in trunk/rpms: . udftools</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3664%20-%20in%20trunk/rpms%3A%20.%20udftools&In-Reply-To=%3C20051020111415.E31D231810B%40pooch.vmhosting.org%3E"
       TITLE="[svn] r3664 - in trunk/rpms: . udftools">packagers at lists.rpmforge.net
       </A><BR>
    <I>Thu Oct 20 13:14:15 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002463.html">[svn] r3663 - in trunk/rpms: PyKDE SDL_gfx a52dec acroread afick	aide airsnort aldo alsa-driver alsaplayer amavisd-new	ap-utils apcupsd apserver ara asp2php asterisk aterm athcool	autodir autopano-sift avifile bash-completion bastet biew	bind bitlbee boa bogofilter bwm-ng cabletv camE celestia	checkpassword-pam clamav clamtk clearsilver colortail cpu	cpufreqd current daapd dante dcc dconf ddclient denyhosts	devilspie dia dillo diradmin directfb djvulibre dkftpbench	dnsmasq dstat dvdauthor dxfscope easysok easytag echoping	elmo enca esvn etherape fake fann ffcall fftv fftw fish	flumotion gaim galculator gambas gammu gcm gcombust	gemhunters gfax gift-gnutella git gnokii gnubiff gnuboy	gnutls gnuvd gocr graphviz gregexp gstreamer gtick gtkmm2	gtweakui gweled gwenview hk_classes hymn icmpinfo imcom	imlib2 imprison intersync iperf iptraf irssi jamboree js	kdirstat keepalived kernel-module-drbd kernel-module-freeswan	kernel-module-mpi350 kernel-module-thinkpad kig kildclient	kmuddy kmyirc kmymoney kolourpaint kvirc lame	laptop-mode-tools lbe lde libbraille libcaca libdvbpsi libgda	libgnomedb libidn libsigc++ libsnack libtasn1 libtc libxclass	libxml2 lincvs linneighborhood lirc lircrc_config lmbench	logwatch lua mach malsync manedit mc memcached mergeant miau	micq mimedefang mixxx moagg mod_log_sql mod_suphp modlogan	mon most mozilla-bonobo mpeg2dec mrxvt muh multitail ne	netscape4 nettee nget nmap nsc ntfsprogs ntop ocaml ogmtools	oidentd op opencdk openrm openvpn otrs p7zip paketto	pathological pdflib pdumpfs peacock perl-Apache-Session	perl-AppConfig perl-Authen-SASL perl-CSS-Tiny perl-Carp-Clan	perl-Config-General perl-Config-Record perl-Config-Tiny	perl-Convert-UUlib perl-Crypt-Rijndael perl-Crypt-Twofish2	perl-Data-ShowTable perl-ExtUtils-AutoInstall perl-FCGI	perl-File-RsyncP perl-GD-Text-Util perl-Gnome2-Vte	perl-HTML-Template perl-IO-stringy perl-Log-Dispatch	perl-Log-Message perl-Math-BigInt-GMP perl-Msgcat	perl-Net-DAAP-DMAP perl-Net-DAV-Server perl-Net-DPAP-Client	perl-Net-Domain-TLD perl-Net-IANA-PortNumbers perl-Net-IP	perl-Net-LDAP perl-Net-Netmask perl-Net-WhoisNG-Person	perl-Net-XWhois perl-PAR-Dist perl-POE perl-Params-Validate	perl-Pod-Escapes perl-Test-AutoBuild perl-Text-Template	perl-WSDL-Generator perl-WWW-Search-Ebay perl-X11-SendEvent	perl-XML-Stream perl-ldap pgpool php-eaccelerator php-jpgraph	plan planner prismstumbler pv python-bsddb3	python-elementtree python-imaging python-libacl python-log4py	python-mx-base python-numarray python-xattr qemu rar	razor-agents rdesktop redir rhythmbox rpmforge-release	rrdtool rrdutils rsync rubrica rxvt screenie shalvideo	shntool shorten sketch smbldap-tools snort snortalog socat	sodipodi solarwolf sopwith sound-juicer spamassassin speex	squidguard squidview subversion sulk synergy syslinux	tcpreplay tcptraceroute tellico tinc tiobench tn5250 tpb	tsocks tvtime twin vcdimager vnc2swf vnstat vrb walker	waproamd watchdog widelands wxGTK xawtv xdialog xmms	xmms-infopipe xmms-wma xparam xpde xpenguins xsupplicant yam	yum zephulor zinf zonecheck zziplib
</A></li>
        <LI>Next message: <A HREF="002465.html">[svn] r3665 - trunk/rpms/xmame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: thias
Date: 2005-10-20 13:14:14 +0200 (Thu, 20 Oct 2005)
New Revision: 3664

Added:
   trunk/rpms/udftools/
   trunk/rpms/udftools/udftools-1.0.0b3-mkudffs-bigendian.patch
   trunk/rpms/udftools/udftools-1.0.0b3-pktsetup-chardev.patch
   trunk/rpms/udftools/udftools-1.0.0b3-wrudf-gcc4.patch
   trunk/rpms/udftools/udftools.spec
Log:
Import udftools, taken from Fedora Extras, in order to have it rebuilt for RHEL (see comments in rh bz #156247).


Added: trunk/rpms/udftools/udftools-1.0.0b3-mkudffs-bigendian.patch
===================================================================
--- trunk/rpms/udftools/udftools-1.0.0b3-mkudffs-bigendian.patch	2005-10-20 04:38:29 UTC (rev 3663)
+++ trunk/rpms/udftools/udftools-1.0.0b3-mkudffs-bigendian.patch	2005-10-20 11:14:14 UTC (rev 3664)
@@ -0,0 +1,36 @@
+Date: Sun, 12 Dec 2004 14:25:09 +0100
+From: Christoph Hellwig &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">hch at lst.de</A>&gt;
+To: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">submit at bugs.debian.org</A>
+
+Package: udftools
+Version: 1.0.0b3-6
+
+mkduffs crashes with a segmentation fault when trying to create a
+filesystem on big-endian systems.  e.g. mkudffs /dev/sda4 on my
+PowerMac.
+
+udffstools from CVS on sf.net is fine, and I've extracted the actual
+fix:
+
+
+diff -uNr -Xdontdiff -p udftools-1.0.0b3/mkudffs/mkudffs.c udftools/mkudffs/mkudffs.c
+--- udftools-1.0.0b3/mkudffs/mkudffs.c	2004-02-23 04:35:33.000000000 +0100
++++ udftools/mkudffs/mkudffs.c	2004-03-02 03:09:39.000000000 +0100
+@@ -250,14 +250,14 @@ void split_space(struct udf_disc *disc)
+ 	if (size % offsets[PSPACE_SIZE])
+ 		size -= (size % offsets[PSPACE_SIZE]);
+ 	set_extent(disc, PSPACE, start, size);
+-	for (i=0; i&lt;disc-&gt;udf_lvd[0]-&gt;numPartitionMaps; i++)
++	for (i=0; i&lt;le32_to_cpu(disc-&gt;udf_lvd[0]-&gt;numPartitionMaps); i++)
+ 	{
+ 		if (i == 1)
+ 			disc-&gt;udf_lvid-&gt;freeSpaceTable[i] = cpu_to_le32(0xFFFFFFFF);
+ 		else
+ 			disc-&gt;udf_lvid-&gt;freeSpaceTable[i] = cpu_to_le32(size);
+ 	}
+-	for (j=0; j&lt;disc-&gt;udf_lvd[0]-&gt;numPartitionMaps; j++)
++	for (j=0; j&lt;le32_to_cpu(disc-&gt;udf_lvd[0]-&gt;numPartitionMaps); j++)
+ 	{
+ 		if (j == 1)
+ 			disc-&gt;udf_lvid-&gt;sizeTable[i+j] = cpu_to_le32(0xFFFFFFFF);
+

Added: trunk/rpms/udftools/udftools-1.0.0b3-pktsetup-chardev.patch
===================================================================
--- trunk/rpms/udftools/udftools-1.0.0b3-pktsetup-chardev.patch	2005-10-20 04:38:29 UTC (rev 3663)
+++ trunk/rpms/udftools/udftools-1.0.0b3-pktsetup-chardev.patch	2005-10-20 11:14:14 UTC (rev 3664)
@@ -0,0 +1,346 @@
+From: Peter Osterlund &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">petero2 at telia.com</A>&gt;
+Subject: Re: [RFC][PATCH] Control pktcdvd with an auxiliary character device
+To: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">linux-kernel at vger.kernel.org</A>
+Cc: Christoph Hellwig &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">hch at infradead.org</A>&gt;, Arnd Bergmann &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">arnd at arndb.de</A>&gt;,
+        Jens Axboe &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">axboe at suse.de</A>&gt;, Andrew Morton &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">akpm at osdl.org</A>&gt;
+Date: Wed Jul 14 02:17:27 2004 +0200
+
+Peter Osterlund &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">petero2 at telia.com</A>&gt; writes:
+
+&gt; Peter Osterlund &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">petero2 at telia.com</A>&gt; writes:
+&gt; 
+&gt; &gt; Christoph Hellwig &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">hch at infradead.org</A>&gt; writes:
+&gt; &gt; 
+&gt; &gt; &gt; On Sun, Jul 11, 2004 at 01:20:45AM +0200, Arnd Bergmann wrote:
+&gt; &gt; &gt; &gt; These are actually incorrect definitions since the ioctl argument is
+&gt; &gt; &gt; &gt; not a pointer to unsigned int but instead just an int. However, that's
+&gt; &gt; &gt; &gt; too late to fix without breaking the existing tools.
+&gt; &gt; &gt; 
+&gt; &gt; &gt; The tools need to change anyway to get away from the broken behaviour to
+&gt; &gt; &gt; issue in ioctl on the actual block device to bind it..
+&gt; &gt; 
+&gt; &gt; OK, I'll create a patch that gets rid of the ioctl interface and uses
+&gt; &gt; an auxiliary character device instead to control device bindings.
+&gt; 
+&gt; Here is a patch for 2.6.7-mm7 that does that. The driver creates a
+&gt; misc character device and bind/unbind of the block devices are
+&gt; controlled by ioctl commands on the char device.
+&gt; 
+&gt; This patch needs corresponding changes in the pktsetup user space
+&gt; program. I'll post a patch for pktsetup as a separate message.
+
+And here is a patch for udftools-1.0.0b3 that updates the pktsetup
+program to make it able to use the character device for block device
+setup/teardown.
+
+---
+
+ udftools-1.0.0b3-petero/pktsetup/pktsetup.c |  245 +++++++++++++++++++++++++++-
+ 1 files changed, 238 insertions(+), 7 deletions(-)
+
+diff -puN pktsetup/pktsetup.c~pktsetup-char-dev pktsetup/pktsetup.c
+--- udftools-1.0.0b3/pktsetup/pktsetup.c~pktsetup-char-dev	2004-07-12 19:57:51.000000000 +0200
++++ udftools-1.0.0b3-petero/pktsetup/pktsetup.c	2004-07-14 00:34:02.471317888 +0200
+@@ -1,5 +1,6 @@
+ /*
+  * Copyright (c) 1999,2000	Jens Axboe &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">axboe at suse.de</A>&gt;
++ * Copyright (c) 2004		Peter Osterlund &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">petero2 at telia.com</A>&gt;
+  *
+  *   This program is free software; you can redistribute it and/or modify
+  *   it under the terms of the GNU General Public License as published by
+@@ -19,6 +20,7 @@
+ #include &lt;stdio.h&gt;
+ #include &lt;fcntl.h&gt;
+ #include &lt;sys/ioctl.h&gt;
++#include &lt;sys/stat.h&gt;
+ #include &lt;unistd.h&gt;
+ #include &lt;getopt.h&gt;
+ #include &lt;bits/types.h&gt;
+@@ -33,8 +35,33 @@
+ #define PACKET_SETUP_DEV	_IOW('X', 1, unsigned int)
+ #define PACKET_TEARDOWN_DEV	_IOW('X', 2, unsigned int)
+ #endif
++#ifndef PACKET_CTRL_CMD
++#define PACKET_CTRL_CMD		_IOWR('X', 1, struct pkt_ctrl_command)
++#endif
++
++#define MAJOR(dev)      ((dev &amp; 0xfff00) &gt;&gt; 8)
++#define MINOR(dev)      ((dev &amp; 0xff) | ((dev &gt;&gt; 12) &amp; 0xfff00))
++#define MKDEV(ma,mi)    ((mi &amp; 0xff) | (ma &lt;&lt; 8) | ((mi &amp; ~0xff) &lt;&lt; 12))
++
++#define MISC_MAJOR		10
++#define CTL_DIR &quot;/dev/pktcdvd&quot;
++#define CTL_DEV &quot;control&quot;
++
++#define PKT_CTRL_CMD_SETUP	0
++#define PKT_CTRL_CMD_TEARDOWN	1
++#define PKT_CTRL_CMD_STATUS	2
++
++struct pkt_ctrl_command {
++	__u32 command;				/* in: Setup, teardown, status */
++	__u32 dev_index;			/* in/out: Device index */
++	__u32 dev;				/* in/out: Device nr for cdrw device */
++	__u32 pkt_dev;				/* out: Device nr for packet device */
++	__u32 num_devices;			/* out: Largest device index + 1 */
++	__u32 padding;
++};
++
+ 
+-int init_cdrom(int fd)
++static int init_cdrom(int fd)
+ {
+ 	if (ioctl(fd, CDROM_DRIVE_STATUS, CDSL_CURRENT) &lt; 0) {
+ 		perror(&quot;drive not ready\n&quot;);
+@@ -54,7 +81,7 @@ int init_cdrom(int fd)
+ 	return 0;
+ }
+ 
+-void setup_dev(char *pkt_device, char *device, int rem)
++static void setup_dev(char *pkt_device, char *device, int rem)
+ {
+ 	int pkt_fd, dev_fd, cmd;
+ 
+@@ -88,29 +115,233 @@ void setup_dev(char *pkt_device, char *d
+ 	close(pkt_fd);
+ }
+ 
+-int usage(void)
++static int usage(void)
+ {
+-	printf(&quot;pktsetup /dev/pktcdvd0 /dev/cdrom\tsetup device\n&quot;);
+-	printf(&quot;pktsetup -d /dev/pktcdvd0\t\ttear down device\n&quot;);
++	printf(&quot;For pktcdvd &lt; 0.2.0:\n&quot;);
++	printf(&quot;  pktsetup /dev/pktcdvd0 /dev/cdrom  setup device\n&quot;);
++	printf(&quot;  pktsetup -d /dev/pktcdvd0          tear down device\n&quot;);
++	printf(&quot;For pktcdvd &gt;= 0.2.0:\n&quot;);
++	printf(&quot;  pktsetup dev_name /dev/cdrom       setup device\n&quot;);
++	printf(&quot;  pktsetup -d dev_name               tear down device\n&quot;);
++	printf(&quot;  pktsetup -d major:minor            tear down device\n&quot;);
++	printf(&quot;  pktsetup -s                        show device mappings\n&quot;);
+ 	return 1;
+ }
+ 
++/*
++ * Find the minor device number for the pktcdvd control device.
++ */
++static int get_misc_minor(void)
++{
++	int minor;
++	char name[64];
++	FILE *f;
++
++	if ((f = fopen(&quot;/proc/misc&quot;, &quot;r&quot;)) == NULL)
++		return -1;
++	while (fscanf(f, &quot; %d %64s&quot;, &amp;minor, name) == 2) {
++		if (strcmp(name, &quot;pktcdvd&quot;) == 0) {
++			fclose(f);
++			return minor;
++		}
++	}
++	fclose(f);
++	return -1;
++}
++
++static const char *pkt_dev_name(const char *dev)
++{
++	static char buf[128];
++	snprintf(buf, sizeof(buf), &quot;%s/%s&quot;, CTL_DIR, dev);
++	return buf;
++}
++
++static void create_ctl_dev(void)
++{
++	int misc_minor;
++	struct stat stat_buf;
++	int dev;
++
++	if ((misc_minor = get_misc_minor()) &lt; 0) {
++		system(&quot;/sbin/modprobe pktcdvd&quot;);
++		misc_minor = get_misc_minor();
++	}
++	if (misc_minor &lt; 0) {
++		fprintf(stderr, &quot;Can't find pktcdvd character device\n&quot;);
++		return;
++	}
++	dev = MKDEV(MISC_MAJOR, misc_minor);
++
++	if ((stat(pkt_dev_name(CTL_DEV), &amp;stat_buf) &gt;= 0) &amp;&amp;
++	    S_ISCHR(stat_buf.st_mode) &amp;&amp; (stat_buf.st_rdev == dev))
++		return;			    /* Already set up */
++
++	mkdir(CTL_DIR, 0755);
++	unlink(pkt_dev_name(CTL_DEV));
++	mknod(pkt_dev_name(CTL_DEV), S_IFCHR | 0644, dev);
++}
++
++static int remove_stale_dev_node(int ctl_fd, char *devname)
++{
++	struct stat stat_buf;
++	int i, dev;
++	struct pkt_ctrl_command c;
++
++	if (stat(pkt_dev_name(devname), &amp;stat_buf) &lt; 0)
++		return 0;
++	if (!S_ISBLK(stat_buf.st_mode))
++		return 1;
++	dev = stat_buf.st_rdev;
++	memset(&amp;c, 0, sizeof(struct pkt_ctrl_command));
++	for (i = 0; ; i++) {
++		c.command = PKT_CTRL_CMD_STATUS;
++		c.dev_index = i;
++		if (ioctl(ctl_fd, PACKET_CTRL_CMD, &amp;c) &lt; 0) {
++			perror(&quot;ioctl&quot;);
++			return 1;
++		}
++		if (i &gt;= c.num_devices)
++			break;
++		if (c.pkt_dev == dev)
++			return 1;	    /* busy */
++	}
++	unlink(pkt_dev_name(devname));
++	return 0;
++}
++
++static void setup_dev_chardev(char *pkt_device, char *device, int rem)
++{
++	struct pkt_ctrl_command c;
++	struct stat stat_buf;
++	int ctl_fd, dev_fd;
++
++	memset(&amp;c, 0, sizeof(struct pkt_ctrl_command));
++
++	create_ctl_dev();
++	if ((ctl_fd = open(pkt_dev_name(CTL_DEV), O_RDONLY)) &lt; 0) {
++		perror(&quot;ctl open&quot;);
++		return;
++	}
++
++	if (!rem) {
++		if ((dev_fd = open(device, O_RDONLY | O_NONBLOCK)) == -1) {
++			perror(&quot;open cd-rom&quot;);
++			goto out_close;
++		}
++		if (init_cdrom(dev_fd)) {
++			close(dev_fd);
++			goto out_close;
++		}
++		close(dev_fd);
++
++		if (stat(device, &amp;stat_buf) &lt; 0) {
++			perror(&quot;stat cd-rom&quot;);
++			goto out_close;
++		}
++		if (!S_ISBLK(stat_buf.st_mode)) {
++			fprintf(stderr, &quot;Not a block device\n&quot;);
++			goto out_close;
++		}
++		c.command = PKT_CTRL_CMD_SETUP;
++		c.dev = stat_buf.st_rdev;
++
++		if (remove_stale_dev_node(ctl_fd, pkt_device) != 0) {
++			fprintf(stderr, &quot;Device node '%s' already in use\n&quot;, pkt_device);
++			goto out_close;
++		}
++		if (ioctl(ctl_fd, PACKET_CTRL_CMD, &amp;c) &lt; 0) {
++			perror(&quot;ioctl&quot;);
++			goto out_close;
++		}
++		mknod(pkt_dev_name(pkt_device), S_IFBLK | 0640, c.pkt_dev);
++	} else {
++		int major, minor, remove_node;
++
++		if ((stat(pkt_dev_name(pkt_device), &amp;stat_buf) &gt;= 0) &amp;&amp;
++		    S_ISBLK(stat_buf.st_mode)) {
++			major = MAJOR(stat_buf.st_rdev);
++			minor = MINOR(stat_buf.st_rdev);
++			remove_node = 1;
++		} else if (sscanf(pkt_device, &quot;%d:%d&quot;, &amp;major, &amp;minor) == 2) {
++			remove_node = 0;
++		} else {
++			fprintf(stderr, &quot;Can't find major/minor numbers\n&quot;);
++			goto out_close;
++		}
++
++		c.command = PKT_CTRL_CMD_TEARDOWN;
++		c.pkt_dev = MKDEV(major, minor);
++		if (ioctl(ctl_fd, PACKET_CTRL_CMD, &amp;c) &lt; 0) {
++			perror(&quot;ioctl&quot;);
++			goto out_close;
++		}
++		if (remove_node)
++			unlink(pkt_dev_name(pkt_device));
++	}
++
++out_close:
++	close(ctl_fd);
++}
++
++static void show_mappings(void)
++{
++	struct pkt_ctrl_command c;
++	int ctl_fd, i;
++
++	memset(&amp;c, 0, sizeof(struct pkt_ctrl_command));
++
++	create_ctl_dev();
++	if ((ctl_fd = open(pkt_dev_name(CTL_DEV), O_RDONLY)) &lt; 0) {
++		perror(&quot;ctl open&quot;);
++		return;
++	}
++
++	for (i = 0; ; i++) {
++		c.command = PKT_CTRL_CMD_STATUS;
++		c.dev_index = i;
++		if (ioctl(ctl_fd, PACKET_CTRL_CMD, &amp;c) &lt; 0) {
++			perror(&quot;ioctl&quot;);
++			goto out_close;
++		}
++		if (i &gt;= c.num_devices)
++			break;
++		if (c.dev) {
++			printf(&quot;%2d : %d:%d -&gt; %d:%d\n&quot;,
++			       i, MAJOR(c.pkt_dev), MINOR(c.pkt_dev),
++			       MAJOR(c.dev), MINOR(c.dev));
++		}
++	}
++
++out_close:
++	close(ctl_fd);
++}
++
+ int main(int argc, char **argv)
+ {
+ 	int rem = 0, c;
++	char *pkt_device;
++	char *device;
+ 
+ 	if (argc == 1)
+ 		return usage();
+ 
+-	while ((c = getopt(argc, argv, &quot;d&quot;)) != EOF) {
++	while ((c = getopt(argc, argv, &quot;ds?&quot;)) != EOF) {
+ 		switch (c) {
+ 			case 'd':
+ 				rem = 1;
+ 				break;
++			case 's':
++				show_mappings();
++				return 0;
+ 			default:
+ 				return usage();
+ 		}
+ 	}
+-	setup_dev(argv[optind], argv[optind + 1], rem);
++	pkt_device = argv[optind];
++	device = argv[optind + 1];
++	if (strchr(pkt_device, '/'))
++		setup_dev(pkt_device, device, rem);
++	else
++		setup_dev_chardev(pkt_device, device, rem);
+ 	return 0;
+ }
+_
+
+-- 
+Peter Osterlund - <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">petero2 at telia.com</A>
+<A HREF="http://w1.894.telia.com/~u89404340">http://w1.894.telia.com/~u89404340</A>

Added: trunk/rpms/udftools/udftools-1.0.0b3-wrudf-gcc4.patch
===================================================================
--- trunk/rpms/udftools/udftools-1.0.0b3-wrudf-gcc4.patch	2005-10-20 04:38:29 UTC (rev 3663)
+++ trunk/rpms/udftools/udftools-1.0.0b3-wrudf-gcc4.patch	2005-10-20 11:14:14 UTC (rev 3664)
@@ -0,0 +1,53 @@
+Subject: Bug#288621: udftools: FTBFS (amd64/gcc-4.0): invalid lvalue in assignment
+From: Andreas Jochens &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">aj at andaco.de</A>&gt;
+Message-Id: &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">E1CltQT-00068G-Sy at localhost.localdomain</A>&gt;
+Date: Tue, 04 Jan 2005 19:29:01 +0100
+Lines: 59
+
+Package: udftools
+Severity: normal
+Tags: patch
+
+When building 'udftools' on amd64 with gcc-4.0,
+I get the following error:
+
+wrudf.c:119: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:119: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:119: warning: pointer targets in passing argument 1 of 'strcmp' differ in signedness
+wrudf.c:119: warning: pointer targets in passing argument 1 of 'strncmp' differ in signedness
+wrudf.c:230: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:230: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:230: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:230: warning: pointer targets in passing argument 1 of 'strcmp' differ in signedness
+wrudf.c:230: warning: pointer targets in passing argument 1 of 'strncmp' differ in signedness
+wrudf.c:245: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:245: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:245: warning: pointer targets in passing argument 1 of 'strlen' differ in signedness
+wrudf.c:245: warning: pointer targets in passing argument 1 of 'strcmp' differ in signedness
+wrudf.c:245: warning: pointer targets in passing argument 1 of 'strncmp' differ in signedness
+wrudf.c:248: error: invalid lvalue in assignment
+make[2]: *** [wrudf.o] Error 1
+make[2]: Leaving directory `/udftools-1.0.0b3/wrudf'
+
+With the attached patch 'udftools' can be compiled
+on amd64 using gcc-4.0.
+
+The patch also changes the Build-Depends from 'libreadline4-dev'
+to 'libreadline5-dev'.
+
+Regards
+Andreas Jochens
+
+diff -urN ../tmp-orig/udftools-1.0.0b3/wrudf/wrudf.c ./wrudf/wrudf.c
+--- ../tmp-orig/udftools-1.0.0b3/wrudf/wrudf.c	2002-11-26 08:18:51.000000000 +0100
++++ ./wrudf/wrudf.c	2005-01-04 16:56:49.394078200 +0100
+@@ -245,7 +245,7 @@
+ 	    } else if( strncmp( spm-&gt;partIdent.ident, UDF_ID_VIRTUAL, strlen(UDF_ID_VIRTUAL)) == 0 )
+ 		virtualPartitionNum = i;
+ 	}
+-	(char*)spm += spm-&gt;partitionMapLength;
++	spm = (char*)spm + spm-&gt;partitionMapLength;
+     }
+ 
+     if( medium == CDR ) {
+diff -urN ../tmp-orig/udftools-1.0.0b3/debian/control ./debian/control

Added: trunk/rpms/udftools/udftools.spec
===================================================================
--- trunk/rpms/udftools/udftools.spec	2005-10-20 04:38:29 UTC (rev 3663)
+++ trunk/rpms/udftools/udftools.spec	2005-10-20 11:14:14 UTC (rev 3664)
@@ -0,0 +1,61 @@
+# $Id$
+# Authority: matthias
+# ExcludeDist: fc4
+
+Summary: Linux UDF Filesystem userspace utilities
+Name: udftools
+Version: 1.0.0b3
+Release: 3
+License: GPL
+Group: Applications/Archiving
+URL: <A HREF="http://sourceforge.net/projects/linux-udf/">http://sourceforge.net/projects/linux-udf/</A>
+Source: <A HREF="http://dl.sf.net/linux-udf/udftools-%{version">http://dl.sf.net/linux-udf/udftools-%{version</A>}.tar.gz
+Patch0: udftools-1.0.0b3-pktsetup-chardev.patch
+Patch1: udftools-1.0.0b3-mkudffs-bigendian.patch
+Patch2: udftools-1.0.0b3-wrudf-gcc4.patch
+Buildroot: %{_tmppath}/%{name}-%{version}-%{release}-root
+BuildRequires: readline-devel
+
+%description
+Linux UDF Filesystem userspace utilities.
+
+
+%prep
+%setup
+%patch0 -p1 -b .pktsetup-chardev
+%patch1 -p1 -b .mkudffs-bigendian
+%patch2 -p1 -b .wrudf-gcc4
+
+
+%build
+%configure
+%{__make} %{?_smp_mflags}
+
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall
+
+
+%clean
+%{__rm} -rf %{buildroot}
+
+
+%files
+%defattr(-, root, root, 0755)
+%doc AUTHORS ChangeLog COPYING
+%{_bindir}/*
+%{_libdir}/libudffs.a
+%exclude %{_libdir}/libudffs.la
+%{_mandir}/man?/*
+
+
+%changelog
+* Tue May  3 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.0b3-3
+- Include patches to fix big endian issue and gcc4 compile.
+
+* Mon Feb  7 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.0b3-1
+- Initial RPM release, based on spec file from John Treacy.
+- Exclude .la file.
+- Remove unneeded /sbin/ldconfig calls (only a static lib for now).
+


Property changes on: trunk/rpms/udftools/udftools.spec
___________________________________________________________________
Name: svn:keywords
   + Id


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002463.html">[svn] r3663 - in trunk/rpms: PyKDE SDL_gfx a52dec acroread afick	aide airsnort aldo alsa-driver alsaplayer amavisd-new	ap-utils apcupsd apserver ara asp2php asterisk aterm athcool	autodir autopano-sift avifile bash-completion bastet biew	bind bitlbee boa bogofilter bwm-ng cabletv camE celestia	checkpassword-pam clamav clamtk clearsilver colortail cpu	cpufreqd current daapd dante dcc dconf ddclient denyhosts	devilspie dia dillo diradmin directfb djvulibre dkftpbench	dnsmasq dstat dvdauthor dxfscope easysok easytag echoping	elmo enca esvn etherape fake fann ffcall fftv fftw fish	flumotion gaim galculator gambas gammu gcm gcombust	gemhunters gfax gift-gnutella git gnokii gnubiff gnuboy	gnutls gnuvd gocr graphviz gregexp gstreamer gtick gtkmm2	gtweakui gweled gwenview hk_classes hymn icmpinfo imcom	imlib2 imprison intersync iperf iptraf irssi jamboree js	kdirstat keepalived kernel-module-drbd kernel-module-freeswan	kernel-module-mpi350 kernel-module-thinkpad kig kildclient	kmuddy kmyirc kmymoney kolourpaint kvirc lame	laptop-mode-tools lbe lde libbraille libcaca libdvbpsi libgda	libgnomedb libidn libsigc++ libsnack libtasn1 libtc libxclass	libxml2 lincvs linneighborhood lirc lircrc_config lmbench	logwatch lua mach malsync manedit mc memcached mergeant miau	micq mimedefang mixxx moagg mod_log_sql mod_suphp modlogan	mon most mozilla-bonobo mpeg2dec mrxvt muh multitail ne	netscape4 nettee nget nmap nsc ntfsprogs ntop ocaml ogmtools	oidentd op opencdk openrm openvpn otrs p7zip paketto	pathological pdflib pdumpfs peacock perl-Apache-Session	perl-AppConfig perl-Authen-SASL perl-CSS-Tiny perl-Carp-Clan	perl-Config-General perl-Config-Record perl-Config-Tiny	perl-Convert-UUlib perl-Crypt-Rijndael perl-Crypt-Twofish2	perl-Data-ShowTable perl-ExtUtils-AutoInstall perl-FCGI	perl-File-RsyncP perl-GD-Text-Util perl-Gnome2-Vte	perl-HTML-Template perl-IO-stringy perl-Log-Dispatch	perl-Log-Message perl-Math-BigInt-GMP perl-Msgcat	perl-Net-DAAP-DMAP perl-Net-DAV-Server perl-Net-DPAP-Client	perl-Net-Domain-TLD perl-Net-IANA-PortNumbers perl-Net-IP	perl-Net-LDAP perl-Net-Netmask perl-Net-WhoisNG-Person	perl-Net-XWhois perl-PAR-Dist perl-POE perl-Params-Validate	perl-Pod-Escapes perl-Test-AutoBuild perl-Text-Template	perl-WSDL-Generator perl-WWW-Search-Ebay perl-X11-SendEvent	perl-XML-Stream perl-ldap pgpool php-eaccelerator php-jpgraph	plan planner prismstumbler pv python-bsddb3	python-elementtree python-imaging python-libacl python-log4py	python-mx-base python-numarray python-xattr qemu rar	razor-agents rdesktop redir rhythmbox rpmforge-release	rrdtool rrdutils rsync rubrica rxvt screenie shalvideo	shntool shorten sketch smbldap-tools snort snortalog socat	sodipodi solarwolf sopwith sound-juicer spamassassin speex	squidguard squidview subversion sulk synergy syslinux	tcpreplay tcptraceroute tellico tinc tiobench tn5250 tpb	tsocks tvtime twin vcdimager vnc2swf vnstat vrb walker	waproamd watchdog widelands wxGTK xawtv xdialog xmms	xmms-infopipe xmms-wma xparam xpde xpenguins xsupplicant yam	yum zephulor zinf zonecheck zziplib
</A></li>
	<LI>Next message: <A HREF="002465.html">[svn] r3665 - trunk/rpms/xmame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
