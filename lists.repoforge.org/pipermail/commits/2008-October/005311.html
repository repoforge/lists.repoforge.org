<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r6512 - in trunk/tools/dar: . dists/el2i dists/el3a	dists/el3i dists/el4a dists/el4i dists/el5a dists/el5i	dists/fc1i dists/fc2a dists/fc2i dists/fc3a dists/fc3i	dists/fc4i dists/rh6i dists/rh7i dists/rh8i dists/rh9i
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6512%20-%20in%20trunk/tools/dar%3A%20.%20dists/el2i%20dists/el3a%0A%09dists/el3i%20dists/el4a%20dists/el4i%20dists/el5a%20dists/el5i%0A%09dists/fc1i%20dists/fc2a%20dists/fc2i%20dists/fc3a%20dists/fc3i%0A%09dists/fc4i%20dists/rh6i%20dists/rh7i%20dists/rh8i%20dists/rh9i&In-Reply-To=%3C200810122145.m9CLjWu0001030%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005310.html">
   <LINK REL="Next"  HREF="005312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r6512 - in trunk/tools/dar: . dists/el2i dists/el3a	dists/el3i dists/el4a dists/el4i dists/el5a dists/el5i	dists/fc1i dists/fc2a dists/fc2i dists/fc3a dists/fc3i	dists/fc4i dists/rh6i dists/rh7i dists/rh8i dists/rh9i</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6512%20-%20in%20trunk/tools/dar%3A%20.%20dists/el2i%20dists/el3a%0A%09dists/el3i%20dists/el4a%20dists/el4i%20dists/el5a%20dists/el5i%0A%09dists/fc1i%20dists/fc2a%20dists/fc2i%20dists/fc3a%20dists/fc3i%0A%09dists/fc4i%20dists/rh6i%20dists/rh7i%20dists/rh8i%20dists/rh9i&In-Reply-To=%3C200810122145.m9CLjWu0001030%40surya.karan.org%3E"
       TITLE="[svn] r6512 - in trunk/tools/dar: . dists/el2i dists/el3a	dists/el3i dists/el4a dists/el4i dists/el5a dists/el5i	dists/fc1i dists/fc2a dists/fc2i dists/fc3a dists/fc3i	dists/fc4i dists/rh6i dists/rh7i dists/rh8i dists/rh9i">packagers at lists.rpmforge.net
       </A><BR>
    <I>Sun Oct 12 23:45:32 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="005310.html">[svn] r6511 - trunk/tools/mrepo
</A></li>
        <LI>Next message: <A HREF="005312.html">[svn] r6513 - in trunk/rpms: perl-Archive-Zip perl-CGI-Ajax	perl-Catalyst-Model-SVN perl-Data-Page	perl-File-Copy-Recursive perl-IO-Socket-INET6 perl-IPC-PubSub	perl-IPC-Run3 perl-LEOCHARRE-DEBUG	perl-Lingua-Alphabet-Phonetic perl-Lingua-DE-Wortschatz	perl-Lingua-Han-PinYin perl-Lingua-Stem-Snowball	perl-Lingua-StopWords perl-Linux-LVM	perl-Locale-Currency-Format perl-Locale-Maketext-Lexicon	perl-LockFile-Simple perl-Log-Dispatch-FileRotate	perl-MIME-tools perl-Mail-Box perl-Mail-IMAPClient	perl-Mail-SPF perl-Mail-Sender perl-MailTools	perl-Math-Amoeba perl-Math-BaseCalc perl-Math-Counting	perl-Math-GMP perl-Math-Random perl-Math-RungeKutta	perl-Math-Units perl-Object-InsideOut
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5311">[ date ]</a>
              <a href="thread.html#5311">[ thread ]</a>
              <a href="subject.html#5311">[ subject ]</a>
              <a href="author.html#5311">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2008-10-12 22:45:32 +0100 (Sun, 12 Oct 2008)
New Revision: 6512

Modified:
   trunk/tools/dar/dar-build
   trunk/tools/dar/dar-exec
   trunk/tools/dar/dar-list-perl.py
   trunk/tools/dar/dar-perl.py
   trunk/tools/dar/dar-prepare
   trunk/tools/dar/dar-shell
   trunk/tools/dar/dar-update
   trunk/tools/dar/dists/el2i/config
   trunk/tools/dar/dists/el3a/config
   trunk/tools/dar/dists/el3i/config
   trunk/tools/dar/dists/el4a/config
   trunk/tools/dar/dists/el4i/config
   trunk/tools/dar/dists/el5a/config
   trunk/tools/dar/dists/el5i/config
   trunk/tools/dar/dists/fc1i/config
   trunk/tools/dar/dists/fc2a/config
   trunk/tools/dar/dists/fc2i/config
   trunk/tools/dar/dists/fc3a/config
   trunk/tools/dar/dists/fc3i/config
   trunk/tools/dar/dists/fc4i/config
   trunk/tools/dar/dists/rh6i/config
   trunk/tools/dar/dists/rh7i/config
   trunk/tools/dar/dists/rh8i/config
   trunk/tools/dar/dists/rh9i/config
Log:
Improvements to DAR for RHEL5 and LD_ASSUME_KERNEL handling.

Modified: trunk/tools/dar/dar-build
===================================================================
--- trunk/tools/dar/dar-build	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-build	2008-10-12 21:45:32 UTC (rev 6512)
@@ -253,7 +253,7 @@
                 ln -sf $CHROOTDIR/$dist/root/.distcc/state /root/.distcc/
                 export DISTCC_LOG=&quot;$TEMPDIR/distcc-$LOGFILE&quot;
                 rm -f &quot;$DISTCC_LOG&quot;
-                export MAKEFLAGS=&quot;-j$CPUNR CC=\&quot;$DISTCC_CC\&quot; CXX=\&quot;$DISTCC_CXX\&quot; GXX=\&quot;$DISTCC_CXX\&quot;&quot;
+                export MAKEFLAGS=&quot;-j$CPUNR CC='$DISTCC_CC' CXX='$DISTCC_CXX' GXX='$DISTCC_CXX'&quot;
                 export DISTCC_HOSTS CC=&quot;$DISTCC_CC&quot; CXX=&quot;$DISTCC_CXX&quot; GXX=&quot;$DISTCC_CXX&quot;
                 export PATH=&quot;/usr/lib/distcc/bin:$PATH&quot;
             else
@@ -275,13 +275,6 @@
                 export CCACHE_RECACHE=&quot;1&quot;
             fi
 
-            ### Check for Setarch
-            if [ -x &quot;/usr/bin/setarch&quot; -a &quot;$DISTARCH&quot; != &quot;$(uname -m)&quot; ]; then
-                SETARCH=&quot;/usr/bin/setarch $DISTARCH&quot;
-            else
-                unset SETARCH
-            fi
-
             ### Disable ExtUtils::AutoInstall in perl packages
             export PERL_EXTUTILS_AUTOINSTALL=&quot;--skipdeps --skip&quot;
 
@@ -290,9 +283,7 @@
 
             ### Prepare rpm options
             if [ &quot;$FORCE_VERBOSE&quot; ]; then
-                RPMBUILDOPTS=&quot;$RPMBUILDOPTS -vv --target $arch&quot;
-            else
-                RPMBUILDOPTS=&quot;$RPMBUILDOPTS --target $arch&quot;
+                RPMBUILDOPTS=&quot;$RPMBUILDOPTS -vv&quot;
             fi
 
             if [ &quot;$FORCE_VERBOSE&quot; == &quot;yes&quot; ]; then
@@ -307,14 +298,15 @@
                 export LD_PRELOAD=&quot;/lib/libsoapbox.so&quot;
             fi
 
-            BUILDCMD=&quot;/usr/bin/rpmbuild -bb --clean $RPMBUILDOPTS \
+            BUILDCMD=&quot;/usr/bin/rpmbuild -bb --clean $RPMBUILDOPTS --target $arch \
                     --define \&quot;_smp_mflags $MAKEFLAGS\&quot; \
                     --define \&quot;_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm\&quot; \
                     --define \&quot;_initrddir %{_sysconfdir}/rc.d/init.d\&quot; \
                     --define \&quot;_rpmdir $PACKAGEDIR/$app\&quot; \
                     --define \&quot;_sourcedir $SPECDIR\&quot; \
-                    --define \&quot;_builddir $BUILDDIR\&quot; \
+                    --define \&quot;_builddir $ROOT/build\&quot; \
                     --define \&quot;_tmppath $TEMPDIR\&quot; \
+                    --define \&quot;_buildroot $TEMPDIR/$app-$VERSION-$RELEASE-root\&quot; \
                     --define \&quot;debug_package %nil\&quot; \
                     --define \&quot;dtag $DISTNAME\&quot; \
                     --define \&quot;disttag $DISTNAME\&quot; \
@@ -334,37 +326,10 @@
                 echo -e &quot;\n----- Build log -----&quot;
 
                 ### Check for building as user
-                if [ $AS_ROOT -eq 1 ]; then
-                    $SETARCH chroot &quot;$CHROOTDIR/$dist&quot; /usr/bin/rpmbuild -bb --clean $RPMBUILDOPTS \
-                        --define &quot;_smp_mflags $MAKEFLAGS&quot; \
-                        --define &quot;_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm&quot; \
-                        --define &quot;_initrddir %{_sysconfdir}/rc.d/init.d&quot; \
-                        --define &quot;_rpmdir $PACKAGEDIR/$app&quot; \
-                        --define &quot;_sourcedir $SPECDIR&quot; \
-                        --define &quot;_builddir $ROOT/build&quot; \
-                        --define &quot;_buildroot $TEMPDIR/$app-$VERSION-$RELEASE-root&quot; \
-                        --define &quot;debug_package %nil&quot; \
-                        --define &quot;dtag $DISTNAME&quot; \
-                        --define &quot;disttag $DISTNAME&quot; \
-                        --define &quot;$DISTNAME 1&quot; \
-                        --define &quot;$DISTNICK 1&quot; \
-                        &quot;$NEWSPECFILE&quot;
+                if [ $AS_ROOT -ne 1 ]; then
+                    echo &quot;$BUILDCMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$dist&quot; /bin/su -lm $BUILD_USER -c &quot;/bin/bash --login -s&quot;
                 else
-                    $SETARCH chroot &quot;$CHROOTDIR/$dist&quot; /bin/su -lm $BUILD_USER -c &quot;/usr/bin/rpmbuild -bb --clean $RPMBUILDOPTS \
-                        --define '_smp_mflags $MAKEFLAGS' \
-                        --define '_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm' \
-                        --define '_initrddir %{_sysconfdir}/rc.d/init.d' \
-                        --define '_rpmdir $PACKAGEDIR/$app' \
-                        --define '_sourcedir $SPECDIR' \
-                        --define '_builddir $ROOT/build' \
-                        --define '_tmppath $TEMPDIR' \
-                        --define '_buildroot $TEMPDIR/$app-$VERSION-$RELEASE-root' \
-                        --define 'debug_package %nil' \
-                        --define 'dtag $DISTNAME' \
-                        --define 'disttag $DISTNAME' \
-                        --define '$DISTNAME 1' \
-                        --define '$DISTNICK 1' \
-                        $NEWSPECFILE&quot;
+                    echo &quot;$BUILDCMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$dist&quot; /bin/bash --login -s
                 fi
 
             ) &gt;&gt;&quot;$PACKAGEDIR/$app/_buildlogs/$LOGFILE_KO&quot; 2&gt;&amp;1
@@ -460,15 +425,16 @@
             if [ &quot;$FORCE_VERBOSE&quot; == &quot;yes&quot; ]; then
                 echo &quot;Building source package $app using \&quot;$SPECFILE\&quot; for $dist&quot;
             fi
-            chroot &quot;$CHROOTDIR/$dist&quot; /usr/bin/rpmbuild -bs \
-                --define &quot;_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm&quot; \
-                --define &quot;_srcrpmdir $PACKAGEDIR/$app&quot; \
-                --define &quot;_sourcedir $SPECDIR&quot; \
-                --define &quot;$dist 1&quot; \
-                --define &quot;dist $DISTNAME&quot; \
-                --define &quot;disttag $DISTNAME&quot; \
-                --define &quot;$DISTNAME 1&quot; \
-                &quot;$NEWSPECFILE&quot; &amp;&gt;/dev/null
+            BUILDCMD=&quot;/usr/bin/rpmbuild -bs \
+                --define \&quot;_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm\&quot; \
+                --define \&quot;_srcrpmdir $PACKAGEDIR/$app\&quot; \
+                --define \&quot;_sourcedir $SPECDIR\&quot; \
+                --define \&quot;$dist 1\&quot; \
+                --define \&quot;dist $DISTNAME\&quot; \
+                --define \&quot;disttag $DISTNAME\&quot; \
+                --define \&quot;$DISTNAME 1\&quot; \
+                \&quot;$NEWSPECFILE\&quot;&quot;
+            echo &quot;$BUILDCMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$dist&quot; /bin/su -lm $BUILD_USER -c &quot;/bin/bash --login -s&quot; &amp;&gt;/dev/null
             RC=$?
             if [ $RC -eq 0 ]; then
                 if [ &quot;$FORCE_VERBOSE&quot; == &quot;yes&quot; ]; then

Modified: trunk/tools/dar/dar-exec
===================================================================
--- trunk/tools/dar/dar-exec	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-exec	2008-10-12 21:45:32 UTC (rev 6512)
@@ -2,8 +2,8 @@
 source &quot;/usr/share/dar/dar-functions&quot;
 
 function help {
-	cat &lt;&lt;EOF
-usage: dar-exec [-q] [-d dist,dist2] cmd	
+    cat &lt;&lt;EOF
+usage: dar-exec [-q] [-d dist,dist2] cmd    
 Run a command in one or more DAR build environments
 
 dar-exec options:
@@ -32,8 +32,8 @@
 CMD=$@
 
 if [ ! -d &quot;$ROOT&quot; ]; then
-	echo &quot;ERROR: probably in chroot jail&quot; &gt;&amp;2
-	exit 1
+    echo &quot;ERROR: probably in chroot jail&quot; &gt;&amp;2
+    exit 1
 fi
 
 set_dists
@@ -41,39 +41,30 @@
 AS_ROOT=1
 
 for distname in $DISTS; do
-	if [ -z &quot;$QUIET&quot; ]; then
-		echo -e &quot;$_BL_$_WH= Executing \&quot;$_YE$CMD$_WH\&quot; for $_YE$distname$_WH.$_DE&quot;
-	fi
+    if [ -z &quot;$QUIET&quot; ]; then
+        echo -e &quot;$_BL_$_WH= Executing \&quot;$_YE$CMD$_WH\&quot; for $_YE$distname$_WH.$_DE&quot;
+    fi
 
-	if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
-		source &quot;$CONFIGDIR/dists/$distname/config&quot;
-		export arch=&quot;$DISTARCH&quot; dist=&quot;${DISTNAME// *}&quot; nick=&quot;$DISTNICK&quot; path=&quot;$DISTPATH&quot; repo=&quot;$REPO&quot; tag=&quot;${DISTTAG// *}&quot;
-	fi
+    if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
+        source &quot;$CONFIGDIR/dists/$distname/config&quot;
+        export arch=&quot;$DISTARCH&quot; dist=&quot;${DISTNAME// *}&quot; nick=&quot;$DISTNICK&quot; path=&quot;$DISTPATH&quot; repo=&quot;$REPO&quot; tag=&quot;${DISTTAG// *}&quot;
+    fi
 
-	### Check for building as user
-	if [ $AS_ROOT -eq 1 ]; then
-#		DO_SU=&quot;/bin/su -l -c&quot;
-		if [ &quot;$FORCE_VERBOSE&quot; ]; then
-			DO_SU=&quot;/bin/bash -x -s&quot;
-		else
-			DO_SU=&quot;/bin/bash -s&quot;
-		fi
-	else
-		if [ &quot;$FORCE_VERBOSE&quot; ]; then
-			DO_SU=&quot;/bin/su -lm $BUILD_USER -- /bin/bash -x -s&quot;
-		else
-			DO_SU=&quot;/bin/su -lm $BUILD_USER -- /bin/bash -s&quot;
-		fi
-	fi
+    ### Check for building as user
+    if [ $AS_ROOT -eq 1 -a -z &quot;$FORCE_VERBOSE&quot; ]; then
+        echo &quot;$CMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -s
+    elif [ $AS_ROOT -eq 1 -a &quot;$FORCE_VERBOSE&quot; ]; then
+        echo &quot;$CMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -x -s
+    elif [ $AS_ROOT -ne 1 -a -z &quot;$FORCE_VERBOSE&quot; ]; then
+        echo &quot;$CMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/su -lm $BUILD_USER -c &quot;/bin/bash --login -s&quot;
+    else
+        echo &quot;$CMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/su -lm $BUILD_USER -c &quot;/bin/bash --login -x -s&quot;
+    fi
+    RC=$?
 
-#	echo chroot &quot;$CHROOTDIR/$distname&quot; $DO_SU $CMD
-#	chroot &quot;$CHROOTDIR/$distname&quot; $DO_SU $CMD
-	echo &quot;$CMD&quot; | chroot &quot;$CHROOTDIR/$distname&quot; $DO_SU
-	RC=$?
-
-	if [ $RC -ne 0 ]; then
-		error &quot;$_RE_${_WH}Failed execution (RC=$_YE$RC$_WH)$_DE&quot;
-	fi
+    if [ $RC -ne 0 ]; then
+        error &quot;$_RE_${_WH}Failed execution (RC=$_YE$RC$_WH)$_DE&quot;
+    fi
 done
 
 exit 0

Modified: trunk/tools/dar/dar-list-perl.py
===================================================================
--- trunk/tools/dar/dar-list-perl.py	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-list-perl.py	2008-10-12 21:45:32 UTC (rev 6512)
@@ -16,7 +16,7 @@
     filename = os.path.join(tmppath, os.path.basename(url))
     try:
         st = os.stat(filename)
-        if st and st.st_mtime + 1800 &gt; time.time():
+        if st and st.st_mtime + 3600 &gt; time.time():
 #            print &gt;&gt;sys.stderr, &quot;File %s is recent, skip download.&quot; % os.path.basename(url)
             return True
     except:

Modified: trunk/tools/dar/dar-perl.py
===================================================================
--- trunk/tools/dar/dar-perl.py	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-perl.py	2008-10-12 21:45:32 UTC (rev 6512)
@@ -79,7 +79,7 @@
     filename = os.path.join(tmppath, os.path.basename(url))
     try:
         st = os.stat(filename)
-        if st and st.st_mtime + 1800.0 &gt; time.time():
+        if st and st.st_mtime + 3600.0 &gt; time.time():
 #            print &gt;&gt;sys.stderr, &quot;File %s is recent, skip download.&quot; % os.path.basename(url)
             return True
     except:

Modified: trunk/tools/dar/dar-prepare
===================================================================
--- trunk/tools/dar/dar-prepare	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-prepare	2008-10-12 21:45:32 UTC (rev 6512)
@@ -3,38 +3,38 @@
 source &quot;/usr/share/dar/dar-functions&quot;
 
 if [ -z &quot;$DEFAULT_DISTS&quot; -o -z &quot;$ROOT&quot; ]; then
-	echo &quot;ERROR: There's something wrong with your configuration !&quot; &gt;&amp;2
-	exit 1
+    echo &quot;ERROR: There's something wrong with your configuration !&quot; &gt;&amp;2
+    exit 1
 fi
 
 umount /dar/build 2&gt;/dev/null
-mount -o bind /dev/shm /dar/build/
+#mount -o bind /dev/shm /dar/build/
 
 for distname in $DEFAULT_DISTS; do
-	if [ &quot;${DEFAULT_DISTS// */}&quot; != $distname ]; then
-		ln -f $CHROOTDIR/${DEFAULT_DISTS// */}/root/.bash_history $CHROOTDIR/$distname/root/.bash_history
-	fi
+    if [ &quot;${DEFAULT_DISTS// */}&quot; != $distname ]; then
+        ln -f $CHROOTDIR/${DEFAULT_DISTS// */}/root/.bash_history $CHROOTDIR/$distname/root/.bash_history
+    fi
 
-	umount $CHROOTDIR/$distname{/dev/pts,/proc,/sys,/tmp,$ROOT/build,$ROOT/} 2&gt;/dev/null
+    umount $CHROOTDIR/$distname{/dev/pts,/proc,/sys,/tmp,$ROOT/build,$ROOT/} 2&gt;/dev/null
 
-#	rm -rf $CHROOTDIR/$distname{$RPMTMPPATH}/*
-	mkdir -p $CHROOTDIR/$distname/$ROOT/
-	mount -o bind $ROOT $CHROOTDIR/$distname/$ROOT/
+#   rm -rf $CHROOTDIR/$distname{$RPMTMPPATH}/*
+    mkdir -p $CHROOTDIR/$distname/$ROOT/
+    mount -o bind $ROOT $CHROOTDIR/$distname/$ROOT/
 
-	mkdir -p $CHROOTDIR/$distname/proc/
-	mount -t proc proc $CHROOTDIR/$distname/proc/
+    mkdir -p $CHROOTDIR/$distname/proc/
+    mount -t proc proc $CHROOTDIR/$distname/proc/
 
-	mkdir -p $CHROOTDIR/$distname/sys/
-	mount -t sysfs sys $CHROOTDIR/$distname/sys/
+    mkdir -p $CHROOTDIR/$distname/sys/
+    mount -t sysfs sys $CHROOTDIR/$distname/sys/
 
-	mkdir -p $CHROOTDIR/$distname/dev/pts/
-	mount -t devpts devpts $CHROOTDIR/$distname/dev/pts/
+    mkdir -p $CHROOTDIR/$distname/dev/pts/
+    mount -t devpts devpts $CHROOTDIR/$distname/dev/pts/
 
-###	Use this when you want to speed up building :)
-	mkdir -p $CHROOTDIR/$distname/$ROOT/build/
-	mount -o bind /dev/shm $CHROOTDIR/$distname$ROOT/build/
+### Use this when you want to speed up building :)
+#    mkdir -p $CHROOTDIR/$distname/$ROOT/build/
+#    mount -o bind /dev/shm $CHROOTDIR/$distname$ROOT/build/
 
-###	Use thise when using X processes inside chroots
-	mkdir -p $CHROOTDIR/$distname/tmp/
-	mount -o bind /tmp/ $CHROOTDIR/$distname/tmp/
+### Use thise when using X processes inside chroots
+#    mkdir -p $CHROOTDIR/$distname/tmp/
+#    mount -o bind /tmp/ $CHROOTDIR/$distname/tmp/
 done

Modified: trunk/tools/dar/dar-shell
===================================================================
--- trunk/tools/dar/dar-shell	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-shell	2008-10-12 21:45:32 UTC (rev 6512)
@@ -2,8 +2,8 @@
 source &quot;/usr/share/dar/dar-functions&quot;
 
 function help {
-	cat &lt;&lt;EOF
-usage: dar-shell [-q] [-d dist,dist2] cmd     
+    cat &lt;&lt;EOF
+usage: dar-shell [-q] [-v] [-d dist,dist2] cmd
 Acquire a shell in one or more DAR build environments
 
 dar-exec options:
@@ -11,6 +11,7 @@
   -d dist,dist2         select build envs
   -h                    this help message
   -q                    be very quiet
+  -v                    more verbose
 
 exported variables:
 
@@ -20,12 +21,12 @@
 exit 1
 }
 
-daropts &quot;d:hq&quot; $@
+daropts &quot;d:hqv&quot; $@
 CMD=&quot;$OPTS&quot;
 
 if [ ! -d &quot;$ROOT&quot; ]; then
-	echo &quot;ERROR: probably in chroot jail&quot; &gt;&amp;2
-	exit 1
+    echo &quot;ERROR: probably in chroot jail&quot; &gt;&amp;2
+    exit 1
 fi
 
 set_dists
@@ -33,19 +34,23 @@
 AS_ROOT=1
 
 if [ -z &quot;$QUIET&quot; ]; then
-	echo -e &quot;$_BL_$_WH= Entering shells.$_DE&quot;
+    echo -e &quot;$_BL_$_WH= Entering shells.$_DE&quot;
 fi
 for distname in $DISTS; do
-	if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
-		source &quot;$CONFIGDIR/dists/$distname/config&quot;
-		export arch=&quot;$DISTARCH&quot; dist=&quot;${DISTNAME// *}&quot; nick=&quot;$DISTNICK&quot; path=&quot;$DISTPATH&quot; repo=&quot;$REPO&quot; tag=&quot;${DISTTAG// *}&quot;
-	fi
+    if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
+        source &quot;$CONFIGDIR/dists/$distname/config&quot;
+        export arch=&quot;$DISTARCH&quot; dist=&quot;${DISTNAME// *}&quot; nick=&quot;$DISTNICK&quot; path=&quot;$DISTPATH&quot; repo=&quot;$REPO&quot; tag=&quot;${DISTTAG// *}&quot;
+    fi
 
-	setarch $DISTARCH chroot $CHROOTDIR/$distname
+    if [ -z &quot;$FORCE_VERBOSE&quot; ]; then
+        setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login
+    else
+        setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -x
+    fi
 done
 if [ -z &quot;$QUIET&quot; ]; then
-	echo -en &quot;$_BL_$_WH= Returning to parent shell. Press ENTER.$_DE&quot;
-	read a
+    echo -en &quot;$_BL_$_WH= Returning to parent shell. Press ENTER.$_DE&quot;
+    read a
 fi
 
 exit 0

Modified: trunk/tools/dar/dar-update
===================================================================
--- trunk/tools/dar/dar-update	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dar-update	2008-10-12 21:45:32 UTC (rev 6512)
@@ -12,40 +12,49 @@
 
 ### Update build environment
 for distname in $DISTS; do
-	echo &quot;Updating $distname.&quot;
-        if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
-                source &quot;$CONFIGDIR/dists/$distname/config&quot;
+    echo &quot;Updating $distname.&quot;
+    if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
+        source &quot;$CONFIGDIR/dists/$distname/config&quot;
+    else
+        warning &quot;Configfile $CONFIGDIR/dists/$distname/config missing. Aborting.&quot;
+        continue
+    fi
+
+    if [ &quot;$CREATE_REPO&quot; ]; then
+        echo &quot;Building $distname repository in $DISTPATH.&quot;
+        build_tree_apt &quot;$DISTNAME $DISTTAG&quot; &quot;$DISTPATH&quot;
+        build_repo_apt &quot;$DISTPATH&quot;
+#       build_repo_yum &quot;$DISTTAG&quot; &quot;$DISTPATH&quot;
+    fi
+
+    if [ &quot;$UPDATECMD&quot; ]; then
+        if [ -z &quot;$FORCE_VERBOSE&quot; ]; then
+            echo &quot;$UPDATECMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -s
         else
-                warning &quot;Configfile $CONFIGDIR/dists/$distname/config missing. Aborting.&quot;
-                continue
+            echo &quot;$UPDATECMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -x -s
         fi
+    fi
 
-	if [ &quot;$CREATE_REPO&quot; ]; then
-		echo &quot;Building $distname repository in $DISTPATH.&quot;
-		build_tree_apt &quot;$DISTNAME $DISTTAG&quot; &quot;$DISTPATH&quot;
-		build_repo_apt &quot;$DISTPATH&quot;
-#		build_repo_yum &quot;$DISTTAG&quot; &quot;$DISTPATH&quot;
-	fi
+    if [ -z &quot;$PKGS&quot; -a &quot;$UPGRADECMD&quot; ]; then
+        if [ -z &quot;$FORCE_VERBOSE&quot; ]; then
+            echo &quot;$UPGRADECMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -s
+        else
+            echo &quot;$UPGRADECMD&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -x -s
+        fi
+    fi
 
-	if [ &quot;$UPDATECMD&quot; ]; then
-		chroot $CHROOTDIR/$distname $UPDATECMD
-	fi
-
-	if [ -z &quot;$PKGS&quot; -a &quot;$UPGRADECMD&quot; ]; then
-		chroot $CHROOTDIR/$distname $UPGRADECMD
-	fi
-
-	if [ &quot;$INSTALLCMD&quot; -a &quot;$PKGS&quot; ]; then
-		if echo &quot;$INSTALLCMD&quot; | grep -q '%p'; then
-			for pkg in $PKGS; do
-				instcmd=&quot;$(echo $INSTALLCMD | sed -e &quot;s|%p|$pkg|g&quot;)&quot;
-				echo &quot;Installing $pkg in $distname.&quot;
-				chroot $CHROOTDIR/$distname $instcmd
-			done
-		else
-			echo $PKGS | xargs chroot $CHROOTDIR/$distname $INSTALLCMD
-		fi
-	fi
-	echo
+    if [ &quot;$INSTALLCMD&quot; -a &quot;$PKGS&quot; ]; then
+        for pkg in $PKGS; do
+            instcmd=&quot;$(echo $INSTALLCMD | sed -e &quot;s|%p|$pkg|g&quot;)&quot;
+            echo &quot;Installing $pkg in $distname.&quot;
+            chroot $CHROOTDIR/$distname $instcmd
+            if [ -z &quot;$FORCE_VERBOSE&quot; ]; then
+                echo &quot;$instcmd&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -s
+            else
+                echo &quot;$instcmd&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -x -s
+            fi
+        done
+    fi
+    echo
 done
 echo &quot;Finished.&quot;

Modified: trunk/tools/dar/dists/el2i/config
===================================================================
--- trunk/tools/dar/dists/el2i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el2i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -25,4 +25,4 @@
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
-export LD_ASSUME_KERNEL=&quot;2.4.1&quot;
+ASSUME_KERNEL=&quot;2.4.1&quot;

Modified: trunk/tools/dar/dists/el3a/config
===================================================================
--- trunk/tools/dar/dists/el3a/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el3a/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/el3i/config
===================================================================
--- trunk/tools/dar/dists/el3i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el3i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/el4a/config
===================================================================
--- trunk/tools/dar/dists/el4a/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el4a/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/el4i/config
===================================================================
--- trunk/tools/dar/dists/el4i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el4i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/el5a/config
===================================================================
--- trunk/tools/dar/dists/el5a/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el5a/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/el5i/config
===================================================================
--- trunk/tools/dar/dists/el5i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/el5i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc1i/config
===================================================================
--- trunk/tools/dar/dists/fc1i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc1i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -21,5 +21,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc2a/config
===================================================================
--- trunk/tools/dar/dists/fc2a/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc2a/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,5 +24,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc2i/config
===================================================================
--- trunk/tools/dar/dists/fc2i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc2i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -21,5 +21,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc3a/config
===================================================================
--- trunk/tools/dar/dists/fc3a/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc3a/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -21,5 +21,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc3i/config
===================================================================
--- trunk/tools/dar/dists/fc3i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc3i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -21,5 +21,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/fc4i/config
===================================================================
--- trunk/tools/dar/dists/fc4i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/fc4i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -23,5 +23,3 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;no&quot;
 REPO_CREATEREPO=&quot;yes&quot;
-
-export -n LD_ASSUME_KERNEL

Modified: trunk/tools/dar/dists/rh6i/config
===================================================================
--- trunk/tools/dar/dists/rh6i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/rh6i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -22,4 +22,4 @@
 REPO_YUM=&quot;no&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
-export LD_ASSUME_KERNEL=&quot;2.4.1&quot;
+ASSUME_KERNEL=&quot;2.4.1&quot;

Modified: trunk/tools/dar/dists/rh7i/config
===================================================================
--- trunk/tools/dar/dists/rh7i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/rh7i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -22,4 +22,4 @@
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
-export LD_ASSUME_KERNEL=&quot;2.4.1&quot;
+ASSUME_KERNEL=&quot;2.4.1&quot;

Modified: trunk/tools/dar/dists/rh8i/config
===================================================================
--- trunk/tools/dar/dists/rh8i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/rh8i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -22,4 +22,4 @@
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
-export LD_ASSUME_KERNEL=&quot;2.4.1&quot;
+ASSUME_KERNEL=&quot;2.4.1&quot;

Modified: trunk/tools/dar/dists/rh9i/config
===================================================================
--- trunk/tools/dar/dists/rh9i/config	2008-10-12 11:18:10 UTC (rev 6511)
+++ trunk/tools/dar/dists/rh9i/config	2008-10-12 21:45:32 UTC (rev 6512)
@@ -24,4 +24,4 @@
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
-export LD_ASSUME_KERNEL=&quot;2.4.1&quot;
+ASSUME_KERNEL=&quot;2.4.1&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005310.html">[svn] r6511 - trunk/tools/mrepo
</A></li>
	<LI>Next message: <A HREF="005312.html">[svn] r6513 - in trunk/rpms: perl-Archive-Zip perl-CGI-Ajax	perl-Catalyst-Model-SVN perl-Data-Page	perl-File-Copy-Recursive perl-IO-Socket-INET6 perl-IPC-PubSub	perl-IPC-Run3 perl-LEOCHARRE-DEBUG	perl-Lingua-Alphabet-Phonetic perl-Lingua-DE-Wortschatz	perl-Lingua-Han-PinYin perl-Lingua-Stem-Snowball	perl-Lingua-StopWords perl-Linux-LVM	perl-Locale-Currency-Format perl-Locale-Maketext-Lexicon	perl-LockFile-Simple perl-Log-Dispatch-FileRotate	perl-MIME-tools perl-Mail-Box perl-Mail-IMAPClient	perl-Mail-SPF perl-Mail-Sender perl-MailTools	perl-Math-Amoeba perl-Math-BaseCalc perl-Math-Counting	perl-Math-GMP perl-Math-Random perl-Math-RungeKutta	perl-Math-Units perl-Object-InsideOut
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5311">[ date ]</a>
              <a href="thread.html#5311">[ thread ]</a>
              <a href="subject.html#5311">[ subject ]</a>
              <a href="author.html#5311">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
