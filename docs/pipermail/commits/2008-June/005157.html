<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r6358 - in trunk/rpms: apt synaptic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6358%20-%20in%20trunk/rpms%3A%20apt%20synaptic&In-Reply-To=%3C200806120901.m5C91Mbg023049%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005156.html">
   <LINK REL="Next"  HREF="005158.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r6358 - in trunk/rpms: apt synaptic</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r6358%20-%20in%20trunk/rpms%3A%20apt%20synaptic&In-Reply-To=%3C200806120901.m5C91Mbg023049%40surya.karan.org%3E"
       TITLE="[svn] r6358 - in trunk/rpms: apt synaptic">packagers at lists.rpmforge.net
       </A><BR>
    <I>Thu Jun 12 11:01:22 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="005156.html">[svn] r6357 - in trunk/tools/unoconv: . tests
</A></li>
        <LI>Next message: <A HREF="005158.html">[svn] r6359 - trunk/rpms/ntop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5157">[ date ]</a>
              <a href="thread.html#5157">[ thread ]</a>
              <a href="subject.html#5157">[ subject ]</a>
              <a href="author.html#5157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2008-06-12 10:01:21 +0100 (Thu, 12 Jun 2008)
New Revision: 6358

Added:
   trunk/rpms/apt/apt-0.5.15lorg3.2-ppc.patch
   trunk/rpms/apt/apt-0.5.15lorg3.94-gcc43.patch
   trunk/rpms/apt/apt-0.5.15lorg3.94-tool-headers.patch
   trunk/rpms/apt/apt-0.5.15lorg3.x-cache-corruption.patch
   trunk/rpms/apt/apt-devel.spec
   trunk/rpms/apt/comps2prio.xsl
   trunk/rpms/apt/upgradevirt.lua
Removed:
   trunk/rpms/apt/apt-cnc.spec
   trunk/rpms/apt/apt-dag.spec
   trunk/rpms/apt/apt-test.spec
Modified:
   trunk/rpms/apt/apt.spec
   trunk/rpms/synaptic/synaptic.spec
Log:
Updates

Added: trunk/rpms/apt/apt-0.5.15lorg3.2-ppc.patch
===================================================================
--- trunk/rpms/apt/apt-0.5.15lorg3.2-ppc.patch	                        (rev 0)
+++ trunk/rpms/apt/apt-0.5.15lorg3.2-ppc.patch	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,18 @@
+diff -ur apt-0.5.15lorg3.2~/buildlib/archtable apt-0.5.15lorg3.2/buildlib/archtable
+--- apt-0.5.15lorg3.2~/buildlib/archtable	2006-06-21 18:16:11.000000000 -0400
++++ apt-0.5.15lorg3.2/buildlib/archtable	2006-10-15 19:22:09.000000000 -0400
+@@ -12,10 +12,10 @@
+ alpha.*	alpha
+ m68k	m68k
+ arm.*	arm
+-ppc	powerpc
+-powerpc	powerpc
+-ppc64		powerpc64
+-powerpc64	powerpc64
++ppc	ppc
++powerpc	ppc
++ppc64		ppc64
++powerpc64	ppc64
+ mipsel  mipsel
+ mipseb	mips
+ mips	mips

Added: trunk/rpms/apt/apt-0.5.15lorg3.94-gcc43.patch
===================================================================
--- trunk/rpms/apt/apt-0.5.15lorg3.94-gcc43.patch	                        (rev 0)
+++ trunk/rpms/apt/apt-0.5.15lorg3.94-gcc43.patch	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,18 @@
+commit 20a28924c7e7a2b28130f2847c097eae4bc98882
+Author: Panu Matilainen &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">pmatilai at laiskiainen.org</A>&gt;
+Date:   Mon Feb 11 19:35:15 2008 +0200
+
+    Add missing include for gcc 4.3
+
+diff --git a/methods/http.cc b/methods/http.cc
+index 82c113d..4939500 100644
+--- a/methods/http.cc
++++ b/methods/http.cc
+@@ -39,6 +39,7 @@
+ #include &lt;errno.h&gt;
+ #include &lt;string.h&gt;
+ #include &lt;iostream&gt;
++#include &lt;algorithm&gt;
+ #include &lt;map&gt;
+ 
+ // Internet stuff

Added: trunk/rpms/apt/apt-0.5.15lorg3.94-tool-headers.patch
===================================================================
--- trunk/rpms/apt/apt-0.5.15lorg3.94-tool-headers.patch	                        (rev 0)
+++ trunk/rpms/apt/apt-0.5.15lorg3.94-tool-headers.patch	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,65 @@
+commit d6087997e31317a7fdcb53973e69e1f9b3c0a0ac
+Author: Panu Matilainen &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">pmatilai at laiskiainen.org</A>&gt;
+Date:   Fri Jan 11 23:00:35 2008 +0200
+
+    Oops, forgot to adjust tools/ for rpmhandler going private
+
+diff --git a/tools/cached_md5.cc b/tools/cached_md5.cc
+index 4df228b..5bf789b 100644
+--- a/tools/cached_md5.cc
++++ b/tools/cached_md5.cc
+@@ -17,9 +17,9 @@
+ 
+ #include &lt;apt-pkg/error.h&gt;
+ #include &lt;apt-pkg/tagfile.h&gt;
+-#include &lt;apt-pkg/rpmhandler.h&gt;
+ #include &lt;apt-pkg/configuration.h&gt;
+ #include &lt;apt-pkg/md5.h&gt;
++#include &quot;rpmhandler.h&quot;
+ 
+ #include &lt;config.h&gt;
+ 
+diff --git a/tools/genpkglist.cc b/tools/genpkglist.cc
+index e067790..c0c608c 100644
+--- a/tools/genpkglist.cc
++++ b/tools/genpkglist.cc
+@@ -20,9 +20,9 @@
+ #include &lt;apt-pkg/error.h&gt;
+ #include &lt;apt-pkg/tagfile.h&gt;
+ #include &lt;apt-pkg/configuration.h&gt;
+-#include &lt;apt-pkg/rpmhandler.h&gt;
+ #include &lt;config.h&gt;
+ 
++#include &quot;rpmhandler.h&quot;
+ #include &quot;cached_md5.h&quot;
+ 
+ #if RPM_VERSION &gt;= 0x040100
+diff --git a/tools/gensrclist.cc b/tools/gensrclist.cc
+index ea1bb92..0597560 100644
+--- a/tools/gensrclist.cc
++++ b/tools/gensrclist.cc
+@@ -20,10 +20,10 @@
+ 
+ #include &lt;apt-pkg/error.h&gt;
+ #include &lt;apt-pkg/tagfile.h&gt;
+-#include &lt;apt-pkg/rpmhandler.h&gt;
+ #include &lt;apt-pkg/configuration.h&gt;
+ #include &lt;config.h&gt;
+ 
++#include &quot;rpmhandler.h&quot;
+ #include &quot;cached_md5.h&quot;
+ 
+ #if RPM_VERSION &gt;= 0x040100
+--- a/test/versiontest.cc
++++ b/test/versiontest.cc
+@@ -17,9 +17,9 @@
+ #include &lt;system.h&gt;
+ #include &lt;apt-pkg/error.h&gt;
+ #include &lt;apt-pkg/version.h&gt;
+-#include &lt;apt-pkg/rpmversion.h&gt;
+ #include &lt;iostream&gt;
+ #include &lt;fstream&gt;
++#include &quot;rpmversion.h&quot;
+ 
+ using namespace std;
+ 

Added: trunk/rpms/apt/apt-0.5.15lorg3.x-cache-corruption.patch
===================================================================
--- trunk/rpms/apt/apt-0.5.15lorg3.x-cache-corruption.patch	                        (rev 0)
+++ trunk/rpms/apt/apt-0.5.15lorg3.x-cache-corruption.patch	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,22 @@
+Index: apt-pkg/pkgcachegen.cc
+===================================================================
+--- apt-pkg/pkgcachegen.cc	(revision 272)
++++ apt-pkg/pkgcachegen.cc	(working copy)
+@@ -650,6 +650,17 @@
+ 	 continue;
+       }
+ 
++      // Band-aid for cache corruption issue (RH bugzilla #211254) 
++      // until real cause and cure is found
++      for (pkgCache::PkgFileIterator File = Cache.FileBegin(); 
++	    File.end() == false; File++) {
++	 if (File.FileName() == NULL) {
++	    _error-&gt;Warning(_(&quot;Cache corruption detected, band-aid applied.&quot;));
++	    _error-&gt;Warning(_(&quot;See <A HREF="https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=211254">https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=211254</A> for further info.&quot;));
++	    return false;
++	 }
++      }
++
+       // FindInCache is also expected to do an IMS check.
+       pkgCache::PkgFileIterator File = (*Start)-&gt;FindInCache(Cache);
+       if (File.end() == true)

Deleted: trunk/rpms/apt/apt-cnc.spec
===================================================================
--- trunk/rpms/apt/apt-cnc.spec	2008-06-11 23:56:53 UTC (rev 6357)
+++ trunk/rpms/apt/apt-cnc.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -1,373 +0,0 @@
-# $Id$
-# Authority: dag
-# Upstream: Gustavo Niemeyer &lt;niemeyer$conectiva,com&gt;
-
-%{?dtag: %{expand: %%define %dtag 1}}
-%define LIBVER 3.3
-
-Summary: Debian's Advanced Packaging Tool with RPM support
-Name: apt
-Version: 0.5.15cnc7
-Release: 1.2
-License: GPL
-Group: System Environment/Base
-URL: <A HREF="https://moin.conectiva.com.br/AptRpm">https://moin.conectiva.com.br/AptRpm</A>
-
-#can't find a normal link which works with spectool or wget
-Source: apt-%{version}.tar.bz2
-#Source: <A HREF="https://moin.conectiva.com.br/AptRpm?action=AttachFile&amp;do=get&amp;target=apt-%{version">https://moin.conectiva.com.br/AptRpm?action=AttachFile&amp;do=get&amp;target=apt-%{version</A>}.tar.bz2
-#Source: <A HREF="http://moin.conectiva.com.br/files/AptRpm/attachments/apt-%{version">http://moin.conectiva.com.br/files/AptRpm/attachments/apt-%{version</A>}.tar.bz2
-Patch0: apt-0.5.15cnc6-rpmpriorities.patch
-Patch1: apt-0.5.15cnc5-nodignosig.patch
-Patch2: apt-0.5.15cnc4-nopromote.patch
-#Patch3: apt-0.5.5cnc6-rpm402.patch
-#is applied in 0.5.15cnc7
-Patch4: apt-0.5.15cnc6-rpmhandler.patch
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-
-BuildRequires: rpm-devel &gt;= 4.0, zlib-devel, gettext
-BuildRequires: readline-devel, bison, gcc-c++, libtool
-BuildRequires: pkgconfig &gt;= 0.9
-%{!?rh6:BuildRequires: bzip2-devel, libstdc++-devel, docbook-utils}
-
-%{!?dtag:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?fc5:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?fc4:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?el4:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?fc3:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?fc2:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?fc1:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?el3:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?rh9:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?rh8:BuildRequires: libelf-devel}
-%{?rh7:BuildRequires: libelf}
-%{?el2:BuildRequires: libelf}
-%{?rh6:BuildRequires: libelf}
-
-Requires: rpm &gt;= 4.0, zlib, bzip2-libs, libstdc++
-
-%description
-A port of Debian's apt tools for RPM based distributions, or at least
-originally for Conectiva and now Red Hat Linux. It provides the apt-get
-utility that provides a simpler, safer way to install and upgrade packages.
-APT features complete installation ordering, multiple source capability and
-several other unique features.
-
-%package devel
-Summary: Header files, libraries and development documentation for %{name}
-Group: Development/Libraries
-Requires: %{name} = %{version}-%{release}
-
-%description devel
-This package contains the header files, static libraries and development
-documentation for %{name}. If you like to develop programs using %{name},
-you will need to install %{name}-devel.
-
-%prep
-%setup
-%patch0 -b .rpmpriorities
-#patch1 -b .nodignosig
-#patch2 -p1 -b .nopromote
-#{?rh6:%patch3 -b .402}
-#%patch4 -b .rpmhandler
-
-%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag RPM Repository %{dtag}/%{_arch} APT-HTTP/1.3|' methods/http.cc
-
-%{__cat} &lt;&lt;EOF &gt;dag.list
-# Name: Dag RPM Repository
-# URL: <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
-
-### Dag RPM Repository for Fedora Core
-%{!?fc5:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/5/en/%{_arch} dag
-%{!?fc4:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/4/en/%{_arch} dag
-%{!?fc3:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/3/en/%{_arch} dag
-%{!?fc2:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/2/en/%{_arch} dag
-%{!?fc1:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/1/en/i386 dag
-
-### Dag RPM Repository for Red Hat Enterprise Linux
-%{!?el4:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/el4/en/%{_arch} dag
-%{!?el3:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/el3/en/%{_arch} dag
-%{!?el2:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/el2.1/en/%{_arch} dag
-
-### Dag RPM Repository for Red Hat
-%{!?rh9:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/9/en/i386 dag
-%{!?rh8:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/8.0/en/i386 dag
-%{!?rh7:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/7.3/en/i386 dag
-%{!?rh6:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/6.2/en/i386 dag
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;os.list
-# Name: FreshRPMS OS/updates
-# URL: <A HREF="http://ayo.freshrpms.net/">http://ayo.freshrpms.net/</A>
-
-### Fedora Core
-%{!?fc5:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/5/%{_arch} core updates
-%{!?fc4:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/4/%{_arch} core updates
-%{!?fc3:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/3/%{_arch} core updates
-%{!?fc2:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/%{_arch} core updates
-%{!?fc1:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/%{_arch} core updates
-
-### Red Hat Linux
-%{!?rh9:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 os updates
-%{!?rh8:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 os updates
-%{!?rh7:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 os updates
-%{!?rh6:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 os powertools updates
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;freshrpms.list
-# Name: FreshRPMS
-# URL: <A HREF="http://ayo.freshrpms.net/">http://ayo.freshrpms.net/</A>
-
-### Fedora Core
-%{!?fc5:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/5/%{_arch} freshrpms
-%{!?fc4:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/4/%{_arch} freshrpms
-%{!?fc3:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/3/%{_arch} freshrpms
-%{!?fc2:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/%{_arch} freshrpms
-%{!?fc1:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/i386 freshrpms
-
-### Red Hat Linux
-%{!?rh9:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 freshrpms
-%{!?rh8:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 freshrpms
-%{!?rh7:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 freshrpms
-%{!?rh6:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 freshrpms
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;newrpms.list
-# Name: NewRPMS
-# URL: <A HREF="http://newrpms.sunsite.dk/">http://newrpms.sunsite.dk/</A>
-
-### Fedora Core
-%{!?fc5:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc5 newrpms
-%{!?fc4:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc4 newrpms
-%{!?fc3:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc3 newrpms
-%{!?fc2:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc2 newrpms
-%{!?fc1:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc1 newrpms
-
-### Red Hat Linux
-%{!?rh9:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/9.0 newrpms
-%{!?rh8:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/8.0 newrpms
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;dries.list
-# Name: Dries RPM Repository
-# URL: <A HREF="http://dries.studentenweb.org/apt/">http://dries.studentenweb.org/apt/</A>
-
-### Fedora Core
-%{!?fc5:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/fedora/fc5/i386 dries
-%{!?fc4:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/fedora/fc4/i386 dries
-%{!?fc3:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/fedora/fc3/i386 dries
-%{!?fc2:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/fedora/fc2/i386 dries
-%{!?fc1:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/fedora/fc1/i386 dries
-
-### Red Hat Enterprise Linux
-%{!?el4:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/redhat/el4/en/i386 dries
-%{!?el3:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> dries/redhat/el3/en/i386 dries
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;atrpms.list
-# Name: ATrpms
-# URL: <A HREF="http://atrpms.physik.fu-berlin.de/">http://atrpms.physik.fu-berlin.de/</A>
-
-### Fedora Core
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/4/en/i386 at-testing
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/3/en/i386 at-testing
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/2/en/i386 at-testing
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/1/en/i386 at-testing
-
-### Red Hat Linux
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/9/en/i386 at-testing
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/8.0/en/i386 at-testing
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/7.3/en/i386 at-testing
-EOF
-
-%{__cat} &lt;&lt;'EOF' &gt;apt.conf
-APT {
-	Clean-Installed &quot;false&quot;;
-	Get {
-		Assume-Yes &quot;false&quot;;
-		Download-Only &quot;false&quot;;
-		Show-Upgraded &quot;true&quot;;
-		Fix-Broken &quot;false&quot;;
-		Ignore-Missing &quot;false&quot;;
-		Compile &quot;false&quot;;
-	};
-};
-
-Acquire {
-	Retries &quot;0&quot;;
-	HTTP {
-		Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
-	};
-};
-
-RPM {
-	Ignore { };
-	Hold { };
-	Options { };
-	Install-Options &quot;&quot;;
-	Erase-Options &quot;&quot;;
-//	Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
-	Source {
-		Build-Command &quot;rpmbuild --rebuild&quot;;
-	};
-	Allow-Duplicated {
-		&quot;^kernel$&quot;;
-		&quot;^kernel-&quot;;
-		&quot;^gpg-pubkey$&quot;;
-	};
-};
-EOF
-
-%build
-%{?fc5:libtoolize -f &amp;&amp; autoreconf}
-%{?fc4:libtoolize -f &amp;&amp; autoreconf}
-#{__autoconf}
-%configure \
-	--program-prefix=&quot;%{?_program_prefix}&quot; \
-	--includedir=&quot;%{_includedir}/apt-pkg&quot;
-#	--with-hashmap
-%{__make} %{?_smp_mflags}
-
-%install
-%{__rm} -rf %{buildroot}
-%makeinstall \
-	includedir=&quot;%{buildroot}%{_includedir}/apt-pkg&quot;
-%find_lang %{name}
-
-%{__install} -d -m0755 \
-		%{buildroot}%{_sysconfdir}/apt/{apt.conf.d,sources.list.d} \
-		%{buildroot}%{_localstatedir}/cache/apt/{archives/partial,genpkglist,gensrclist} \
-		%{buildroot}%{_localstatedir}/state/apt/lists/partial \
-		%{buildroot}%{_libdir}/apt/scripts/
-%{__install} -p -m0644 rpmpriorities apt.conf %{buildroot}%{_sysconfdir}/apt/
-%{__install} -p -m0644 dag.list os.list freshrpms.list newrpms.list dries.list atrpms.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/
-touch %{buildroot}%{_sysconfdir}/apt/preferences \
-	%{buildroot}%{_sysconfdir}/apt/vendors.list
-
-#%{__ln_s} -f %{_libdir}libapt-pkg-libc6.3-5.so.0 %{buildroot}%{_libdir}libapt-pkg-libc6.3-5.so.%{LIBVER}
-
-%post
-/sbin/ldconfig 2&gt;/dev/null
-
-%postun
-/sbin/ldconfig 2&gt;/dev/null
-
-%clean
-%{__rm} -rf %{buildroot}
-
-%files -f %{name}.lang
-%defattr(-, root, root, 0755)
-%doc AUTHORS* COPYING* TODO contrib/ doc/examples/
-%doc %{_mandir}/man?/*
-%dir %{_sysconfdir}/apt/
-%config(noreplace) %{_sysconfdir}/apt/apt.conf
-%config(noreplace) %{_sysconfdir}/apt/preferences
-#config(noreplace) %{_sysconfdir}/apt/sources.list
-%config(noreplace) %{_sysconfdir}/apt/vendors.list
-%config %{_sysconfdir}/apt/rpmpriorities
-%config(noreplace) %{_sysconfdir}/apt/apt.conf.d/
-%config(noreplace) %{_sysconfdir}/apt/sources.list.d/
-%{_bindir}/apt-cache
-%{_bindir}/apt-cdrom
-%{_bindir}/apt-config
-%{_bindir}/apt-get
-%{_bindir}/apt-shell
-%{_bindir}/genbasedir
-%{_bindir}/genpkglist
-%{_bindir}/gensrclist
-%{_bindir}/countpkglist
-%{_libdir}/apt/
-%{_libdir}/libapt-pkg-*.so.*
-%{_localstatedir}/cache/apt/
-%{_localstatedir}/state/apt/
-
-%files devel
-%defattr(-, root, root, 0755)
-%{_libdir}/libapt-pkg.a
-%exclude %{_libdir}/libapt-pkg.la
-%{_libdir}/libapt-pkg.so
-%{_includedir}/apt-pkg/
-#exclude %{_libdir}/*.la
-
-%changelog
-* Tue Apr 11 2006 Dries Verachtert &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dries at ulyssis.org</A>&gt; - 0.5.15cnc7-1.2
-- Rebuild for Fedora Core 5.
-
-* Mon Jan 02 2005 Dries Verachtert &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dries at ulyssis.org</A>&gt; - 0.5.15cnc7-1
-- Added libtoolize and autoreconf fix for Fedora Core 5, thanks
-  to Stephen Clement.
-- Updated to release 0.5.15cnc7.
-
-* Sat Nov 20 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-4
-- Added readline-devel as buildrequirement for apt-shell.
-
-* Thu Jul 01 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-3
-- Fix for apt-bug triggered by mach.
-
-* Fri Jun 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-2
-- Make apt understand about architectures.
-
-* Tue Mar 23 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-1
-- Updated to release 0.5.15cnc6.
-
-* Sat Jan 24 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Added RHAS21 repository.
-
-* Sun Jan 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc5-0
-- Updated to release 0.5.15cnc5.
-
-* Sat Dec 06 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-1
-- Disabled the epoch promotion behaviour on RH9.
-
-* Thu Dec 04 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-0
-- Updated to release 0.5.15cnc4.
-
-* Tue Nov 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc3-0
-- Updated to release 0.5.15cnc3.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc2-0
-- Updated to release 0.5.15cnc2.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Fixed apt pinning.
-- Added RHFC1 repository.
-
-* Sat Nov 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-0
-- Updated to release 0.5.15cnc1.
-
-* Sun Oct 26 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-1
-- Added RHEL3 repository.
-
-* Tue Jun 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-0
-- Added newrpms and enable it by default.
-- Updated to release 0.5.5cnc6.
-
-* Tue Jun 03 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-4
-- Added freshrpms and enable it by default.
-
-* Sun Jun 01 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-3
-- Work around a bug in apt (apt.conf).
-
-* Fri May 30 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-2
-- Moved sources.list to sources.d/
-
-* Wed Apr 16 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-1
-- Updated to release 0.5.5cnc5.
-
-* Tue Apr 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-2
-- RH90 repository rename from redhat/9.0 to redhat/9.
-
-* Sat Apr 05 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-1
-- FreshRPMS fixes to repository locations.
-
-* Sun Mar 09 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-0
-- Updated to release 0.5.5cnc4.1.
-
-* Fri Feb 28 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc3-0
-- Updated to release 0.5.5cnc3.
-
-* Tue Feb 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc2-0
-- Updated to release 0.5.5cnc2.
-
-* Mon Feb 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.4cnc9-0
-- Initial package. (using DAR)

Deleted: trunk/rpms/apt/apt-dag.spec
===================================================================
--- trunk/rpms/apt/apt-dag.spec	2008-06-11 23:56:53 UTC (rev 6357)
+++ trunk/rpms/apt/apt-dag.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -1,378 +0,0 @@
-# $Id$
-# Authority: axel
-# Upstream: Gustavo Niemeyer &lt;niemeyer$conectiva,com&gt;
-
-%{?dtag: %{expand: %%define %dtag 1}}
-%define LIBVER 3.3
-
-Summary: Debian's Advanced Packaging Tool with RPM support
-Name: apt
-Version: 0.5.15cnc5
-Release: 1
-License: GPL
-Group: System Environment/Base
-URL: <A HREF="https://moin.conectiva.com.br/AptRpm">https://moin.conectiva.com.br/AptRpm</A>
-
-Source: <A HREF="http://moin.conectiva.com.br/files/AptRpm/attachments/apt-%{version">http://moin.conectiva.com.br/files/AptRpm/attachments/apt-%{version</A>}.tar.bz2
-Patch0: apt-0.5.15cnc1-rpmpriorities.patch
-Patch1: apt-0.5.5cnc5-nodignosig.patch
-Patch2: apt-0.5.15cnc4-nopromote.patch
-#Patch3: apt-0.5.5cnc6-rpm402.patch
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-
-BuildRequires: rpm-devel &gt;= 4.0, zlib-devel, gettext
-%{!?rh6:BuildRequires: bzip2-devel, libstdc++-devel, docbook-utils}
-
-%{?fc1:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?el3:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?rh9:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?rh8:BuildRequires: libelf-devel}
-%{?rh7:BuildRequires: libelf}
-%{?el2:BuildRequires: libelf}
-%{?rh6:BuildRequires: libelf}
-
-Requires: rpm &gt;= 4.0, zlib, bzip2-libs, libstdc++
-
-%description
-A port of Debian's apt tools for RPM based distributions, or at least
-originally for Conectiva and now Red Hat Linux. It provides the apt-get
-utility that provides a simpler, safer way to install and upgrade packages.
-APT features complete installation ordering, multiple source capability and
-several other unique features.
-
-%package devel
-Summary: Header files, libraries and development documentation for %{name}
-Group: Development/Libraries
-Requires: %{name} = %{version}-%{release}
-
-%description devel
-This package contains the header files, static libraries and development
-documentation for %{name}. If you like to develop programs using %{name},
-you will need to install %{name}-devel.
-
-%prep
-%setup
-%patch0 -b .rpmpriorities
-#patch1 -b .nodignosig
-#patch2 -p1 -b .nopromote
-#{?rh62:%patch3 -b .402}
-
-%{?fc2:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH FC2 APT-HTTP/1.3|' methods/http.cc}
-%{?fc1:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH FC1 APT-HTTP/1.3|' methods/http.cc}
-%{?el3:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH EL3 APT-HTTP/1.3|' methods/http.cc}
-%{?rh9:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH 9 APT-HTTP/1.3|' methods/http.cc}
-%{?rh8:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH 8.0 APT-HTTP/1.3|' methods/http.cc}
-%{?rh7:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH 7.3 APT-HTTP/1.3|' methods/http.cc}
-%{?el2:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH EL2.1 APT-HTTP/1.3|' methods/http.cc}
-%{?rh6:%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|Dag Apt Repository RH 6.2 APT-HTTP/1.3|' methods/http.cc}
-
-%{__cat} &lt;&lt;EOF &gt;dag.list
-### Dag Apt Repository
-### &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
-### More information of this repository at:
-###	<A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
-
-### Dag Apt Repository for Red Hat Fedore Core 2
-%{!?fc2:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/2/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/2/en/i386 dag
-
-### Dag Apt Repository for Red Hat Fedore Core 1
-%{!?fc1:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/1/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> fedora/1/en/i386 dag
-
-### Dag Apt Repository for Red Hat Enterprise Linux 3
-%{!?el3:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/el3/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/el3/en/i386 dag
-
-### Dag Apt Repository for Red Hat 9
-%{!?rh9:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/9/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/9/en/i386 dag
-
-### Dag Apt Repository for Red Hat 8.0
-%{!?rh8:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/8.0/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/8.0/en/i386 dag
-
-### Dag Apt Repository for Red Hat 7.3
-%{!?rh7:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/7.3/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/7.3/en/i386 dag
-
-### Dag Apt Repository for Red Hat Enterprise Linux 2.1
-%{!?el2:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/as2.1/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/as2.1/en/i386 dag
-
-### Dag Apt Repository for Red Hat 6.2
-%{!?rh6:#}rpm <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/6.2/en/i386 dag
-#rpm-src <A HREF="http://apt.sw.be">http://apt.sw.be</A> redhat/6.2/en/i386 dag
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;os.list
-### List of available apt repositories available from ayo.freshrpms.net.
-### This file should contain an uncommented default suitable for your system.
-###
-### See <A HREF="http://ayo.freshrpms.net/">http://ayo.freshrpms.net/</A> for a list of other repositories and mirrors.
-
-### Red Hat Fedora Core 2
-%{!?fc2:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/i386 core updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/i386 core updates
-
-### Red Hat Fedora Core 1
-%{!?fc1:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/i386 core updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/i386 core updates
-
-### Red Hat Linux 9
-%{!?rh9:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 os updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 os updates
-
-### Red Hat Linux 8.0
-%{!?rh8:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 os updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 os updates
-
-### Red Hat Linux 7.3
-%{!?rh7:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 os updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 os updates
-
-### Red Hat Linux 6.2
-%{!?rh6:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 os powertools updates
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 os powertools updates
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;freshrpms.list
-### List of available apt repositories available from ayo.freshrpms.net.
-### This file should contain an uncommented default suitable for your system.
-###
-### See <A HREF="http://ayo.freshrpms.net/">http://ayo.freshrpms.net/</A> for a list of other repositories and mirrors.
-
-### Red Hat Fedora Core 2
-%{!?fc2:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/2/i386 freshrpms
-
-### Red Hat Fedora Core 1
-%{!?fc1:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/1/i386 freshrpms
-
-### Red Hat Linux 9
-%{!?rh9:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/9/i386 freshrpms
-
-### Red Hat Linux 8.0
-%{!?rh8:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/8.0/i386 freshrpms
-
-### Red Hat Linux 7.3
-%{!?rh7:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/7.3/i386 freshrpms
-
-### Red Hat Linux 6.2
-%{!?rh6:#}rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 freshrpms
-#rpm-src <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/6.2/i386 freshrpms
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;newrpms.list
-### See <A HREF="http://newrpms.sunsite.dk/">http://newrpms.sunsite.dk/</A> for more information.
-
-### Red Hat Fedora Core 2
-%{!?fc2:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc2 newrpms
-#rpm-src <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc2 newrpms
-
-### Red Hat Fedora Core 1
-%{!?fc1:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc1 newrpms
-#rpm-src <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/fc1 newrpms
-
-### Red Hat Linux 9
-%{!?rh9:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/9.0 newrpms
-#rpm-src <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/9.0 newrpms
-
-### Red Hat Linux 8.0
-%{!?rh8:#}rpm <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/8.0 newrpms
-#rpm-src <A HREF="http://newrpms.sunsite.dk/apt/">http://newrpms.sunsite.dk/apt/</A> redhat/en/i386/8.0 newrpms
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;atrpms.list
-### See <A HREF="http://atrpms.physik.fu-berlin.de/">http://atrpms.physik.fu-berlin.de/</A> for more information.
-### Possible sections: at-stable, at-good, at-testing, at-bleeding
-
-### Red Hat Fedora Core 2
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/2/en/i386 at-testing
-#rpm-src <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/2/en/i386 at-testing
-
-### Red Hat Fedora Core 1
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/1/en/i386 at-testing
-#rpm-src <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> fedora/1/en/i386 at-testing
-
-### Red Hat Linux 9
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/9/en/i386 at-testing
-#rpm-src <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/9/en/i386 at-testing
-
-### Red Hat Linux 8.0
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/8.0/en/i386 at-testing
-#rpm-src <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/8.0/en/i386 at-testing
-
-### Red Hat Linux 7.3
-#rpm <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/7.3/en/i386 at-testing
-#rpm-src <A HREF="http://apt.physik.fu-berlin.de">http://apt.physik.fu-berlin.de</A> redhat/7.3/en/i386 at-testing
-EOF
-
-%{__cat} &lt;&lt;'EOF' &gt;apt.conf
-APT {
-	Clean-Installed &quot;false&quot;;
-	Get {
-		Assume-Yes &quot;false&quot;;
-		Download-Only &quot;false&quot;;
-		Show-Upgraded &quot;true&quot;;
-		Fix-Broken &quot;false&quot;;
-		Ignore-Missing &quot;false&quot;;
-		Compile &quot;false&quot;;
-	};
-};
-
-Acquire {
-	Retries &quot;0&quot;;
-	HTTP {
-		Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
-	};
-};
-
-RPM {
-	Ignore { };
-	Hold { };
-	Options { };
-	Install-Options &quot;&quot;;
-	Erase-Options &quot;&quot;;
-//	Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
-	Source {
-		Build-Command &quot;rpmbuild --rebuild&quot;;
-	};
-	Allow-Duplicated {
-		&quot;^kernel$&quot;;
-		&quot;^kernel-&quot;;
-		&quot;^gpg-pubkey$&quot;;
-	};
-};
-EOF
-
-%build
-#{__autoconf}
-%configure \
-	--disable-dependency-tracking \
-	--program-prefix=&quot;%{?_program_prefix}&quot; \
-	--includedir=&quot;%{_includedir}/apt-pkg&quot;
-#	--with-hashmap
-%{__make} %{?_smp_mflags}
-
-%install
-%{__rm} -rf %{buildroot}
-%makeinstall \
-	includedir=&quot;%{buildroot}%{_includedir}/apt-pkg&quot;
-%find_lang %{name}
-
-%{__install} -d -m0755 \
-		%{buildroot}%{_sysconfdir}/apt/{apt.conf.d,sources.list.d} \
-		%{buildroot}%{_localstatedir}/cache/apt/{archives/partial,genpkglist,gensrclist} \
-		%{buildroot}%{_localstatedir}/state/apt/lists/partial \
-		%{buildroot}%{_libdir}/apt/scripts/
-%{__install} -m0644 rpmpriorities apt.conf %{buildroot}%{_sysconfdir}/apt/
-%{__install} -m0644 dag.list os.list freshrpms.list newrpms.list atrpms.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/
-touch %{buildroot}%{_sysconfdir}/apt/preferences \
-	%{buildroot}%{_sysconfdir}/apt/vendors.list
-
-#%{__ln_s} -f %{_libdir}libapt-pkg-libc6.3-5.so.0 %{buildroot}%{_libdir}libapt-pkg-libc6.3-5.so.%{LIBVER}
-
-### Clean up buildroot
-%{__rm} -f %{buildroot}%{_libdir}/*.la
-
-%post
-/sbin/ldconfig
-
-%postun
-/sbin/ldconfig
-
-%clean
-%{__rm} -rf %{buildroot}
-
-%files -f %{name}.lang
-%defattr(-, root, root, 0755)
-%doc AUTHORS* COPYING* TODO contrib/ doc/examples/
-%doc %{_mandir}/man?/*
-%dir %{_sysconfdir}/apt/
-%config(noreplace) %{_sysconfdir}/apt/apt.conf
-%config(noreplace) %{_sysconfdir}/apt/preferences
-#config(noreplace) %{_sysconfdir}/apt/sources.list
-%config(noreplace) %{_sysconfdir}/apt/vendors.list
-%config %{_sysconfdir}/apt/rpmpriorities
-%config(noreplace) %{_sysconfdir}/apt/apt.conf.d/
-%config(noreplace) %{_sysconfdir}/apt/sources.list.d/
-%{_bindir}/*
-%{_libdir}/*.so.*
-%{_libdir}/apt/
-%{_localstatedir}/cache/apt/
-%{_localstatedir}/state/apt/
-
-%files devel
-%defattr(-, root, root, 0755)
-%{_libdir}/*.a
-%{_libdir}/*.so
-%{_includedir}/apt-pkg/
-#exclude %{_libdir}/*.la
-
-%changelog
-* Sat Jan 24 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Added RHAS21 repository.
-
-* Sun Jan 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc5-0
-- Updated to release 0.5.15cnc5.
-
-* Sat Dec 06 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-1
-- Disabled the epoch promotion behaviour on RH9.
-
-* Thu Dec 04 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-0
-- Updated to release 0.5.15cnc4.
-
-* Tue Nov 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc3-0
-- Updated to release 0.5.15cnc3.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc2-0
-- Updated to release 0.5.15cnc2.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Fixed apt pinning.
-- Added RHFC1 repository.
-
-* Sat Nov 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-0
-- Updated to release 0.5.15cnc1.
-
-* Sun Oct 26 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-1
-- Added RHEL3 repository.
-
-* Tue Jun 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-0
-- Added newrpms and enable it by default.
-- Updated to release 0.5.5cnc6.
-
-* Tue Jun 03 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-4
-- Added freshrpms and enable it by default.
-
-* Sun Jun 01 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-3
-- Work around a bug in apt (apt.conf).
-
-* Fri May 30 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-2
-- Moved sources.list to sources.d/
-
-* Wed Apr 16 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-1
-- Updated to release 0.5.5cnc5.
-
-* Tue Apr 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-2
-- RH90 repository rename from redhat/9.0 to redhat/9.
-
-* Sat Apr 05 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-1
-- FreshRPMS fixes to repository locations.
-
-* Sun Mar 09 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-0
-- Updated to release 0.5.5cnc4.1.
-
-* Fri Feb 28 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc3-0
-- Updated to release 0.5.5cnc3.
-
-* Tue Feb 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc2-0
-- Updated to release 0.5.5cnc2.
-
-* Mon Feb 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.4cnc9-0
-- Initial package. (using DAR)

Added: trunk/rpms/apt/apt-devel.spec
===================================================================
--- trunk/rpms/apt/apt-devel.spec	                        (rev 0)
+++ trunk/rpms/apt/apt-devel.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,691 @@
+# $Id$
+# Authority: dag
+# Upstream: Panu Matilainen &lt;pmatilai$laiskiainen,org&gt;
+
+# Tag: test
+
+%define python_sitearch %(%{__python} -c 'from distutils import sysconfig; print sysconfig.get_python_lib(1)')
+
+%{?dtag: %{expand: %%define %dtag 1}}
+
+%{?rh8:%define _without_elfutils 1}
+
+%{?rh7:%define _without_elfutils 1}
+%{?rh7:%define _without_python22 1}
+%{?rh7:%define _without_rpm42 1}
+
+%{?el2:%define _without_elfutils 1}
+%{?el2:%define _without_pkgconfig 1}
+%{?el2:%define _without_python22 1}
+%{?el2:%define _without_rpm42 1}
+
+%{?rh6:%define _without_elfutils 1}
+%{?rh6:%define _without_pkgconfig 1}
+%{?rh6:%define _without_python22 1}
+%{?rh6:%define _without_rpm42 1}
+
+Summary: Debian's Advanced Packaging Tool with RPM support
+Name: apt
+Version: 0.5.15lorg3.94a
+Release: 2
+License: GPL
+Group: System Environment/Base
+URL: <A HREF="http://apt-rpm.org/">http://apt-rpm.org/</A>
+
+#Source0: <A HREF="http://apt-rpm.org/releases/apt-%{version">http://apt-rpm.org/releases/apt-%{version</A>}.tar.bz2
+Source0: <A HREF="http://apt-rpm.org/testing/apt-%{version">http://apt-rpm.org/testing/apt-%{version</A>}.tar.bz2
+Source19: comps2prio.xsl
+Source51: upgradevirt.lua
+Patch0: apt-0.5.15lorg3.2-ppc.patch
+Patch1: apt-0.5.15lorg3.x-cache-corruption.patch
+Patch3: apt-0.5.15lorg3.94-gcc43.patch
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+
+BuildRequires: bison
+BuildRequires: bzip2-devel
+BuildRequires: gcc-c++
+BuildRequires: gettext
+BuildRequires: libstdc++-devel
+BuildRequires: libtool
+BuildRequires: libxml2-devel &gt;= 2.6.16
+BuildRequires: ncurses-devel
+BuildRequires: readline-devel
+BuildRequires: rpm-devel &gt;= 3.0.5
+BuildRequires: sqlite-devel
+BuildRequires: zlib-devel
+%{!?_without_elfutils:BuildRequires: beecrypt-devel, elfutils-devel}
+%{?_without_elfutils:BuildRequires: libelf}
+%{!?_without_pkgconfig:BuildRequires: pkgconfig &gt;= 0.9}
+%{!?_without_python22:BuildRequires: python-devel &gt;= 2.2}
+
+%{?rh8:BuildRequires: libelf-devel}
+%{!?rh6:BuildRequires: bzip2-devel, libstdc++-devel, docbook-utils}
+
+Requires: bzip2-libs
+Requires: chkconfig
+Requires: gnupg
+Requires: ldconfig
+Requires: libstdc++
+Requires: libxml2 &gt;= 2.6.16
+Requires: rpm &gt;= 3.0.5
+Requires: zlib
+
+%description
+A port of Debian's apt tools for RPM based distributions, or at least
+originally for Conectiva and now Red Hat Linux. It provides the apt-get
+utility that provides a simpler, safer way to install and upgrade packages.
+APT features complete installation ordering, multiple source capability and
+several other unique features.
+
+%package devel
+Summary: Header files, libraries and development documentation for %{name}
+Group: Development/Libraries
+Requires: %{name} = %{version}-%{release}
+
+%description devel
+This package contains the header files, static libraries and development
+documentation for %{name}. If you like to develop programs using %{name},
+you will need to install %{name}-devel.
+
+%package -n python-apt
+Summary: Python bindings for libapt-pkg
+Group: Development/Libraries
+Requires: %{name} = %{version}-%{release}
+Obsoletes: apt-python &lt;= %{version}-%{release}
+Provides: apt-python = %{version}-%{release}
+
+%description -n python-apt
+The python-apt package contains a module which allows python programs
+to access the APT library interface.
+
+%prep
+%setup
+%patch0 -p1 -b .ppc
+%patch1 -p0 -b .mmap
+%patch3 -p1 -b .gcc43
+
+### Fix docs to reference correct paths
+%{__perl} -pi -e '
+        s|\bconfigure-index\.gz\b|configure-index|g;
+        s|/usr/share/doc/apt/|%{_docdir}/%{name}-%{version}/|g;
+    ' doc/apt.ent doc/*/apt.ent.* doc/offline.sgml contrib/apt-wrapper/apt.ent
+
+%{__install} -Dp -m644 %{SOURCE19} comps2prio.xsl
+
+%{?el5:name='Red Hat Enterprise'; version='5'}
+%{?el4:name='Red Hat Enterprise'; version='4'}
+%{?el3:name='Red Hat Enterprise'; version='3'}
+%{?el2:name='Red Hat Enterprise'; version='2.1'}
+%{?fc7:name='Fedora Core'; version='7'}
+%{?fc6:name='Fedora Core'; version='6'}
+%{?fc5:name='Fedora Core'; version='5'}
+%{?fc4:name='Fedora Core'; version='4'}
+%{?fc3:name='Fedora Core'; version='3'}
+%{?fc2:name='Fedora Core'; version='2'}
+%{?fc1:name='Fedora Core'; version='1'}
+%{?rh9:name='Red Hat'; version='9'}
+%{?rh8:name='Red Hat'; version='8.0'}
+%{?rh7:name='Red Hat'; version='7.3'}
+%{?rh6:name='Red Hat'; version='6.2'}
+
+%{__cat} &lt;&lt;EOF &gt;rpmpriorities
+Essential:
+  authconfig
+  basesystem
+  bash
+  centos-release
+  coreutils
+  cpio
+  e2fsprogs
+  ed
+  fedora-release
+  file
+  filesystem
+  glibc
+  grub
+  hdparm
+  hotplug
+  initscripts
+  iproute
+  iputils
+  kbd
+  kudzu
+  libgcc
+  losetup
+  passwd
+  procps
+  raidtools
+  readline
+  redhat-release
+  rpm
+  rsyslog
+  setserial
+  setup
+  shadow-utils
+  sh-utils
+  sysklogd
+  SysVinit
+  sysvinit
+  udev
+  util-linux
+  util-linux-ng
+  vim-minimal
+EOF
+
+%{__cat} &lt;&lt;EOF &gt;sources.list
+### Add your custom repositories here or in /etc/apt/sources.list.d/
+EOF
+
+%{__cat} &lt;&lt;'EOF' &gt;os.list
+# Name: Operating system and updates
+
+### Red Hat Enterprise Linux
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/os/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/updates/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/extras/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/fasttrack/$(ARCH)
+#repomd <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH)/RPMS.os
+#repomd <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH)/RPMS.updates
+#rpm <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH) os updates
+
+### Fedora Core Linux
+%{!?fedora:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH)/core
+%{!?fedora:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH)/updates
+#rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH) core updates
+
+### Red Hat Linux
+%{!?rhl:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH)/os
+%{!?rhl:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH)/updates
+#rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH) os updates
+EOF
+
+#%{__cat} &lt;&lt;EOF &gt;apt.conf
+#APT {
+#    Clean-Installed &quot;false&quot;;
+#    Get {
+#        Assume-Yes &quot;false&quot;;
+#        Download-Only &quot;false&quot;;
+#        Show-Upgraded &quot;true&quot;;
+#        Fix-Broken &quot;false&quot;;
+#        Ignore-Missing &quot;false&quot;;
+#        Compile &quot;false&quot;;
+#    };
+#    DistroVersion &quot;$version&quot;;
+#};
+#
+#Acquire {
+#    Retries &quot;0&quot;;
+#    HTTP {
+#        Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
+#    };
+#};
+#
+#RPM {
+#    Ignore { };
+#    Hold { };
+#    Options { };
+#    Install-Options &quot;&quot;;
+#    Erase-Options &quot;&quot;;
+#//  Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
+#    Source {
+#        Build-Command &quot;rpmbuild --rebuild&quot;;
+#    };
+#    Allow-Duplicated {
+#        &quot;^kernel$&quot;;
+#        &quot;^kernel-bigmem$&quot;;
+#        &quot;^kernel-devel$&quot;;
+#        &quot;^kernel-enterprise$&quot;;
+#        &quot;^kernel-headers$&quot;;
+#        &quot;^kernel-hugemem$&quot;;
+#        &quot;^kernel-largesmp$&quot;;
+#        &quot;^kernel-smp$&quot;;
+#        &quot;^kernel-source$&quot;;
+#        &quot;^kernel-unsupported$&quot;;
+#        &quot;^kernel-xen$&quot;;
+#        &quot;^gpg-pubkey$&quot;;
+#    };
+#    Order &quot;true&quot;;
+#};
+#EOF
+
+%{__cat} &lt;&lt;EOF &gt;apt.conf
+// User customizable configuration
+
+RPM {
+    // Uncomment to disable GPG-signature checking for packages
+    // GPG-Check &quot;false&quot;;
+    // Uncomment to prevent kernel being handled along with (dist-)upgrade
+    // Upgrade-Virtual &quot;false&quot;;
+    // Uncomment to hold packages with modified config files in (dist-)upgrade
+    // Preserve-Config &quot;true&quot;;
+};
+
+// Options for the downloading routines
+Acquire {
+    // Retries &quot;1&quot;;
+    // http::Proxy &quot;<A HREF="http://user:password@proxy-server.domain.tld:port/">http://user:password@proxy-server.domain.tld:port/</A>&quot;;
+    // http::Proxy &quot;<A HREF="http://proxy-server.domain.tld:port/">http://proxy-server.domain.tld:port/</A>&quot;;
+};
+EOF
+
+%{__cat} &lt;&lt;EOF &gt;default.conf
+// These are &quot;factory defaults&quot;, DO NOT CHANGE!
+// Put your customizations to /etc/apt/apt.conf instead, those will
+// override any setting in here.
+
+APT {
+    Get {
+        Show-Versions &quot;true&quot;;
+    }
+    DistroVersion &quot;$version&quot;;
+};
+
+RPM {
+    // Always check GPG keys and automatically import new ones
+    GPG-Check &quot;true&quot;;
+    GPG-Import &quot;true&quot;;
+    Allow-Duplicated {
+        &quot;^gpg-pubkey$&quot;;
+        &quot;^kernel$&quot;;
+        &quot;^kernel-bigmem$&quot;;
+        &quot;^kernel-devel$&quot;;
+        &quot;^kernel-enterprise$&quot;;
+        &quot;^kernel-headers$&quot;;
+        &quot;^kernel-hugemem$&quot;;
+        &quot;^kernel-largesmp$&quot;;
+        &quot;^kernel-smp$&quot;;
+        &quot;^kernel-source$&quot;;
+        &quot;^kernel-unsupported$&quot;;
+        &quot;^kernel-xen$&quot;;
+    };
+    Order &quot;true&quot;;
+};
+
+// Options for the downloading routines
+Acquire {
+    http::User-Agent &quot;APT-HTTP/1.3&quot;;
+};
+
+Scripts {
+    Init { &quot;gpg-import.lua&quot;; };
+    PM {
+        Pre { &quot;gpg-check.lua&quot;; };
+        Post { &quot;upgradevirt.lua&quot;; };
+    };
+    AptGet {
+        Upgrade { &quot;upgradevirt.lua&quot;; };
+        DistUpgrade {&quot;upgradevirt.lua&quot;; };
+        Install::SelectPackage { &quot;upgradevirt.lua&quot;; };
+        Install::PreResolve { &quot;upgradevirt.lua&quot;; };
+        Install::TranslateArg { &quot;upgradevirt.lua&quot;; };
+    };
+    Synaptic {
+        DistUpgrade { &quot;upgradevirt.lua&quot;; };
+    };
+};
+
+// upgradevirt.lua specific item - make newly installed kernel default
+Kernel {
+    // As of FC3+, the kernel packages take care of this automatically
+    //Set-Default &quot;true&quot;;
+    Module-Prefix {
+        &quot;kernel-module-&quot;;
+        &quot;kmod-&quot;;
+    };
+};
+EOF
+
+%{__cat} &lt;&lt;'EOF' &gt;apt.sysv
+#!/bin/bash
+#
+# Init file to enable/disable automatice upgrades by apt
+#
+# Written by Dag Wie&#235;rs &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
+#
+# chkconfig: - 50 01
+# description: Enable daily apt upgrade using cron.
+#
+# processname: apt-get
+# config: /etc/apt/
+
+source /etc/rc.d/init.d/functions
+
+lockfile=&quot;/var/lock/subsys/apt&quot;
+
+RETVAL=0
+
+start() {
+    echo -n $&quot;Enabling daily apt upgrade in cron: &quot;
+    touch &quot;$lockfile&quot; &amp;&amp; success || failure
+    RETVAL=$?
+    echo
+}
+
+stop() {
+    echo -n $&quot;Disabling daily apt upgrade in cron: &quot;
+    rm -f &quot;$lockfile&quot; &amp;&amp; success || failure
+    RETVAL=$?
+    echo
+}
+
+restart() {
+    stop
+    start
+}
+case &quot;$1&quot; in
+  start)
+    start
+    ;;
+  stop)
+    stop
+    ;;
+  restart|force-reload)
+    restart
+    ;;
+  reload)
+    ;;
+  condrestart)
+    [ -f &quot;$lockfile&quot; ] &amp;&amp; restart
+    ;;
+  status)
+    if [ -f $lockfile ]; then
+        echo $&quot;Daily apt upgrade is enabled in cron.&quot;
+        RETVAL=0
+    else
+        echo $&quot;Daily apt upgrade is disabled in cron.&quot;
+        RETVAL=3
+    fi
+    ;;
+  *)
+    echo $&quot;Usage: $0 {start|stop|status|restart|reload|force-reload|condrestart}&quot;
+    exit 1
+esac
+
+exit $RETVAL
+EOF
+
+%{__cat} &lt;&lt;EOF &gt;apt.sysconfig
+### Actually perform updates or only check what's available [yes|no]
+CHECK_ONLY=no
+
+### Hold back packages with modified configuration files [yes|no]
+PRESERVE_CONFIG=no
+
+### Any extra parameters you want to pass to dist-upgrade
+EXTRA_OPTIONS=
+EOF
+
+%{__cat} &lt;&lt;'EOF' &gt;apt.cron
+#!/bin/sh
+
+[ ! -f /var/lock/subsys/apt ] &amp;&amp; exit 0
+
+[ -f /etc/sysconfig/apt ] &amp;&amp; source /etc/sysconfig/apt
+
+[ $CHECK_ONLY == &quot;yes&quot; ] &amp;&amp; OPTS=&quot;$OPTS --check-only&quot;
+[ $PRESERVE_CONFIG == &quot;yes&quot; ] &amp;&amp; OPTS=&quot;$OPTS -o rpm::preserve-config=true&quot;
+OPTS=&quot;$OPTS $EXTRA_OPTIONS&quot;
+
+if /usr/bin/apt-get -qq update; then
+    /usr/bin/apt-get dist-upgrade -qq --check-only
+    if [ $? -eq 100 ]; then
+        /usr/bin/apt-get -q -y $OPTS dist-upgrade
+    fi
+fi
+EOF
+
+%build
+%{?_without_pkgconfig:export PKG_CONFIG=&quot;/bin/true&quot;}
+%{?_without_pkgconfig:export LIBXML2_CFLAGS=&quot;$(xml2-config --cflags)&quot;}
+%{?_without_pkgconfig:export LIBXML2_LIBS=&quot;$(xml2-config --libs)&quot;}
+%configure \
+    --program-prefix=&quot;%{?_program_prefix}&quot; \
+    --includedir=&quot;%{_includedir}/apt-pkg&quot; \
+    --disable-dependency-tracking \
+    --disable-static
+%{__make} %{?_smp_mflags}
+
+%if %{!?_without_python22:1}0
+%{__make} -C python PYTHON=&quot;%{__python}&quot; %{?_smp_mflags}
+%{__python} -O -c &quot;import py_compile; py_compile.compile('python/apt.py')&quot;
+%endif
+
+#xsltproc -o rpmpriorities comps2prio.xsl %{_datadir}/comps/%{_build_arch}/comps.xml
+
+%install
+%{__rm} -rf %{buildroot}
+%{__make} install DESTDIR=&quot;%{buildroot}&quot; includedir=&quot;%{_includedir}/apt-pkg&quot;
+%find_lang %{name}
+
+%{__install} -d -m0755 %{buildroot}%{_sysconfdir}/apt/{apt.conf.d,gpg,sources.list.d}/
+%{__install} -d -m0755 %{buildroot}%{_libdir}/apt/scripts/
+%{__install} -Dp -m0644 apt.conf %{buildroot}%{_sysconfdir}/apt/apt.conf
+%{__install} -Dp -m0644 default.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/default.conf
+#%{__install} -Dp -m0644 sources.list %{buildroot}%{_sysconfdir}/apt/sources.list
+%{__install} -Dp -m0644 os.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/os.list
+%{__install} -Dp -m0644 rpmpriorities %{buildroot}%{_sysconfdir}/apt/rpmpriorities
+touch %{buildroot}%{_sysconfdir}/apt/{preferences,vendors.list}
+
+### Install the LUA scripts
+%{__install} -Dp -m0644 contrib/allow-duplicated/allow-duplicated.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/allow-duplicated.conf
+%{__install} -Dp -m0755 contrib/allow-duplicated/allow-duplicated.lua %{buildroot}%{_datadir}/apt/scripts/allow-duplicated.lua
+%{__install} -Dp -m0644 contrib/apt-groupinstall/apt-groupinstall.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/apt-groupinstall.conf
+%{__install} -Dp -m0755 contrib/apt-groupinstall/apt-groupinstall.lua %{buildroot}%{_datadir}/apt/scripts/apt-groupinstall.lua
+%{__install} -Dp -m0755 contrib/apt-groupinstall/groupinstall-backend-comps.py %{buildroot}%{_datadir}/apt/scripts/groupinstall-backend-comps.py
+touch %{buildroot}%{_datadir}/apt/scripts/groupinstall-backend-comps.py{c,o}
+%if %{!?_without_rpm42:1}0
+%{__install} -Dp -m0755 contrib/gpg-check/gpg-check.lua %{buildroot}%{_datadir}/apt/scripts/gpg-check.lua
+%{__install} -Dp -m0755 contrib/gpg-check/gpg-import.lua %{buildroot}%{_datadir}/apt/scripts/gpg-import.lua
+%endif
+%{__install} -Dp -m0644 contrib/log/log.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/log.conf
+%{__install} -Dp -m0755 contrib/log/log.lua %{buildroot}%{_datadir}/apt/scripts/log.lua
+%{__install} -Dp -m0755 %{SOURCE51} %{buildroot}%{_datadir}/apt/scripts/upgradevirt.lua
+
+%if %{!?_without_python22:1}0
+### Install the python bindings
+mkdir -p %{buildroot}%{python_sitearch}/
+%{__install} -Dp -m0755 python/_apt.so %{buildroot}%{python_sitearch}/_apt.so
+%{__install} -Dp -m0644 python/apt.py %{buildroot}%{python_sitearch}/apt.py
+touch %{buildroot}%{python_sitearch}/apt.py{c,o}
+%endif
+
+### Install the cronjob
+%{__install} -Dp -m0755 apt.sysv %{buildroot}%{_initrddir}/apt
+%{__install} -Dp -m0755 apt.cron %{buildroot}%{_sysconfdir}/cron.daily/apt
+%{__install} -Dp -m0644 apt.sysconfig %{buildroot}%{_sysconfdir}/sysconfig/apt
+
+### Clean up docs
+find contrib/ -type f -exec %{__chmod} a-x {} \;
+
+%post
+/sbin/ldconfig
+/sbin/chkconfig --add apt
+
+%preun
+if [ $1 -eq 0 ] ; then
+    /sbin/service apt stop &amp;&gt;/dev/null || :
+    /sbin/chkconfig --del apt
+fi
+
+%postun -p /sbin/ldconfig
+
+%clean
+%{__rm} -rf %{buildroot}
+
+%files -f %{name}.lang
+%defattr(-, root, root, 0755)
+%doc ABOUT* AUTHORS* ChangeLog COPYING* lua/COPYRIGHT TODO comps2prio.xsl contrib/ doc/examples/
+%doc %{_mandir}/man5/apt.conf.5*
+%doc %{_mandir}/man5/apt_preferences.5*
+%doc %{_mandir}/man5/sources.list.5*
+%doc %{_mandir}/man5/vendors.list.5*
+%doc %{_mandir}/man8/apt-cache.8*
+%doc %{_mandir}/man8/apt-cdrom.8*
+%doc %{_mandir}/man8/apt-config.8*
+%doc %{_mandir}/man8/apt-get.8*
+%doc %{_mandir}/man8/apt.8*
+%dir %{_sysconfdir}/apt/
+%config(noreplace) %{_sysconfdir}/apt/apt.conf
+%config(noreplace) %{_sysconfdir}/apt/preferences
+#config(noreplace) %{_sysconfdir}/apt/sources.list
+%config(noreplace) %{_sysconfdir}/apt/vendors.list
+%config %{_sysconfdir}/apt/rpmpriorities
+%config(noreplace) %{_sysconfdir}/apt/apt.conf.d/
+%config %{_sysconfdir}/apt/apt.conf.d/default.conf
+%config %{_sysconfdir}/apt/apt.conf.d/multilib.conf
+%config(noreplace) %{_sysconfdir}/apt/gpg/
+%config(noreplace) %{_sysconfdir}/apt/sources.list.d/
+%config(noreplace) %{_sysconfdir}/sysconfig/apt
+%config %{_sysconfdir}/cron.daily/apt
+%config %{_initrddir}/apt
+%{_bindir}/apt-cache
+%{_bindir}/apt-cdrom
+%{_bindir}/apt-config
+%{_bindir}/apt-get
+%{_bindir}/apt-shell
+%{_bindir}/countpkglist
+%{_bindir}/genbasedir
+%{_bindir}/genpkglist
+%{_bindir}/gensrclist
+%{_datadir}/apt/
+%{_libdir}/apt/
+%{_libdir}/libapt-pkg.so.*
+%{_localstatedir}/cache/apt/
+%{_localstatedir}/lib/apt/
+
+%files devel
+%defattr(-, root, root, 0755)
+%{_includedir}/apt-pkg/
+%{_libdir}/libapt-pkg.so
+%{_libdir}/pkgconfig/libapt-pkg.pc
+%exclude %{_libdir}/libapt-pkg.la
+
+%if %{!?_without_python22:1}0
+%files -n python-apt
+%defattr(-, root, root, 0755)
+%{python_sitearch}/_apt.so
+%{python_sitearch}/apt.py
+%ghost %{python_sitearch}/apt.pyc
+%ghost %{python_sitearch}/apt.pyo
+%endif
+
+%changelog
+* Thu Jun 12 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.94a-2
+- Improved default configuration.
+- Added pkglog.lua by default.
+
+* Wed Jun 11 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.94a-1
+- Updated to release 0.5.15lorg3.94a.
+
+* Wed Jun 11 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.94-1
+- Added patches from Fedora.
+- Updated to release 0.5.15lorg3.94.
+
+* Fri Jun 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.2-1
+- Updated to release 0.5.15lorg3.2.
+
+* Sun Jun 04 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-4
+- Fixed APT::DistroVersion.
+
+* Sun Jun 04 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-3
+- Added APT::DistroVersion and RPM::Order to apt.conf.
+
+* Mon May 29 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-2
+- Fixed a segfault with the new createrepo -n output.
+
+* Tue May 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-1
+- Updated to 0.5.15lorg3.1.
+
+* Thu Apr 27 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-3
+- Added patch to handle no-epoch on &lt;= RH9.
+
+* Tue Apr 25 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-2
+- Added patch to allow synaptic to build.
+
+* Mon Apr 24 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-1
+- Updated to 0.5.15lorg3.
+
+* Tue Apr 11 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-0.rc1
+- Updated to 0.5.15lorg3-rc1.
+
+* Sun Mar 05 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg2-0.20060301
+- Experimental version from Panu with repomd and multilib support.
+
+* Mon Jan 02 2005 Dries Verachtert &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dries at ulyssis.org</A>&gt; - 0.5.15cnc7-1
+- Added libtoolize and autoreconf fix for Fedora Core 5, thanks
+  to Stephen Clement.
+- Updated to release 0.5.15cnc7.
+
+* Sat Nov 20 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-4
+- Added readline-devel as buildrequirement for apt-shell.
+
+* Thu Jul 01 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-3
+- Fix for apt-bug triggered by mach.
+
+* Fri Jun 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-2
+- Make apt understand about architectures.
+
+* Tue Mar 23 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-1
+- Updated to release 0.5.15cnc6.
+
+* Sat Jan 24 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
+- Added RHAS21 repository.
+
+* Sun Jan 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc5-0
+- Updated to release 0.5.15cnc5.
+
+* Sat Dec 06 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-1
+- Disabled the epoch promotion behaviour on RH9.
+
+* Thu Dec 04 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-0
+- Updated to release 0.5.15cnc4.
+
+* Tue Nov 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc3-0
+- Updated to release 0.5.15cnc3.
+
+* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc2-0
+- Updated to release 0.5.15cnc2.
+
+* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
+- Fixed apt pinning.
+- Added RHFC1 repository.
+
+* Sat Nov 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-0
+- Updated to release 0.5.15cnc1.
+
+* Sun Oct 26 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-1
+- Added RHEL3 repository.
+
+* Tue Jun 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-0
+- Added newrpms and enable it by default.
+- Updated to release 0.5.5cnc6.
+
+* Tue Jun 03 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-4
+- Added freshrpms and enable it by default.
+
+* Sun Jun 01 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-3
+- Work around a bug in apt (apt.conf).
+
+* Fri May 30 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-2
+- Moved sources.list to sources.d/
+
+* Wed Apr 16 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-1
+- Updated to release 0.5.5cnc5.
+
+* Tue Apr 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-2
+- RH90 repository rename from redhat/9.0 to redhat/9.
+
+* Sat Apr 05 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-1
+- FreshRPMS fixes to repository locations.
+
+* Sun Mar 09 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-0
+- Updated to release 0.5.5cnc4.1.
+
+* Fri Feb 28 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc3-0
+- Updated to release 0.5.5cnc3.
+
+* Tue Feb 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc2-0
+- Updated to release 0.5.5cnc2.
+
+* Mon Feb 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.4cnc9-0
+- Initial package. (using DAR)


Property changes on: trunk/rpms/apt/apt-devel.spec
___________________________________________________________________
Name: svn:keywords
   + Id Revision
Name: svn:eol-style
   + native

Deleted: trunk/rpms/apt/apt-test.spec
===================================================================
--- trunk/rpms/apt/apt-test.spec	2008-06-11 23:56:53 UTC (rev 6357)
+++ trunk/rpms/apt/apt-test.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -1,329 +0,0 @@
-# $Id$
-# Authority: dag
-# Upstream: Panu Matilainen &lt;pmatilai$laiskiainen,org&gt;
-
-# Tag: test
-
-%{?dtag: %{expand: %%define %dtag 1}}
-
-%{?rh8:%define _without_elfutils 1}
-%{?rh7:%define _without_elfutils 1}
-
-%{?el2:%define _without_elfutils 1}
-%{?el2:%define _without_pkgconfig 1}
-
-%{?rh6:%define _without_elfutils 1}
-%{?rh6:%define _without_pkgconfig 1}
-
-%define LIBVER 3.3
-
-Summary: Debian's Advanced Packaging Tool with RPM support
-Name: apt
-Version: 0.5.15lorg3.90
-Release: 1
-License: GPL
-Group: System Environment/Base
-URL: <A HREF="http://apt-rpm.org/">http://apt-rpm.org/</A>
-
-Source: <A HREF="http://apt-rpm.org/testing/apt-%{version">http://apt-rpm.org/testing/apt-%{version</A>}.tar.bz2
-BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-
-BuildRequires: rpm-devel &gt;= 3.0.5, zlib-devel, gettext, ncurses-devel
-BuildRequires: readline-devel, bison, gcc-c++, libtool, libxml2-devel &gt;= 2.6.16
-%{!?_without_pkgconfig:BuildRequires: pkgconfig &gt;= 0.9}
-
-%{!?_without_elfutils:BuildRequires: beecrypt-devel, elfutils-devel}
-%{?_without_elfutils:BuildRequires: libelf}
-
-%{!?rh6:BuildRequires: bzip2-devel, libstdc++-devel, docbook-utils}
-%{?rh8:BuildRequires: libelf-devel}
-
-Requires: rpm &gt;= 3.0.5, zlib, bzip2-libs, libstdc++
-Requires: libxml2 &gt;= 2.6.16
-
-%description
-A port of Debian's apt tools for RPM based distributions, or at least
-originally for Conectiva and now Red Hat Linux. It provides the apt-get
-utility that provides a simpler, safer way to install and upgrade packages.
-APT features complete installation ordering, multiple source capability and
-several other unique features.
-
-%package devel
-Summary: Header files, libraries and development documentation for %{name}
-Group: Development/Libraries
-Requires: %{name} = %{version}-%{release}
-
-%description devel
-This package contains the header files, static libraries and development
-documentation for %{name}. If you like to develop programs using %{name},
-you will need to install %{name}-devel.
-
-%prep
-%setup -n %{name}-%{version}
-
-%{?el5:name='Red Hat Enterprise'; version='5'}
-%{?el4:name='Red Hat Enterprise'; version='4'}
-%{?el3:name='Red Hat Enterprise'; version='3'}
-%{?el2:name='Red Hat Enterprise'; version='2.1'}
-%{?fc7:name='Fedora Core'; version='7'}
-%{?fc6:name='Fedora Core'; version='6'}
-%{?fc5:name='Fedora Core'; version='5'}
-%{?fc4:name='Fedora Core'; version='4'}
-%{?fc3:name='Fedora Core'; version='3'}
-%{?fc2:name='Fedora Core'; version='2'}
-%{?fc1:name='Fedora Core'; version='1'}
-%{?rh9:name='Red Hat'; version='9'}
-%{?rh8:name='Red Hat'; version='8.0'}
-%{?rh7:name='Red Hat'; version='7.3'}
-%{?rh6:name='Red Hat'; version='6.2'}
-
-%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|RPMforge RPM Repository %{dtag}/%{_arch} APT-HTTP/1.3|' methods/http.cc
-
-%{__cat} &lt;&lt;'EOF' &gt;os.list
-# Name: Operating system and updates
-
-### Red Hat Enterprise Linux
-#repomd <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH)/os
-#repomd <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH)/updates
-#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt/os
-#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt/updates
-#rpm <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH) os updates
-#rpm <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt os updates
-
-### Fedora Core Linux
-%{!?fedora:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH)/core
-%{!?fedora:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH)/updates
-#rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH) core updates
-
-### Red Hat Linux
-%{!?rhl:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH)/os
-%{!?rhl:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH)/updates
-#rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH) os updates
-EOF
-
-%{__cat} &lt;&lt;EOF &gt;apt.conf
-APT {
-	Clean-Installed &quot;false&quot;;
-	Get {
-		Assume-Yes &quot;false&quot;;
-		Download-Only &quot;false&quot;;
-		Show-Upgraded &quot;true&quot;;
-		Fix-Broken &quot;false&quot;;
-		Ignore-Missing &quot;false&quot;;
-		Compile &quot;false&quot;;
-	};
-	DistroVersion &quot;$version&quot;;
-};
-
-Acquire {
-	Retries &quot;0&quot;;
-	HTTP {
-		Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
-	};
-};
-
-RPM {
-	Ignore { };
-	Hold { };
-	Options { };
-	Install-Options &quot;&quot;;
-	Erase-Options &quot;&quot;;
-//	Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
-	Source {
-		Build-Command &quot;rpmbuild --rebuild&quot;;
-	};
-	Allow-Duplicated {
-		&quot;^kernel$&quot;;
-		&quot;^kernel-&quot;;
-		&quot;^gpg-pubkey$&quot;;
-	};
-	Order &quot;true&quot;;
-};
-EOF
-
-%build
-%{?_without_pkgconfig:export LIBXML2_CFLAGS=&quot;$(xml2-config --cflags)&quot;}
-%{?_without_pkgconfig:export LIBXML2_LIBS=&quot;$(xml2-config --libs)&quot;}
-%configure \
-	--program-prefix=&quot;%{?_program_prefix}&quot; \
-	--includedir=&quot;%{_includedir}/apt-pkg&quot;
-#	--with-hashmap
-%{__make} %{?_smp_mflags}
-
-%install
-%{__rm} -rf %{buildroot}
-%makeinstall \
-	includedir=&quot;%{buildroot}%{_includedir}/apt-pkg&quot;
-%find_lang %{name}
-
-%{__install} -d -m0755 \
-		%{buildroot}%{_sysconfdir}/apt/{apt.conf.d,sources.list.d} \
-		%{buildroot}%{_localstatedir}/cache/apt/{archives/partial,genpkglist,gensrclist} \
-		%{buildroot}%{_localstatedir}/state/apt/lists/partial \
-		%{buildroot}%{_libdir}/apt/scripts/
-%{__install} -p -m0644 rpmpriorities apt.conf %{buildroot}%{_sysconfdir}/apt/
-%{__install} -p -m0644 os.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/
-touch %{buildroot}%{_sysconfdir}/apt/preferences \
-	%{buildroot}%{_sysconfdir}/apt/vendors.list
-
-#%{__ln_s} -f %{_libdir}libapt-pkg-libc6.3-5.so.0 %{buildroot}%{_libdir}libapt-pkg-libc6.3-5.so.%{LIBVER}
-
-%post -p /sbin/ldconfig
-%postun -p /sbin/ldconfig
-
-%clean
-%{__rm} -rf %{buildroot}
-
-%files -f %{name}.lang
-%defattr(-, root, root, 0755)
-%doc AUTHORS* COPYING* TODO contrib/ doc/examples/
-%doc %{_mandir}/man5/apt.conf.5*
-%doc %{_mandir}/man5/apt_preferences.5*
-%doc %{_mandir}/man5/sources.list.5*
-%doc %{_mandir}/man5/vendors.list.5*
-%doc %{_mandir}/man8/apt-cache.8*
-%doc %{_mandir}/man8/apt-cdrom.8*
-%doc %{_mandir}/man8/apt-config.8*
-%doc %{_mandir}/man8/apt-get.8*
-%doc %{_mandir}/man8/apt.8*
-%dir %{_sysconfdir}/apt/
-%config(noreplace) %{_sysconfdir}/apt/apt.conf
-%config(noreplace) %{_sysconfdir}/apt/preferences
-#config(noreplace) %{_sysconfdir}/apt/sources.list
-%config(noreplace) %{_sysconfdir}/apt/vendors.list
-%config %{_sysconfdir}/apt/rpmpriorities
-%config(noreplace) %{_sysconfdir}/apt/apt.conf.d/
-%config(noreplace) %{_sysconfdir}/apt/sources.list.d/
-%{_bindir}/apt-cache
-%{_bindir}/apt-cdrom
-%{_bindir}/apt-config
-%{_bindir}/apt-get
-%{_bindir}/apt-shell
-%{_bindir}/genbasedir
-%{_bindir}/genpkglist
-%{_bindir}/gensrclist
-%{_bindir}/countpkglist
-%{_libdir}/apt/
-%{_libdir}/libapt-pkg-*.so.*
-%{_localstatedir}/cache/apt/
-%{_localstatedir}/state/apt/
-
-%files devel
-%defattr(-, root, root, 0755)
-%{_libdir}/libapt-pkg.a
-%exclude %{_libdir}/libapt-pkg.la
-%{_libdir}/libapt-pkg.so
-%{_includedir}/apt-pkg/
-
-%changelog
-* Wed Mar 07 2007 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.90-1
-- Updated to release 0.5.15lorg3.90.
-
-* Fri Jun 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.2-1
-- Updated to release 0.5.15lorg3.2.
-
-* Sun Jun 04 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-4
-- Fixed APT::DistroVersion.
-
-* Sun Jun 04 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-3
-- Added APT::DistroVersion and RPM::Order to apt.conf.
-
-* Mon May 29 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-2
-- Fixed a segfault with the new createrepo -n output.
-
-* Tue May 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.1-1
-- Updated to 0.5.15lorg3.1.
-
-* Thu Apr 27 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-3
-- Added patch to handle no-epoch on &lt;= RH9.
-
-* Tue Apr 25 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-2
-- Added patch to allow synaptic to build.
-
-* Mon Apr 24 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-1
-- Updated to 0.5.15lorg3.
-
-* Tue Apr 11 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3-0.rc1
-- Updated to 0.5.15lorg3-rc1.
-
-* Sun Mar 05 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg2-0.20060301
-- Experimental version from Panu with repomd and multilib support.
-
-* Mon Jan 02 2005 Dries Verachtert &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dries at ulyssis.org</A>&gt; - 0.5.15cnc7-1
-- Added libtoolize and autoreconf fix for Fedora Core 5, thanks
-  to Stephen Clement.
-- Updated to release 0.5.15cnc7.
-
-* Sat Nov 20 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-4
-- Added readline-devel as buildrequirement for apt-shell.
-
-* Thu Jul 01 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-3
-- Fix for apt-bug triggered by mach.
-
-* Fri Jun 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-2
-- Make apt understand about architectures.
-
-* Tue Mar 23 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc6-1
-- Updated to release 0.5.15cnc6.
-
-* Sat Jan 24 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Added RHAS21 repository.
-
-* Sun Jan 04 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc5-0
-- Updated to release 0.5.15cnc5.
-
-* Sat Dec 06 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-1
-- Disabled the epoch promotion behaviour on RH9.
-
-* Thu Dec 04 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc4-0
-- Updated to release 0.5.15cnc4.
-
-* Tue Nov 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc3-0
-- Updated to release 0.5.15cnc3.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc2-0
-- Updated to release 0.5.15cnc2.
-
-* Mon Nov 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-1
-- Fixed apt pinning.
-- Added RHFC1 repository.
-
-* Sat Nov 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15cnc1-0
-- Updated to release 0.5.15cnc1.
-
-* Sun Oct 26 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-1
-- Added RHEL3 repository.
-
-* Tue Jun 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc6-0
-- Added newrpms and enable it by default.
-- Updated to release 0.5.5cnc6.
-
-* Tue Jun 03 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-4
-- Added freshrpms and enable it by default.
-
-* Sun Jun 01 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-3
-- Work around a bug in apt (apt.conf).
-
-* Fri May 30 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-2
-- Moved sources.list to sources.d/
-
-* Wed Apr 16 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc5-1
-- Updated to release 0.5.5cnc5.
-
-* Tue Apr 08 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-2
-- RH90 repository rename from redhat/9.0 to redhat/9.
-
-* Sat Apr 05 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-1
-- FreshRPMS fixes to repository locations.
-
-* Sun Mar 09 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc4.1-0
-- Updated to release 0.5.5cnc4.1.
-
-* Fri Feb 28 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc3-0
-- Updated to release 0.5.5cnc3.
-
-* Tue Feb 25 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.5cnc2-0
-- Updated to release 0.5.5cnc2.
-
-* Mon Feb 10 2003 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.4cnc9-0
-- Initial package. (using DAR)

Modified: trunk/rpms/apt/apt.spec
===================================================================
--- trunk/rpms/apt/apt.spec	2008-06-11 23:56:53 UTC (rev 6357)
+++ trunk/rpms/apt/apt.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -2,42 +2,68 @@
 # Authority: dag
 # Upstream: Panu Matilainen &lt;pmatilai$laiskiainen,org&gt;
 
+%define python_sitearch %(%{__python} -c 'from distutils import sysconfig; print sysconfig.get_python_lib(1)')
+
 %{?dtag: %{expand: %%define %dtag 1}}
 
 %{?rh8:%define _without_elfutils 1}
+
 %{?rh7:%define _without_elfutils 1}
+%{?rh7:%define _without_python22 1}
+%{?rh7:%define _without_rpm42 1}
 
 %{?el2:%define _without_elfutils 1}
 %{?el2:%define _without_pkgconfig 1}
+%{?el2:%define _without_python22 1}
+%{?el2:%define _without_rpm42 1}
 
 %{?rh6:%define _without_elfutils 1}
 %{?rh6:%define _without_pkgconfig 1}
+%{?rh6:%define _without_python22 1}
+%{?rh6:%define _without_rpm42 1}
 
-%define LIBVER 3.3
-
 Summary: Debian's Advanced Packaging Tool with RPM support
 Name: apt
 Version: 0.5.15lorg3.2
-Release: 1
+Release: 3
 License: GPL
 Group: System Environment/Base
 URL: <A HREF="http://apt-rpm.org/">http://apt-rpm.org/</A>
 
-Source: <A HREF="http://apt-rpm.org/releases/apt-%{version">http://apt-rpm.org/releases/apt-%{version</A>}.tar.bz2
+Source0: <A HREF="http://apt-rpm.org/releases/apt-%{version">http://apt-rpm.org/releases/apt-%{version</A>}.tar.bz2
+Source19: comps2prio.xsl
+Source51: upgradevirt.lua
+Patch0: apt-0.5.15lorg3.2-ppc.patch
+Patch1: apt-0.5.15lorg3.x-cache-corruption.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 
-BuildRequires: rpm-devel &gt;= 3.0.5, zlib-devel, gettext, ncurses-devel
-BuildRequires: readline-devel, bison, gcc-c++, libtool, libxml2-devel &gt;= 2.6.16
-%{!?_without_pkgconfig:BuildRequires: pkgconfig &gt;= 0.9}
-
+BuildRequires: bison
+BuildRequires: bzip2-devel
+BuildRequires: gcc-c++
+BuildRequires: gettext
+BuildRequires: libstdc++-devel
+BuildRequires: libtool
+BuildRequires: libxml2-devel &gt;= 2.6.16
+BuildRequires: ncurses-devel
+BuildRequires: readline-devel
+BuildRequires: rpm-devel &gt;= 3.0.5
+BuildRequires: zlib-devel
 %{!?_without_elfutils:BuildRequires: beecrypt-devel, elfutils-devel}
 %{?_without_elfutils:BuildRequires: libelf}
+%{!?_without_pkgconfig:BuildRequires: pkgconfig &gt;= 0.9}
+%{!?_without_python22:BuildRequires: python-devel &gt;= 2.2}
 
+%{?rh8:BuildRequires: libelf-devel}
 %{!?rh6:BuildRequires: bzip2-devel, libstdc++-devel, docbook-utils}
-%{?rh8:BuildRequires: libelf-devel}
 
-Requires: rpm &gt;= 3.0.5, zlib, bzip2-libs, libstdc++
+Requires: bzip2-libs
+Requires: chkconfig
+Requires: gnupg
+Requires: ldconfig
+Requires: libstdc++
 Requires: libxml2 &gt;= 2.6.16
+Requires: rpm &gt;= 3.0.5
+Requires: zlib
 
 %description
 A port of Debian's apt tools for RPM based distributions, or at least
@@ -56,9 +82,30 @@
 documentation for %{name}. If you like to develop programs using %{name},
 you will need to install %{name}-devel.
 
+%package -n python-apt
+Summary: Python bindings for libapt-pkg
+Group: Development/Libraries
+Requires: %{name} = %{version}-%{release}
+Obsoletes: apt-python &lt;= %{version}-%{release}
+Provides: apt-python = %{version}-%{release}
+
+%description -n python-apt
+The python-apt package contains a module which allows python programs
+to access the APT library interface.
+
 %prep
-%setup -n %{name}-%{version}
+%setup
+%patch0 -p1 -b .ppc
+%patch1 -p0 -b .mmap
 
+### Fix docs to reference correct paths
+%{__perl} -pi -e '
+        s|\bconfigure-index\.gz\b|configure-index|g;
+        s|/usr/share/doc/apt/|%{_docdir}/%{name}-%{version}/|g;
+    ' doc/apt.ent doc/*/apt.ent.* doc/offline.sgml contrib/apt-wrapper/apt.ent
+
+%{__install} -Dp -m644 %{SOURCE19} comps2prio.xsl
+
 %{?el5:name='Red Hat Enterprise'; version='5'}
 %{?el4:name='Red Hat Enterprise'; version='4'}
 %{?el3:name='Red Hat Enterprise'; version='3'}
@@ -75,18 +122,65 @@
 %{?rh7:name='Red Hat'; version='7.3'}
 %{?rh6:name='Red Hat'; version='6.2'}
 
-%{__perl} -pi.orig -e 's|RPM APT-HTTP/1.3|RPMforge RPM Repository %{dtag}/%{_arch} APT-HTTP/1.3|' methods/http.cc
+%{__cat} &lt;&lt;EOF &gt;rpmpriorities
+Essential:
+  authconfig
+  basesystem
+  bash
+  centos-release
+  coreutils
+  cpio
+  e2fsprogs
+  ed
+  fedora-release
+  file
+  filesystem
+  glibc
+  grub
+  hdparm
+  hotplug
+  initscripts
+  iproute
+  iputils
+  kbd
+  kudzu
+  libgcc
+  losetup
+  passwd
+  procps
+  raidtools
+  readline
+  redhat-release
+  rpm
+  rsyslog
+  setserial
+  setup
+  shadow-utils
+  sh-utils
+  sysklogd
+  SysVinit
+  sysvinit
+  udev
+  util-linux
+  util-linux-ng
+  vim-minimal
+EOF
 
+%{__cat} &lt;&lt;EOF &gt;sources.list
+### Add your custom repositories here or in /etc/apt/sources.list.d/
+EOF
+
 %{__cat} &lt;&lt;'EOF' &gt;os.list
 # Name: Operating system and updates
 
 ### Red Hat Enterprise Linux
-#repomd <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH)/os
-#repomd <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH)/updates
-#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt/os
-#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt/updates
-#rpm <A HREF="http://yam">http://yam</A> rhel$(VERSION)as-$(ARCH) os updates
-#rpm <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/apt os updates
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/os/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/updates/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/extras/$(ARCH)
+#repomd <A HREF="http://mirror.centos.org">http://mirror.centos.org</A> centos/$(VERSION)/fasttrack/$(ARCH)
+#repomd <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH)/RPMS.os
+#repomd <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH)/RPMS.updates
+#rpm <A HREF="http://mrepo">http://mrepo</A> rhel$(VERSION)s-$(ARCH) os updates
 
 ### Fedora Core Linux
 %{!?fedora:#}repomd <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> fedora/linux/$(VERSION)/$(ARCH)/core
@@ -99,74 +193,316 @@
 #rpm <A HREF="http://ayo.freshrpms.net">http://ayo.freshrpms.net</A> redhat/$(VERSION)/$(ARCH) os updates
 EOF
 
+#%{__cat} &lt;&lt;EOF &gt;apt.conf
+#APT {
+#    Clean-Installed &quot;false&quot;;
+#    Get {
+#        Assume-Yes &quot;false&quot;;
+#        Download-Only &quot;false&quot;;
+#        Show-Upgraded &quot;true&quot;;
+#        Fix-Broken &quot;false&quot;;
+#        Ignore-Missing &quot;false&quot;;
+#        Compile &quot;false&quot;;
+#    };
+#    DistroVersion &quot;$version&quot;;
+#};
+#
+#Acquire {
+#    Retries &quot;0&quot;;
+#    HTTP {
+#        Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
+#    };
+#};
+#
+#RPM {
+#    Ignore { };
+#    Hold { };
+#    Options { };
+#    Install-Options &quot;&quot;;
+#    Erase-Options &quot;&quot;;
+#//  Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
+#    Source {
+#        Build-Command &quot;rpmbuild --rebuild&quot;;
+#    };
+#    Allow-Duplicated {
+#        &quot;^kernel$&quot;;
+#        &quot;^kernel-bigmem$&quot;;
+#        &quot;^kernel-devel$&quot;;
+#        &quot;^kernel-enterprise$&quot;;
+#        &quot;^kernel-headers$&quot;;
+#        &quot;^kernel-hugemem$&quot;;
+#        &quot;^kernel-largesmp$&quot;;
+#        &quot;^kernel-smp$&quot;;
+#        &quot;^kernel-source$&quot;;
+#        &quot;^kernel-unsupported$&quot;;
+#        &quot;^kernel-xen$&quot;;
+#        &quot;^gpg-pubkey$&quot;;
+#    };
+#    Order &quot;true&quot;;
+#};
+#EOF
+
 %{__cat} &lt;&lt;EOF &gt;apt.conf
-APT {
-	Clean-Installed &quot;false&quot;;
-	Get {
-		Assume-Yes &quot;false&quot;;
-		Download-Only &quot;false&quot;;
-		Show-Upgraded &quot;true&quot;;
-		Fix-Broken &quot;false&quot;;
-		Ignore-Missing &quot;false&quot;;
-		Compile &quot;false&quot;;
-	};
-	DistroVersion &quot;$version&quot;;
+// User customizable configuration
+
+RPM {
+    // Uncomment to disable GPG-signature checking for packages
+    // GPG-Check &quot;false&quot;;
+    // Uncomment to prevent kernel being handled along with (dist-)upgrade
+    // Upgrade-Virtual &quot;false&quot;;
+    // Uncomment to hold packages with modified config files in (dist-)upgrade
+    // Preserve-Config &quot;true&quot;;
 };
 
+// Options for the downloading routines
 Acquire {
-	Retries &quot;0&quot;;
-	HTTP {
-		Proxy &quot;&quot;; // <A HREF="http://user:pass@host:port/">http://user:pass@host:port/</A>
-	};
+    // Retries &quot;1&quot;;
+    // http::Proxy &quot;<A HREF="http://user:password@proxy-server.domain.tld:port/">http://user:password@proxy-server.domain.tld:port/</A>&quot;;
+    // http::Proxy &quot;<A HREF="http://proxy-server.domain.tld:port/">http://proxy-server.domain.tld:port/</A>&quot;;
 };
+EOF
 
+%{__cat} &lt;&lt;EOF &gt;default.conf
+// These are &quot;factory defaults&quot;, DO NOT CHANGE!
+// Put your customizations to /etc/apt/apt.conf instead, those will
+// override any setting in here.
+
+APT {
+    Get {
+        Show-Versions &quot;true&quot;;
+    }
+    DistroVersion &quot;$version&quot;;
+};
+
 RPM {
-	Ignore { };
-	Hold { };
-	Options { };
-	Install-Options &quot;&quot;;
-	Erase-Options &quot;&quot;;
-//	Pre-Install-Pkgs { &quot;/usr/bin/apt-sigchecker&quot;; };
-	Source {
-		Build-Command &quot;rpmbuild --rebuild&quot;;
-	};
-	Allow-Duplicated {
-		&quot;^kernel$&quot;;
-		&quot;^kernel-&quot;;
-		&quot;^gpg-pubkey$&quot;;
-	};
-	Order &quot;true&quot;;
+    // Always check GPG keys and automatically import new ones
+    GPG-Check &quot;true&quot;;
+    GPG-Import &quot;true&quot;;
+    Allow-Duplicated {
+        &quot;^gpg-pubkey$&quot;;
+        &quot;^kernel$&quot;;
+        &quot;^kernel-bigmem$&quot;;
+        &quot;^kernel-devel$&quot;;
+        &quot;^kernel-enterprise$&quot;;
+        &quot;^kernel-headers$&quot;;
+        &quot;^kernel-hugemem$&quot;;
+        &quot;^kernel-largesmp$&quot;;
+        &quot;^kernel-smp$&quot;;
+        &quot;^kernel-source$&quot;;
+        &quot;^kernel-unsupported$&quot;;
+        &quot;^kernel-xen$&quot;;
+    };
+    Order &quot;true&quot;;
 };
+
+// Options for the downloading routines
+Acquire {
+    http::User-Agent &quot;APT-HTTP/1.3&quot;;
+};
+
+Scripts {
+    Init { &quot;gpg-import.lua&quot;; };
+    PM {
+        Pre { &quot;gpg-check.lua&quot;; };
+        Post { &quot;upgradevirt.lua&quot;; };
+    };
+    AptGet {
+        Upgrade { &quot;upgradevirt.lua&quot;; };
+        DistUpgrade {&quot;upgradevirt.lua&quot;; };
+        Install::SelectPackage { &quot;upgradevirt.lua&quot;; };
+        Install::PreResolve { &quot;upgradevirt.lua&quot;; };
+        Install::TranslateArg { &quot;upgradevirt.lua&quot;; };
+    };
+    Synaptic {
+        DistUpgrade { &quot;upgradevirt.lua&quot;; };
+    };
+};
+
+// upgradevirt.lua specific item - make newly installed kernel default
+Kernel {
+    // As of FC3+, the kernel packages take care of this automatically
+    //Set-Default &quot;true&quot;;
+    Module-Prefix {
+        &quot;kernel-module-&quot;;
+        &quot;kmod-&quot;;
+    };
+};
 EOF
 
+%{__cat} &lt;&lt;'EOF' &gt;apt.sysv
+#!/bin/bash
+#
+# Init file to enable/disable automatice upgrades by apt
+#
+# Written by Dag Wie&#235;rs &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
+#
+# chkconfig: - 50 01
+# description: Enable daily apt upgrade using cron.
+#
+# processname: apt-get
+# config: /etc/apt/
+
+source /etc/rc.d/init.d/functions
+
+lockfile=&quot;/var/lock/subsys/apt&quot;
+
+RETVAL=0
+
+start() {
+    echo -n $&quot;Enabling daily apt upgrade in cron: &quot;
+    touch &quot;$lockfile&quot; &amp;&amp; success || failure
+    RETVAL=$?
+    echo
+}
+
+stop() {
+    echo -n $&quot;Disabling daily apt upgrade in cron: &quot;
+    rm -f &quot;$lockfile&quot; &amp;&amp; success || failure
+    RETVAL=$?
+    echo
+}
+
+restart() {
+    stop
+    start
+}
+case &quot;$1&quot; in
+  start)
+    start
+    ;;
+  stop)
+    stop
+    ;;
+  restart|force-reload)
+    restart
+    ;;
+  reload)
+    ;;
+  condrestart)
+    [ -f &quot;$lockfile&quot; ] &amp;&amp; restart
+    ;;
+  status)
+    if [ -f $lockfile ]; then
+        echo $&quot;Daily apt upgrade is enabled in cron.&quot;
+        RETVAL=0
+    else
+        echo $&quot;Daily apt upgrade is disabled in cron.&quot;
+        RETVAL=3
+    fi
+    ;;
+  *)
+    echo $&quot;Usage: $0 {start|stop|status|restart|reload|force-reload|condrestart}&quot;
+    exit 1
+esac
+
+exit $RETVAL
+EOF
+
+%{__cat} &lt;&lt;EOF &gt;apt.sysconfig
+### Actually perform updates or only check what's available [yes|no]
+CHECK_ONLY=no
+
+### Hold back packages with modified configuration files [yes|no]
+PRESERVE_CONFIG=no
+
+### Any extra parameters you want to pass to dist-upgrade
+EXTRA_OPTIONS=
+EOF
+
+%{__cat} &lt;&lt;'EOF' &gt;apt.cron
+#!/bin/sh
+
+[ ! -f /var/lock/subsys/apt ] &amp;&amp; exit 0
+
+[ -f /etc/sysconfig/apt ] &amp;&amp; source /etc/sysconfig/apt
+
+[ $CHECK_ONLY == &quot;yes&quot; ] &amp;&amp; OPTS=&quot;$OPTS --check-only&quot;
+[ $PRESERVE_CONFIG == &quot;yes&quot; ] &amp;&amp; OPTS=&quot;$OPTS -o rpm::preserve-config=true&quot;
+OPTS=&quot;$OPTS $EXTRA_OPTIONS&quot;
+
+if /usr/bin/apt-get -qq update; then
+    /usr/bin/apt-get dist-upgrade -qq --check-only
+    if [ $? -eq 100 ]; then
+        /usr/bin/apt-get -q -y $OPTS dist-upgrade
+    fi
+fi
+EOF
+
 %build
+%{?_without_pkgconfig:export PKG_CONFIG=&quot;/bin/true&quot;}
 %{?_without_pkgconfig:export LIBXML2_CFLAGS=&quot;$(xml2-config --cflags)&quot;}
 %{?_without_pkgconfig:export LIBXML2_LIBS=&quot;$(xml2-config --libs)&quot;}
 %configure \
-	--program-prefix=&quot;%{?_program_prefix}&quot; \
-	--includedir=&quot;%{_includedir}/apt-pkg&quot;
-#	--with-hashmap
+    --program-prefix=&quot;%{?_program_prefix}&quot; \
+    --includedir=&quot;%{_includedir}/apt-pkg&quot; \
+    --disable-dependency-tracking \
+    --disable-static
 %{__make} %{?_smp_mflags}
 
+%if %{!?_without_python22:1}0
+%{__make} -C python PYTHON=&quot;%{__python}&quot; %{?_smp_mflags}
+%{__python} -O -c &quot;import py_compile; py_compile.compile('python/apt.py')&quot;
+%endif
+
+#xsltproc -o rpmpriorities comps2prio.xsl %{_datadir}/comps/%{_build_arch}/comps.xml
+
 %install
 %{__rm} -rf %{buildroot}
-%makeinstall \
-	includedir=&quot;%{buildroot}%{_includedir}/apt-pkg&quot;
+%{__make} install DESTDIR=&quot;%{buildroot}&quot; includedir=&quot;%{_includedir}/apt-pkg&quot;
 %find_lang %{name}
 
-%{__install} -d -m0755 \
-		%{buildroot}%{_sysconfdir}/apt/{apt.conf.d,sources.list.d} \
-		%{buildroot}%{_localstatedir}/cache/apt/{archives/partial,genpkglist,gensrclist} \
-		%{buildroot}%{_localstatedir}/state/apt/lists/partial \
-		%{buildroot}%{_libdir}/apt/scripts/
-%{__install} -p -m0644 rpmpriorities apt.conf %{buildroot}%{_sysconfdir}/apt/
-%{__install} -p -m0644 os.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/
-touch %{buildroot}%{_sysconfdir}/apt/preferences \
-	%{buildroot}%{_sysconfdir}/apt/vendors.list
+%{__install} -d -m0755 %{buildroot}%{_sysconfdir}/apt/{apt.conf.d,gpg,sources.list.d}/
+%{__install} -d -m0755 %{buildroot}%{_localstatedir}/cache/apt/{archives/partial,genpkglist,gensrclist}/
+%{__install} -d -m0755 %{buildroot}%{_localstatedir}/lib/apt/lists/partial/
+%{__install} -d -m0755 %{buildroot}%{_libdir}/apt/scripts/
+%{__install} -Dp -m0644 apt.conf %{buildroot}%{_sysconfdir}/apt/apt.conf
+%{__install} -Dp -m0644 default.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/default.conf
+#%{__install} -Dp -m0644 sources.list %{buildroot}%{_sysconfdir}/apt/sources.list
+%{__install} -Dp -m0644 os.list %{buildroot}%{_sysconfdir}/apt/sources.list.d/os.list
+%{__install} -Dp -m0644 rpmpriorities %{buildroot}%{_sysconfdir}/apt/rpmpriorities
+touch %{buildroot}%{_sysconfdir}/apt/{preferences,vendors.list}
 
-#%{__ln_s} -f %{_libdir}libapt-pkg-libc6.3-5.so.0 %{buildroot}%{_libdir}libapt-pkg-libc6.3-5.so.%{LIBVER}
+### Install the LUA scripts
+%{__install} -Dp -m0644 contrib/allow-duplicated/allow-duplicated.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/allow-duplicated.conf
+%{__install} -Dp -m0755 contrib/allow-duplicated/allow-duplicated.lua %{buildroot}%{_datadir}/apt/scripts/allow-duplicated.lua
+%{__install} -Dp -m0644 contrib/apt-groupinstall/apt-groupinstall.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/apt-groupinstall.conf
+%{__install} -Dp -m0755 contrib/apt-groupinstall/apt-groupinstall.lua %{buildroot}%{_datadir}/apt/scripts/apt-groupinstall.lua
+%{__install} -Dp -m0755 contrib/apt-groupinstall/groupinstall-backend-comps.py %{buildroot}%{_datadir}/apt/scripts/groupinstall-backend-comps.py
+touch %{buildroot}%{_datadir}/apt/scripts/groupinstall-backend-comps.py{c,o}
+%if %{!?_without_rpm42:1}0
+%{__install} -Dp -m0755 contrib/gpg-check/gpg-check.lua %{buildroot}%{_datadir}/apt/scripts/gpg-check.lua
+%{__install} -Dp -m0755 contrib/gpg-check/gpg-import.lua %{buildroot}%{_datadir}/apt/scripts/gpg-import.lua
+%endif
+%{__install} -Dp -m0644 contrib/log/log.conf %{buildroot}%{_sysconfdir}/apt/apt.conf.d/log.conf
+%{__install} -Dp -m0755 contrib/log/log.lua %{buildroot}%{_datadir}/apt/scripts/log.lua
+%{__install} -Dp -m0755 %{SOURCE51} %{buildroot}%{_datadir}/apt/scripts/upgradevirt.lua
 
-%post -p /sbin/ldconfig
+%if %{!?_without_python22:1}0
+### Install the python bindings
+mkdir -p %{buildroot}%{python_sitearch}/
+%{__install} -Dp -m0755 python/_apt.so %{buildroot}%{python_sitearch}/_apt.so
+%{__install} -Dp -m0644 python/apt.py %{buildroot}%{python_sitearch}/apt.py
+touch %{buildroot}%{python_sitearch}/apt.py{c,o}
+%endif
+
+### Install the cronjob
+%{__install} -Dp -m0755 apt.sysv %{buildroot}%{_initrddir}/apt
+%{__install} -Dp -m0755 apt.cron %{buildroot}%{_sysconfdir}/cron.daily/apt
+%{__install} -Dp -m0644 apt.sysconfig %{buildroot}%{_sysconfdir}/sysconfig/apt
+
+### Clean up docs
+find contrib/ -type f -exec %{__chmod} a-x {} \;
+
+%post
+/sbin/ldconfig
+/sbin/chkconfig --add apt
+
+%preun
+if [ $1 -eq 0 ] ; then
+    /sbin/service apt stop &amp;&gt;/dev/null || :
+    /sbin/chkconfig --del apt
+fi
+
 %postun -p /sbin/ldconfig
 
 %clean
@@ -174,7 +510,7 @@
 
 %files -f %{name}.lang
 %defattr(-, root, root, 0755)
-%doc AUTHORS* COPYING* TODO contrib/ doc/examples/
+%doc ABOUT* AUTHORS* ChangeLog COPYING* lua/COPYRIGHT TODO comps2prio.xsl contrib/ doc/examples/
 %doc %{_mandir}/man5/apt.conf.5*
 %doc %{_mandir}/man5/apt_preferences.5*
 %doc %{_mandir}/man5/sources.list.5*
@@ -191,29 +527,50 @@
 %config(noreplace) %{_sysconfdir}/apt/vendors.list
 %config %{_sysconfdir}/apt/rpmpriorities
 %config(noreplace) %{_sysconfdir}/apt/apt.conf.d/
+%config %{_sysconfdir}/apt/apt.conf.d/default.conf
+%config(noreplace) %{_sysconfdir}/apt/gpg/
 %config(noreplace) %{_sysconfdir}/apt/sources.list.d/
+%config(noreplace) %{_sysconfdir}/sysconfig/apt
+%config %{_sysconfdir}/cron.daily/apt
+%config %{_initrddir}/apt
 %{_bindir}/apt-cache
 %{_bindir}/apt-cdrom
 %{_bindir}/apt-config
 %{_bindir}/apt-get
 %{_bindir}/apt-shell
+%{_bindir}/countpkglist
 %{_bindir}/genbasedir
 %{_bindir}/genpkglist
 %{_bindir}/gensrclist
-%{_bindir}/countpkglist
+%{_datadir}/apt/
 %{_libdir}/apt/
 %{_libdir}/libapt-pkg-*.so.*
 %{_localstatedir}/cache/apt/
-%{_localstatedir}/state/apt/
+%{_localstatedir}/lib/apt/
 
 %files devel
 %defattr(-, root, root, 0755)
-%{_libdir}/libapt-pkg.a
+%{_includedir}/apt-pkg/
+%{_libdir}/libapt-pkg.so
 %exclude %{_libdir}/libapt-pkg.la
-%{_libdir}/libapt-pkg.so
-%{_includedir}/apt-pkg/
 
+%if %{!?_without_python22:1}0
+%files -n python-apt
+%defattr(-, root, root, 0755)
+%{python_sitearch}/_apt.so
+%{python_sitearch}/apt.py
+%ghost %{python_sitearch}/apt.pyc
+%ghost %{python_sitearch}/apt.pyo
+%endif
+
 %changelog
+* Thu Jun 12 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.2-3
+- Improved default configuration.
+- Added pkglog.lua by default.
+
+* Wed Jun 11 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.2-2
+- Added patches from Fedora.
+
 * Fri Jun 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.5.15lorg3.2-1
 - Updated to release 0.5.15lorg3.2.
 

Added: trunk/rpms/apt/comps2prio.xsl
===================================================================
--- trunk/rpms/apt/comps2prio.xsl	                        (rev 0)
+++ trunk/rpms/apt/comps2prio.xsl	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,17 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;xsl:stylesheet xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot; version=&quot;1.0&quot;&gt;
+
+  &lt;xsl:output method=&quot;text&quot; encoding=&quot;UTF-8&quot; /&gt;
+
+  &lt;xsl:template match=&quot;comps&quot;&gt;
+    &lt;xsl:text&gt;Essential:&amp;#xA;&lt;/xsl:text&gt;
+    &lt;xsl:for-each
+      select=&quot;group[id='core']/packagelist/packagereq[@type='mandatory']&quot;&gt;
+      &lt;xsl:sort select=&quot;.&quot; /&gt;
+      &lt;xsl:text&gt;  &lt;/xsl:text&gt;
+      &lt;xsl:value-of select=&quot;.&quot; /&gt;
+      &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;
+    &lt;/xsl:for-each&gt;
+  &lt;/xsl:template&gt;
+
+&lt;/xsl:stylesheet&gt;

Added: trunk/rpms/apt/upgradevirt.lua
===================================================================
--- trunk/rpms/apt/upgradevirt.lua	                        (rev 0)
+++ trunk/rpms/apt/upgradevirt.lua	2008-06-12 09:01:21 UTC (rev 6358)
@@ -0,0 +1,198 @@
+
+if confget(&quot;RPM::Upgrade-Virtual/b&quot;, &quot;false&quot;) == &quot;false&quot; then
+    return
+end
+
+knames = { &quot;hugemem&quot;, &quot;bigmem&quot;, &quot;enterprise&quot;, &quot;smp&quot;, &quot;BOOT&quot; }
+
+-- get kernel package name for running kernel (kernel-smp, kernel, etc)
+function get_kerneltype()
+	for i, ktype in ipairs(knames) do
+		if string.find(posix.uname(&quot;%r&quot;), ktype) then
+			return ktype
+		end
+	end
+	-- it's either unknown type or normal UP system
+	return &quot;&quot;
+end
+
+-- get package name
+function get_kernelname()
+	suffix = get_kerneltype()
+	if suffix == &quot;&quot; then
+		return &quot;kernel&quot;
+	else
+		return &quot;kernel-&quot;..suffix
+	end
+end
+
+-- if grubby is available set default kernel to version
+function set_default(version)
+	if not posix.access('/sbin/grubby', 'x') then
+		return
+	end
+	grubby = io.popen(&quot;LANG=C /sbin/grubby --default-kernel&quot;)
+	for line in grubby.lines(grubby) do
+		-- don't touch the default if it's not a linux system
+		if string.find(line, &quot;vmlinuz&quot;) then
+			ktype = get_kerneltype()
+			vmlinuz = '/boot/vmlinuz-'..version..ktype
+			if posix.access(vmlinuz, 'f') then
+				print(_(&quot;Setting &quot;..vmlinuz..&quot; as new default kernel.&quot;))
+				os.execute('/sbin/grubby --set-default='..vmlinuz)
+			else
+				aptwarning(_(&quot;Unable to set new default kernel &quot;..vmlinuz))
+			end
+		end
+	end
+end
+
+-- find + mark for install any packages where uname -r is part of pkg name
+-- eg external kernel modules
+function upgrade_kernel_modules(new_version)
+    modprefix = confgetlist(&quot;Kernel::Module-Prefix&quot;)
+	if not new_version or not modprefix then
+		return
+	end
+
+	seenpkgs = {}
+	pkgs = pkglist()
+	for i, pkg in ipairs(pkgs) do
+		-- oh fun.. loop through all installed packages and see there are
+		-- any which provide module-prefix, try to install version matching
+		-- our new kernel
+    	if not pkgisvirtual(pkg) and pkgvercur(pkg) then
+        	ver = pkgvercur(pkg)
+        	for j, prov in ipairs(verprovlist(ver)) do
+				for x, prefix in ipairs(modprefix) do
+            		if string.sub(prov.name, 1, string.len(prefix)) == prefix then
+						inst = pkgfind(prov.name..&quot;-&quot;..new_version)
+						if inst then
+							markinstall(inst)
+						elseif not seenpkgs[prov.name] == true then
+							print(_(&quot;WARNING: &quot;..prov.name..&quot; not available for kernel &quot;..new_version..&quot;!&quot;))
+                    	end                                         
+						seenpkgs[prov.name] = true
+					end
+            	end
+        	end
+    	end
+	end
+end
+
+
+-- find all virtualized packages, their versions and if they're installed
+function find_instonly_pkgs()
+	pkgs = {}
+	for i, pkg in ipairs(pkglist()) do
+		idx = string.find(pkgname(pkg), &quot;#&quot;)
+		ver = pkgvercur(pkg)
+		if idx and not pkgisvirtual(pkg) then
+			name = string.sub(pkgname(pkg), 1, idx-1)
+			if not ver then
+				ver = pkgvercand(pkg)
+			end
+			-- new entry
+			if not pkgs[name] then
+				tmp = {}
+				tmp.pkg = pkg
+				tmp.ver = ver
+				tmp.inst = false
+				pkgs[name] = tmp
+			end
+			if pkgvercur(pkg) then
+				pkgs[name].inst = true
+			end
+			-- mark it as latest if newer than what already known
+			if ver and verstrcmp(verstr(ver), verstr(pkgs[name].ver)) &gt; 0 then
+				pkgs[name].ver = ver
+				pkgs[name].pkg = pkg
+			end
+		end
+	end
+	return pkgs
+end
+
+-- mark installed virtualized packages for &quot;upgrade&quot;
+function mark_upgrade(name, pkg)
+	kname = get_kernelname()
+	if pkg.inst and not pkgvercur(pkg.pkg) then
+		markinstall(pkg.pkg)
+		if name == kname and not pkgvercur(pkg.pkg) then
+			confset('Kernel::New-Version', verstr(pkg.ver))
+		end
+	end
+end
+
+-- find the latest version of given virtual pkg for installation
+function mark_install(virtualpkg)
+	kname = get_kernelname()
+	pkgs = find_instonly_pkgs()
+	for name in pkgs do
+		if name == virtualpkg then
+			selected = pkgs[name].pkg
+		end
+	end
+	if virtualpkg == kname and not pkgvercur(pkgs[virtualpkg].pkg) then
+		confset('Kernel::New-Version', verstr(pkgs[virtualpkg].ver))
+	end
+end
+
+-- normal install operation
+if script_slot == 'Scripts::AptGet::Install::SelectPackage' then
+	modprefix = confgetlist('Kernel::Module-Prefix')
+	for i, prefix in ipairs(modprefix) do
+		if string.find(virtualname, prefix, 1, true) then
+			moduname = virtualname..&quot;-&quot;..posix.uname(&quot;%r&quot;)
+			modpkg = pkgfind(moduname)
+			if modpkg then
+				selected = modpkg
+			else
+				apterror(_(&quot;Couldn't find package &quot;..moduname))
+				return
+			end
+		end
+	end
+	mark_install(virtualname)
+	return
+elseif script_slot == 'Scripts::AptGet::Install::PreResolve' then
+	kname = get_kernelname()
+	if not confexists('Kernel::New-Version') then
+		for i, pkg in ipairs(pkglist()) do
+			idx = string.find(pkgname(pkg), &quot;#&quot;)
+			if statinstall(pkg) and idx then
+				name = string.sub(pkgname(pkg), 1, idx-1)
+				if kname == name and not pkgvercur(pkg) then
+					confset('Kernel::New-Version', verstr(pkgvercand(pkg)))
+				end
+			end
+		end	
+	end
+	if confexists('Kernel::New-Version') then
+		upgrade_kernel_modules(confget('Kernel::New-Version'))
+	end
+-- if there's no virtual provide without the version in the name
+-- we need to match it here instead of selectpackage
+elseif script_slot == 'Scripts::AptGet::Install::TranslateArg' then
+    modprefix = confgetlist('Kernel::Module-Prefix')
+    for i, prefix in ipairs(modprefix) do
+		if string.find(argument, prefix, 1, true) then
+			translated = argument..&quot;-&quot;..posix.uname(&quot;%r&quot;)
+		end
+	end
+	return
+elseif script_slot == 'Scripts::AptGet::Upgrade' or 
+   script_slot == 'Scripts::AptGet::DistUpgrade' then
+	pkgs = find_instonly_pkgs()
+	table.foreach(pkgs, mark_upgrade)
+	if confexists('Kernel::New-Version') then
+		upgrade_kernel_modules(confget('Kernel::New-Version'))
+	end
+elseif script_slot == 'Scripts::PM::Post' then
+	if confget('Kernel::Set-Default/b', &quot;false&quot;) == &quot;true&quot; and 
+       confexists('Kernel::New-Version') then
+		set_default(confget('Kernel::New-Version'))
+	end
+end
+		
+-- vim:ts=4:sw=4


Property changes on: trunk/rpms/apt/upgradevirt.lua
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/rpms/synaptic/synaptic.spec
===================================================================
--- trunk/rpms/synaptic/synaptic.spec	2008-06-11 23:56:53 UTC (rev 6357)
+++ trunk/rpms/synaptic/synaptic.spec	2008-06-12 09:01:21 UTC (rev 6358)
@@ -5,22 +5,31 @@
 Summary: Graphical package management program using apt
 Name: synaptic
 Version: 0.57.2
-Release: 3
+Release: 4
 License: GPL
 Group: Applications/System
 URL: <A HREF="http://www.nongnu.org/synaptic/">http://www.nongnu.org/synaptic/</A>
+
 Source: <A HREF="http://savannah.nongnu.org/download/synaptic/synaptic-%{version">http://savannah.nongnu.org/download/synaptic/synaptic-%{version</A>}.tar.gz
 Patch0: <A HREF="http://apt-rpm.org/patches/synaptic-0.57.2-gcc41.patch">http://apt-rpm.org/patches/synaptic-0.57.2-gcc41.patch</A>
 Patch1: <A HREF="http://apt-rpm.org/patches/synaptic-0.57.2-repomd-1.patch">http://apt-rpm.org/patches/synaptic-0.57.2-repomd-1.patch</A>
 Patch2: <A HREF="http://apt-rpm.org/patches/synaptic-0.57.2-showprog.patch">http://apt-rpm.org/patches/synaptic-0.57.2-showprog.patch</A>
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-Requires: apt &gt;= 0.5.4, usermode
+
+BuildRequires: apt-devel &gt;= 0.5.15lorg3.2
+BuildRequires: rpm-devel &gt;= 4.0
+BuildRequires: gtk2-devel &gt;= 2.4
+BuildRequires: libglade2-devel &gt;= 2.0
+BuildRequires: gcc-c++
+BuildRequires: docbook-utils
+BuildRequires: gettext
+BuildRequires: xmlto
+BuildRequires: scrollkeeper
+BuildRequires: perl(XML::Parser)
+Requires: apt &gt;= 0.5.15lorg3.2
+Requires: usermode
 Requires(pre): scrollkeeper
 Requires(postun): scrollkeeper
-BuildRequires: apt-devel &gt;= 0.5.4, rpm-devel &gt;= 4.0
-BuildRequires: gtk2-devel &gt;= 2.4, libglade2-devel &gt;= 2.0
-BuildRequires: gcc-c++, docbook-utils, gettext, xmlto, scrollkeeper
-BuildRequires: perl(XML::Parser)
 
 %description
 Synaptic (previously known as raptor) is a graphical package management
@@ -65,60 +74,54 @@
 Categories=GNOME;Application;SystemSetup;X-Red-Hat-Base;
 EOF
 
-
 %build
-%configure
+%configure --disable-dependency-tracking
 %{__make} %{?_smp_mflags}
 
-
 %install
 %{__rm} -rf %{buildroot}
-%makeinstall
+%{__make} install DESTDIR=&quot;%{buildroot}&quot;
 %find_lang %{name}
 
-# Install the consolehelper symlink
+### Install the consolehelper symlink
 %{__mkdir_p} %{buildroot}%{_bindir}
 %{__ln_s} consolehelper %{buildroot}%{_bindir}/synaptic
 
-# Install the consolehelper required files
-%{__install} -Dp -m 0644 synaptic.apps \
-    %{buildroot}%{_sysconfdir}/security/console.apps/synaptic
-%{__install} -Dp -m 0644 synaptic.pam \
-    %{buildroot}%{_sysconfdir}/pam.d/synaptic
+### Install the consolehelper required files
+%{__install} -Dp -m0644 synaptic.apps %{buildroot}%{_sysconfdir}/security/console.apps/synaptic
+%{__install} -Dp -m0644 synaptic.pam %{buildroot}%{_sysconfdir}/pam.d/synaptic
 
-# Remove legacy menu entry
+### Remove legacy menu entry
 %{__rm} -f %{buildroot}%{_sysconfdir}/X11/sysconfig/synaptic.desktop
 
-
 %clean
 %{__rm} -rf %{buildroot}
 
-
 %post
 %{_bindir}/scrollkeeper-update -q || :
 
 %postun
 %{_bindir}/scrollkeeper-update -q || :
 
-
 %files -f %{name}.lang
 %defattr(-, root, root, 0755)
 %doc AUTHORS ChangeLog COPYING NEWS README TODO
-%{_sysconfdir}/pam.d/synaptic
-%{_sysconfdir}/security/console.apps/synaptic
+%doc %{_mandir}/man8/synaptic.8*
+%config(noreplace) %{_sysconfdir}/pam.d/synaptic
+%config(noreplace) %{_sysconfdir}/security/console.apps/synaptic
 %{_bindir}/synaptic
-%{_sbindir}/synaptic
 %{_datadir}/applications/synaptic.desktop
 %{_datadir}/applications/synaptic-kde.desktop
 %{_datadir}/gnome/help/synaptic/
 %{_datadir}/omf/synaptic/
 %{_datadir}/pixmaps/synaptic.png
 %{_datadir}/synaptic/
-%{_mandir}/man8/*
-%exclude %{_localstatedir}/scrollkeeper/
+%{_sbindir}/synaptic
 
+%changelog
+* Thu Jun 12 2008 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.57.2-4
+- Rebuild against apt-0.5.15lorg3.2.
 
-%changelog
 * Fri Jun 23 2006 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.57.2-3
 - Added more patches to make synaptic work with apt-0.5.15lorg3.2.
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005156.html">[svn] r6357 - in trunk/tools/unoconv: . tests
</A></li>
	<LI>Next message: <A HREF="005158.html">[svn] r6359 - trunk/rpms/ntop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5157">[ date ]</a>
              <a href="thread.html#5157">[ thread ]</a>
              <a href="subject.html#5157">[ subject ]</a>
              <a href="author.html#5157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
