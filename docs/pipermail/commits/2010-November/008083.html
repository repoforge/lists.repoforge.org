<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r9299 - in /trunk/tools/dar: ./ dists/el2i/ dists/el3a/ dists/el3i/ dists/el4a/ dists/el4i/ dists/el5a/ dists/el5i/
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9299%20-%20in%20/trunk/tools/dar%3A%20./%20dists/el2i/%20dists/el3a/%0A%20dists/el3i/%20dists/el4a/%20dists/el4i/%20dists/el5a/%20dists/el5i/&In-Reply-To=%3C201011171307.oAHD7UUV029185%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008082.html">
   <LINK REL="Next"  HREF="008084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r9299 - in /trunk/tools/dar: ./ dists/el2i/ dists/el3a/ dists/el3i/ dists/el4a/ dists/el4i/ dists/el5a/ dists/el5i/</H1>
    <B>Dag Wieers</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9299%20-%20in%20/trunk/tools/dar%3A%20./%20dists/el2i/%20dists/el3a/%0A%20dists/el3i/%20dists/el4a/%20dists/el4i/%20dists/el5a/%20dists/el5i/&In-Reply-To=%3C201011171307.oAHD7UUV029185%40surya.karan.org%3E"
       TITLE="[svn] r9299 - in /trunk/tools/dar: ./ dists/el2i/ dists/el3a/ dists/el3i/ dists/el4a/ dists/el4i/ dists/el5a/ dists/el5i/">dag at wieers.com
       </A><BR>
    <I>Wed Nov 17 14:07:30 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008082.html">[svn] r9298 - in /trunk/rpms: perl-Algorithm-Diff/ perl-AppConfig/ perl-Archive-Extract/ perl-Archive-Tar/ perl-Authen-SASL/ perl-B-Keywords/ perl-BSD-Resource/ perl-Bit-Vector/ perl-Business-ISBN-Data/ perl-Business-ISBN/ perl-CGI-Persistent/ perl-CGI-Session/ perl-CGI/ perl-CSS-Tiny/ perl-Cache-Memcached/ perl-Carp-Clan/ perl-Class-Accessor/ perl-Class-Data-Inheritable/ perl-Class-Inspector/ perl-Class-Singleton/ perl-Class-Trigger/ perl-Clone/ perl-Compress-Raw-Zlib/ perl-Compress-Zlib/ perl-Config-General/ perl-Config-Simple/ perl-Config-Tiny/ perl-Convert-ASN1/ perl-Convert-BinHex/ perl-Crypt-OpenSSL-Bignum/ perl-Crypt-OpenSSL-RSA/ perl-Crypt-OpenSSL-Random/ perl-Crypt-PasswdMD5/ perl-Crypt-SSLeay/ perl-DBD-Pg/ perl-DBD-SQLite/ perl-DBI/ perl-DBIx-Simple/ perl-DB_File/ perl-Data-OptList/ perl-Date-Calc/ perl-Date-Manip/ perl-DateTime-Format-DateParse/ perl-DateTime-Format-Mail/ perl-DateTime-Format-W3CDTF/ perl-DateTime/ perl-Devel-Cover/ perl-Devel-Cycle/ perl-Devel-Leak/ perl-Devel-StackTrace/ perl-Devel-Symdump/ perl-Digest-BubbleBabble/ perl-Digest-HMAC/ perl-Digest-MD5/ perl-Digest-SHA/ perl-Digest-SHA1/
</A></li>
        <LI>Next message: <A HREF="008084.html">[svn] r9300 - /trunk/rpms/perl-NetAddr-IP/perl-NetAddr-IP.spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8083">[ date ]</a>
              <a href="thread.html#8083">[ thread ]</a>
              <a href="subject.html#8083">[ subject ]</a>
              <a href="author.html#8083">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: Wed Nov 17 13:07:29 2010
New Revision: 9299

URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge?rev=9299&amp;view=rev">http://svn.rpmforge.net/viewvc/rpmforge?rev=9299&amp;view=rev</A>
Log:
Improvements to DAR related to RPMforge-extras, duplicates and RHEL6

Added:
    trunk/tools/dar/dar-duplicate   (with props)
    trunk/tools/dar/dar-metadata   (with props)
Modified:
    trunk/tools/dar/Makefile
    trunk/tools/dar/commands.txt
    trunk/tools/dar/dar-build
    trunk/tools/dar/dar-functions
    trunk/tools/dar/dar-shell
    trunk/tools/dar/dar-update
    trunk/tools/dar/dar.conf
    trunk/tools/dar/dists/el2i/config
    trunk/tools/dar/dists/el3a/config
    trunk/tools/dar/dists/el3i/config
    trunk/tools/dar/dists/el4a/config
    trunk/tools/dar/dists/el4i/config
    trunk/tools/dar/dists/el5a/config
    trunk/tools/dar/dists/el5i/config

Modified: trunk/tools/dar/Makefile
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/Makefile?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/Makefile?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/Makefile (original)
+++ trunk/tools/dar/Makefile Wed Nov 17 13:07:29 2010
@@ -9,7 +9,7 @@
 localstatedir=/var
 sbindir=/usr/sbin
 
-DIST_SCRIPTS=dar-build dar-dotty dar-exec dar-kickoff dar-new dar-prepare dar-repo dar-shell dar-sync dar-update
+DIST_SCRIPTS=dar-build dar-dotty dar-exec dar-kickoff dar-metadata dar-new dar-prepare dar-repo dar-shell dar-sync dar-update
 DIST_LIBS=dar-functions
 
 DESTDIR=

Modified: trunk/tools/dar/commands.txt
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/commands.txt?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/commands.txt?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/commands.txt (original)
+++ trunk/tools/dar/commands.txt Wed Nov 17 13:07:29 2010
@@ -2,7 +2,8 @@
 ### &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
 
 ### Install build environment
-old=fc3-i386; new=el4-i386; chr=el4i; diff -u &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/rpmqa-$old.list) &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/rpmqa-$new.list) | grep &quot;^-&quot; | sed -e 's|^-||' | xargs dar-update -d $chr
+#old=fc3-i386; new=el4-i386; chr=el4i; diff -u &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/rpmqa-$old.list) &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/rpmqa-$new.list) | grep &quot;^-&quot; | sed -e 's|^-||' | xargs dar-update -d $chr
+dar-exec -d el6i yum install $(old=el5i; new=el6i; diff -u &lt;(dar-exec -q -d $old rpm -qa --qf '%{name}\\n' | sort) &lt;(dar-exec -q -d $new rpm -qa --qf '%{name}\\n' | sort) | grep &quot;^-&quot; | sed -e 's|^-||')
 
 ### Build missing packages compared to other dist
 old=fc3-i386; new=el4-i386; chr=el4i; diff -u &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/packages-$old.list) &lt;(cut -f1 /dar/pub/rpmforge/persona/dag/state/packages-$new.list) | grep &quot;^-&quot; | sed -e 's|^-||' | xargs dar-build -n -d $chr

Modified: trunk/tools/dar/dar-build
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-build?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-build?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dar-build (original)
+++ trunk/tools/dar/dar-build Wed Nov 17 13:07:29 2010
@@ -62,7 +62,6 @@
     chown -R $BUILD_USER.$BUILD_GROUP &quot;$SPECDIR/&quot;
     chmod -R a+r &quot;$SPECDIR/&quot;
 
-    set_tag
     set_dists
     set_exclude_dist
     set_exclusive_dist
@@ -82,6 +81,7 @@
             continue
         fi
 
+        set_tag
         if [ &quot;$TAG&quot; ]; then
             TAGS=&quot;$TAG&quot;
         fi
@@ -146,20 +146,11 @@
             ### Check if already build (2 version schemes, multiple disttags)
             for disttag in $DISTNAME $DISTTAG; do
                 for tag in $TAGS; do
-                    NEWRPMFILE=&quot;$app-$VERSION-$RELEASE.$arch.rpm&quot;
-                    OLDRPMFILE=&quot;$app-$VERSION-$RELEASE.$arch.rpm&quot;
-                    for rpmfile in $NEWRPMFILE $OLDRPMFILE; do
-#                       echo $rpmfile
-                        if [ -z &quot;$FORCE_OVERWRITE&quot; -a -f &quot;$PACKAGEDIR/$app/$rpmfile&quot; ]; then
-                            warning &quot;Package \&quot;$PACKAGEDIR/$app/$rpmfile\&quot; already exists.&quot;
-
-#                           if [ -z &quot;$SOURCE_DISTS&quot; ]; then
-#                               SOURCE_DISTS=&quot;$DISTNICK&quot;
-#                           fi
-
-                            continue 4
-                        fi
-                    done
+                    rpmfile=&quot;$app-$VERSION-$RELEASE.$arch.rpm&quot;
+                    if [ -z &quot;$FORCE_OVERWRITE&quot; -a -f &quot;$PACKAGEDIR/$app/$rpmfile&quot; ]; then
+                        warning &quot;Package \&quot;$PACKAGEDIR/$app/$rpmfile\&quot; already exists.&quot;
+                        continue 3
+                    fi
                 done
             done
 

Added: trunk/tools/dar/dar-duplicate
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-duplicate?rev=9299&amp;view=markup">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-duplicate?rev=9299&amp;view=markup</A>
==============================================================================
--- trunk/tools/dar/dar-duplicate (added)
+++ trunk/tools/dar/dar-duplicate Wed Nov 17 13:07:29 2010
@@ -1,0 +1,46 @@
+#!/bin/bash
+
+source &quot;/usr/share/dar/dar-functions&quot;
+
+for pkg in /dar/rpms/*; do
+    title=
+    base=&quot;$(basename $pkg)&quot;
+    cat &lt;&lt;EOF | while read dist name path; do
+el6 EL6 rhel6s-i386
+el5 EL5 rhel5s-i386
+el4 EL4 rhel4as-i386
+el3 EL3 rhel3as-i386
+el2 EL2 rhel2.1as-i386
+EOF
+        unset ${!dist}
+        for file in /dar/mrepo/$path/{updates,optional}/$base-*.rpm; do
+            if [ -f $file ]; then
+                file=$(basename $file)
+                version=&quot;${file#*-}&quot;
+                version=&quot;${file%.*.*}&quot;
+                if [ -z &quot;$title&quot; ]; then
+                    echo -e &quot;$_BL_$_WH= Found \&quot;$_YE$base/$base.spec$_WH\&quot;$_DE&quot;
+                    title=&quot;yes&quot;
+                fi
+                echo &quot;### $name ships with $version&quot;
+                echo &quot;%{?$dist:# Tag: rfx}&quot;
+                for file in /dar/packages/$base/*.$dist.rf.*.rpm; do
+                    if [ -f $file ]; then
+                        mkdir -p /dar/old/$base/
+                        mv -v $file /dar/old/$base/
+                    fi
+                done
+                for file in /dar/packages/$base/_buildlogs/*.$dist.rf.*.log.gz; do
+                    if [ -f $file ]; then
+                        mkdir -p /dar/old/$base/_buildlogs/
+                        mv -v $file /dar/old/$base/_buildlogs/
+                    fi
+                done
+                break
+            fi
+        done
+    done
+#    if [ &quot;$title&quot; ]; then
+#        echo
+#    fi
+done

Propchange: trunk/tools/dar/dar-duplicate
------------------------------------------------------------------------------
    svn:executable = *

Modified: trunk/tools/dar/dar-functions
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-functions?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-functions?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dar-functions (original)
+++ trunk/tools/dar/dar-functions Wed Nov 17 13:07:29 2010
@@ -7,335 +7,321 @@
 DARCONFIG=&quot;/etc/dar/dar.conf&quot;
 
 ### ANSI colors
-_DE=&quot;\033[0;0m&quot;		# Default
-_BK=&quot;\033[0;30m&quot;	# Black
-_DB=&quot;\033[0;34m&quot;	# Dark Blue
-_SI=&quot;\033[0;37m&quot;	# Silver
-_GA=&quot;\033[1;30m&quot;	# Gray
-_RE=&quot;\033[1;31m&quot;	# Red
-_GR=&quot;\033[1;32m&quot;	# Green
-_YE=&quot;\033[1;33m&quot;	# Yellow
-_BL=&quot;\033[1;34m&quot;	# Blue
-_MA=&quot;\033[1;35m&quot;	# Magenta
-_CY=&quot;\033[1;36m&quot;	# Cyan
-_WH=&quot;\033[1;37m&quot;	# White
-
-_BK_=&quot;\033[40m&quot;		# Black BG
-_RE_=&quot;\033[41m&quot;		# Red BG
-_BL_=&quot;\033[44m&quot;		# Blue BG
-_WH_=&quot;\033[47m&quot;		# White BG
+_DE=&quot;\033[0;0m&quot;     # Default
+_BK=&quot;\033[0;30m&quot;    # Black
+_DB=&quot;\033[0;34m&quot;    # Dark Blue
+_SI=&quot;\033[0;37m&quot;    # Silver
+_GA=&quot;\033[1;30m&quot;    # Gray
+_RE=&quot;\033[1;31m&quot;    # Red
+_GR=&quot;\033[1;32m&quot;    # Green
+_YE=&quot;\033[1;33m&quot;    # Yellow
+_BL=&quot;\033[1;34m&quot;    # Blue
+_MA=&quot;\033[1;35m&quot;    # Magenta
+_CY=&quot;\033[1;36m&quot;    # Cyan
+_WH=&quot;\033[1;37m&quot;    # White
+
+_BK_=&quot;\033[40m&quot;     # Black BG
+_RE_=&quot;\033[41m&quot;     # Red BG
+_BL_=&quot;\033[44m&quot;     # Blue BG
+_WH_=&quot;\033[47m&quot;     # White BG
 
 _BELL=&quot;&quot;
 
 ### Cleans environment
 function clean_env {
-	:
+    :
 }
 
 ### Give a timestamp
 function timestamp {
-	echo $(date +'%h %d %H:%M:%S')
+    echo $(date +'%h %d %H:%M:%S')
 }
 
 ### Just log and fill error-buffer
 function log {
-	local MSG=&quot;$(timestamp) $*&quot;
-	echo &quot;$MSG&quot; &gt;&amp;2
-	ERRORBUFFER=&quot;$ERRORBUFFER\n$MSG&quot;
+    local MSG=&quot;$(timestamp) $*&quot;
+    echo &quot;$MSG&quot; &gt;&amp;2
+    ERRORBUFFER=&quot;$ERRORBUFFER\n$MSG&quot;
 }
 
 ### Log only if debugging is on
 function debug {
-	if [ &quot;$DEBUG&quot; == &quot;yes&quot; ]; then
-		log &quot;DEBUG: $*&quot;
-	else
-		local MSG=&quot;$(timestamp) $*&quot;
-		ERRORBUFFER=&quot;$ERRORBUFFER\n$MSG&quot;
-	fi
+    if [ &quot;$DEBUG&quot; == &quot;yes&quot; ]; then
+        log &quot;DEBUG: $*&quot;
+    else
+        local MSG=&quot;$(timestamp) $*&quot;
+        ERRORBUFFER=&quot;$ERRORBUFFER\n$MSG&quot;
+    fi
 }
 
 ### Log and put error-boolean on (so die will escalate the problem)
 function error {
-	ERROR=&quot;yes&quot;
-	echo -e &quot;\033[1;31mERROR:\033[0;0m $*&quot; &gt;&amp;2
-#	log &quot;ERROR: $*&quot;
+    ERROR=&quot;yes&quot;
+    echo -e &quot;\033[1;31mERROR:\033[0;0m $*&quot; &gt;&amp;2
+#   log &quot;ERROR: $*&quot;
 }
 
 ### Log and put warning-boolean on (so die will escalate the problem)
 function warning {
-	ERROR=&quot;yes&quot;
-	if [ &quot;$FORCE_VERBOSE&quot; == &quot;yes&quot; ]; then
-		echo -e &quot;\033[1;33mWARNING:\033[0;0m $*&quot; &gt;&amp;2
-#		log &quot;WARNING: $*&quot;
-	fi
+    ERROR=&quot;yes&quot;
+    if [ &quot;$FORCE_VERBOSE&quot; == &quot;yes&quot; ]; then
+        echo -e &quot;\033[1;33mWARNING:\033[0;0m $*&quot; &gt;&amp;2
+#       log &quot;WARNING: $*&quot;
+    fi
 }
 
 ### Stop running and escalate if problems
 function die {
-	if [ &quot;$*&quot; -o &quot;$ERROR&quot; == &quot;yes&quot; ]; then
-		log &quot;$* Exiting.&quot;
-		exit 1
-	else
-		debug &quot;Exiting successfully.&quot;
-		exit 0
-	fi
+    if [ &quot;$*&quot; -o &quot;$ERROR&quot; == &quot;yes&quot; ]; then
+        log &quot;$* Exiting.&quot;
+        exit 1
+    else
+        debug &quot;Exiting successfully.&quot;
+        exit 0
+    fi
 }
 
 function expand_specfile {
-	local SPECFILE=&quot;$1&quot;
-	if [ &quot;$DISTNAME&quot; -a &quot;$TAG&quot; -a &quot;$DISTNICK&quot; -a &quot;$MAKEFLAGS&quot; ]; then
-		rpmdb -D &quot;dtag $DISTNAME&quot; -D &quot;dist .$DISTNAME.$TAG&quot; -D &quot;$DISTNICK 1&quot; -D &quot;$DISTNAME 1&quot; -D &quot;_smp_mflags $MAKEFLAGS&quot; -E &quot;%{expand:%(cat $SPECFILE)}&quot;
-	else
-		cat $SPECFILE
-	fi
+    local SPECFILE=&quot;$1&quot;
+    rpmdb ${DISTNAME:+-D &quot;dtag $DISTNAME&quot;} ${TAG:+-D &quot;dist .$DISTNAME.$TAG&quot;} ${DISTNICK:+-D &quot;$DISTNICK 1&quot;} ${DISTNAME:+-D &quot;$DISTNAME 1&quot;} ${MAKEFLAGS:+-D &quot;_smp_mflags $MAKEFLAGS&quot;} -E &quot;%{expand:%(head -n256 $SPECFILE)}&quot;
 }
 
 function rpmconf {
-	local CONFIG=&quot;$1&quot;
-
-	if [ &quot;$2&quot; ]; then
-		local SPECFILE=&quot;$2&quot;
-	fi
-
-	if [ -z &quot;$SPECFILE&quot; ]; then
-		return 1
-	fi
-
-#	if [ &quot;$3&quot; != &quot;nocheck&quot; ]; then
-#		if [ &quot;$DISTNICK&quot; ]; then
-#			local RPMVER=&quot;$(chroot $CHROOTDIR/$DISTNICK rpm --version | cut -d' ' -f3)&quot;
-#		fi
+    local CONFIG=&quot;$1&quot;
+
+    if [ &quot;$2&quot; ]; then
+        local SPECFILE=&quot;$2&quot;
+    fi
+
+    if [ -z &quot;$SPECFILE&quot; ]; then
+        return 1
+    fi
 
     (
-#	if [ -z &quot;$DISTNICK&quot; ] || [ &quot;$RPMVER&quot; \&lt; &quot;4.1&quot; ] || ! chroot &quot;$CHROOTDIR/$DISTNICK&quot; /bin/su -lm $BUILD_USER -c &quot;rpmdb -D \&quot;dtag $DISTNAME\&quot; -D \&quot;disttag $DISTNAME\&quot; -D \&quot;$DISTNICK 1\&quot; -D \&quot;$DISTNAME 1\&quot; -E \&quot;%{expand:%(head -n128 $SPECFILE)}\&quot;&quot; | grep -i &quot;^ *$CONFIG *:&quot; | sed -e &quot;s/^ *$CONFIG *: *//i&quot; | head -1; then
-#    if [ -z &quot;$DISTNICK&quot; ] || [ &quot;$RPMVER&quot; \&lt; &quot;4.1&quot; ] || ! expand_specfile $SPECFILE | grep -i &quot;^ *$CONFIG *:&quot; | sed -e &quot;s/^ *$CONFIG *: *//i&quot; | head -1; then
-	if ! expand_specfile $SPECFILE | grep -i &quot;^ *$CONFIG *:&quot; | sed -e &quot;s/^ *$CONFIG *: *//i&quot; | head -1; then
-		debug &quot;Config $CONFIG not found in $SPECFILE&quot;
-	fi
-	) | perl -p -e &quot;s|\s+| |g; s|^\s+||; s|\s+$||;&quot;
+    if ! expand_specfile $SPECFILE | grep -i &quot;^ *$CONFIG *:&quot; | sed -e &quot;s/^ *$CONFIG *: *//i&quot; | head -1; then
+        debug &quot;Config $CONFIG not found in $SPECFILE&quot;
+    fi
+    ) | perl -p -e &quot;s|\s+| |g; s|^\s+||; s|\s+$||;&quot;
 }
 
 function rpmmacro {
-	CONFIG=&quot;$1&quot;
-
-	if [ &quot;$2&quot; ]; then
-		SPECFILE=&quot;$2&quot;
-	fi
-
-	if [ -z &quot;$SPECFILE&quot; ]; then
-		return 1
-	fi
-
-	if ! grep -i &quot;^%define $CONFIG &quot; $SPECFILE | sed -e &quot;s/^%define $CONFIG *//i&quot; | head -1; then
-		debug &quot;Macro $CONFIG not found in $SPECFILE&quot;
-	fi
+    local CONFIG=&quot;$1&quot;
+
+    if [ &quot;$2&quot; ]; then
+        local SPECFILE=&quot;$2&quot;
+    fi
+
+    if [ -z &quot;$SPECFILE&quot; ]; then
+        return 1
+    fi
+
+    if ! expand_specfile $SPECFILE | grep -i &quot;^%define $CONFIG &quot; | sed -e &quot;s/^%define $CONFIG *//i&quot; | head -1; then
+        debug &quot;Macro $CONFIG not found in $SPECFILE&quot;
+    fi
 }
 
 function metaconf {
-	CONFIG=&quot;$1&quot;
-
-	if [ &quot;$2&quot; ]; then
-		SPECFILE=&quot;$2&quot;
-	fi
-
-	if [ -z &quot;$SPECFILE&quot; ]; then
-		return 1
-	fi
-
-#	if ! grep -i &quot;^# *Dar$CONFIG *:&quot; $SPECFILE | sed -e &quot;s/^# *Dar$CONFIG *: *//i&quot; | head -1; then
-#		debug &quot;Config Dar$CONFIG not found in $SPECFILE&quot;
-#	fi
-	if ! grep -i &quot;^# *$CONFIG *:&quot; $SPECFILE | sed -e &quot;s/^# *$CONFIG *: *//i&quot; | head -1; then
-		debug &quot;MetaConfig $CONFIG not found in $SPECFILE&quot;
-	fi
+    local CONFIG=&quot;$1&quot;
+
+    if [ &quot;$2&quot; ]; then
+        local SPECFILE=&quot;$2&quot;
+    fi
+
+    if [ -z &quot;$SPECFILE&quot; ]; then
+        return 1
+    fi
+
+    if ! expand_specfile $SPECFILE | grep -i &quot;^# *$CONFIG *:&quot; | sed -e &quot;s/^# *$CONFIG *: *//i&quot; | head -1; then
+        debug &quot;MetaConfig $CONFIG not found in $SPECFILE&quot;
+    fi
 }
 
 function daropts {
-	OPTIONS=&quot;$1&quot;; shift
-	OPTIND=1
-	while getopts &quot;$OPTIONS&quot; c; do
-		case &quot;$c&quot; in
-			(a)	FORCE_ARCHS=&quot;$OPTARG&quot;;;
-			(d)	FORCE_DISTS=&quot;$OPTARG&quot;;;
-			(f)	FORCE_OVERWRITE=&quot;yes&quot;;;
-			(h)	help;;
-			(n)	NOSOURCE=&quot;yes&quot;;;
-			(r)	CREATE_REPO=&quot;yes&quot;;;
-			(s)	FORCE_SOURCE_DISTS=&quot;$OPTARG&quot;;;
-			(t)	FORCE_TAG=&quot;$OPTARG&quot;;;
-			(v)	FORCE_VERBOSE=&quot;yes&quot;;;
-			(q)	QUIET=&quot;yes&quot;;;
-#			(-)	c=${OPTARG/#-/}; OPTARG=&quot;$(echo $* | cut -d' ' -f$OPTIND)&quot;
-#			case &quot;$c&quot; in
-#				(port) port=&quot;$OPTARG&quot;; OPTIND=$((OPTIND+1));;
-#				(*) options=&quot;$options --$c $OPTARG&quot;; OPTIND=$((OPTIND+1));;
-#			esac;;
-#			('?')	error &quot;allow: Option \&quot;-$c\&quot; not allowed&quot; &gt;&amp;2;; 
-			(*)	error &quot;Option \&quot;-$OPTARG\&quot; unknown.&quot;
-		esac
-	done
-	shift $((OPTIND-1))
-	OPTS=$@
+    OPTIONS=&quot;$1&quot;; shift
+    OPTIND=1
+    while getopts &quot;$OPTIONS&quot; c; do
+        case &quot;$c&quot; in
+            (a) FORCE_ARCHS=&quot;$OPTARG&quot;;;
+            (d) FORCE_DISTS=&quot;$OPTARG&quot;;;
+            (f) FORCE_OVERWRITE=&quot;yes&quot;;;
+            (h) help;;
+            (n) NOSOURCE=&quot;yes&quot;;;
+            (r) CREATE_REPO=&quot;yes&quot;;;
+            (s) FORCE_SOURCE_DISTS=&quot;$OPTARG&quot;;;
+            (t) FORCE_TAG=&quot;$OPTARG&quot;;;
+            (v) FORCE_VERBOSE=&quot;yes&quot;;;
+            (q) QUIET=&quot;yes&quot;;;
+#           (-) c=${OPTARG/#-/}; OPTARG=&quot;$(echo $* | cut -d' ' -f$OPTIND)&quot;
+#           case &quot;$c&quot; in
+#               (port) port=&quot;$OPTARG&quot;; OPTIND=$((OPTIND+1));;
+#               (*) options=&quot;$options --$c $OPTARG&quot;; OPTIND=$((OPTIND+1));;
+#           esac;;
+#           ('?')   error &quot;allow: Option \&quot;-$c\&quot; not allowed&quot; &gt;&amp;2;; 
+            (*) error &quot;Option \&quot;-$OPTARG\&quot; unknown.&quot;
+        esac
+    done
+    shift $((OPTIND-1))
+    OPTS=$@
 }
 
 function set_archs {
-	if [ &quot;$FORCE_ARCHS&quot; ]; then
-		ARCHS=&quot;${FORCE_ARCHS//[,:;]/ }&quot;
-	elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
-		ARCHS=&quot;nosrc&quot;
-	else
-		ARCHS=&quot;$(metaconf Archs)&quot;
-	fi
-	if [ -z &quot;$ARCHS&quot; ]; then
-		ARCHS=&quot;$(rpmconf BuildArch)&quot;
-	fi
-	if [ -z &quot;$ARCHS&quot; ]; then
-		ARCHS=&quot;$DISTARCH&quot;
-	fi
-	if [ -z &quot;$ARCHS&quot; ]; then
-		ARCHS=&quot;$DEFAULT_ARCHS&quot;
-	fi
+    if [ &quot;$FORCE_ARCHS&quot; ]; then
+        ARCHS=&quot;${FORCE_ARCHS//[,:;]/ }&quot;
+    elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
+        ARCHS=&quot;nosrc&quot;
+    else
+        ARCHS=&quot;$(metaconf Archs)&quot;
+    fi
+    if [ -z &quot;$ARCHS&quot; ]; then
+        ARCHS=&quot;$(rpmconf BuildArch)&quot;
+    fi
+    if [ -z &quot;$ARCHS&quot; ]; then
+        ARCHS=&quot;$DISTARCH&quot;
+    fi
+    if [ -z &quot;$ARCHS&quot; ]; then
+        ARCHS=&quot;$DEFAULT_ARCHS&quot;
+    fi
 }
 
 function set_dists {
-	unset NODIST
-	if [ &quot;$FORCE_DISTS&quot; ]; then
-		DISTS=&quot;${FORCE_DISTS//[,:;]/ }&quot;
-	elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
-		NODIST=&quot;nodist&quot;
-		DISTS=&quot;$(echo &quot;$DISTS&quot; | cut -f1)&quot;
-	else
-		DISTS=&quot;$(metaconf Dists)&quot;
-	fi
-	if [ &quot;$(metaconf Dist)&quot; == &quot;nodist&quot; ]; then
-		NODIST=&quot;nodist&quot;
-		DISTS=&quot;$(echo $DISTS | cut -f1)&quot;
-	fi
-	if [ -z &quot;$DISTS&quot; ]; then
-		DISTS=&quot;$DEFAULT_DISTS&quot;
-	fi
+    unset NODIST
+    if [ &quot;$FORCE_DISTS&quot; ]; then
+        DISTS=&quot;${FORCE_DISTS//[,:;]/ }&quot;
+    elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
+        NODIST=&quot;nodist&quot;
+        DISTS=&quot;$(echo &quot;$DISTS&quot; | cut -f1)&quot;
+    else
+        DISTS=&quot;$(metaconf Dists)&quot;
+    fi
+    if [ &quot;$(metaconf Dist)&quot; == &quot;nodist&quot; ]; then
+        NODIST=&quot;nodist&quot;
+        DISTS=&quot;$(echo $DISTS | cut -f1)&quot;
+    fi
+    if [ -z &quot;$DISTS&quot; ]; then
+        DISTS=&quot;$DEFAULT_DISTS&quot;
+    fi
 }
 
 function set_exclude_dist {
-	EXCLUDE_DIST=&quot;$(metaconf ExcludeDist)&quot;
+    EXCLUDE_DIST=&quot;$(metaconf ExcludeDist)&quot;
 }
 
 function set_exclusive_dist {
-	EXCLUSIVE_DIST=&quot;$(metaconf ExclusiveDist)&quot;
+    EXCLUSIVE_DIST=&quot;$(metaconf ExclusiveDist)&quot;
 }
 
 function set_source_dists {
-	if [ &quot;$FORCE_SOURCE_DISTS&quot; ]; then
-		SOURCE_DISTS=&quot;${FORCE_SOURCE_DISTS//[,:;]/ }&quot;
-	elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
-		SOURCE_DISTS=&quot;$(echo ${FORCE_DISTS//[,:;]/ } | cut -f1)&quot;
-	else
-		SOURCE_DISTS=&quot;$(metaconf SourceDists)&quot;
-	fi
+    if [ &quot;$FORCE_SOURCE_DISTS&quot; ]; then
+        SOURCE_DISTS=&quot;${FORCE_SOURCE_DISTS//[,:;]/ }&quot;
+    elif [ &quot;$(rpmconf Nosource)&quot; != &quot;&quot; ]; then
+        SOURCE_DISTS=&quot;$(echo ${FORCE_DISTS//[,:;]/ } | cut -f1)&quot;
+    else
+        SOURCE_DISTS=&quot;$(metaconf SourceDists)&quot;
+    fi
 }
 
 function set_tag {
-	TAGS=&quot;$DEFAULT_TAGS&quot;
-	if [ -n &quot;$FORCE_TAG&quot; ]; then
-		TAG=&quot;$FORCE_TAG&quot;
-		TAGS=&quot;$FORCE_TAG&quot;
-	else
-		TAG=&quot;$(metaconf Tag)&quot;
-	fi
-	if [ -z &quot;$DEFAULT_TAG&quot; ]; then
-		DEFAULT_TAG=&quot;${DEFAULT_TAGS/ */}&quot;
-	fi
-	if [ -z &quot;$TAG&quot; ]; then
-		TAG=&quot;$DEFAULT_TAG&quot;
-	fi
+    TAGS=&quot;$DEFAULT_TAGS&quot;
+    if [ -n &quot;$FORCE_TAG&quot; ]; then
+        TAG=&quot;$FORCE_TAG&quot;
+        TAGS=&quot;$FORCE_TAG&quot;
+    else
+        TAG=&quot;$(metaconf Tag)&quot;
+    fi
+    if [ -z &quot;$DEFAULT_TAG&quot; ]; then
+        DEFAULT_TAG=&quot;${DEFAULT_TAGS/ */}&quot;
+    fi
+    if [ -z &quot;$TAG&quot; ]; then
+        TAG=&quot;$DEFAULT_TAG&quot;
+    fi
 }
 
 function set_soapbox {
-	if [ -n &quot;$FORCE_SOAPBOX&quot; ]; then
-		SOAPBOX=&quot;$FORCE_SOAPBOX&quot;
-	else
-		SOAPBOX=&quot;$(metaconf Soapbox)&quot;
-	fi
-	if [ -z &quot;$SOAPBOX&quot; ]; then SOAPBOX=&quot;$USE_SOAPBOX&quot;; fi
+    if [ -n &quot;$FORCE_SOAPBOX&quot; ]; then
+        SOAPBOX=&quot;$FORCE_SOAPBOX&quot;
+    else
+        SOAPBOX=&quot;$(metaconf Soapbox)&quot;
+    fi
+    if [ -z &quot;$SOAPBOX&quot; ]; then SOAPBOX=&quot;$USE_SOAPBOX&quot;; fi
 }
 
 function set_as_root {
-	if [ -n &quot;$FORCE_AS_ROOT&quot; ]; then
-		AS_ROOT=&quot;$FORCE_AS_ROOT&quot;
-	else
-		AS_ROOT=&quot;$(metaconf BuildAsRoot)&quot;
-	fi
-	if [ -z &quot;$AS_ROOT&quot; ]; then AS_ROOT=&quot;$USE_ROOT&quot;; fi
+    if [ -n &quot;$FORCE_AS_ROOT&quot; ]; then
+        AS_ROOT=&quot;$FORCE_AS_ROOT&quot;
+    else
+        AS_ROOT=&quot;$(metaconf BuildAsRoot)&quot;
+    fi
+    if [ -z &quot;$AS_ROOT&quot; ]; then AS_ROOT=&quot;$USE_ROOT&quot;; fi
 }
 
 function set_distcc {
-	if [ -n &quot;$FORCE_DISTCC&quot; ]; then
-		DISTCC=&quot;$FORCE_DISTCC&quot;
-	else
-		DISTCC=&quot;$(metaconf Distcc)&quot;
-	fi
-	if [ -z &quot;$DISTCC&quot; ]; then DISTCC=&quot;$USE_DISTCC&quot;; fi
+    if [ -n &quot;$FORCE_DISTCC&quot; ]; then
+        DISTCC=&quot;$FORCE_DISTCC&quot;
+    else
+        DISTCC=&quot;$(metaconf Distcc)&quot;
+    fi
+    if [ -z &quot;$DISTCC&quot; ]; then DISTCC=&quot;$USE_DISTCC&quot;; fi
 }
 
 function set_ccache {
-	if [ -n &quot;$FORCE_CCACHE&quot; ]; then
-		CCACHE=&quot;$FORCE_CCACHE&quot;
-	else
-		CCACHE=&quot;$(metaconf Ccache)&quot;
-	fi
-	if [ -z &quot;$CCACHE&quot; ]; then CCACHE=&quot;$USE_CCACHE&quot;; fi
+    if [ -n &quot;$FORCE_CCACHE&quot; ]; then
+        CCACHE=&quot;$FORCE_CCACHE&quot;
+    else
+        CCACHE=&quot;$(metaconf Ccache)&quot;
+    fi
+    if [ -z &quot;$CCACHE&quot; ]; then CCACHE=&quot;$USE_CCACHE&quot;; fi
 }
 
 function download_sources {
-	local RC=1
-	local ERC=0
-	local i=1
+    local RC=1
+    local ERC=0
+    local i=1
     ### FIXME: Do not hardcode a distribution here
-	for url in $(spectool -l &lt;(expand_specfile $SPECFILE) 2&gt;/dev/null | cut -f2 -d' '); do
-		filename=&quot;$SPECDIR/$(basename $url)&quot;
-		if [ ! -s &quot;$filename&quot; ]; then
-			warning &quot;Source \&quot;$(basename $filename)\&quot; not found, downloading [$url].&quot;
-			local i=1
-			RC=1
-			while [ $RC -ne 0 -a $i -lt 4 ]; do
-#				wget -v -t5 -T2 -O &quot;$filename&quot; &quot;$url&quot;
-				wget -q -t30 -T10 -O &quot;$filename&quot; &quot;$url&quot;
-#				wget -q -T1 -O &quot;$filename&quot; &quot;$url&quot;
-#				lftpget &quot;$url&quot; -c -o &quot;$filename&quot;
-#				lftpget &quot;$url&quot; -c -O &quot;$(dirname $filename)&quot; -o &quot;$(basename $filename)&quot;
-				RC=$?
-				i=$((i+1))
-			done
-			if [ $RC -ne 0 ]; then
-				error &quot;Problems downloading source [$url].&quot;
-				if [ -s &quot;$filename&quot; ]; then
-					rm &quot;$filename&quot;
-				fi
-				ERC=1
-			fi
-		fi
-	done
-	return $ERC
+    for url in $(spectool -l &lt;(expand_specfile $SPECFILE) 2&gt;/dev/null | cut -f2 -d' '); do
+        filename=&quot;$SPECDIR/$(basename $url)&quot;
+        if [ ! -s &quot;$filename&quot; ]; then
+            warning &quot;Source \&quot;$(basename $filename)\&quot; not found, downloading [$url].&quot;
+            local i=1
+            RC=1
+            while [ $RC -ne 0 -a $i -lt 4 ]; do
+#               wget -v -t5 -T2 -O &quot;$filename&quot; &quot;$url&quot;
+                wget -q -t30 -T10 -O &quot;$filename&quot; &quot;$url&quot;
+#               wget -q -T1 -O &quot;$filename&quot; &quot;$url&quot;
+#               lftpget &quot;$url&quot; -c -o &quot;$filename&quot;
+#               lftpget &quot;$url&quot; -c -O &quot;$(dirname $filename)&quot; -o &quot;$(basename $filename)&quot;
+                RC=$?
+                i=$((i+1))
+            done
+            if [ $RC -ne 0 ]; then
+                error &quot;Problems downloading source [$url].&quot;
+                if [ -s &quot;$filename&quot; ]; then
+                    rm &quot;$filename&quot;
+                fi
+                ERC=1
+            fi
+        fi
+    done
+    return $ERC
 }
 
 function build_env {
-	local DISTNICK=&quot;$1&quot;
-	local DISTNAME=&quot;$2&quot;
-	local OPTIONS=&quot;&quot;
-	local RPMVER=&quot;$(chroot $CHROOTDIR/$DISTNICK rpm --version | cut -d' ' -f3)&quot;
-
-	if [ &quot;$RPMVER&quot; \&gt; &quot;4.0.2&quot; ]; then
-		OPTIONS=&quot;$OPTIONS --nodigest&quot;
-	fi
-	if [ &quot;$RPMVER&quot; \&gt; &quot;4.0.99&quot; ]; then
-		OPTIONS=&quot;$OPTIONS --nosignature&quot;
-	fi
-
-	chroot $CHROOTDIR/$DISTNICK rpm -qa $OPTIONS --qf &quot;%{name}\t%{version}-%{release}\n&quot;| sort &gt;$STATEDIR/rpmqa-$DISTNAME-$DISTARCH.list 2&gt;/dev/null
+    local DISTNICK=&quot;$1&quot;
+    local DISTNAME=&quot;$2&quot;
+    local OPTIONS=&quot;&quot;
+    local RPMVER=&quot;$(chroot $CHROOTDIR/$DISTNICK rpm --version | cut -d' ' -f3)&quot;
+
+    if [ &quot;$RPMVER&quot; \&gt; &quot;4.0.2&quot; ]; then
+        OPTIONS=&quot;$OPTIONS --nodigest&quot;
+    fi
+    if [ &quot;$RPMVER&quot; \&gt; &quot;4.0.99&quot; ]; then
+        OPTIONS=&quot;$OPTIONS --nosignature&quot;
+    fi
+
+    chroot $CHROOTDIR/$DISTNICK rpm -qa $OPTIONS --qf &quot;%{name}\t%{version}-%{release}\n&quot;| sort &gt;$STATEDIR/rpmqa-$DISTNAME-$DISTARCH.list 2&gt;/dev/null
 }
 
 function build_htaccess {
-	cat &lt;&lt;EOF &gt;&quot;$PACKAGEDIR/.htaccess&quot;
+    cat &lt;&lt;EOF &gt;&quot;$PACKAGEDIR/.htaccess&quot;
 Options +Indexes
 DirectoryIndex .
 #IndexOrderDefault Descending Date
@@ -343,217 +329,217 @@
 IndexOptions +TrackModified
 
 EOF
-	for dir in $(ls $PACKAGEDIR); do
-		if [ -d &quot;$PACKAGEDIR/$dir&quot; ]; then
-			SPECFILE=&quot;$(ls $PACKAGEDIR/$dir/*.spec | cut -d' ' -f1)&quot;
-			if [ -f &quot;$SPECFILE&quot; ]; then
-				echo &quot;AddDescription \&quot;$(rpmconf Summary)\&quot; $dir&quot; &gt;&gt;&quot;$PACKAGEDIR/.htaccess&quot;
-			fi
-		fi
-	done
+    for dir in $(ls $PACKAGEDIR); do
+        if [ -d &quot;$PACKAGEDIR/$dir&quot; ]; then
+            SPECFILE=&quot;$(ls $PACKAGEDIR/$dir/*.spec | cut -d' ' -f1)&quot;
+            if [ -f &quot;$SPECFILE&quot; ]; then
+                echo &quot;AddDescription \&quot;$(rpmconf Summary)\&quot; $dir&quot; &gt;&gt;&quot;$PACKAGEDIR/.htaccess&quot;
+            fi
+        fi
+    done
 }
 
 function build_content {
-	local DISTNAME=&quot;$1&quot;
-	local DISTPATH=&quot;$2&quot;
-
-#	find &quot;$PACKAGEDIR/&quot; -name &quot;*.$TAG.$DIST.*.rpm&quot; \
-#			-o -name &quot;*.$DIST.$TAG.*.rpm&quot; | \
-#		sed -e &quot;
-#			s|.\+/\(.\+\)-[0-9].\+-[0-9].*\.$TAG\.$DIST\..\+\.rpm|\1|;
-#			s|.\+/\(.\+\)-[0-9].\+-[0-9].*\.$DIST\.$TAG\..\+\.rpm|\1|;
-#		&quot; | sort | uniq &gt;$STATEDIR/packages-$DIST.list
-
-	for rpm in $FTPDIR/$DISTPATH/RPMS.$REPO/*.rpm; do
-		rpm=&quot;${rpm%-*-*}&quot;
-		echo &quot;${rpm//#*\/}&quot;
-	done | sort | uniq &gt;$STATEDIR/packages-$DISTNAME-$DISTARCH.list
+    local DISTNAME=&quot;$1&quot;
+    local DISTPATH=&quot;$2&quot;
+
+#   find &quot;$PACKAGEDIR/&quot; -name &quot;*.$TAG.$DIST.*.rpm&quot; \
+#           -o -name &quot;*.$DIST.$TAG.*.rpm&quot; | \
+#       sed -e &quot;
+#           s|.\+/\(.\+\)-[0-9].\+-[0-9].*\.$TAG\.$DIST\..\+\.rpm|\1|;
+#           s|.\+/\(.\+\)-[0-9].\+-[0-9].*\.$DIST\.$TAG\..\+\.rpm|\1|;
+#       &quot; | sort | uniq &gt;$STATEDIR/packages-$DIST.list
+
+    for rpm in $FTPDIR/$DISTPATH/RPMS.$REPO/*.rpm; do
+        rpm=&quot;${rpm%-*-*}&quot;
+        echo &quot;${rpm//#*\/}&quot;
+    done | sort | uniq &gt;$STATEDIR/packages-$DISTNAME-$DISTARCH.list
 }
 
 function build_tree_apt {
-	local DISTTAG=&quot;$1&quot;
-	local DISTPATH=&quot;$2&quot;
-
-	echo &quot;Building Apt tree.&quot;
-
-	### Creating directories
-	mkdir -p $FTPDIR/$DISTPATH/{base,RPMS.$REPO}/
-
-	### Make SPEC files readable
-	echo $PACKAGEDIR/*/*.spec | xargs chmod +r
-
-	### Removing old packages
-	echo $FTPDIR/$DISTPATH/RPMS.$REPO/*.rpm | xargs rm -f
-
-	### FIXME: This should not be done hardcoded, rather have a list of archs inside the dist-config
-	### FIXME: And iterate through that list
-	for disttag in $DISTTAG nodist 0; do
-		for tag in $TAGS; do
-		
-		case &quot;$DISTARCH&quot; in
-			i386)
-				find $PACKAGEDIR -type f -a \( \
-						-name &quot;*.$tag.$disttag.noarch.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.i?86.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.athlon.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.i?86.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.athlon.rpm&quot; \) \
-					-exec ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ \;
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
-				;;
-#			x86_64)
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
-#				;;
-			*)
-				find $PACKAGEDIR -type f -a \( \
-						-name &quot;*.$tag.$disttag.noarch.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.$DISTARCH.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.$DISTARCH.rpm&quot; \) \
-					-exec ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ \;
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
-				;;
-		esac
-
-		done
-	done
+    local DISTTAG=&quot;$1&quot;
+    local DISTPATH=&quot;$2&quot;
+
+    echo &quot;Building Apt tree.&quot;
+
+    ### Creating directories
+    mkdir -p $FTPDIR/$DISTPATH/{base,RPMS.$REPO}/
+
+    ### Make SPEC files readable
+    echo $PACKAGEDIR/*/*.spec | xargs chmod +r
+
+    ### Removing old packages
+    echo $FTPDIR/$DISTPATH/RPMS.$REPO/*.rpm | xargs rm -f
+
+    ### FIXME: This should not be done hardcoded, rather have a list of archs inside the dist-config
+    ### FIXME: And iterate through that list
+    for disttag in $DISTTAG nodist 0; do
+        for tag in $TAGS; do
+
+        case &quot;$DISTARCH&quot; in
+            i386)
+                find $PACKAGEDIR -type f -a \( \
+                        -name &quot;*.$tag.$disttag.noarch.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.i?86.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.athlon.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.i?86.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.athlon.rpm&quot; \) \
+                    -exec ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ \;
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
+                ;;
+#           x86_64)
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
+#               ;;
+            *)
+                find $PACKAGEDIR -type f -a \( \
+                        -name &quot;*.$tag.$disttag.noarch.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.$DISTARCH.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.$DISTARCH.rpm&quot; \) \
+                    -exec ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ \;
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/RPMS.$REPO/ &amp;&gt;/dev/null
+                ;;
+        esac
+
+        done
+    done
 }
 
 function build_repo_apt {
-	local DISTPATH=&quot;$1&quot;
-
-	echo &quot;Building Apt repo.&quot;
-
-	if [ ! -d &quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot; ]; then
-		mkdir -p &quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot;
-	fi
-
-	### Build Apt repository
-	genbasedir --flat --bloat --cachedir=&quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot; --bz2only $FTPDIR/$DISTPATH $REPO &gt;/dev/null
-#	genbasedir --progress --flat --bloat $FTPDIR/$DISTPATH $REPO
-#	genbasedir --progress --hashonly $FTPDIR/$DISTPATH $REPO
+    local DISTPATH=&quot;$1&quot;
+
+    echo &quot;Building Apt repo.&quot;
+
+    if [ ! -d &quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot; ]; then
+        mkdir -p &quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot;
+    fi
+
+    ### Build Apt repository
+    genbasedir --flat --bloat --cachedir=&quot;$TEMPDIR/.cache/genbasedir/$DISTNICK/$REPO&quot; --bz2only $FTPDIR/$DISTPATH $REPO &gt;/dev/null
+#   genbasedir --progress --flat --bloat $FTPDIR/$DISTPATH $REPO
+#   genbasedir --progress --hashonly $FTPDIR/$DISTPATH $REPO
 }
 
 function build_tree_yum {
-	local DISTTAG=&quot;$1&quot;
-	local DISTPATH=&quot;$2&quot;
-
-	echo &quot;Building Yum tree.&quot;
-
-	### Creating directories
-	mkdir -p $FTPDIR/$DISTPATH/$REPO/{RPMS,headers}/
-
-	### Removing old packages
-	echo $FTPDIR/$DISTPATH/$REPO/RPMS/*.rpm | xargs rm -f
-	echo $FTPDIR/$DISTPATH/$REPO/headers/*.hdr | xargs rm -f
-
-	### FIXME: This should not be done hardcoded, rather have a list of archs inside the dist-config
-	### FIXME: And iterate through that list
-	### Hardlink files
-	for disttag in $DISTTAG nodist 0; do
-		for tag in $TAGS; do
-
-		case &quot;$DISTARCH&quot; in
-			i386)
-				find $PACKAGEDIR -type f -a \( \
-						-name &quot;*.$tag.$disttag.noarch.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.i?86.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.athlon.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.i?86.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.athlon.rpm&quot; \) \
-					-exec ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ \;
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
-				;;
-#			x86_64)
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
-#				;;
-			*)
-				find $PACKAGEDIR -type f -a \( \
-						-name &quot;*.$tag.$disttag.noarch.rpm&quot; \
-						-o -name &quot;*.$tag.$disttag.$DISTARCH.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
-						-o -name &quot;*.$disttag.$tag.$DISTARCH.rpm&quot; \) \
-					-exec ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ \;
-#				echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
-#				echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
-				;;
-		esac
-
-		done
-	done
-#	ln -f $PACKAGEDIR/*/*.$TAG.src.rpm $FTPDIR/$DISTPATH/$REPO/SRPMS/ &amp;&gt;/dev/null
+    local DISTTAG=&quot;$1&quot;
+    local DISTPATH=&quot;$2&quot;
+
+    echo &quot;Building Yum tree.&quot;
+
+    ### Creating directories
+    mkdir -p $FTPDIR/$DISTPATH/$REPO/{RPMS,headers}/
+
+    ### Removing old packages
+    echo $FTPDIR/$DISTPATH/$REPO/RPMS/*.rpm | xargs rm -f
+    echo $FTPDIR/$DISTPATH/$REPO/headers/*.hdr | xargs rm -f
+
+    ### FIXME: This should not be done hardcoded, rather have a list of archs inside the dist-config
+    ### FIXME: And iterate through that list
+    ### Hardlink files
+    for disttag in $DISTTAG nodist 0; do
+        for tag in $TAGS; do
+
+        case &quot;$DISTARCH&quot; in
+            i386)
+                find $PACKAGEDIR -type f -a \( \
+                        -name &quot;*.$tag.$disttag.noarch.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.i?86.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.athlon.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.i?86.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.athlon.rpm&quot; \) \
+                    -exec ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ \;
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
+                ;;
+#           x86_64)
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,i386,i586,i686,athlon,x86_64}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
+#               ;;
+            *)
+                find $PACKAGEDIR -type f -a \( \
+                        -name &quot;*.$tag.$disttag.noarch.rpm&quot; \
+                        -o -name &quot;*.$tag.$disttag.$DISTARCH.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.noarch.rpm&quot; \
+                        -o -name &quot;*.$disttag.$tag.$DISTARCH.rpm&quot; \) \
+                    -exec ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ \;
+#               echo $PACKAGEDIR/*/*.$tag.$disttag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null # Backward compatibility
+#               echo $PACKAGEDIR/*/*.{$disttag,0}.$tag.{noarch,$DISTARCH}.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DISTPATH/$REPO/RPMS/ &amp;&gt;/dev/null
+                ;;
+        esac
+
+        done
+    done
+#   ln -f $PACKAGEDIR/*/*.$TAG.src.rpm $FTPDIR/$DISTPATH/$REPO/SRPMS/ &amp;&gt;/dev/null
 }
 
 function build_repo_yum {
-	local DISTPATH=&quot;$1&quot;
-
-	echo &quot;Building Yum repo.&quot;
-
-	### Build Yum repository
-#	yum-arch -q -z -d -c $FTPDIR/$DISTPATH/$REPO/
-	yum-arch -q -z $FTPDIR/$DISTPATH/$REPO/ &amp;&gt;/dev/null
+    local DISTPATH=&quot;$1&quot;
+
+    echo &quot;Building Yum repo.&quot;
+
+    ### Build Yum repository
+#   yum-arch -q -z -d -c $FTPDIR/$DISTPATH/$REPO/
+    yum-arch -q -z $FTPDIR/$DISTPATH/$REPO/ &amp;&gt;/dev/null
 }
 
 function build_repo {
-	local DISTPATH=&quot;$1&quot;
-	local REPODATA=&quot;$FTPDIR/$DISTPATH/$REPO/repodata/&quot;
-	local DISTDESC=&quot;$2&quot;
-
-	echo &quot;Building repomd.&quot;
-	if [ &quot;$DISTNICK&quot; ]; then
-		local RPMVER=&quot;$(chroot $CHROOTDIR/$DISTNICK rpm --version | cut -d' ' -f3)&quot;
-	fi
-
-	local OPTIONS=&quot;&quot;
-	if [ &quot;$RPMVER&quot; \&lt; &quot;4.2.1&quot; ]; then
-		OPTIONS=&quot;-n&quot;
-	fi
-
-	if [ -d &quot;$FTPDIR/$DISTPATH/$REPO/.olddata/&quot; ]; then
-		rm -rf &quot;$FTPDIR/$DISTPATH/$REPO/.olddata/&quot;
-	fi
-	if [ ! -d &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot; ]; then
-		mkdir -p &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot;
-	fi
-	createrepo -q $OPTIONS --checkts -c &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
-	sync
-	echo &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot; &gt;&quot;$REPODATA/repomd.xml&quot;
-	echo &quot;&lt;repomd xmlns=\&quot;<A HREF="http://linux.duke.edu/metadata/repo\">http://linux.duke.edu/metadata/repo\</A>&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-	for file in other filelists primary; do
-		echo &quot;### Generated by DAR, <A HREF="http://dag.wieers.com/home-made/dar/">http://dag.wieers.com/home-made/dar/</A>&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		echo &quot;  &lt;data type=\&quot;$file\&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		echo &quot;    &lt;location href=\&quot;repodata/$file.xml.gz\&quot;/&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		gunzip &quot;$REPODATA/$file.xml.gz&quot;
-		echo &quot;    &lt;open-checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml&quot; | cut -f1 -d' ')&lt;/open-checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		gzip -9 --rsyncable -f &quot;$REPODATA/$file.xml&quot;
-    		echo &quot;    &lt;checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml.gz&quot; | cut -f1 -d' ')&lt;/checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		echo &quot;    &lt;timestamp&gt;$(stat -c &quot;%Y&quot; &quot;$REPODATA/$file.xml.gz&quot;)&lt;/timestamp&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-		echo &quot;  &lt;/data&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-	done
-	echo &quot;&lt;/repomd&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
-
-#	echo &quot;Building repoview.&quot;
-#	repoview --quiet --title=&quot;RPMforge: $DISTDESC&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
-#	repoview --quiet --url=&quot;<A HREF="http://apt.sw.be/$DISTPATH/">http://apt.sw.be/$DISTPATH/</A>&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
+    local DISTPATH=&quot;$1&quot;
+    local REPODATA=&quot;$FTPDIR/$DISTPATH/$REPO/repodata/&quot;
+    local DISTDESC=&quot;$2&quot;
+
+    echo &quot;Building repomd.&quot;
+    if [ &quot;$DISTNICK&quot; ]; then
+        local RPMVER=&quot;$(chroot $CHROOTDIR/$DISTNICK rpm --version | cut -d' ' -f3)&quot;
+    fi
+
+    local OPTIONS=&quot;&quot;
+    if [ &quot;$RPMVER&quot; \&lt; &quot;4.2.1&quot; ]; then
+        OPTIONS=&quot;-n&quot;
+    fi
+
+    if [ -d &quot;$FTPDIR/$DISTPATH/$REPO/.olddata/&quot; ]; then
+        rm -rf &quot;$FTPDIR/$DISTPATH/$REPO/.olddata/&quot;
+    fi
+    if [ ! -d &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot; ]; then
+        mkdir -p &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot;
+    fi
+    createrepo -q $OPTIONS --checkts -c &quot;$TEMPDIR/.cache/createrepo/$DISTNICK/$REPO&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
+    sync
+    echo &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot; &gt;&quot;$REPODATA/repomd.xml&quot;
+    echo &quot;&lt;repomd xmlns=\&quot;<A HREF="http://linux.duke.edu/metadata/repo\">http://linux.duke.edu/metadata/repo\</A>&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+    for file in other filelists primary; do
+        echo &quot;### Generated by DAR, <A HREF="http://dag.wieers.com/home-made/dar/">http://dag.wieers.com/home-made/dar/</A>&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        echo &quot;  &lt;data type=\&quot;$file\&quot;&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        echo &quot;    &lt;location href=\&quot;repodata/$file.xml.gz\&quot;/&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        gunzip &quot;$REPODATA/$file.xml.gz&quot;
+        echo &quot;    &lt;open-checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml&quot; | cut -f1 -d' ')&lt;/open-checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        gzip -9 --rsyncable -f &quot;$REPODATA/$file.xml&quot;
+            echo &quot;    &lt;checksum type=\&quot;sha\&quot;&gt;$(sha1sum &quot;$REPODATA/$file.xml.gz&quot; | cut -f1 -d' ')&lt;/checksum&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        echo &quot;    &lt;timestamp&gt;$(stat -c &quot;%Y&quot; &quot;$REPODATA/$file.xml.gz&quot;)&lt;/timestamp&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+        echo &quot;  &lt;/data&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+    done
+    echo &quot;&lt;/repomd&gt;&quot; &gt;&gt;&quot;$REPODATA/repomd.xml&quot;
+
+#   echo &quot;Building repoview.&quot;
+#   repoview --quiet --title=&quot;RPMforge: $DISTDESC&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
+#   repoview --quiet --url=&quot;<A HREF="http://apt.sw.be/$DISTPATH/">http://apt.sw.be/$DISTPATH/</A>&quot; &quot;$FTPDIR/$DISTPATH/$REPO&quot;
 }
 
 function build_repo_srpms {
-	local DIR=&quot;$1&quot;
-
-	mkdir -p $FTPDIR/$DIR
-	echo $FTPDIR/$DIR/*.src.rpm | xargs rm -f
-	for tag in $TAGS; do
-		echo $PACKAGEDIR/*/*.$tag.src.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DIR/ &amp;&gt;/dev/null
-	done
-
-#	genbasedir --bloat --bz2only $FTPDIR/$DISTPATH/ $REPO
+    local DIR=&quot;$1&quot;
+
+    mkdir -p $FTPDIR/$DIR
+    echo $FTPDIR/$DIR/*.src.rpm | xargs rm -f
+    for tag in $TAGS; do
+        echo $PACKAGEDIR/*/*.$tag.src.rpm | xargs -n 1 | xargs -i ln -f {} $FTPDIR/$DIR/ &amp;&gt;/dev/null
+    done
+
+#   genbasedir --bloat --bz2only $FTPDIR/$DISTPATH/ $REPO
 }
 
 #export LD_ASSUME_KERNEL=&quot;2.4.9&quot;
@@ -561,12 +547,14 @@
 
 ### Main
 if [ -r &quot;$DARCONFIG&quot; ]; then
-	clean_env
-	source &quot;$DARCONFIG&quot;
+    clean_env
+    source &quot;$DARCONFIG&quot;
 else
-	die &quot;Cannot access configfile ($DARCONFIG).&quot;
+    die &quot;Cannot access configfile ($DARCONFIG).&quot;
 fi
 
 if [ -r ~/&quot;.dar.conf&quot; ]; then
-	source ~/&quot;.dar.conf&quot;
+    source ~/&quot;.dar.conf&quot;
 fi
+
+# vim:ts=4:sw=4:et

Added: trunk/tools/dar/dar-metadata
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-metadata?rev=9299&amp;view=markup">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-metadata?rev=9299&amp;view=markup</A>
==============================================================================
--- trunk/tools/dar/dar-metadata (added)
+++ trunk/tools/dar/dar-metadata Wed Nov 17 13:07:29 2010
@@ -1,0 +1,52 @@
+#!/bin/bash
+
+source &quot;/usr/share/dar/dar-functions&quot;
+
+function help {
+    cat &lt;&lt;EOF
+usage: dar-metadata [-q] [-v] [-d dist,dist2]
+Update local repository metadata
+
+dar-exec options:
+
+  -d dist,dist2         select build envs
+  -f                    force
+  -h                    this help message
+  -q                    be very quiet
+  -v                    more verbose
+
+EOF
+exit 1
+}
+
+daropts &quot;d:fhqv&quot; $@
+CMD=&quot;$OPTS&quot;
+
+if [ ! -d &quot;$ROOT&quot; ]; then
+    echo &quot;ERROR: probably in chroot jail&quot; &gt;&amp;2
+    exit 1
+fi
+
+set_dists
+for distname in $DISTS; do
+    if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
+        source &quot;$CONFIGDIR/dists/$distname/config&quot;
+
+        if [ -z &quot;$QUIET&quot; ]; then
+            echo -e &quot;$_BL_$_WH= Finding $_YE$DISTNAME$_WE/$_YE$DISTARCH$_WH packages...$_DE&quot;
+        fi
+
+        find /dar/packages/ \( -name &quot;*.$DISTNAME.rf.$DISTARCH.rpm&quot; -o -name &quot;*.$DISTNAME.rf.noarch.rpm&quot; \) -exec ln -f {} $MREPODIR/$MREPONAME/rpmforge/RPMS/ \;
+        find /dar/packages/ \( -name &quot;*.$DISTNAME.rfx.$DISTARCH.rpm&quot; -o -name &quot;*.$DISTNAME.rfx.noarch.rpm&quot; \) -exec ln -f {} $MREPODIR/$MREPONAME/rpmforge-extras/RPMS/ \;
+        find /dar/packages/ \( -name &quot;*.$DISTNAME.rft.$DISTARCH.rpm&quot; -o -name &quot;*.$DISTNAME.rft.noarch.rpm&quot; \) -exec ln -f {} $MREPODIR/$MREPONAME/rpmforge-testing/RPMS/ \;
+        if [ &quot;$QUIET&quot; -a &quot;$FORCE&quot; ]; then
+            mrepo -g -f -q $MREPONAME
+        elif [ &quot;$QUIET&quot; -a -z &quot;$FORCE&quot; ]; then
+            mrepo -g -q $MREPONAME
+        elif [ -z &quot;$QUIET&quot; -a &quot;$FORCE&quot; ]; then
+            mrepo -g -f -vv $MREPONAME
+        else
+            mrepo -g -vv $MREPONAME
+        fi
+    fi
+done

Propchange: trunk/tools/dar/dar-metadata
------------------------------------------------------------------------------
    svn:executable = *

Modified: trunk/tools/dar/dar-shell
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-shell?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-shell?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dar-shell (original)
+++ trunk/tools/dar/dar-shell Wed Nov 17 13:07:29 2010
@@ -33,10 +33,11 @@
 set_as_root
 AS_ROOT=1
 
-if [ -z &quot;$QUIET&quot; ]; then
-    echo -e &quot;$_BL_$_WH= Entering shells.$_DE&quot;
-fi
 for distname in $DISTS; do
+    if [ -z &quot;$QUIET&quot; ]; then
+        echo -e &quot;$_BL_$_WH= Entering $_YE$distname$_WH shell.$_DE&quot;
+    fi
+
     if [ -r &quot;$CONFIGDIR/dists/$distname/config&quot; ]; then
         source &quot;$CONFIGDIR/dists/$distname/config&quot;
         export arch=&quot;$DISTARCH&quot; dist=&quot;${DISTNAME// *}&quot; nick=&quot;$DISTNICK&quot; path=&quot;$DISTPATH&quot; repo=&quot;$REPO&quot; tag=&quot;${DISTTAG// *}&quot;
@@ -49,7 +50,7 @@
     fi
 done
 if [ -z &quot;$QUIET&quot; ]; then
-    echo -en &quot;$_BL_$_WH= Returning to parent shell. Press ENTER.$_DE&quot;
+    echo -en &quot;$_BL_$_WH= Returning to ${_YE}parent$_WH shell. Press ENTER.$_DE&quot;
     read a
 fi
 

Modified: trunk/tools/dar/dar-update
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-update?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar-update?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dar-update (original)
+++ trunk/tools/dar/dar-update Wed Nov 17 13:07:29 2010
@@ -4,7 +4,7 @@
 
 source &quot;/usr/share/dar/dar-functions&quot;
 
-daropts &quot;:a:d:rs:&quot; $@
+daropts &quot;:a:d:qrs:&quot; $@
 PKGS=&quot;$OPTS&quot;
 
 #DISTS=&quot;$DEFAULT_DISTS&quot;
@@ -21,10 +21,13 @@
     fi
 
     if [ &quot;$CREATE_REPO&quot; ]; then
-        echo &quot;Building $distname repository in $DISTPATH.&quot;
-        build_tree_apt &quot;$DISTNAME $DISTTAG&quot; &quot;$DISTPATH&quot;
-        build_repo_apt &quot;$DISTPATH&quot;
-#       build_repo_yum &quot;$DISTTAG&quot; &quot;$DISTPATH&quot;
+        if [ -z &quot;$QUIET&quot; ]; then
+            echo &quot;Building $distname repository in $DISTPATH.&quot;
+        fi
+        dar-metadata -q -d $distname
+#        build_tree_apt &quot;$DISTNAME $DISTTAG&quot; &quot;$DISTPATH&quot;
+#        build_repo_apt &quot;$DISTPATH&quot;
+#        build_repo_yum &quot;$DISTTAG&quot; &quot;$DISTPATH&quot;
     fi
 
     if [ &quot;$UPDATECMD&quot; ]; then
@@ -46,7 +49,9 @@
     if [ &quot;$INSTALLCMD&quot; -a &quot;$PKGS&quot; ]; then
         for pkg in $PKGS; do
             instcmd=&quot;$(echo $INSTALLCMD | sed -e &quot;s|%p|$pkg|g&quot;)&quot;
-            echo &quot;Installing $pkg in $distname.&quot;
+            if [ -z &quot;$QUIET&quot; ]; then
+                echo &quot;Installing $pkg in $distname.&quot;
+            fi
             chroot $CHROOTDIR/$distname $instcmd
             if [ -z &quot;$FORCE_VERBOSE&quot; ]; then
                 echo &quot;$instcmd&quot; | setarch $DISTARCH /usr/sbin/chroot &quot;$CHROOTDIR/$distname&quot; /bin/bash --login -s

Modified: trunk/tools/dar/dar.conf
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar.conf?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dar.conf?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dar.conf (original)
+++ trunk/tools/dar/dar.conf Wed Nov 17 13:07:29 2010
@@ -6,13 +6,14 @@
 STATEDIR=&quot;$FTPDIR/rpmforge/persona/dag/state&quot;
 SPECSDIR=&quot;$ROOT/rpms&quot;
 CHROOTDIR=&quot;$ROOT/chroot&quot;
+MREPODIR=&quot;$ROOT/mrepo&quot;
 
 BUILDDIR=&quot;$ROOT/build&quot;
 TEMPDIR=&quot;$ROOT/tmp&quot;
 
 #DEFAULT_DISTS=&quot;el4a el4i fc3a fc3i fc2a fc2i fc1i el3a el3i rh9i rh7i el2i&quot;
 #DEFAULT_DISTS=&quot;el5a el5i el4a el4i el3a el3i rh9i rh7i el2i&quot;
-DEFAULT_DISTS=&quot;el5a el5i el4a el4i el3a el3i el2i&quot;
+DEFAULT_DISTS=&quot;el6a el6i el5a el5i el4a el4i el3a el3i el2i&quot;
 DEFAULT_SOURCE_DISTS=&quot;el5i&quot;
 DEFAULT_ARCHS=&quot;i386&quot;
 DEFAULT_TAGS=&quot;rf dag&quot;

Modified: trunk/tools/dar/dists/el2i/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el2i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el2i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el2i/config (original)
+++ trunk/tools/dar/dists/el2i/config Wed Nov 17 13:07:29 2010
@@ -25,4 +25,6 @@
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
 
+MREPONAME=&quot;rhel2.1as-i386&quot;
+
 ASSUME_KERNEL=&quot;2.4.1&quot;

Modified: trunk/tools/dar/dists/el3a/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el3a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el3a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el3a/config (original)
+++ trunk/tools/dar/dists/el3a/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel3as-x86_64&quot;

Modified: trunk/tools/dar/dists/el3i/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el3i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el3i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el3i/config (original)
+++ trunk/tools/dar/dists/el3i/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel3as-i386&quot;

Modified: trunk/tools/dar/dists/el4a/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el4a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el4a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el4a/config (original)
+++ trunk/tools/dar/dists/el4a/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel4as-x86_64&quot;

Modified: trunk/tools/dar/dists/el4i/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el4i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el4i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el4i/config (original)
+++ trunk/tools/dar/dists/el4i/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel4as-i386&quot;

Modified: trunk/tools/dar/dists/el5a/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el5a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el5a/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el5a/config (original)
+++ trunk/tools/dar/dists/el5a/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel5s-x86_64&quot;

Modified: trunk/tools/dar/dists/el5i/config
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el5i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/dar/dists/el5i/config?rev=9299&amp;r1=9298&amp;r2=9299&amp;view=diff</A>
==============================================================================
--- trunk/tools/dar/dists/el5i/config (original)
+++ trunk/tools/dar/dists/el5i/config Wed Nov 17 13:07:29 2010
@@ -24,3 +24,5 @@
 REPO_APT=&quot;yes&quot;
 REPO_YUM=&quot;yes&quot;
 REPO_CREATEREPO=&quot;yes&quot;
+
+MREPONAME=&quot;rhel5s-i386&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008082.html">[svn] r9298 - in /trunk/rpms: perl-Algorithm-Diff/ perl-AppConfig/ perl-Archive-Extract/ perl-Archive-Tar/ perl-Authen-SASL/ perl-B-Keywords/ perl-BSD-Resource/ perl-Bit-Vector/ perl-Business-ISBN-Data/ perl-Business-ISBN/ perl-CGI-Persistent/ perl-CGI-Session/ perl-CGI/ perl-CSS-Tiny/ perl-Cache-Memcached/ perl-Carp-Clan/ perl-Class-Accessor/ perl-Class-Data-Inheritable/ perl-Class-Inspector/ perl-Class-Singleton/ perl-Class-Trigger/ perl-Clone/ perl-Compress-Raw-Zlib/ perl-Compress-Zlib/ perl-Config-General/ perl-Config-Simple/ perl-Config-Tiny/ perl-Convert-ASN1/ perl-Convert-BinHex/ perl-Crypt-OpenSSL-Bignum/ perl-Crypt-OpenSSL-RSA/ perl-Crypt-OpenSSL-Random/ perl-Crypt-PasswdMD5/ perl-Crypt-SSLeay/ perl-DBD-Pg/ perl-DBD-SQLite/ perl-DBI/ perl-DBIx-Simple/ perl-DB_File/ perl-Data-OptList/ perl-Date-Calc/ perl-Date-Manip/ perl-DateTime-Format-DateParse/ perl-DateTime-Format-Mail/ perl-DateTime-Format-W3CDTF/ perl-DateTime/ perl-Devel-Cover/ perl-Devel-Cycle/ perl-Devel-Leak/ perl-Devel-StackTrace/ perl-Devel-Symdump/ perl-Digest-BubbleBabble/ perl-Digest-HMAC/ perl-Digest-MD5/ perl-Digest-SHA/ perl-Digest-SHA1/
</A></li>
	<LI>Next message: <A HREF="008084.html">[svn] r9300 - /trunk/rpms/perl-NetAddr-IP/perl-NetAddr-IP.spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8083">[ date ]</a>
              <a href="thread.html#8083">[ thread ]</a>
              <a href="subject.html#8083">[ subject ]</a>
              <a href="author.html#8083">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
