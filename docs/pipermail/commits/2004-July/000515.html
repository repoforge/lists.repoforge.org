<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SVN] r1706 - in trunk/tools: . yam yam/html yam/old
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1706%20-%20in%20trunk/tools%3A%20.%20yam%20yam/html%20yam/old&In-Reply-To=%3C20040721182431.093951FCAA%40server01.nl.egwn.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000514.html">
   <LINK REL="Next"  HREF="000516.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SVN] r1706 - in trunk/tools: . yam yam/html yam/old</H1>
    <B>svn-commits at rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5BSVN%5D%20r1706%20-%20in%20trunk/tools%3A%20.%20yam%20yam/html%20yam/old&In-Reply-To=%3C20040721182431.093951FCAA%40server01.nl.egwn.net%3E"
       TITLE="[SVN] r1706 - in trunk/tools: . yam yam/html yam/old">svn-commits at rpmforge.net
       </A><BR>
    <I>Wed Jul 21 20:24:31 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000514.html">[SVN] r1705 - trunk/tools/dar
</A></li>
        <LI>Next message: <A HREF="000516.html">[SVN] r1707 - trunk/rpms/perl-MD5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#515">[ date ]</a>
              <a href="thread.html#515">[ thread ]</a>
              <a href="subject.html#515">[ subject ]</a>
              <a href="author.html#515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2004-07-21 20:24:29 +0200 (Wed, 21 Jul 2004)
New Revision: 1706

Added:
   trunk/tools/yam/
   trunk/tools/yam/AUTHORS
   trunk/tools/yam/COPYING
   trunk/tools/yam/ChangeLog
   trunk/tools/yam/Makefile
   trunk/tools/yam/README
   trunk/tools/yam/README.dhcpd
   trunk/tools/yam/README.dnsmasq
   trunk/tools/yam/THANKS
   trunk/tools/yam/TODO
   trunk/tools/yam/dnsmasq-yam.conf
   trunk/tools/yam/html/
   trunk/tools/yam/html/HEADER.index.shtml
   trunk/tools/yam/html/HEADER.repo.shtml
   trunk/tools/yam/html/README.index.shtml
   trunk/tools/yam/old/
   trunk/tools/yam/old/yam.mk
   trunk/tools/yam/yam
   trunk/tools/yam/yam.conf
   trunk/tools/yam/yam.httpd
   trunk/tools/yam/yam.spec
   trunk/tools/yam/yam.sysv
Log:
Initial import of Yam so other people can work on it.


Added: trunk/tools/yam/AUTHORS
===================================================================
--- trunk/tools/yam/AUTHORS	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/AUTHORS	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1 @@
+Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;

Added: trunk/tools/yam/COPYING
===================================================================
--- trunk/tools/yam/COPYING	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/COPYING	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,340 @@
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+     59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The &quot;Program&quot;, below,
+refers to any such program or work, and a &quot;work based on the Program&quot;
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term &quot;modification&quot;.)  Each licensee is addressed as &quot;you&quot;.
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and &quot;any
+later version&quot;, you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+			    NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+	    How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the &quot;copyright&quot; line and a pointer to where the full notice is found.
+
+    &lt;one line to give the program's name and a brief idea of what it does.&gt;
+    Copyright (C) &lt;year&gt;  &lt;name of author&gt;
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year  name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a &quot;copyright disclaimer&quot; for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  &lt;signature of Ty Coon&gt;, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Library General
+Public License instead of this License.

Added: trunk/tools/yam/ChangeLog
===================================================================
--- trunk/tools/yam/ChangeLog	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/ChangeLog	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,15 @@
+* 0.4
+- Added noarch by default to all dists
+
+* 0.3
+- Remove dangling symlinks (crashes yum/apt)
+- Improved symlinking code
+- Add -g/--generate and --unmount options for more finegrained commands
+- Added Yam httpd configuration for Apache
+- Added serverside HTML pages and file-descriptions
+- Added ISO-directory in repository
+- Added information to integrate with dnsmasq (on-going)
+- Added SYSV script to automatically mount on boot and unmount on shutdown
+
+* 0.2
+- Initial public release

Added: trunk/tools/yam/Makefile
===================================================================
--- trunk/tools/yam/Makefile	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/Makefile	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,30 @@
+prefix = /usr
+sysconfdir = /etc
+bindir = $(prefix)/bin
+sbindir = $(prefix)/sbin
+libdir = $(prefix)/lib
+datadir = $(prefix)/share
+mandir = $(datadir)/man
+localstatedir = /var
+
+httpddir = $(sysconfdir)/httpd/conf.d
+initrddir = $(sysconfdir)/rc.d/init.d
+htmldir = $(libdir)/yam/html
+
+all: install
+
+install:
+	install -D -m0644 yam.conf $(DESTDIR)$(sysconfdir)/yam.conf
+	install -D -m0755 yam $(DESTDIR)$(bindir)/yam
+	install -D -m0644 yam.httpd $(DESTDIR)$(httpddir)/yam.conf
+	install -D -m0755 yam.sysv $(DESTDIR)$(initrddir)/yam
+
+	install -d -m0755 $(DESTDIR)$(htmldir)
+	install -m0644 html/* $(DESTDIR)$(htmldir)
+
+	
+	@if [ &quot;$(prefix)&quot; == &quot;/usr&quot; -a -x &quot;/sbin/chkconfig&quot; ]; then \
+		/sbin/chkconfig --add yam; \
+	elif [ -x &quot;$(sbindir)/chkconfig&quot; ]; then \
+		$(sbindir)/chkconfig --add yam; \
+	fi

Added: trunk/tools/yam/README
===================================================================
--- trunk/tools/yam/README	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/README	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1 @@
+Placeholder for a real README.

Added: trunk/tools/yam/README.dhcpd
===================================================================
--- trunk/tools/yam/README.dhcpd	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/README.dhcpd	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1 @@
+Placeholder.

Added: trunk/tools/yam/README.dnsmasq
===================================================================
--- trunk/tools/yam/README.dnsmasq	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/README.dnsmasq	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,22 @@
+To set up yam with dnsmasq, put the example dnsmasq-yam.conf configfile
+as /etc/dnsmasq-yam.conf and add the following line to /etc/dnsmasq.conf:
+
+	conf-file /etc/dnsmasq-yam.conf
+
+Then adapt /etc/dnsmasq-yam.conf to your preferences.
+
+For DNS to work, add all systems to /etc/hosts. To map a host to a fixed
+IP address with DHCP, add the MAC-address and hostname/ip-address to
+/etc/ethers. eg.
+
+	/etc/hosts:
+
+	127.0.0.1	localhost
+	10.0.0.1	yam
+	10.0.0.10	host1
+	10.0.0.11	host2
+
+
+	/etc/ethers:
+	00:0B:1C:2D:3E:4F	host1
+	00:0B:1A:29:38:48	host2

Added: trunk/tools/yam/THANKS
===================================================================
--- trunk/tools/yam/THANKS	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/THANKS	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,4 @@
+This tool is my first python program.
+
+It is dedicated to Ryan Carrico, who kindly donated
+a Python book to me from my Amazon wishlist.

Added: trunk/tools/yam/TODO
===================================================================
--- trunk/tools/yam/TODO	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/TODO	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,10 @@
++ Change file permissiones of packages in RPMS.extras, RPMS.updates and RPMS.dag
++ Adapt to work with SLES, Mandrake, Whitebox, ...
++ Think of a way to speed up generating repositories
++ Create information about repository-updates in HEADER.shtml/README.shtml
++ Improve updates/extras mirroring code (use rsync or add <A HREF="rsync://">rsync://</A> to lftp)
++ Add CSM support
++ Add integration/documentation with ISC dhcpd
++ Improve SHTML output (more condensed and useful information)
++ Add default kickstart files/location
++ Improve the copy/symlink/rename functions, using exceptions

Added: trunk/tools/yam/dnsmasq-yam.conf
===================================================================
--- trunk/tools/yam/dnsmasq-yam.conf	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/dnsmasq-yam.conf	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,5 @@
+### Red Hat Enterprise 3 for x86
+dhcp-boot=/yam/rhes3-i386/pxelinux.0,emyn,10.0.0.1
+
+### Fedora Core 2 for x86
+#dhcp-boot=/yam/fc2-i386/pxelinux.0,emyn,10.0.0.1

Added: trunk/tools/yam/html/HEADER.index.shtml
===================================================================
--- trunk/tools/yam/html/HEADER.index.shtml	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/html/HEADER.index.shtml	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,4 @@
+&lt;h1&gt;Yam RPM Mirror on &lt;!--#echo var=&quot;SERVER_NAME&quot; --&gt; (&lt;!--#echo var=&quot;SERVER_ADDR&quot; --&gt;)&lt;/h1&gt;
+The subdirectories below are created and managed by &lt;b&gt;Yam&lt;/b&gt;. They contain RPM repositories
+for use with Apt and Yum, directories to allow for remote network installs, as well as
+ISO files for people to download and burn to disc.

Added: trunk/tools/yam/html/HEADER.repo.shtml
===================================================================
--- trunk/tools/yam/html/HEADER.repo.shtml	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/html/HEADER.repo.shtml	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,17 @@
+&lt;h1&gt;Yam RPM Mirror at &lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt;&lt;/h1&gt;
+
+&lt;u&gt;Network installation&lt;/u&gt;: Select &quot;HTTP installation method&quot; &amp;raquo; &quot;&lt;!--#echo var=&quot;SERVER_NAME&quot; --&gt;&quot; &amp;raquo; &quot;&lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt;&quot; during installation&lt;br&gt;
+
+&lt;!-- To install Red Hat from the network, select the &lt;b&gt;HTTP installation method&lt;/b&gt; and then specify for Web site name: &lt;b&gt;&lt;!--#echo var=&quot;SERVER_NAME&quot; --&gt;&lt;/b&gt; or &lt;b&gt;&lt;!--#echo var=&quot;SERVER_ADDR&quot; --&gt;&lt;/b&gt; and as Red Hat directory: &lt;b&gt;&lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt;&lt;/b&gt;.&lt;br&gt; --&gt;
+
+&lt;u&gt;Apt configuration&lt;/u&gt;: Add &quot;rpm <A HREF="http://&lt;!--#echo">http://&lt;!--#echo</A> var=&quot;SERVER_NAME&quot; --&gt; &lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt; os updates &lt;i&gt;repo1 repo2 ...&lt;/i&gt;&quot; to /etc/apt/sources.list&lt;br&gt;
+
+&lt;!-- The configuration of this Apt repository is:
+&lt;nobr&gt;&lt;b&gt;rpm <A HREF="http://&lt;!--#echo">http://&lt;!--#echo</A> var=&quot;SERVER_NAME&quot; --&gt; &lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt; &lt;i&gt;os&lt;/i&gt; &lt;i&gt;updates&lt;/i&gt; &lt;i&gt;extras&lt;/i&gt; &lt;i&gt;&amp;lt;repo&amp;gt;&lt;/i&gt;&lt;/b&gt;&lt;/nobr&gt;&lt;br&gt; --&gt;
+
+&lt;u&gt;Yum configuration&lt;/u&gt;: Add &quot;baseurl=<A HREF="http://&lt;!--#echo">http://&lt;!--#echo</A> var=&quot;SERVER_NAME&quot; --&gt;&lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt;RPMS.&lt;i&gt;repo&lt;/i&gt;&quot; to /etc/yum.conf&lt;br&gt;
+
+&lt;!-- The configuration of this Yum repository is:
+&lt;nobr&gt;&lt;b&gt;baseurl=<A HREF="http://&lt;!--#echo">http://&lt;!--#echo</A> var=&quot;SERVER_NAME&quot; --&gt;&lt;!--#echo var=&quot;REQUEST_URI&quot; --&gt;RPMS.&lt;i&gt;&amp;lt;repo&amp;gt;&lt;/i&gt;&lt;/b&gt;&lt;/nobr&gt;&lt;br&gt; --&gt;
+
+&lt;!-- For more information see the &lt;b&gt;Yam&lt;/b&gt; documentation or the &lt;a href=&quot;<A HREF="http://dag.wieers.com/home-made/yam/">http://dag.wieers.com/home-made/yam/</A>&quot;&gt;&lt;b&gt;Yam&lt;/b&gt; website&lt;/a&gt;. --&gt;

Added: trunk/tools/yam/html/README.index.shtml
===================================================================
--- trunk/tools/yam/html/README.index.shtml	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/html/README.index.shtml	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,3 @@
+&lt;!-- &lt;!--#echo var=&quot;SERVER_SOFTWARE&quot; --&gt; at &lt;!--#echo var=&quot;SERVER_NAME&quot; --&gt; Port &lt;!--#echo var=&quot;SERVER_PORT&quot; --&gt;&lt;br&gt; --&gt;
+For more information see the &lt;b&gt;Yam&lt;/b&gt; documentation or the &lt;a href=&quot;<A HREF="http://dag.wieers.com/home-made/yam/">http://dag.wieers.com/home-made/yam/</A>&quot;&gt;&lt;b&gt;Yam&lt;/b&gt; website&lt;/a&gt;.
+&lt;b&gt;Yam&lt;/b&gt; was written by &lt;a href=&quot;<A HREF="http://dag.wieers.com/">http://dag.wieers.com/</A>&quot;&gt;Dag Wieers&lt;/a&gt;.

Added: trunk/tools/yam/old/yam.mk
===================================================================
--- trunk/tools/yam/old/yam.mk	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/old/yam.mk	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,315 @@
+isodir=/mnt/iso
+xnldir=/var/www/xnl
+tftpdir=/tftpboot/xnl
+pxelinux=/usr/lib/syslinux/pxelinux.0
+
+RHNUSER=<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
+LOGNAME=$(shell logname)
+
+all: mount-all update-all build-all pxe-all
+
+umount: umount-all
+mount: mount-all
+update: update-all
+pxe: pxe-all
+build: build-all
+
+mount-all: umount-all m-fc1-i386 m-fc1-AMD64 m-tao1-i386 m-rhas3-i386 m-rhes3-i386 m-rhws3-i386 m-rhas3-AMD64 m-rhas21 m-rh73
+#mount-all: umount-all m-fc1-i386 m-rhas3-i386 m-rh73
+### Disable unsupported distributions (rh62, rh73)
+#update-all: u-fc1-i386 u-fc1-AMD64
+update-all: u-fc1-i386 u-tao1-i386 u-rh73
+build-all: b-fc1-i386 b-fc1-AMD64 b-tao1-i386 b-rhas3-i386 b-rhes3-i386 b-rhws3-i386 b-rhas3-AMD64 b-rhas21
+#build-all: b-fc1-i386 b-tao3-i386 b-rhas3-i386 b-rh73
+
+pxe-all: x-fc1-i386 x-fc1-AMD64 x-tao1-i386 x-rhas3-i386 x-rhes3-i386 x-rhws3-i386 x-rhas3-AMD64 x-rhas21 x-rh73
+
+umount-all:
+	-umount $(xnldir)/*/disc?/ &amp;&gt;/dev/null
+	<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">- at for</A> i in $(shell seq 1 256); do losetup -d /dev/loop$$i; done &amp;&gt;/dev/null
+
+### Red Hat Fedora Core 1 (i386)
+m-fc1-i386: dist=$(subst m-,,$@)
+m-fc1-i386:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3}
+	mount -o loop $(isodir)/yarrow-i386-disc1.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/yarrow-i386-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/yarrow-i386-disc3.iso $(xnldir)/$(dist)/disc3/
+
+u-fc1-i386: dist=$(subst u-,,$@)
+u-fc1-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="http://ayo.freshrpms.net/fedora/linux/1/i386/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/1/i386/RPMS.updates/</A> $(xnldir)/$(dist)/RPMS.updates'
+
+b-fc1-i386: dist=$(subst b-,,$@)
+b-fc1-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3}/Fedora/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-fc1-i386: dist=$(subst x-,,$@)
+x-fc1-i386:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### TaoLinux 1 (i386)
+m-tao1-i386: dist=$(subst m-,,$@)
+m-tao1-i386:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3}
+	mount -o loop $(isodir)/mooch-i386-disc1.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/mooch-i386-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/mooch-i386-disc3.iso $(xnldir)/$(dist)/disc3/
+
+u-tao1-i386: dist=$(subst u-,,$@)
+u-tao1-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="http://dist.taolinux.org/tao-1.0/updates/">http://dist.taolinux.org/tao-1.0/updates/</A> $(xnldir)/$(dist)/RPMS.updates'
+
+b-tao1-i386: dist=$(subst b-,,$@)
+b-tao1-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3}/Tao/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-tao1-i386: dist=$(subst x-,,$@)
+x-tao1-i386:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Fedora Core 1 (x86_64)
+m-fc1-AMD64: dist=$(subst m-,,$@)
+m-fc1-AMD64:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3}
+	mount -o loop $(isodir)/yarrow-x86_64-disc1.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/yarrow-x86_64-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/yarrow-x86_64-disc3.iso $(xnldir)/$(dist)/disc3/
+
+u-fc1-AMD64: dist=$(subst u-,,$@)
+u-fc1-AMD64:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="http://ayo.freshrpms.net/fedora/linux/1/x86_64/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/1/x86_64/RPMS.updates/</A> $(xnldir)/$(dist)/RPMS.updates'
+
+b-fc1-AMD64: dist=$(subst b-,,$@)
+b-fc1-AMD64:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3}/Fedora/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-fc1-AMD64: dist=$(subst x-,,$@)
+x-fc1-AMD64:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Enterprise Linux 3 (i386)
+m-rhel3-i386: dist=$(subst m-,,$@)
+m-rhel3-i386:
+	mkdir -p $(xnldir)/$(dist)/disc{2,3,4}/
+	mount -o loop $(isodir)/rhel-3-i386-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/rhel-3-i386-disc3.iso $(xnldir)/$(dist)/disc3/
+	mount -o loop $(isodir)/rhel-3-i386-disc4.iso $(xnldir)/$(dist)/disc4/
+
+	mkdir -p $(xnldir)/$(dist)/RPMS.extras/
+
+
+### Red Hat Advanced Server 3 (i386)
+m-rhas3-i386: dist=$(subst m-,,$@)
+m-rhas3-i386: m-rhel3-i386
+	mkdir -p $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/rhel-3-U1-i386-as-disc1.iso $(xnldir)/$(dist)/disc1/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/ $(xnldir)/$(dist)/
+
+b-rhas3-i386: dist=$(subst b-,,$@)
+b-rhas3-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.os,.updates}/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/rhel3-i386/RPMS.extras/ $(xnldir)/$(dist)/
+
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/Updates/*.rpm $(xnldir)/$(dist)/RPMS.updates/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rhas3-i386: dist=$(subst x-,,$@)
+x-rhas3-i386:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Enterprise Server 3 (i386)
+m-rhes3-i386: dist=$(subst m-,,$@)
+m-rhes3-i386: m-rhel3-i386
+	mkdir -p $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/rhel-3-U1-i386-es-disc1.iso $(xnldir)/$(dist)/disc1/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/ $(xnldir)/$(dist)/
+
+b-rhes3-i386: dist=$(subst b-,,$@)
+b-rhes3-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/rhel3-i386/RPMS.extras/ $(xnldir)/$(dist)/
+
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/Updates/*.rpm $(xnldir)/$(dist)/RPMS.updates/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rhes3-i386: dist=$(subst x-,,$@)
+x-rhes3-i386:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Work Station 3 (i386)
+m-rhws3-i386: dist=$(subst m-,,$@)
+m-rhws3-i386: m-rhel3-i386
+	mkdir -p $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/rhel-3-U1-i386-ws-disc1.iso $(xnldir)/$(dist)/disc1/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/ $(xnldir)/$(dist)/
+
+b-rhws3-i386: dist=$(subst b-,,$@)
+b-rhws3-i386:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/rhel3-i386/disc{2,3,4}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/rhel3-i386/RPMS.extras/ $(xnldir)/$(dist)/
+
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/Updates/*.rpm $(xnldir)/$(dist)/RPMS.updates/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rhws3-i386: dist=$(subst x-,,$@)
+x-rhws3-i386:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Advanced Server 3 (AMD64)
+m-rhas3-AMD64: dist=$(subst m-,,$@)
+m-rhas3-AMD64:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3,4}/
+	mount -o loop $(isodir)/rhel-3-U1-AMD64-as-disc1.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/rhel-3-AMD64-as-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/rhel-3-AMD64-as-disc3.iso $(xnldir)/$(dist)/disc3/
+	mount -o loop $(isodir)/rhel-3-AMD64-as-disc4.iso $(xnldir)/$(dist)/disc4/
+
+u-rhas3-AMD64:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="https://$(RHNUSER">https://$(RHNUSER</A>)@rhn.redhat.com/ $(xnldir)/rh73/RPMS.updates'
+
+b-rhas3-AMD64: dist=$(subst b-,,$@)
+b-rhas3-AMD64:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3,4}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/disc1/RedHat/Updates/*.rpm $(xnldir)/$(dist)/RPMS.updates/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rhas3-AMD64: dist=$(subst x-,,$@)
+x-rhas3-AMD64:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/{initrd.img,vmlinuz} $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat 7.3
+m-rh73: dist=$(subst m-,,$@)
+m-rh73:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3}
+	mount -o loop $(isodir)/valhalla-i386-disc1.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/valhalla-i386-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/valhalla-i386-disc3.iso $(xnldir)/$(dist)/disc3/
+
+u-rh73: dist=$(subst u-,,$@)
+u-rh73:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="http://ayo.freshrpms.net/redhat/7.3/i386/RPMS.updates/">http://ayo.freshrpms.net/redhat/7.3/i386/RPMS.updates/</A> $(xnldir)/$(dist)/RPMS.updates'
+
+b-rh73: dist=$(subst b-,,$@)
+b-rh73:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rh73: dist=$(subst x-,,$@)
+x-rh73:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/initrd-everything.img $(tftpdir)/$(dist)/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/vmlinuz $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat Advanced Server 2.1
+m-rhas21: dist=$(subst m-,,$@)
+m-rhas21:
+	mkdir -p $(xnldir)/$(dist)/disc{1,2,3}/
+	mount -o loop $(isodir)/RHEL2.1AS-U3-re1215.RC1.0-i386-disc1-update.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/RHEL2.1AS-U3-re1215.RC1.0-i386-disc2.iso $(xnldir)/$(dist)/disc2/
+	mount -o loop $(isodir)/RHEL2.1AS-U3-re1215.RC1.0-i386-disc3.iso $(xnldir)/$(dist)/disc3/
+
+b-rhas21: dist=$(subst b-,,$@)
+b-rhas21:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2,3}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+x-rhas21: dist=$(subst x-,,$@)
+x-rhas21:
+	mkdir -p $(tftpdir)/$(dist)/pxelinux.cfg/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/initrd-everything.img $(tftpdir)/$(dist)/
+	cp -a $(xnldir)/$(dist)/disc1/images/pxeboot/vmlinuz $(tftpdir)/$(dist)/
+	cp -a $(pxelinux) $(tftpdir)/$(dist)/
+
+
+### Red Hat 6.2
+m-rh62: dist=$(subst m-,,$@)
+m-rh62:
+	mkdir -p $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/redhat-6.2-i386.iso $(xnldir)/$(dist)/disc1/
+	mount -o loop $(isodir)/Powertools-6.2-i386.iso $(xnldir)/$(dist)/disc2/
+
+u-rh62: dist=$(subst u-,,$@)
+u-rh62:
+	mkdir -p $(xnldir)/$(dist)/RPMS.updates/
+	lftp -c 'mirror -r <A HREF="ftp://ftp.redhat.com/pub/redhat/linux/updates/6.2/en/os/*/">ftp://ftp.redhat.com/pub/redhat/linux/updates/6.2/en/os/*/</A> $(xnldir)/$(dist)/RPMS.updates'
+	lftp -c 'mirror -r <A HREF="ftp://ftp.redhat.com/pub/redhat/linux/updates/6.2/en/powertools/*/">ftp://ftp.redhat.com/pub/redhat/linux/updates/6.2/en/powertools/*/</A> $(xnldir)/$(dist)/RPMS.updates'
+
+b-rh62: dist=$(subst b-,,$@)
+b-rh62:
+	mkdir -p $(xnldir)/$(dist)/RPMS{,.extras,.os,.updates}/
+	ln -sf $(xnldir)/$(dist)/disc{1,2}/RedHat/RPMS/*.rpm $(xnldir)/$(dist)/RPMS.os/
+	ln -sf $(xnldir)/$(dist)/RPMS.{os,updates,extras}/*.rpm $(xnldir)/$(dist)/RPMS/
+
+	genbasedir --progress --flat --bloat --bz2only $(xnldir)/$(dist) os updates extras
+
+
+delta:
+	rsync -avHl --progress --delete-after -e &quot;/usr/bin/ssh -oCompression=no&quot; $(xnldir)/* $(LOGNAME)@delta.be.ibm.com:$(xnldir)
+
+cars:
+	nc -i 1 esni.be.ibm.com 259
+
+esni:
+	rsync -avHL --progress --delete-after -e &quot;/usr/bin/ssh -oCompression=no&quot; $(xnldir)/* <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">be03774 at aix.be.ibm.com</A>:/var/ftp/pub/linux

Added: trunk/tools/yam/yam
===================================================================
--- trunk/tools/yam/yam	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/yam	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,426 @@
+#!/usr/bin/python
+
+import os, sys, glob, string, re, filecmp, shutil, getopt
+import ConfigParser, urlparse
+
+class options:
+	def __init__(self, args):
+		self.configfile = None
+		self.debug = None
+		self.dists = None
+		self.generate = False
+		self.quiet = False
+		self.repos = None
+		self.update = False
+		self.verbose = False
+		self.extra = False
+		self.umount = False
+
+		try:
+			opts, args = getopt.getopt (args, 'c:d:ghqr:uvx',
+                                    ['config=', 'dists=', 'generate=', 'help', 'quiet', 'repos=', 'umount', 'update', 'verbose', 'extras'])
+		except getopt.error, exc:
+			die(5, 'error: %s' % str(exc))
+
+		for opt, arg in opts:
+			if opt in ('-c', '--config'):
+				self.configfile = arg
+			elif opt in ('-d', '--dists'):
+				self.dists = arg.split(',')
+			elif opt in ('-g', '--generate'):
+				self.generate = True
+			elif opt in ('-h', '--help'):
+				self.usage()
+				self.help()
+				sys.exit(0)
+			elif opt in ('-q', '--quiet'):
+				self.quiet = True
+			elif opt in ('-r', '--repos'):
+				self.repos = arg.split(',')
+			elif opt in ('-u', '--update'):
+				self.update = True
+			elif opt in ('-v', '--verbose'):
+				self.verbose = True
+			elif opt in ('-x', '--extras'):
+				self.extra = True
+			elif opt in ('-x', '--umount'):
+				self.umount = True
+
+	def usage(self):
+		print 'usage: yam [-g] [-q] [-u] [-v] [-x] [-c config] [-d dist1,dist2]'
+
+	def help(self):
+		print '''Set up a distribution server from ISO files
+
+Yam options:
+  -c, --config=file     specify alternative configfile
+  -d, --dists=dist      specify distributions
+  -g, --generate	generate repositories
+  -q, --quiet           minimal output
+  -u, --update		fetch updates (if possible)
+  -v, --verbose		be more verbose
+  -x, --extras		fetch extras (if possible)
+      --unmount		unmount distributions
+'''
+		
+class config:
+	def __init__(self):
+		if op.configfile:
+			self.configfile = op.configfile
+		else:
+			self.configfile = '/etc/yam.conf'
+		self.cfg = ConfigParser.ConfigParser()
+		(s,b,p,q,f,o) = urlparse.urlparse(self.configfile)
+		if s in ('http', 'ftp', 'file'):
+			configfh = urllib.urlopen(self.configfile)
+			try:
+				self.cfg.readfp(configfh)
+			except ConfigParser.MissingSectionHeaderError, e:
+				die(6, 'Error accessing URL: %s' % self.configfile)
+		else:
+			if os.access(self.configfile, os.R_OK):
+				self.cfg.read(self.configfile)
+			else:
+				die(6, 'Error accessing file: %s' % self.configfile)
+
+		self.htmldir = self.getoption('main', 'htmldir', '/usr/lib/yam/html')
+		self.isodir = self.getoption('main', 'isodir', '/mnt/iso')
+		self.lockfile = self.getoption('main', 'lockfile', '/var/run/yam.pid')
+		self.pxelinux = self.getoption('main', 'pxelinux', '/usr/lib/syslinux/pxelinux.0')
+		self.tftpdir = self.getoption('main', 'tftpdir', '/tftpboot/yam')
+		self.yamdir = self.getoption('main', 'yamdir', '/var/www/yam')
+
+		self.apt = not self.getoption('main', 'apt', 'yes') in ('no', 'off', 'false')
+		self.yum = not self.getoption('main', 'yum', 'yes') in ('no', 'off', 'false')
+
+		self.genbasedircmd = self.getoption('main', 'genbasedircmd', '/usr/bin/genbasedir')
+		self.lftpcmd = self.getoption('main', 'lftpcmd', '/usr/bin/lftp')
+		self.mountcmd = self.getoption('main', 'mountcmd', '/bin/mount')
+		self.umountcmd = self.getoption('main', 'umountcmd', '/bin/umount')
+		self.yumarchcmd = self.getoption('main', 'yumarchcmd', '/usr/bin/yum-arch')
+
+		self.extras = self.getextras()
+		self.dists = self.getsections()
+
+	def getoption(self, section, option, var):
+		&quot;Get an option from a section from configfile&quot;
+		try:
+			var = self.cfg.get(section, option)
+		except ConfigParser.NoSectionError, e:
+			print 'Failed to find section: %s' % section
+		except ConfigParser.NoOptionError, e:
+			if not var:
+				debug('Failed to find option %s in section %s' % (option, section))
+				pass
+		debug('Setting config %s in section %s to %s' % (option, section, var))
+		return var
+
+	def getsections(self):
+		&quot;Get all non-main/extras sections from configfile&quot;
+		list={}
+		for section in self.cfg.sections():
+			if section in [ 'main', 'extras']:
+				continue
+			list[section] = {}
+			if self.getoption(section, 'arch', None):
+				list[section]['arch'] = self.getoption(section, 'arch', ('i386', 'i586', 'i686')).split()
+			if self.getoption(section, 'iso', None):
+				list[section]['iso'] = self.getoption(section, 'iso', None).split()
+			list[section]['subdir'] = self.getoption(section, 'subdir', 'RedHat')
+			if self.getoption(section, 'tag', None):
+				list[section]['tag'] = self.getoption(section, 'tag', None).split()
+			list[section]['updates'] = self.getoption(section, 'updates', None)
+		if list == {}:
+			die(2, 'No distribution sections defined')
+		return list
+
+	def getisos(self, dist):
+		&quot;Return all ISOs for a distribution&quot;
+		isos=[]
+		if self.dists[dist].has_key('iso'):
+			for file in self.dists[dist]['iso']:
+				for iso in glob.glob(self.isodir + '/' + file):
+					isos.append(iso)
+		return isos
+
+	def getextras(self):
+		&quot;Return all extra repositories&quot;
+		extras={}
+		for opt in self.cfg.options('extras'):
+			if self.getoption('extras', opt, None):
+				extras[opt]=self.getoption('extras', opt, None).split()
+		return extras
+
+def info(str):
+	&quot;Output info message&quot;
+	if op.verbose and not op.quiet:
+		print str
+
+def debug(str):
+	&quot;Output debugging message&quot;
+	if op.debug:
+		print 'DEBUG:', str
+
+def die(ret, str):
+	&quot;Print error and exit with errorcode&quot;
+	print str
+	sys.exit(ret)
+
+def readfile(file, len = 0):
+	&quot;Return content of a file&quot;
+	if len: return open(file, 'r').read(len)
+	return open(file, 'r').read()
+
+def is_mounted(dev):
+	&quot;Check whether a device/file is mounted&quot;
+	for entry in readfile('/etc/mtab').split('\n'):
+		if entry != '':
+			list = entry.split()
+			if dev == list[0]:
+				return True
+	return False
+
+def cleanup(*targets):
+	&quot;Remove RPM packages from multiple targets&quot;
+	for target in targets:
+		if os.path.exists(target) and not os.path.isdir(target):
+			remove(target)
+		if not os.path.exists(target):
+			mkdir(target)
+			continue
+		for file in glob.glob(target + '/*.rpm'):
+			remove(file)
+
+def symlinkglob(str, *targets):
+	&quot;Symlink files to multiple targets&quot;
+	for file in glob.glob(str):
+		for target in targets:
+			mkdir(target)
+			symlink(file, target)
+
+def symlink(src, dst):
+	&quot;Create a symbolic link, force if dst exists&quot;
+	if not os.path.islink(dst) and os.path.isdir(dst):
+		dst += '/' + os.path.basename(src)
+	if os.path.isfile(dst) and filecmp.cmp(src, dst) == 0:
+		os.unlink(dst)
+	if os.path.islink(dst):
+		os.unlink(dst)
+	mkdir(os.path.dirname(dst))
+	if not os.path.exists(dst):
+		os.symlink(src, dst)
+
+def copy(src, dst):
+	&quot;Copy a file, force if dst exists&quot;
+	if os.path.isdir(dst):
+		dst += '/' + os.path.basename(src) 
+	if os.path.islink(dst) or os.path.isfile(dst):
+		os.unlink(dst)
+	mkdir(os.path.dirname(dst))
+	if not os.path.exists(dst):
+		shutil.copy2(src, dst)
+
+def remove(dst):
+	os.unlink(dst)
+
+def mkdir(path):
+	&quot;Create a directory, and parents if needed&quot;
+	if not os.path.exists(path):
+		os.makedirs(path)
+
+def mountpoint(dev):
+	&quot;Return the mountpoint of a mounted device/file&quot;
+	for entry in readfile('/etc/mtab').split('\n'):
+		if entry != '':
+			list = entry.split()
+			if dev == list[0]:
+				return list[1]
+
+def mountiso(iso, mount):
+	&quot;Loopback mount an ISO&quot;
+	if not os.path.exists(iso):
+		die(3, 'File %s does not exist.' % iso)
+	if not os.path.isfile(cf.mountcmd):
+		die(4, 'mount command not %s' % cf.mountcmd)
+	if is_mounted(iso):
+		mount2 = mountpoint(iso)
+		if mount2 != mount:
+			if os.path.exists(mount) and not os.path.islink(mount):
+				print '%s - %s' % (mount, os.tempnam(os.path.dirname(mount)))
+				os.rename(mount, os.tempnam(os.path.dirname(mount), 'bak-'))
+			if not os.path.islink(mount):
+				info('Symlink ISO to %s' % mount)
+				os.symlink(mount2, mount)
+	else:
+		if os.path.exists(mount) and not os.path.isdir(mount):
+			os.rename(mount, os.tempnam(os.path.dirname(mount), 'bak-'))
+		mkdir(mount)
+		if not os.path.ismount(mount):
+			info('Mount ISO %s to %s' % (iso, mount))
+			os.system('%s -o loop %s %s' % (cf.mountcmd, iso, mount))
+
+def umountiso(mount):
+	&quot;Umount a mounted ISO&quot;
+	if not os.path.isfile(cf.umountcmd):
+		die(4, 'umount command not %s' % cf.umountcmd)
+	if os.path.ismount(mount):
+		os.system('%s %s' % (cf.umountcmd, mount))
+
+def lftpmirror(url, path):
+	&quot;Mirror everything from a HTTP/FTP/SFTP URL&quot;
+	if not os.path.isfile(cf.lftpcmd):
+		die(4, 'lftp command not %s' % cf.lftpcmd)
+	info('Fetch updates from %s' % url)
+	mkdir(path)
+	print '%s -c \'mirror -a -r -I *.rpm %s %s\'' % (cf.lftpcmd, url, path)
+	os.system('%s -c \'set dns:fatal-timeout 2; set net:timeout 15; mirror -a -I *.rpm %s %s\'' % (cf.lftpcmd, url, path))
+
+def extralink((dist, extra), dirpath, namelist):
+	&quot;Symlink RPM packages that match a given arch and disttag&quot;
+	if cf.dists[dist].has_key('tag') and cf.dists[dist]['arch']:
+		for tag in cf.dists[dist]['tag']:
+			for arch in cf.dists[dist]['arch'] + [ 'noarch' ]:
+				symlinkglob(dirpath + '/*.' + tag + '*.' + arch + '.rpm', 
+					cf.yamdir + '/' + dist + '/RPMS.'+ extra, 
+					cf.yamdir + '/' + dist + '/RPMS')
+
+def aptrepo(dist):
+	&quot;Create an Apt repository for a specific dist&quot;
+	repos = ''
+	yamdir = cf.yamdir + '/' + dist
+	if not os.path.isfile(cf.genbasedircmd):
+		die(4, 'genbasedir command not %s' % cf.genbasedircmd)	
+	for repo in ['os', 'updates', 'extras'] + cf.extras.keys():
+		if os.path.exists(yamdir + '/RPMS.' + repo): repos += ' ' + repo
+	if repos:
+		info('Create Apt repository for %s' % repos)
+		os.system('%s --flat --bloat --bz2only %s %s' % (cf.genbasedircmd, yamdir, repos))
+
+def yumrepo(dist):
+	&quot;Create a Yum repository for a specific dist&quot;
+	yamdir = cf.yamdir + '/' + dist
+	if not os.path.isfile(cf.yumarchcmd):
+		die(4, 'yum-arch command not %s' % cf.yumarchcmd)
+	os.system('%s -q -l %s' % (cf.yumarchcmd, yamdir + '/RPMS'))
+	for repo in ['os', 'updates', 'extras'] + cf.extras.keys():
+		if os.path.exists(yamdir + '/RPMS.' + repo):
+			info('Create Yum repository for %s' % repo)
+			os.system('%s -q -l %s' % (cf.yumarchcmd, yamdir + '/RPMS.' + repo))
+
+def htmlrepo(dist):
+	&quot;Put html information in repository&quot;
+	yamdir = cf.yamdir + '/' + dist
+	symlink(cf.htmldir + '/HEADER.repo.shtml', yamdir + '/HEADER.shtml')
+	symlink(cf.htmldir + '/README.index.shtml', yamdir + '/README.shtml')
+	
+
+def main():
+	if op.dists:
+		dists=op.dists
+	else:
+		dists=cf.dists.keys()
+
+	symlink(cf.htmldir + '/HEADER.index.shtml', cf.yamdir + '/HEADER.shtml')
+	symlink(cf.htmldir + '/README.index.shtml', cf.yamdir + '/README.shtml')
+
+	### Update extras
+	if op.extra:
+		for extra in cf.extras.keys():
+			for source in cf.extras[extra]:
+				lftpmirror(source, cf.isodir + '/extras/' + extra)
+
+	for dist in dists:
+		if not cf.dists.has_key(dist):
+			info('Ignoring distribution %s, is not defined' % dist)
+			continue
+
+		if not cf.getisos(dist):
+			info('Ignoring distribution %s, has no ISOs' % dist)
+			continue
+
+		yamdir = cf.yamdir + '/' + dist
+		info('Processing %s using %s' % (dist, yamdir))
+
+		### Mount ISOs
+		for iso in cf.getisos(dist):
+			mkdir(yamdir + '/ISO/')
+			symlink(iso, yamdir + '/ISO/')
+			discnr = re.compile('disc([0-9])').search(iso).group(1)
+			if op.umount:
+				umountiso(yamdir + '/disc' + discnr)
+				continue
+			else:
+				mountiso(iso, yamdir + '/disc' + discnr)
+
+		### Symlink html for repository
+		htmlrepo(dist)
+
+		### Update updates
+		if op.update:
+			if cf.dists[dist]['updates']:
+				lftpmirror(cf.dists[dist]['updates'], cf.isodir + '/updates/' + dist)
+
+		### Symlink os packages
+		if op.generate:
+			cleanup(yamdir + '/RPMS')
+
+			### Symlink os update packages
+			if cf.dists[dist]['subdir']:
+				info('Symlink OS packages from ISO')
+				cleanup(yamdir + '/RPMS.os')
+				symlinkglob(yamdir + '/disc?/' + cf.dists[dist]['subdir'] + '/RPMS/*.rpm',
+					yamdir + '/RPMS.os',
+					yamdir + '/RPMS')
+			
+			### Symlink update packages
+			info('Symlink update packages from %s' % yamdir + '/RPMS.updates/')
+			cleanup(yamdir + '/RPMS.updates')
+			symlinkglob(cf.isodir + '/updates/' + dist + '/*.rpm',
+				yamdir + '/RPMS.updates',
+				yamdir + '/RPMS')
+
+			symlinkglob(yamdir + '/disc?/Updates/RPMS/*.rpm',
+				yamdir + '/RPMS.updates',
+				yamdir + '/RPMS')
+			### FIXME: should remove identical files from cf.isodir + '/updates/' + dist + '/*.rpm'
+#			os.remove(cf.isodir + '/updates/' + dist + '/' + os.path.basename(file))
+	
+			### Symlink extra packages
+			info('Symlink extra packages from %s' % cf.isodir + '/extras/' + dist)
+			cleanup(yamdir + '/RPMS.extras')
+			symlinkglob(cf.isodir + '/extras/' + dist + '/*.rpm',
+				yamdir + '/RPMS.extras',
+				yamdir + '/RPMS')
+	
+			info('Symlink extra packages from %s' % cf.isodir + '/extras/all')
+			symlinkglob(cf.isodir + '/extras/all/*.rpm',
+				yamdir + '/RPMS.extras',
+				yamdir + '/RPMS')
+	
+			for extra in cf.extras:
+				info('Symlink %s packages from %s' % (extra, cf.isodir + '/extras/' + extra))
+				cleanup(yamdir + '/RPMS.' + extra)
+				os.path.walk(cf.isodir + '/extras/' + extra, extralink, (dist, extra))
+	
+			### Create apt/yum repository
+			if cf.yum:
+				yumrepo(dist)
+			if cf.apt:
+				aptrepo(dist)
+
+			### Create pxe boot
+			if cf.tftpdir:
+				tftpdir = cf.tftpdir + '/' + dist
+				info('Symlink pxe boot files to %s ' % tftpdir)
+				mkdir(tftpdir + '/pxelinux.cfg/')
+				for file in glob.glob(yamdir + '/disc?/images/pxeboot/vmlinuz'):
+					copy(file, tftpdir)
+				for file in glob.glob(yamdir + '/disc?/images/pxeboot/initrd*.img'):
+					copy(file, tftpdir)
+				if cf.pxelinux:
+					copy(cf.pxelinux, tftpdir)
+
+if __name__ == '__main__':
+	op=options(sys.argv[1:])
+	cf=config()
+	main()


Property changes on: trunk/tools/yam/yam
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/yam/yam.conf
===================================================================
--- trunk/tools/yam/yam.conf	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/yam.conf	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,135 @@
+### Configuration file for Yam
+
+[main]
+yamdir=/var/www/yam
+isodir=/mnt/iso
+#tftpdir=/tftpboot/yam
+#pxelinux=/usr/lib/syslinux/pxelinux.0
+
+[extras]
+#dag=<A HREF="http://apt.sw.be/packages/">http://apt.sw.be/packages/</A>
+dag=<A HREF="http://apt/packages/">http://apt/packages/</A>
+#fr=<A HREF="http://ayo.freshrpms.net/fedora/">http://ayo.freshrpms.net/fedora/</A> <A HREF="http://ayo.freshrpms.net/redhat/">http://ayo.freshrpms.net/redhat/</A>
+#dries=<A HREF="http://dries.studentenweb.org/apt/packages/">http://dries.studentenweb.org/apt/packages/</A>
+
+[fc2-i386]
+iso=FC2-i386-disc?.iso
+updates=<A HREF="http://yam/fc2-i386/RPMS.updates/">http://yam/fc2-i386/RPMS.updates/</A>
+updates=<A HREF="http://ayo.freshrpms.net/fedora/linux/2/i386/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/2/i386/RPMS.updates/</A>
+subdir=Fedora
+tag=fc2 rhfc2
+arch=i386 i586 i686
+
+[fc2-x86_64]
+iso=FC2-x86_64-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/fedora/linux/2/x86_64/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/2/x86_64/RPMS.updates/</A>
+subdir=Fedora
+tag=fc2 rhfc2
+arch=x86_64
+
+[fc1-i386]
+iso=yarrow-i386-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/fedora/linux/1/i386/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/1/i386/RPMS.updates/</A>
+subdir=Fedora
+tag=fc1 rhfc1
+arch=i386 i586 i686
+
+[fc1-x86_64]
+iso=yarrow-x86_64-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/fedora/linux/1/x86_64/RPMS.updates/">http://ayo.freshrpms.net/fedora/linux/1/x86_64/RPMS.updates/</A>
+subdir=Fedora
+tag=fc1 rhfc1
+arch=x86_64
+
+[tao1-i386]
+iso=mooch-i386-disc?.iso
+subdir=Tao
+updates=<A HREF="http://dist.taolinux.org/tao-1.0/updates/">http://dist.taolinux.org/tao-1.0/updates/</A>
+tag=el3 rhel3
+arch=i386 i586 i686
+
+[centos3-i386]
+iso=CentOS-3.1-i386.disc?.iso
+updates=<A HREF="http://wopr.mind.ilstu.edu/caosity/centos-3/3.1/updates/*/RPMS/">http://wopr.mind.ilstu.edu/caosity/centos-3/3.1/updates/*/RPMS/</A>
+tag=el3 rhel3
+arch=i386 i586 i686
+
+[centos2-i386]
+iso=CentOS-2-i386-disc?.iso
+updates=<A HREF="http://wopr.mind.ilstu.edu/caosity/centos-2/updates/*/">http://wopr.mind.ilstu.edu/caosity/centos-2/updates/*/</A>
+tag=el2 rhel2.1
+arch=i386 i586 i686
+
+[rhas3-ppc]
+iso=rhel-3-U1-ppc-as-disc?.iso rhel-3-ppc-disc?.iso
+tag=el3 rhel3
+arch=ppc
+
+[rhas3-s390x]
+iso=rhel-3-U2-s390x-as-disc?.iso
+tag=el3 rhel3
+arch=s390x
+
+[rhas3-s390]
+iso=rhel-3-U2-s390-as-disc?.iso
+tag=el3 rhel3
+arch=s390
+
+[rhas3-x86_64]
+iso=rhel-3-U2-x86_64-as-disc?.iso rhel-3-U2-x86_64-disc?.iso
+tag=el3 rhel3
+arch=x86_64
+
+[rhes3-x86_64]
+iso=rhel-3-U2-x86_64-es-disc?.iso rhel-3-U2-x86_64-disc?.iso
+tag=el3 rhel3
+arch=x86_64
+
+[rhws3-x86_64]
+iso=rhel-3-U2-x86_64-ws-disc?.iso rhel-3-U2-x86_64-disc?.iso
+tag=el3 rhel3
+arch=x86_64
+
+[rhas3-i386]
+iso=rhel-3-U2-i386-as-disc?.iso rhel-3-U2-i386-disc?.iso
+tag=el3 rhel3
+arch=i386
+
+[rhes3-i386]
+iso=rhel-3-U2-i386-es-disc?.iso rhel-3-U2-i386-disc?.iso
+tag=el3 rhel3
+arch=i386
+
+[rhws3-i386]
+iso=rhel-3-U2-i386-ws-disc?.iso rhel-3-U2-i386-disc?.iso
+tag=el3 rhel3
+arch=i386
+
+[rh9-i386]
+iso=shrike-i386-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/redhat/9/i386/RPMS.updates/">http://ayo.freshrpms.net/redhat/9/i386/RPMS.updates/</A>
+tag=rh9 rh90
+arch=i386
+
+[rh80-i386]
+iso=psyche-i386-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/redhat/8.0/i386/RPMS.updates/">http://ayo.freshrpms.net/redhat/8.0/i386/RPMS.updates/</A>
+tag=rh8 rh80
+arch=i386
+
+[rh73-i386]
+iso=valhalla-i386-disc?.iso
+updates=<A HREF="http://ayo.freshrpms.net/redhat/7.3/i386/RPMS.updates/">http://ayo.freshrpms.net/redhat/7.3/i386/RPMS.updates/</A>
+tag=rh7 rh73
+arch=i386
+
+[rhas21-i386]
+iso=RHEL2.1AS-U4-re0427.2.1-i386-disc?.iso rhel-21-u2-i386-disc?.iso
+tag=el2 rhel2.1
+arch=i386
+
+[rh62-i386]
+iso=redhat-6.2-i386.iso Powertools-6.2-i386.iso
+updates=<A HREF="http://ayo.freshrpms.net/redhat/6.2/i386/RPMS.updates/">http://ayo.freshrpms.net/redhat/6.2/i386/RPMS.updates/</A>
+tag=rh6 rh62
+arch=i386

Added: trunk/tools/yam/yam.httpd
===================================================================
--- trunk/tools/yam/yam.httpd	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/yam.httpd	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,53 @@
+Alias /yam /var/www/yam
+#Alias /yamiso /mnt/iso
+
+&lt;Directory /var/www/yam&gt;
+	Options Indexes FollowSymlinks SymLinksifOwnerMatch IncludesNOEXEC
+	IndexOptions NameWidth=* DescriptionWidth=*
+	
+	HeaderName HEADER.shtml
+	ReadmeName README.shtml
+
+	AddDescription &quot;CDROM ISO files&quot; ISO
+	AddDescription &quot;OS RPM packages&quot; RPMS.os
+	AddDescription &quot;OS update RPM packages&quot; RPMS.updates
+	AddDescription &quot;Extra RPM packages&quot; RPMS.extras
+	AddDescription &quot;3rd party RPM packages&quot; RPMS.
+	AddDescription &quot;OS source RPM packages&quot; SRPMS
+	AddDescription &quot;All RPM packages merged&quot; RPMS
+
+	AddDescription &quot;Apt repository meta data&quot; base
+	AddDescription &quot;Yum repository meta data&quot; headers
+	AddDescription &quot;Temporary Yum meta data&quot; .newheaders
+
+	AddDescription &quot;CentOS 2 for x86&quot; centos2-i386
+	AddDescription &quot;CentOS 3 for x86&quot; centos3-i386
+	AddDescription &quot;Fedora Core 1 for x86&quot; fc1-i386
+	AddDescription &quot;Fedora Core 1 for x86_64&quot; fc1-x86_64
+	AddDescription &quot;Fedora Core 2 for x86&quot; fc2-i386
+	AddDescription &quot;Fedora Core 2 for x86_64&quot; fc2-x86_64
+	AddDescription &quot;Red Hat Linux 6.2 for x86&quot; rh62-i386
+	AddDescription &quot;Red Hat Linux 7.3 for x86&quot; rh73-i386
+	AddDescription &quot;Red Hat Linux 8.0 for x86&quot; rh80-i386
+	AddDescription &quot;Red Hat Linux 9 for x86&quot; rh9-i386
+	AddDescription &quot;Red Hat Advanced Server 2 for x86&quot; rhas21-i386
+	AddDescription &quot;Red Hat Advanced Server 3 for x86&quot; rhas3-i386
+	AddDescription &quot;Red Hat Advanced Server 3 for x86_64&quot; rhas3-x86_64
+	AddDescription &quot;Red Hat Advanced Server 3 for PPC&quot; rhas3-ppc
+	AddDescription &quot;Red Hat Advanced Server 3 for s/390&quot; rhas3-s390
+	AddDescription &quot;Red Hat Enterprise Server 3 for x86&quot; rhes3-i386
+	AddDescription &quot;Red Hat Enterprise Server 3 for x86_64&quot; rhes3-x86_64
+	AddDescription &quot;Red Hat Workstation 3 for x86&quot; rhws3-i386
+	AddDescription &quot;Red Hat Workstation 3 for x86_64&quot; rhws3-x86_64
+	AddDescription &quot;Tao Linux 1 for x86_64&quot; tao1-x86-64
+	AddDescription &quot;Tao Linux 1 for x86&quot; tao1-i386
+	AddDescription &quot;Tao Linux 1 for x86_64&quot; tao1-x86-64
+&lt;/Directory&gt;
+
+&lt;VirtualHost *&gt;
+	ServerName yam
+	ServerAlias 127.0.0.1 localhost
+	DocumentRoot /var/www/yam
+	ErrorLog logs/yam-error_log
+	CustomLog logs/yam-access_log combined
+&lt;/VirtualHost&gt;

Added: trunk/tools/yam/yam.spec
===================================================================
--- trunk/tools/yam/yam.spec	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/yam.spec	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,67 @@
+# $Id: _template.spec 471 2004-05-03 19:42:19Z dag $
+# Authority: dag
+# Upstream: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
+
+Summary: Tool to set up a Yum/Apt mirror from various sources (ISO, ftp, ...)
+Name: yam
+Version: 0.3
+Release: 1
+License: GPL
+Group: System Environment/Base
+URL: <A HREF="http://dag.wieers.com/home-made/yam/">http://dag.wieers.com/home-made/yam/</A>
+
+Packager: Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
+Vendor: Dag Apt Repository, <A HREF="http://dag.wieers.com/apt/">http://dag.wieers.com/apt/</A>
+
+Source: <A HREF="http://dag.wieers.com/home-made/yam/yam-%{version">http://dag.wieers.com/home-made/yam/yam-%{version</A>}.tar.bz2
+BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
+
+Requires: python
+
+%description
+Yam builds a local Apt/Yum RPM repository from local ISO files,
+downloaded updates and extra packages from 3rd party repositories.
+
+It can download all updates and extras automatically, creates
+the repository structure and meta-data, enables HTTP access to 
+the repository and creates a directory-structure for PXE/TFTP.
+
+With yam, you can enable your laptop or a local server to provide
+updates for the whole network and provide the proper files to
+allow installations via the network.
+
+By default it works out of the box with:
+
+	Fedora Core 1 and 2
+	Red Hat Enterprise Linux 2.1 and 3 (WS, ES, AS)
+	Tao Linux 1
+	CentOS 2.1 and 3
+	Red Hat Linux 6.2, 7.3, 8.0 and 9
+
+%prep
+%setup
+
+%build
+
+%install
+%{__rm} -rf %{buildroot}
+%makeinstall
+
+%clean
+%{__rm} -rf %{buildroot}
+
+%files
+%defattr(-, root, root, 0755)
+%doc AUTHORS ChangeLog COPYING README THANKS TODO
+%config(noreplace) %{_sysconfdir}/yam.conf
+%config(noreplace) %{_sysconfdir}/httpd/conf.d/yam.conf
+%config %{_initrddir}/yam
+%{_bindir}/yam
+%{_libdir}/yam/
+
+%changelog
+* Wed May 19 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.3-1
+- Updated to release 0.3.
+
+* Fri May 14 2004 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt; - 0.2-1
+- Initial package. (using DAR)


Property changes on: trunk/tools/yam/yam.spec
___________________________________________________________________
Name: svn:keywords
   + &quot;Id&quot;
Name: svn:eol-style
   + native

Added: trunk/tools/yam/yam.sysv
===================================================================
--- trunk/tools/yam/yam.sysv	2004-07-21 18:07:38 UTC (rev 1705)
+++ trunk/tools/yam/yam.sysv	2004-07-21 18:24:29 UTC (rev 1706)
@@ -0,0 +1,78 @@
+#!/bin/bash
+#
+# Init script for Yam distribution server.
+#
+# Written by Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;.
+#
+# chkconfig: 2345 90 10
+# description: Yam distribution server.
+#
+# processname: yam
+# config: /etc/yam.conf
+# pidfile: /var/run/amavisd.pid
+
+source /etc/rc.d/init.d/functions
+
+[ -x /usr/bin/yam ] || exit 1
+
+### Default variables
+SYSCONFIG=&quot;/etc/sysconfig/yam&quot;
+YAMCONFIG=&quot;/etc/yam.conf&quot;
+
+### Read configuration
+[ -r &quot;$SYSCONFIG&quot; ] &amp;&amp; source &quot;$SYSCONFIG&quot;
+
+[ -r &quot;$YAMCONFIG&quot; ] || exit 1
+
+RETVAL=0
+prog=&quot;yam&quot;
+desc=&quot;Yam Distribution Server&quot;
+
+start() {
+	echo -n $&quot;Starting $desc ($prog): &quot;
+	yam -c $YAMCONFIG
+	RETVAL=$?
+	[ $RETVAL -eq 0 ] &amp;&amp; success || failure
+	echo
+	[ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/$prog
+	return $RETVAL
+}
+
+stop() {
+	echo -n $&quot;Shutting down $desc ($prog): &quot;
+	yam --umount -c $YAMCONFIG
+	RETVAL=$?
+	[ $RETVAL -eq 0 ] &amp;&amp; success || failure
+	echo
+	[ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/$prog
+	return $RETVAL
+}
+
+restart() {
+	stop
+	start
+}
+
+case &quot;$1&quot; in
+  start)
+	start
+	;;
+  stop)
+	stop
+	;;
+  restart|reload)
+	restart
+	;;
+  reload)
+	reload
+	;;
+  condrestart)
+	[ -e /var/lock/subsys/$prog ] &amp;&amp; restart
+	RETVAL=$?
+	;;
+  *)
+	echo $&quot;Usage: $0 {start|stop|restart|condrestart}&quot;
+	RETVAL=1
+esac
+
+exit $RETVAL


Property changes on: trunk/tools/yam/yam.sysv
___________________________________________________________________
Name: svn:executable
   + *


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000514.html">[SVN] r1705 - trunk/tools/dar
</A></li>
	<LI>Next message: <A HREF="000516.html">[SVN] r1707 - trunk/rpms/perl-MD5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#515">[ date ]</a>
              <a href="thread.html#515">[ thread ]</a>
              <a href="subject.html#515">[ subject ]</a>
              <a href="author.html#515">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
