<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r7606 - in trunk/tools/dstat: . docs plugins
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r7606%20-%20in%20trunk/tools/dstat%3A%20.%20docs%20plugins&In-Reply-To=%3C200908141528.n7EFSgTd024382%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006401.html">
   <LINK REL="Next"  HREF="006403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r7606 - in trunk/tools/dstat: . docs plugins</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r7606%20-%20in%20trunk/tools/dstat%3A%20.%20docs%20plugins&In-Reply-To=%3C200908141528.n7EFSgTd024382%40surya.karan.org%3E"
       TITLE="[svn] r7606 - in trunk/tools/dstat: . docs plugins">packagers at lists.rpmforge.net
       </A><BR>
    <I>Fri Aug 14 17:28:42 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="006401.html">[svn] r7605 - trunk/rpms/truecrypt
</A></li>
        <LI>Next message: <A HREF="006403.html">[svn] r7607 - in trunk/tools/wiipresent: . docs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6402">[ date ]</a>
              <a href="thread.html#6402">[ thread ]</a>
              <a href="subject.html#6402">[ subject ]</a>
              <a href="author.html#6402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: 2009-08-14 16:28:41 +0100 (Fri, 14 Aug 2009)
New Revision: 7606

Added:
   trunk/tools/dstat/plugins/dstat_fan.py
Modified:
   trunk/tools/dstat/ChangeLog
   trunk/tools/dstat/Makefile
   trunk/tools/dstat/TODO
   trunk/tools/dstat/docs/dstat-paper.txt
   trunk/tools/dstat/dstat
   trunk/tools/dstat/plugins/dstat_battery.py
   trunk/tools/dstat/plugins/dstat_cpufreq.py
   trunk/tools/dstat/plugins/dstat_freespace.py
   trunk/tools/dstat/plugins/dstat_gpfs.py
   trunk/tools/dstat/plugins/dstat_gpfsop.py
   trunk/tools/dstat/plugins/dstat_innodb_buffer.py
   trunk/tools/dstat/plugins/dstat_innodb_io.py
   trunk/tools/dstat/plugins/dstat_innodb_ops.py
   trunk/tools/dstat/plugins/dstat_lustre.py
   trunk/tools/dstat/plugins/dstat_mysql5_com.py
   trunk/tools/dstat/plugins/dstat_mysql5_conn.py
   trunk/tools/dstat/plugins/dstat_mysql5_io.py
   trunk/tools/dstat/plugins/dstat_mysql5_keys.py
   trunk/tools/dstat/plugins/dstat_mysql_io.py
   trunk/tools/dstat/plugins/dstat_mysql_keys.py
   trunk/tools/dstat/plugins/dstat_net_packets.py
   trunk/tools/dstat/plugins/dstat_nfs3.py
   trunk/tools/dstat/plugins/dstat_nfs3op.py
   trunk/tools/dstat/plugins/dstat_nfsd3.py
   trunk/tools/dstat/plugins/dstat_nfsd3op.py
   trunk/tools/dstat/plugins/dstat_postfix.py
   trunk/tools/dstat/plugins/dstat_power.py
   trunk/tools/dstat/plugins/dstat_rpc.py
   trunk/tools/dstat/plugins/dstat_rpcd.py
   trunk/tools/dstat/plugins/dstat_thermal.py
   trunk/tools/dstat/plugins/dstat_topbio.py
   trunk/tools/dstat/plugins/dstat_topcpu.py
   trunk/tools/dstat/plugins/dstat_topio.py
   trunk/tools/dstat/plugins/dstat_topmem.py
   trunk/tools/dstat/plugins/dstat_topoom.py
   trunk/tools/dstat/plugins/dstat_vmkint.py
   trunk/tools/dstat/plugins/dstat_vmknic.py
   trunk/tools/dstat/plugins/dstat_vmmemctl.py
   trunk/tools/dstat/plugins/dstat_vzcpu.py
   trunk/tools/dstat/plugins/dstat_vzubc.py
Log:
Drop support for Python 1.5. Introduced splitlines() function that allows a replace/split on readlines(). Added external dstat_fan plugin to show fan speed.

Modified: trunk/tools/dstat/ChangeLog
===================================================================
--- trunk/tools/dstat/ChangeLog	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/ChangeLog	2009-08-14 15:28:41 UTC (rev 7606)
@@ -5,11 +5,14 @@
 - Improvements to dstat_battery and dstat_cpufreq
 - Added external dstat_power plugin to show ACPI power usage
 - Simplified logic inside dstat_time
-- Added external dstat_ntp to show time from an NTP server
+- Added external dstat_ntp plugin to show time from an NTP server
 - Flush sys.stdout later in the loop
 - Filtering out more interfaces (eg. bonding) in total values (Bert de Bruijn)
 - Provide error output when now power information is available (AC power)
 - Make topcpu plugin SMP aware (values are not percent per CPU)
+- Drop support for Python 1.5
+- Introduced splitlines() function that allows a replace/split on readlines()
+- Added external dstat_fan plugin to show fan speed
 
 * 0.6.9 - Locarno - release 02/12/2008
 - Input text color is now gray (again)

Modified: trunk/tools/dstat/Makefile
===================================================================
--- trunk/tools/dstat/Makefile	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/Makefile	2009-08-14 15:28:41 UTC (rev 7606)
@@ -41,32 +41,3 @@
 
 srpm: dist
 	rpmbuild -ts --clean --rmsource --rmspec --define &quot;_rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm&quot; --define &quot;_srcrpmdir ../&quot; ../$(name)-$(version).tar.bz2
-
-
-#### Imperfect translation to dstat15
-tr:
-	cat dstat | perl -p -e ' \
-			next if (s|(\S+)\.center\((.+)\)\.replace\((.+), (.+)\)|string.replace(string.center($$1, $$2), $$3, $$4)|g); \
-			next if (s|(.[-?] .)\.ljust\((\S+)\)|string.ljust\($$1, $$2\)|g); \
-			next if (s|(.[-?] .)\.rjust\((\S+)\)|string.rjust\($$1, $$2\)|g); \
-			next if (s|(. .)\.join\(l\[cpunr\+2:\]\)\.split\((.,.)\)|string.split(string.join(l[cpunr+2:], $$1), $$2)|g); \
-			next if (s|self\.intmap\[(\S+)\.strip\(\)\.lower\(\)\]|self.intmap[string.strip(string.lower($$1))]|g); \
-			next if (s|\((.0.) \+ (. .) \* len\((\S+)\)\)\.rjust\((\S+)\)|string.rjust($$1 + $$2 * len($$3), $$4)|g); \
-			next if (s|(\S+)\.replace\((.:.), (. .)\)\.split\(\)|string.split(string.replace($$1, $$2, $$3))|g); \
-			next if (s|ret\[name\.strip\(\)\.lower\(\)\]|name = string.lower(string.strip(name))\n				ret[name]|g); \
-			s|(\S+)\.replace\((.+), (.+)\)|string.replace($$1, $$2, $$3)|g; \
-			s|(\S+)\.ljust\((.+)\)|string.ljust($$1, $$2)|g; \
-			s|(\S+)\.rjust\((.+)\)|string.rjust($$1, $$2)|g; \
-			s|(\S+)\.center\((.+)\)|string.center($$1, $$2)|g; \
-			s|(\S+)\.strip\((.+)\)|string.strip($$1, $$2)|g; \
-			s|(\S+)\.split\((.+)\)|string.split($$1, $$2)|g; \
-			s|(\S+)\.ljust\(\)|string.ljust($$1)|g; \
-			s|(\S+)\.rjust\(\)|string.rjust($$1)|g; \
-			s|(\S+)\.center\(\)|string.center($$1)|g; \
-			s|(\S+)\.strip\(\)|string.strip($$1)|g; \
-			s|(\S+)\.split\(\)|string.split($$1)|g; \
-			s|(\w+)\.lower\(\)|string.lower($$1)|g; \
-			s|long\(round\(var\)|int\(round\(var\)|g; \
-			s|, time$$|, time, string|g; \
-		' &gt;dstat15.tr
-	@chmod a+x dstat15.tr

Modified: trunk/tools/dstat/TODO
===================================================================
--- trunk/tools/dstat/TODO	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/TODO	2009-08-14 15:28:41 UTC (rev 7606)
@@ -56,7 +56,6 @@
 
 ### General issues
 + Implement better (?) protection against counter rollovers (see mail from Sebastien Prud'homme)
-+ Plugins currently have to be written in python 1.5 to work for dstat15 (lowest common denominator)
 
 ### Plugin issues
 + plugins that use /proc/pid are reasonably slow

Modified: trunk/tools/dstat/docs/dstat-paper.txt
===================================================================
--- trunk/tools/dstat/docs/dstat-paper.txt	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/docs/dstat-paper.txt	2009-08-14 15:28:41 UTC (rev 7606)
@@ -426,11 +426,11 @@
 so in that case if you want to see what is happening, you can simply do:
 
 ----
-dstat -ti -I0
+dstat -ti -I0 -M snooze --debug
 ----
 
 Dstat nowadays can also detect lost ticks (when the number of ticks do not
-much the time progress. This is useful to correlate VM issues with other
+match the time progress. This is useful to correlate VM issues with other
 problems.
 
 

Modified: trunk/tools/dstat/dstat
===================================================================
--- trunk/tools/dstat/dstat	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/dstat	2009-08-14 15:28:41 UTC (rev 7606)
@@ -340,11 +340,24 @@
             raise Exception, 'Cannot open file %s.' % filename
 
     def readlines(self):
+        &quot;Return lines from any file descriptor&quot;
         for fd in self.fd:
             fd.seek(0)
             for line in fd.readlines():
                 yield line
 
+    def splitlines(self, delim=None, replace=None):
+        &quot;Return split lines from any file descriptor&quot;
+        for fd in self.fd:
+            fd.seek(0)
+            for line in fd.readlines():
+                if replace and delim:
+                    yield line.replace(replace, delim).split(delim)
+                elif replace:
+                    yield line.replace(replace, ' ').split()
+                else:
+                    yield line.split(delim)
+
     def statwidth(self):
         &quot;Return complete stat width&quot;
         return len(self.vars) * self.width() + len(self.vars) - 1
@@ -378,14 +391,13 @@
         return ret
 
     def title2(self):
+        ret = ''
         if isinstance(self.name, types.StringType):
-            ret = ''
             for i, nick in enumerate(self.nick):
                 ret = ret + ansi['blue'] + ansi['underline'] + nick.center(self.format[1]) + ansi['default']
                 if i + 1 != len(self.nick): ret = ret + char['space']
             return ret
         else:
-            ret = ''
             for i, name in enumerate(self.name):
                 for j, nick in enumerate(self.nick):
                     ret = ret + ansi['blue'] + ansi['underline'] + nick.center(self.format[1]) + ansi['default']
@@ -410,14 +422,13 @@
             return ret
 
     def titlecsv2(self):
+        ret = ''
         if isinstance(self.name, types.StringType):
-            ret = ''
             for i, nick in enumerate(self.nick):
                 ret = ret + '&quot;' + nick + '&quot;'
                 if i + 1 != len(self.nick): ret = ret + ','
             return ret
         else:
-            ret = ''
             for i, name in enumerate(self.name):
                 for j, nick in enumerate(self.nick):
                     ret = ret + '&quot;' + nick + '&quot;'
@@ -499,8 +510,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 1: continue
             self.val['aio'] = long(l[0])
 
@@ -516,8 +526,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 8 or l[0][0:3] != 'cpu': continue
             ret.append(l[0][3:])
         ret.sort()
@@ -552,8 +561,7 @@
         return ret
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 8: continue
             for name in self.vars:
                 if l[0] == 'cpu' + name or ( l[0] == 'cpu' and name == 'total' ):
@@ -589,8 +597,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) != 5 or l[0][0:3] != 'cpu': continue
             ret.append(l[0][3:])
         ret.sort()
@@ -616,8 +623,7 @@
         return ret
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             for name in self.vars:
                 if l[0] == 'cpu' + name or ( l[0] == 'cpu' and name == 'total' ):
                     self.cn2[name] = ( long(l[1]) + long(l[2]), long(l[3]), long(l[4]) )
@@ -630,7 +636,7 @@
 class dstat_disk(dstat):
     def __init__(self):
         self.format = ('f', 5, 1024)
-        self.diskfilter = re.compile('(dm-[0-9]+|md[0-9]+|[hs]d[a-z]+[0-9]+)')
+        self.diskfilter = re.compile('^(dm-[0-9]+|md[0-9]+|[hs]d[a-z]+[0-9]+)$')
         self.open('/proc/diskstats')
         self.nick = ('read', 'writ')
         self.discover = self.discover()
@@ -640,8 +646,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 13: continue
             if l[3:] == ['0',] * 11: continue
             name = l[2]
@@ -673,8 +678,7 @@
 
     def extract(self):
         for name in self.vars: self.cn2[name] = (0, 0)
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 13: continue
             if l[5] == '0' and l[9] == '0': continue
             name = l[2]
@@ -711,8 +715,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 15 or l[0] == 'major' or int(l[1]) % 16 != 0: continue
             name = l[3]
             ret.append(name)
@@ -741,8 +744,7 @@
 
     def extract(self):
         for name in self.vars: self.cn2[name] = (0, 0)
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 15 or l[0] == 'major' or int(l[1]) % 16 != 0: continue
             name = l[3]
             if not self.diskfilter.match(name):
@@ -777,8 +779,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split(':')
+        for l in self.splitlines(':'):
             if len(l) &lt; 3: continue
             name = l[0]
             if name != 'disk_io': continue
@@ -815,8 +816,7 @@
 
     def extract(self):
         for name in self.vars: self.cn2[name] = (0, 0)
-        for line in self.readlines():
-            l = line.split(':')
+        for line in self.splitlines(':'):
             if len(l) &lt; 3: continue
             name = l[0]
             if name != 'disk_io': continue
@@ -871,11 +871,11 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in dopen('/proc/sys/fs/file-nr').readlines():
+        for line in dopen('/proc/sys/fs/file-nr'):
             l = line.split()
             if len(l) &lt; 1: continue
             self.val['files'] = long(l[0])
-        for line in dopen('/proc/sys/fs/inode-nr').readlines():
+        for line in dopen('/proc/sys/fs/inode-nr'):
             l = line.split()
             if len(l) &lt; 2: continue
             self.val['inodes'] = long(l[0]) - long(l[1])
@@ -893,7 +893,7 @@
 
     def intmap(self):
         ret = {}
-        for line in dopen('/proc/interrupts').readlines():
+        for line in dopen('/proc/interrupts'):
             l = line.split()
             if len(l) &lt;= cpunr: continue
             l1 = l[0].split(':')[0]
@@ -905,8 +905,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if l[0] != 'intr': continue
             for name, i in enumerate(l[2:]):
                 if long(i) &gt; 10: ret.append(str(name))
@@ -915,8 +914,7 @@
 #   def check(self):
 #       if self.fd[0] and self.vars:
 #           self.fd[0].seek(0)
-#           for line in self.fd[0].readlines():
-#               l = line.split()
+#           for l in self.fd[0].splitlines():
 #               if l[0] != 'intr': continue
 #               return True
 #       return False
@@ -939,8 +937,7 @@
         return ret
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'intr': continue
             for name in self.vars:
                 if name != 'total':
@@ -963,8 +960,7 @@
 
     def intmap(self):
         ret = {}
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt;= cpunr: continue
             l1 = l[0].split(':')[0]
             l2 = ' '.join(l[cpunr+2:]).split(',')
@@ -975,8 +971,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; cpunr+1: continue
             name = l[0].split(':')[0]
             if long(l[1]) &gt; 10:
@@ -986,8 +981,7 @@
 #   def check(self):
 #       if self.fd and self.discover:
 #           self.fd[0].seek(0)
-#           for line in self.fd[0].readlines():
-#               l = line.split()
+#           for l in self.fd[0].splitlines():
 #               if l[0] != 'intr' or len(l) &gt; 2: continue
 #               return True
 #       return False
@@ -1010,8 +1004,7 @@
         return ret
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; cpunr+1: continue
             name = l[0].split(':')[0]
             if name in self.vars:
@@ -1040,8 +1033,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 13: continue
             if l[3:] == ['0',] * 11: continue
             name = l[2]
@@ -1073,8 +1065,7 @@
 
     def extract(self):
         for name in self.vars: self.cn2[name] = (0, 0)
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 13: continue
             if l[3] == '0' and l[7] == '0': continue
             name = l[2]
@@ -1118,8 +1109,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 3: continue
             self.val['load1'] = float(l[0])
             self.val['load5'] = float(l[1])
@@ -1136,8 +1126,7 @@
 
     def extract(self):
         for name in self.vars: self.val[name] = 0
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 4: continue
             if l[1] == 'POSIX':
                 self.val['posix'] = self.val['posix'] + 1
@@ -1158,8 +1147,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             name = l[0].split(':')[0]
             if name in self.vars + ('MemTotal', ):
@@ -1171,7 +1159,7 @@
         self.format = ('f', 5, 1024)
         self.open('/proc/net/dev')
         self.nick = ('recv', 'send')
-        self.totalfilter = re.compile('(lo|bond[0-9]+|face|.+\.[0-9]+)')
+        self.totalfilter = re.compile('^(lo|bond[0-9]+|face|.+\.[0-9]+)$')
         self.discover = self.discover()
         self.vars = self.vars()
         self.name = ['net/'+name for name in self.vars]
@@ -1179,8 +1167,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.replace(':', ' ').split()
+        for l in self.splitlines(replace=':'):
             if len(l) &lt; 17: continue
             if l[2] == '0' and l[10] == '0': continue
             name = l[0]
@@ -1209,8 +1196,7 @@
 
     def extract(self):
         self.cn2['total'] = [0, 0]
-        for line in self.readlines():
-            l = line.replace(':', ' ').split()
+        for l in self.splitlines(replace=':'):
             if len(l) &lt; 17: continue
             if l[2] == '0' and l[10] == '0': continue
             name = l[0]
@@ -1237,8 +1223,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             name = l[0]
             if name in self.vars:
@@ -1258,8 +1243,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 3: continue
             name = l[0]
             if name != 'swap': continue
@@ -1281,8 +1265,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             name = l[0]
             if name == 'processes':
@@ -1327,11 +1310,10 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 3: continue
             self.val[l[0]] = long(l[2])
-	self.val['other'] = self.val['sockets:'] - self.val['TCP:'] - self.val['UDP:'] - self.val['RAW:'] - self.val['FRAG:']
+        self.val['other'] = self.val['sockets:'] - self.val['TCP:'] - self.val['UDP:'] - self.val['RAW:'] - self.val['FRAG:']
 
 class dstat_swap(dstat):
     def __init__(self):
@@ -1346,8 +1328,7 @@
 
     def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 5: continue
             if l[0] == 'Filename': continue
             try: 
@@ -1380,8 +1361,7 @@
 
     def extract(self):
         self.val['total'] = [0, 0]
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 5 or l[0] == 'Filename': continue
             name = l[0]
             self.val[name] = ( long(l[3]) * 1024.0, (long(l[2]) - long(l[3])) * 1024.0 )
@@ -1397,8 +1377,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             name = l[0].split(':')[0]
             if name in self.vars + ('SwapTotal',):
@@ -1415,8 +1394,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             name = l[0]
             if name in self.vars:
@@ -1437,8 +1415,7 @@
 
     def extract(self):
         for name in self.vars: self.val[name] = 0
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 12: continue
             ### 01: established, 02: syn_sent,  03: syn_recv, 04: fin_wait1,
             ### 05: fin_wait2,   06: time_wait, 07: close,    08: close_wait,
@@ -1487,8 +1464,7 @@
 
     def extract(self):
         for name in self.vars: self.val[name] = 0
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if l[3] == '07': self.val['listen'] = self.val['listen'] + 1
             elif l[3] == '01': self.val['established'] = self.val['established'] + 1
 
@@ -1503,8 +1479,7 @@
 
     def extract(self):
         for name in self.vars: self.val[name] = 0
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if l[4] == '0002':
                 self.val['datagram'] = self.val['datagram'] + 1
             elif l[4] == '0001':
@@ -1524,8 +1499,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 2: continue
             if l[0] not in self.vars: continue
             self.cn2[l[0]] = long(l[1])
@@ -1618,8 +1592,10 @@
 def dopen(filename):
     &quot;Open a file for reuse, if already opened, return file descriptor&quot;
     global fds
-    if not os.path.exists(filename): return None
-    if 'fds' not in globals().keys(): fds = {}
+    if not os.path.exists(filename):
+        return None
+    if 'fds' not in globals().keys():
+        fds = {}
     if file not in fds.keys():
         fds[filename] = open(filename, 'r', 0)
     else:
@@ -1722,6 +1698,7 @@
     return ret, c
 
 def cprintlist(varlist, format):
+    &quot;Return all columns color printed&quot;
     ret = sep = ''
     for var in varlist:
         ret = ret + sep + cprint(var, format)
@@ -1729,6 +1706,7 @@
     return ret
 
 def cprint(var, format = ('f', 4, 1000)):
+    &quot;Color print one column&quot;
     vartype = format[0]
     maxlen = format[1]
     mp = format[2]
@@ -1960,11 +1938,11 @@
 #           if dev == devlist[0]:
 #               return devlist[1]
 
-def readfile(file):
-    ret = ''
-    for line in open(file,'r').readlines():
-        ret = ret + line
-    return ret
+#def readfile(file):
+#    ret = ''
+#    for line in open(file,'r').readlines():
+#        ret = ret + line
+#    return ret
 
 #cdef extern from &quot;sched.h&quot;:
 #    struct sched_param:
@@ -2106,9 +2084,9 @@
                     import imp
                     filename, pathname, description = imp.find_module('dstat_'+mod)
 
+                    ### TODO: Would using .pyc help with anything ?
                     ### Try loading python plugin
-                    if description[0] == '.py':
-#                           exec compile(readfile(pathname), pathname, 'exec')
+                    if description[0] in ('.py'):
                             execfile(pathname)
                             exec 'o = dstat_%s()' % mod
 

Modified: trunk/tools/dstat/plugins/dstat_battery.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_battery.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_battery.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_battery(dstat):
     def __init__(self):
         self.name = 'battery'
@@ -13,27 +10,27 @@
         self.vars = []
         for battery in os.listdir('/proc/acpi/battery/'):
             for line in dopen('/proc/acpi/battery/'+battery+'/state').readlines():
-                l = string.split(line)
+                l = line.split()
                 if len(l) &lt; 2: continue
                 if l[0] == 'present:' and l[1] == 'yes':
                     self.vars.append(battery)
         self.vars.sort()
-#       self.nick = [string.lower(name) for name in self.vars]
+#       self.nick = [name.lower() for name in self.vars]
         self.nick = []
         for name in self.vars:
-            self.nick.append(string.lower(name))
+            self.nick.append(name.lower())
         self.init(self.vars, 1)
 
     def extract(self):
         for battery in self.vars:
             for line in dopen('/proc/acpi/battery/'+battery+'/info').readlines():
-                l = string.split(line)
+                l = line.split()
                 if len(l) &lt; 4: continue
                 if l[0] == 'last':
                     full = int(l[3])
                     break
             for line in dopen('/proc/acpi/battery/'+battery+'/state').readlines():
-                l = string.split(line)
+                l = line.split()
                 if len(l) &lt; 3: continue
                 if l[0] == 'remaining':
                     current = int(l[2])

Modified: trunk/tools/dstat/plugins/dstat_cpufreq.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_cpufreq.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_cpufreq.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,7 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
 global glob
-import string
 import glob
 
 class dstat_cpufreq(dstat):
@@ -13,13 +11,13 @@
         self.name = 'frequency'
         self.format = ('p', 4, 34)
 #       self.vars = os.listdir('/sys/devices/system/cpu/')
-#       self.nick = [string.lower(name) for name in self.vars]
+#       self.nick = [name.lower() for name in self.vars]
         self.vars = []
         self.nick = []
         for name in glob.glob('/sys/devices/system/cpu/cpu[0-9]*'):
             name = os.path.basename(name)
             self.vars.append(name)
-            self.nick.append(string.lower(name))
+            self.nick.append(name.lower())
         self.nick.sort()
         self.init(self.vars, 1)
 
@@ -34,10 +32,10 @@
     def extract(self):
         for cpu in self.vars:
             for line in dopen('/sys/devices/system/cpu/'+cpu+'/cpufreq/scaling_max_freq').readlines():
-                l = string.split(line)
+                l = line.split()
                 max = int(l[0])
             for line in dopen('/sys/devices/system/cpu/'+cpu+'/cpufreq/scaling_cur_freq').readlines():
-                l = string.split(line)
+                l = line.split()
                 cur = int(l[0])
             ### Need to close because of bug in sysfs (?)
             dclose('/sys/devices/system/cpu/'+cpu+'/cpufreq/scaling_cur_freq')

Added: trunk/tools/dstat/plugins/dstat_fan.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_fan.py	                        (rev 0)
+++ trunk/tools/dstat/plugins/dstat_fan.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -0,0 +1,22 @@
+class dstat_fan(dstat):
+    def __init__(self):
+        self.name = 'fan'
+        self.format = ('d', 4, 500)
+        if os.path.exists('/proc/acpi/ibm/fan'):
+            for line in dopen('/proc/acpi/ibm/fan'):
+                l = line.split()
+                if l[0] == 'speed:':
+                    self.vars = ('speed',)
+            self.nick = self.vars
+        else:
+            raise Exception, 'Needs kernel IBM-ACPI support'
+        self.init(self.vars, 1)
+
+    def extract(self):
+        if os.path.exists('/proc/acpi/ibm/fan'):
+            for line in dopen('/proc/acpi/ibm/fan'):
+                l = line.split()
+                if l[0] == 'speed:':
+                    self.val['speed'] = int(l[1])
+
+# vim:ts=4:sw=4:et

Modified: trunk/tools/dstat/plugins/dstat_freespace.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_freespace.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_freespace.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -2,8 +2,6 @@
 ### FIXME: Would be nice to have a total by default (half implemented)
 
 ### FIXME: Apparently needs python 2.0, possibly python 2.2
-global string
-import string
 
 class dstat_freespace(dstat):
     def __init__(self):
@@ -19,8 +17,7 @@
 
     def vars(self):
         ret = []
-        for line in self.readlines():
-            l = string.split(line)
+        for l in self.splitlines():
             if len(l) &lt; 6: continue
             if l[2] in ('binfmt_misc', 'devpts', 'iso9660', 'none', 'proc', 'sysfs', 'usbfs'): continue
             ### FIXME: Excluding 'none' here may not be what people want (/dev/shm)

Modified: trunk/tools/dstat/plugins/dstat_gpfs.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_gpfs.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_gpfs.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 class dstat_gpfs(dstat):
     def __init__(self):
         self.name = 'gpfs i/o'

Modified: trunk/tools/dstat/plugins/dstat_gpfsop.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_gpfsop.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_gpfsop.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 class dstat_gpfsop(dstat):
     def __init__(self):
         self.name = 'gpfs file operations'

Modified: trunk/tools/dstat/plugins/dstat_innodb_buffer.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_innodb_buffer.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_innodb_buffer.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 global mysql_options
 mysql_options = os.getenv('DSTAT_MYSQL')
 

Modified: trunk/tools/dstat/plugins/dstat_innodb_io.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_innodb_io.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_innodb_io.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 global mysql_options
 mysql_options = os.getenv('DSTAT_MYSQL')
 

Modified: trunk/tools/dstat/plugins/dstat_innodb_ops.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_innodb_ops.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_innodb_ops.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 global mysql_options
 mysql_options = os.getenv('DSTAT_MYSQL')
 

Modified: trunk/tools/dstat/plugins/dstat_lustre.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_lustre.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_lustre.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,5 +1,3 @@
-global string
-import string
 global os
 import os
 

Modified: trunk/tools/dstat/plugins/dstat_mysql5_com.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql5_com.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql5_com.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -2,8 +2,6 @@
 # 2007-09-04 - <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">lefred at inuits.be</A>
 global MySQLdb
 import MySQLdb
-global string, select
-import string, select
 
 global mysql_user
 global mysql_pwd

Modified: trunk/tools/dstat/plugins/dstat_mysql5_conn.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql5_conn.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql5_conn.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -2,8 +2,6 @@
 # 2007-09-04 - <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">lefred at inuits.be</A>
 global MySQLdb
 import MySQLdb
-global string, select
-import string, select
 
 global mysql_user
 global mysql_pwd

Modified: trunk/tools/dstat/plugins/dstat_mysql5_io.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql5_io.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql5_io.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -2,8 +2,6 @@
 # 2007-09-04 - <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">lefred at inuits.be</A>
 global MySQLdb
 import MySQLdb
-global string, select
-import string, select
 
 global mysql_user
 global mysql_pwd

Modified: trunk/tools/dstat/plugins/dstat_mysql5_keys.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql5_keys.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql5_keys.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -2,8 +2,6 @@
 # 2007-09-04 - <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">lefred at inuits.be</A>
 global MySQLdb
 import MySQLdb
-global string, select
-import string, select
 
 global mysql_user
 global mysql_pwd

Modified: trunk/tools/dstat/plugins/dstat_mysql_io.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql_io.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql_io.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 global mysql_options
 mysql_options = os.getenv('DSTAT_MYSQL')
 

Modified: trunk/tools/dstat/plugins/dstat_mysql_keys.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_mysql_keys.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_mysql_keys.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string, select
-import string, select
-
 global mysql_options
 mysql_options = os.getenv('DSTAT_MYSQL')
 

Modified: trunk/tools/dstat/plugins/dstat_net_packets.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_net_packets.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_net_packets.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,49 +3,50 @@
         self.format = ('f', 5, 1000)
         self.open('/proc/net/dev')
         self.nick = ('#recv', '#send')
+        self.totalfilter = re.compile('^(lo|bond[0-9]+|face|.+\.[0-9]+)$')
         self.discover = self.discover()
         self.vars = self.vars()
         self.name = ['pkt/'+name for name in self.vars]
         self.init(self.vars + ['total',], 2)
 
-    def discover(self, *list):
+    def discover(self, *objlist):
         ret = []
-        for line in self.readlines():
-            l = line.replace(':', ' ').split()
+        for l in self.splitlines(replace=':'):
             if len(l) &lt; 17: continue
             if l[2] == '0' and l[10] == '0': continue
             name = l[0]
             if name not in ('lo', 'face'):
                 ret.append(name)
         ret.sort()
-        for item in list: ret.append(item)
+        for item in objlist: ret.append(item)
         return ret
 
     def vars(self):
         ret = []
         if op.netlist:
-            list = op.netlist
+            varlist = op.netlist
         elif not op.full:
-            list = ('total',)
+            varlist = ('total',)
         else:
-            list = self.discover
-#           if len(list) &gt; 2: list = list[0:2]
-            list.sort()
-        for name in list:
+            varlist = self.discover
+#           if len(varlist) &gt; 2: varlist = varlist[0:2]
+            varlist.sort()
+        for name in varlist:
             if name in self.discover + ['total', 'lo']:
                 ret.append(name)
+        if not ret:
+            raise Exception, &quot;No suitable network interfaces found to monitor&quot;
         return ret
 
     def extract(self):
         self.cn2['total'] = [0, 0]
-        for line in self.readlines():
-            l = line.replace(':', ' ').split()
+        for l in self.splitlines(replace=':'):
             if len(l) &lt; 17: continue
             if l[2] == '0' and l[10] == '0': continue
             name = l[0]
             if name in self.vars :
                 self.cn2[name] = ( long(l[2]), long(l[10]) )
-            if name not in ('lo','face'):
+            if not self.totalfilter.match(name):
                 self.cn2['total'] = ( self.cn2['total'][0] + long(l[2]), self.cn2['total'][1] + long(l[10]))
         if update:
             for name in self.cn2.keys():

Modified: trunk/tools/dstat/plugins/dstat_nfs3.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_nfs3.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_nfs3.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_nfs3(dstat):
     def __init__(self):
         self.name = 'nfs3 client'
@@ -12,8 +9,7 @@
         info(1, 'Module dstat_nfs3 is still experimental.')
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'proc3': continue
             self.cn2['read'] = long(l[8])
             self.cn2['write'] = long(l[9])

Modified: trunk/tools/dstat/plugins/dstat_nfs3op.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_nfs3op.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_nfs3op.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_nfs3op(dstat):
     def __init__(self):
         self.name = 'extended nfs3 client operations'
@@ -12,8 +9,7 @@
         info(1, 'Module dstat_nfs3op is still experimental.')
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'proc3': continue
             for i, name in enumerate(self.vars):
                 self.cn2[name] = long(l[i+2])

Modified: trunk/tools/dstat/plugins/dstat_nfsd3.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_nfsd3.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_nfsd3.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_nfsd3(dstat):
     def __init__(self):
         self.name = 'nfs3 server'
@@ -12,8 +9,7 @@
         info(1, 'Module dstat_nfsd3 is still experimental.')
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'proc3': continue
             self.cn2['read'] = long(l[8])
             self.cn2['write'] = long(l[9])

Modified: trunk/tools/dstat/plugins/dstat_nfsd3op.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_nfsd3op.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_nfsd3op.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_nfsd3op(dstat):
     def __init__(self):
         self.name = 'extended nfs3 server operations'
@@ -12,8 +9,7 @@
         info(1, 'Module dstat_nfsd3op is still experimental.')
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'proc3': continue
             for i, name in enumerate(self.vars):
                 self.cn2[name] = long(l[i+2])

Modified: trunk/tools/dstat/plugins/dstat_postfix.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_postfix.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_postfix.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -9,7 +9,7 @@
         self.nick = ('inco', 'actv', 'dfrd', 'bnce', 'defr')
         self.init(self.vars, 1)
 
-    def check(self): 
+    def check(self):
         if not os.access('/var/spool/postfix/active', os.R_OK):
             raise Exception, 'Cannot access postfix queues'
         return True

Modified: trunk/tools/dstat/plugins/dstat_power.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_power.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_power.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_power(dstat):
     def __init__(self):
         self.name = 'power'
@@ -16,7 +13,7 @@
         self.rate = 0
         for battery in os.listdir('/proc/acpi/battery/'):
             for line in dopen('/proc/acpi/battery/'+battery+'/state').readlines():
-                l = string.split(line)
+                l = line.split()
                 if len(l) &lt; 2: continue
                 self.batteries.append(battery)
                 break
@@ -33,7 +30,7 @@
         watts_drawn = 0
         for battery in self.batteries:
             for line in dopen('/proc/acpi/battery/'+battery+'/state').readlines():
-                l = string.split(line)
+                l = line.split()
                 if len(l) &lt; 3: continue
                 if l[0] == 'present:' and l[1] != 'yes': continue
                 if l[0:2] == ['charging','state:'] and l[2] != 'discharging':

Modified: trunk/tools/dstat/plugins/dstat_rpc.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_rpc.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_rpc.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_rpc(dstat):
     def __init__(self):
         self.name = 'rpc client'
@@ -11,8 +8,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'rpc': continue
             for i, name in enumerate(self.vars):
                 self.cn2[name] = long(l[i+1])

Modified: trunk/tools/dstat/plugins/dstat_rpcd.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_rpcd.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_rpcd.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_rpcd(dstat):
     def __init__(self):
         self.name = 'rpc server'
@@ -11,8 +8,7 @@
         self.init(self.vars, 1)
 
     def extract(self):
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if not l or l[0] != 'rpc': continue
             for i, name in enumerate(self.vars):
                 self.cn2[name] = long(l[i+1])

Modified: trunk/tools/dstat/plugins/dstat_thermal.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_thermal.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_thermal.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,25 +1,22 @@
-global string
-import string
-
 class dstat_thermal(dstat):
     def __init__(self):
         self.name = 'thermal'
-        self.format = ('d', 4, 20)
+        self.format = ('d', 3, 20)
         if os.path.exists('/proc/acpi/ibm/thermal'):
-            self.namelist = ['cpu', 'pci', 'hdd', 'cpu', 'bat0', 'unk', 'bat1', 'unk']
+            self.namelist = ['cpu', 'pci', 'hdd', 'cpu', 'ba0', 'unk', 'ba1', 'unk']
             self.nick = []
             for line in dopen('/proc/acpi/ibm/thermal'):
-                l = string.split(line)
+                l = line.split()
                 for i, name in enumerate(self.namelist):
                     if int(l[i+1]) &gt; 0:
                         self.nick.append(name)
             self.vars = self.nick
         elif os.path.exists('/proc/acpi/thermal_zone/'):
             self.vars = os.listdir('/proc/acpi/thermal_zone/')
-#           self.nick = [string.lower(name) for name in self.vars]
+#           self.nick = [name.lower() for name in self.vars]
             self.nick = []
             for name in self.vars:
-                self.nick.append(string.lower(name))
+                self.nick.append(name.lower())
         else:
             raise Exception, 'Needs kernel ACPI or IBM-ACPI support'
         self.init(self.vars, 1)
@@ -27,14 +24,14 @@
     def extract(self):
         if os.path.exists('/proc/acpi/ibm/thermal'):
             for line in dopen('/proc/acpi/ibm/thermal'):
-                l = string.split(line)
+                l = line.split()
                 for i, name in enumerate(self.namelist):
                     if int(l[i+1]) &gt; 0:
                         self.val[name] = int(l[i+1])
         elif os.path.exists('/proc/acpi/thermal_zone/'):
             for zone in self.vars:
                 for line in dopen('/proc/acpi/thermal_zone/'+zone+'/temperature').readlines():
-                    l = string.split(line)
+                    l = line.split()
                     self.val[zone] = int(l[1])
 
 # vim:ts=4:sw=4:et

Modified: trunk/tools/dstat/plugins/dstat_topbio.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_topbio.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_topbio.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_topbio(dstat):
     def __init__(self):
         self.name = 'most expensive'
@@ -37,12 +34,11 @@
                     self.cn1[pid] = {'read_bytes:': 0, 'write_bytes:': 0}
 
                 ### Extract name
-                l = string.split(open('/proc/%s/stat' % pid).read())
-                name = l[1][1:-1]
+                name = open('/proc/%s/stat' % pid).read().split()[1][1:-1]
 
                 ### Extract counters
                 for line in open('/proc/%s/io' % pid).readlines():
-                    l = string.split(line)
+                    l = line.split()
                     if len(l) != 2: continue
                     self.cn2[pid][l[0]] = int(l[1])
 

Modified: trunk/tools/dstat/plugins/dstat_topcpu.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_topcpu.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_topcpu.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 global cpunr
 
 class dstat_topcpu(dstat):
@@ -28,7 +25,7 @@
                 if pid == self.pid: continue
 
                 ### Using dopen() will cause too many open files
-                l = string.split(open('/proc/%s/stat' % pid).read())
+                l = open('/proc/%s/stat' % pid).read().split()
                 if len(l) &lt; 15: continue
 
                 ### Reset previous value if it doesn't exist

Modified: trunk/tools/dstat/plugins/dstat_topio.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_topio.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_topio.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_topio(dstat):
     def __init__(self):
         self.name = 'most expensive'
@@ -37,12 +34,11 @@
                     self.cn1[pid] = {'rchar:': 0, 'wchar:': 0}
 
                 ### Extract name
-                l = string.split(open('/proc/%s/stat' % pid).read())
-                name = l[1][1:-1]
+                name = open('/proc/%s/stat' % pid).read().split()[1][1:-1]
 
                 ### Extract counters
                 for line in open('/proc/%s/io' % pid).readlines():
-                    l = string.split(line)
+                    l = line.split()
                     if len(l) != 2: continue
                     self.cn2[pid][l[0]] = int(l[1])
 

Modified: trunk/tools/dstat/plugins/dstat_topmem.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_topmem.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_topmem.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_topmem(dstat):
     def __init__(self):
         self.name = 'most expensive'
@@ -26,7 +23,7 @@
                 if pid == self.pid: continue
 
                 ### Using dopen() will cause too many open files
-                l = string.split(open('/proc/%s/stat' % pid).read())
+                l = open('/proc/%s/stat' % pid).read().split()
                 if len(l) &lt; 23: continue
                 usage = int(l[23]) * pagesize
 

Modified: trunk/tools/dstat/plugins/dstat_topoom.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_topoom.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_topoom.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -3,9 +3,6 @@
 ###
 ### Authority: <A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>
 
-global string
-import string
-
 class dstat_topoom(dstat):
     def __init__(self):
         self.name = 'out of memory'
@@ -31,7 +28,7 @@
                 if pid == self.pid: continue
 
                 ### Using dopen() will cause too many open files
-                l = string.split(open('/proc/%s/oom_score' % pid).read())
+                l = open('/proc/%s/oom_score' % pid).read().split()
                 if len(l) &lt; 1: continue
                 oom_score = int(l[0])
 
@@ -39,7 +36,7 @@
                 if oom_score &lt; self.val['max']: continue
 
                 ### Extract name
-                l = string.split(open('/proc/%s/stat' % pid).read())
+                l = open('/proc/%s/stat' % pid).read().split()
                 name = l[1][1:-1]
 
             except ValueError:

Modified: trunk/tools/dstat/plugins/dstat_vmkint.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_vmkint.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_vmkint.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -39,9 +39,7 @@
         ret = []
         # default cpu number is 2
         ret = 2
-        self.fd[0].seek(0)
-        for line in self.fd[0].readlines():
-            l = line.split()
+        for l in self.fd[0].splitlines():
             if l[0] == 'Vector': 
                 ret = int( int( l[-1] ) + 1 )
         return ret

Modified: trunk/tools/dstat/plugins/dstat_vmknic.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_vmknic.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_vmknic.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -24,8 +24,7 @@
 
 	def discover(self, *list):
 		ret = []
-		for line in self.fd[0].readlines():
-			l = line.replace(' /','/').split()
+		for l in self.fd[0].splitlines(replace=' /', delim='/'):
 			if len(l) != 12: continue
 			if l[2][:5] == '&lt;Link': continue
 			if ','.join(l) == 'Name,Mtu/TSO,Network,Address,Ipkts,Ierrs,Ibytes,Opkts,Oerrs,Obytes,Coll,Time': continue

Modified: trunk/tools/dstat/plugins/dstat_vmmemctl.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_vmmemctl.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_vmmemctl.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -23,8 +23,7 @@
 			raise Exception, 'Needs VMware Tools (modprobe vmmemctl)'
 
 	def extract(self):
-		for line in self.readlines():
-			l = line.split()
+		for l in self.splitlines():
 			if len(l) &lt; 3: continue
 			if l[0] != 'current:': continue
 			if l[2] != 'pages': continue

Modified: trunk/tools/dstat/plugins/dstat_vzcpu.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_vzcpu.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_vzcpu.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,5 +1,3 @@
-global string
-import string
 
 #Version: 2.2
 #VEID   user    nice    system   uptime     idle             strv   uptime          used           maxlat  totlat  numsched
@@ -19,8 +17,7 @@
 
     def discover(self, *list):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 6 or l[0] == 'VEID': continue
             ret.append(l[0])
         ret.sort()
@@ -49,8 +46,7 @@
 
     def extract(self):
         self.cn2['total'] = [0, 0, 0, 0]
-        for line in self.readlines():
-            l = line.split() 
+        for line in self.splitlines():
             if len(l) &lt; 6 or l[0] == 'VEID': continue
             name = l[0]
             self.cn2[name] = ( long(l[1]), long(l[3]), long(l[4]) - long(l[1]) - long(l[2]) - long(l[3]), long(l[2]) )

Modified: trunk/tools/dstat/plugins/dstat_vzubc.py
===================================================================
--- trunk/tools/dstat/plugins/dstat_vzubc.py	2009-08-09 19:28:15 UTC (rev 7605)
+++ trunk/tools/dstat/plugins/dstat_vzubc.py	2009-08-14 15:28:41 UTC (rev 7606)
@@ -1,6 +1,3 @@
-global string
-import string
-
 class dstat_vzubc(dstat):
     def __init__(self):
         self.format = ('d', 5, 1000)
@@ -14,8 +11,7 @@
 
     def discover(self, *list):
         ret = []
-        for line in self.readlines():
-            l = line.split()
+        for l in self.splitlines():
             if len(l) &lt; 7 or l[0] in ('uid', '0:'): continue
             ret.append(l[0][0:-1])
         ret.sort()
@@ -45,8 +41,7 @@
     def extract(self):
         for name in self.vars + ['total']:
             self.cn2[name] = 0
-        for line in self.readlines():
-            l = line.split() 
+        for l in self.splitlines():
             if len(l) &lt; 6 or l[0] == 'uid':
                 continue
             elif len(l) == 7:


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006401.html">[svn] r7605 - trunk/rpms/truecrypt
</A></li>
	<LI>Next message: <A HREF="006403.html">[svn] r7607 - in trunk/tools/wiipresent: . docs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6402">[ date ]</a>
              <a href="thread.html#6402">[ thread ]</a>
              <a href="subject.html#6402">[ subject ]</a>
              <a href="author.html#6402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
