<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r3173 - in trunk/rpms: xine xine-lib
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3173%20-%20in%20trunk/rpms%3A%20xine%20xine-lib&In-Reply-To=%3C20050502091455.D5F37318021%40lists.rpmforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001974.html">
   <LINK REL="Next"  HREF="001976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r3173 - in trunk/rpms: xine xine-lib</H1>
    <B>packagers at lists.rpmforge.net</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r3173%20-%20in%20trunk/rpms%3A%20xine%20xine-lib&In-Reply-To=%3C20050502091455.D5F37318021%40lists.rpmforge.net%3E"
       TITLE="[svn] r3173 - in trunk/rpms: xine xine-lib">packagers at lists.rpmforge.net
       </A><BR>
    <I>Mon May  2 11:14:55 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001974.html">[svn] r3172 - trunk/tools/yam
</A></li>
        <LI>Next message: <A HREF="001976.html">[svn] r3174 - trunk/rpms/mplayer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1975">[ date ]</a>
              <a href="thread.html#1975">[ thread ]</a>
              <a href="subject.html#1975">[ subject ]</a>
              <a href="author.html#1975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: thias
Date: 2005-05-02 11:14:53 +0200 (Mon, 02 May 2005)
New Revision: 3173

Added:
   trunk/rpms/xine-lib/xine-lib-1.0.1-gcc4.patch
   trunk/rpms/xine-lib/xine-lib-1.0.1-noffmmx.patch
   trunk/rpms/xine/smokeyglass_logo.m1v
   trunk/rpms/xine/smokeyglass_splash.png
   trunk/rpms/xine/xine-ui-0.99.3-gcc4.patch
   trunk/rpms/xine/xine.png
Modified:
   trunk/rpms/xine-lib/xine-lib.spec
   trunk/rpms/xine/xine.spec
Log:
Update xine-lib to 1.0.1, include gcc4 fixes and make xine desktop presence nicer (new icon, spash screen and default screen).


Added: trunk/rpms/xine/smokeyglass_logo.m1v
===================================================================
(Binary files differ)


Property changes on: trunk/rpms/xine/smokeyglass_logo.m1v
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/rpms/xine/smokeyglass_splash.png
===================================================================
(Binary files differ)


Property changes on: trunk/rpms/xine/smokeyglass_splash.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/rpms/xine/xine-ui-0.99.3-gcc4.patch
===================================================================
--- trunk/rpms/xine/xine-ui-0.99.3-gcc4.patch	2005-05-02 00:28:48 UTC (rev 3172)
+++ trunk/rpms/xine/xine-ui-0.99.3-gcc4.patch	2005-05-02 09:14:53 UTC (rev 3173)
@@ -0,0 +1,16 @@
+--- xine-ui-0.99.3/src/xitk/mediamark.c.orig	2005-04-21 21:12:34.000000000 +0800
++++ xine-ui-0.99.3/src/xitk/mediamark.c	2005-04-21 21:15:31.000000000 +0800
+@@ -3121,11 +3121,11 @@ static void mmkeditor_apply(xitk_widget_
+     
+     mrl = atoa(xitk_inputtext_get_text(mmkeditor-&gt;mrl));
+     if(mrl &amp;&amp; (!strlen(mrl)))
+-      xine_strdupa((char *) mrl, (*mmkeditor-&gt;mmk)-&gt;mrl);
++      xine_strdupa(mrl, (*mmkeditor-&gt;mmk)-&gt;mrl);
+     
+     ident = atoa(xitk_inputtext_get_text(mmkeditor-&gt;ident));
+     if(ident &amp;&amp; (!strlen(ident)))
+-      xine_strdupa((char *) ident, mrl);
++      xine_strdupa(ident, mrl);
+ 
+     sub = xitk_inputtext_get_text(mmkeditor-&gt;sub);
+     if(sub &amp;&amp; (!strlen(sub)))

Added: trunk/rpms/xine/xine.png
===================================================================
(Binary files differ)


Property changes on: trunk/rpms/xine/xine.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/rpms/xine/xine.spec
===================================================================
--- trunk/rpms/xine/xine.spec	2005-05-02 00:28:48 UTC (rev 3172)
+++ trunk/rpms/xine/xine.spec	2005-05-02 09:14:53 UTC (rev 3173)
@@ -11,11 +11,15 @@
 Summary: Free multimedia player
 Name: xine
 Version: 0.99.3
-Release: 2
+Release: 4
 License: GPL
 Group: Applications/Multimedia
 URL: <A HREF="http://xinehq.de/">http://xinehq.de/</A>
-Source: <A HREF="http://dl.sf.net/xine/xine-ui-%{version">http://dl.sf.net/xine/xine-ui-%{version</A>}.tar.gz
+Source0: <A HREF="http://dl.sf.net/xine/xine-ui-%{version">http://dl.sf.net/xine/xine-ui-%{version</A>}.tar.gz
+Source1: xine.png
+Source2: <A HREF="http://www.bluebeamentertainment.com/xine/smokeyglass_splash.png">http://www.bluebeamentertainment.com/xine/smokeyglass_splash.png</A>
+Source3: <A HREF="http://www.bluebeamentertainment.com/xine/smokeyglass_logo.m1v">http://www.bluebeamentertainment.com/xine/smokeyglass_logo.m1v</A>
+Patch: xine-ui-0.99.3-gcc4.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: xine-lib &gt;= 1.0.0
 BuildRequires: gcc-c++, XFree86-devel, libpng-devel, xine-lib-devel &gt;= 1.0.0
@@ -41,17 +45,23 @@
 
 %prep
 %setup -n xine-ui-%{version}
+%patch -p1 -b .gcc4
 # Fix for lirc needed to be searched for in lib64
 %{__perl} -pi.orig -e 's|(lirc_libprefix /lib) /usr/lib|$1 %{_libdir}|g' \
     configure
 
+# Replace the default Christmas splash screen, it's nearly May already!
+%{__cp} -a -f %{SOURCE2} misc/xine_splash.png
+# Replace the default window content with one matching the splash screen
+%{__cp} -a -f %{SOURCE3} misc/xine-ui_logo.mpv
+
 %{__cat} &lt;&lt;EOF &gt;xine.desktop
 [Desktop Entry]
-Name=Xine Multimedia Player
+Name=Xine
 Comment=Versatile Multimedia Player
-Exec=xine
+Exec=xine %U
 MimeType=video/mpeg;video/quicktime;video/x-msvideo;audio/x-mp3;audio/x-mp2;audio/x-mpegurl;
-Icon=xine.xpm
+Icon=xine.png
 Terminal=false
 Type=Application
 Encoding=UTF-8
@@ -85,8 +95,13 @@
 %{__make} install DESTDIR=%{buildroot}
 %find_lang xine-ui
 
-%{__install} -Dp -m0644 xine.applications %{buildroot}%{_datadir}/application-registry/xine.applications
+%{__install} -D -m 0644 xine.applications \
+    %{buildroot}%{_datadir}/application-registry/xine.applications
 
+# Replace (ugly) default icons with a nice one
+%{__rm} -rf %{buildroot}%{_datadir}/pixmaps/*
+%{__install} -p -m 0644 %{SOURCE1} %{buildroot}%{_datadir}/pixmaps/
+
 # Remove unpackaged files
 find %{buildroot} -name &quot;xitk*&quot; | xargs rm -rf || :
 
@@ -94,7 +109,7 @@
 %{__mv} %{buildroot}%{_docdir}/xine-ui xine-ui-doc
 
 %if %{?_without_freedesktop:1}0
-%{__install} -Dp -m644 xine.desktop %{buildroot}/etc/X11/applnk/Multimedia/xine.desktop
+%{__install} -D -m 0644 xine.desktop %{buildroot}/etc/X11/applnk/Multimedia/xine.desktop
 %else
 %{__mkdir_p} %{buildroot}%{_datadir}/applications/
 desktop-file-install --vendor %{desktop_vendor} \
@@ -120,7 +135,7 @@
 #{!?_without_aalib:%{_bindir}/aaxine}
 %{_bindir}/*
 %{_datadir}/application-registry/xine.applications
-%{_datadir}/pixmaps/*
+%{_datadir}/pixmaps/xine.png
 %{_datadir}/xine/
 %{!?_without_freedesktop:%{_datadir}/applications/%{desktop_vendor}-%{name}.desktop}
 %{?_without_freedesktop:/etc/X11/applnk/Multimedia/%{name}.desktop}
@@ -132,6 +147,14 @@
 
 
 %changelog
+* Fri Apr 29 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.99.3-4
+- Replace Christmas splash screen with another one.
+- Add gcc4 patch.
+- Replace default icons with a nicer home made one.
+
+* Tue Apr  5 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.99.3-3
+- Fix Exec line in desktop file to get drag and drop to work properly (%U).
+
 * Fri Jan  7 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 0.99.3-2
 - Add a quick lib vs. lib64 replace for lirc static lib detection to work on
   x86_64.

Added: trunk/rpms/xine-lib/xine-lib-1.0.1-gcc4.patch
===================================================================
--- trunk/rpms/xine-lib/xine-lib-1.0.1-gcc4.patch	2005-05-02 00:28:48 UTC (rev 3172)
+++ trunk/rpms/xine-lib/xine-lib-1.0.1-gcc4.patch	2005-05-02 09:14:53 UTC (rev 3173)
@@ -0,0 +1,281 @@
+diff -Naupr xine-lib-1.0.1.orig/src/libffmpeg/libavcodec/avcodec.h xine-lib-1.0.1/src/libffmpeg/libavcodec/avcodec.h
+--- xine-lib-1.0.1.orig/src/libffmpeg/libavcodec/avcodec.h	2005-04-26 10:09:09.000000000 +0200
++++ xine-lib-1.0.1/src/libffmpeg/libavcodec/avcodec.h	2005-04-28 23:28:11.000000000 +0200
+@@ -1603,41 +1603,7 @@ typedef struct AVCodecContext {
+      int intra_dc_precision;
+ } AVCodecContext;
+ 
+-
+-/**
+- * AVOption.
+- */
+-typedef struct AVOption {
+-    /** options' name */
+-    const char *name; /* if name is NULL, it indicates a link to next */
+-    /** short English text help or const struct AVOption* subpointer */
+-    const char *help; //	const struct AVOption* sub;
+-    /** offset to context structure where the parsed value should be stored */
+-    int offset;
+-    /** options' type */
+-    int type;
+-#define FF_OPT_TYPE_BOOL 1      ///&lt; boolean - true,1,on  (or simply presence)
+-#define FF_OPT_TYPE_DOUBLE 2    ///&lt; double
+-#define FF_OPT_TYPE_INT 3       ///&lt; integer
+-#define FF_OPT_TYPE_STRING 4    ///&lt; string (finished with \0)
+-#define FF_OPT_TYPE_MASK 0x1f	///&lt; mask for types - upper bits are various flags
+-//#define FF_OPT_TYPE_EXPERT 0x20 // flag for expert option
+-#define FF_OPT_TYPE_FLAG (FF_OPT_TYPE_BOOL | 0x40)
+-#define FF_OPT_TYPE_RCOVERRIDE (FF_OPT_TYPE_STRING | 0x80)
+-    /** min value  (min == max   -&gt;  no limits) */
+-    double min;
+-    /** maximum value for double/int */
+-    double max;
+-    /** default boo [0,1]l/double/int value */
+-    double defval;
+-    /**
+-     * default string value (with optional semicolon delimited extra option-list
+-     * i.e.   option1;option2;option3
+-     * defval might select other then first argument as default
+-     */
+-    const char *defstr;
+-#define FF_OPT_MAX_DEPTH 10
+-} AVOption;
++struct AVOption;
+ 
+ /**
+  * Parse option(s) and sets fields in passed structure
+diff -Naupr xine-lib-1.0.1.orig/src/libffmpeg/libavcodec/common.h xine-lib-1.0.1/src/libffmpeg/libavcodec/common.h
+--- xine-lib-1.0.1.orig/src/libffmpeg/libavcodec/common.h	2005-04-26 10:09:09.000000000 +0200
++++ xine-lib-1.0.1/src/libffmpeg/libavcodec/common.h	2005-04-28 23:28:11.000000000 +0200
+@@ -27,6 +27,38 @@
+ #define M_PI    3.14159265358979323846
+ #endif
+ 
++typedef struct AVOption {
++    /** options' name */
++    const char *name; /* if name is NULL, it indicates a link to next */
++    /** short English text help or const struct AVOption* subpointer */
++    const char *help; //        const struct AVOption* sub;
++    /** offset to context structure where the parsed value should be stored */
++    int offset;
++    /** options' type */
++    int type;
++#define FF_OPT_TYPE_BOOL 1      ///&lt; boolean - true,1,on  (or simply presence)
++#define FF_OPT_TYPE_DOUBLE 2    ///&lt; double
++#define FF_OPT_TYPE_INT 3       ///&lt; integer
++#define FF_OPT_TYPE_STRING 4    ///&lt; string (finished with \0)
++#define FF_OPT_TYPE_MASK 0x1f   ///&lt; mask for types - upper bits are various flags
++//#define FF_OPT_TYPE_EXPERT 0x20 // flag for expert option
++#define FF_OPT_TYPE_FLAG (FF_OPT_TYPE_BOOL | 0x40)
++#define FF_OPT_TYPE_RCOVERRIDE (FF_OPT_TYPE_STRING | 0x80)
++    /** min value  (min == max   -&gt;  no limits) */
++    double min;
++    /** maximum value for double/int */
++    double max;
++    /** default boo [0,1]l/double/int value */
++    double defval;
++    /**
++     * default string value (with optional semicolon delimited extra option-list
++     * i.e.   option1;option2;option3
++     * defval might select other then first argument as default
++     */
++    const char *defstr;
++#define FF_OPT_MAX_DEPTH 10
++} AVOption;
++
+ #ifdef HAVE_AV_CONFIG_H
+ /* only include the following when compiling package */
+ #    include &quot;config.h&quot;
+@@ -66,7 +98,6 @@
+ #define AVOPTION_SUB(ptr) { .name = NULL, .help = (const char*)ptr }
+ #define AVOPTION_END() AVOPTION_SUB(NULL)
+ 
+-struct AVOption;
+ #ifdef HAVE_MMX
+ extern const struct AVOption avoptions_common[3 + 5];
+ #else
+diff -Naupr xine-lib-1.0.1.orig/src/libw32dll/w32codec.c xine-lib-1.0.1/src/libw32dll/w32codec.c
+--- xine-lib-1.0.1.orig/src/libw32dll/w32codec.c	2005-04-26 10:09:15.000000000 +0200
++++ xine-lib-1.0.1/src/libw32dll/w32codec.c	2005-04-28 23:28:11.000000000 +0200
+@@ -131,7 +131,6 @@ static GUID wmav_clsid =
+  */
+ static pthread_mutex_t win32_codec_mutex;
+ static pthread_once_t once_control = PTHREAD_ONCE_INIT;
+-static char*   win32_codec_name; 
+ 
+ #define VIDEOBUFSIZE 128*1024
+ 
+diff -Naupr xine-lib-1.0.1.orig/src/libw32dll/wine/ext.c xine-lib-1.0.1/src/libw32dll/wine/ext.c
+--- xine-lib-1.0.1.orig/src/libw32dll/wine/ext.c	2005-04-26 10:09:14.000000000 +0200
++++ xine-lib-1.0.1/src/libw32dll/wine/ext.c	2005-04-28 23:28:11.000000000 +0200
+@@ -469,7 +469,7 @@ LPVOID WINAPI VirtualAlloc(LPVOID addres
+ 
+     if (type&amp;MEM_RESERVE &amp;&amp; (unsigned)address&amp;0xffff) {
+        size += (unsigned)address&amp;0xffff;
+-       (unsigned)address &amp;= ~0xffff;
++       address = (unsigned)address &amp; ~0xffff;
+     }
+     pgsz = sysconf(_SC_PAGESIZE);
+     if (type&amp;MEM_COMMIT &amp;&amp; (unsigned)address%pgsz) {
+diff -Naupr xine-lib-1.0.1.orig/src/libw32dll/wine/win32.c xine-lib-1.0.1/src/libw32dll/wine/win32.c
+--- xine-lib-1.0.1.orig/src/libw32dll/wine/win32.c	2005-04-26 10:09:14.000000000 +0200
++++ xine-lib-1.0.1/src/libw32dll/wine/win32.c	2005-04-28 23:28:11.000000000 +0200
+@@ -2623,7 +2623,7 @@ static int WINAPI expGetWindowThreadProc
+     dbgprintf(&quot;GetWindowThreadProcessId(0x%x, 0x%x) =&gt; %d\n&quot;,
+ 	win, pid_data, tid);
+     if (pid_data)
+-	(int)*pid_data = tid;
++	*pid_data = tid;
+     return tid;
+ }
+ 
+diff -Naupr xine-lib-1.0.1.orig/src/libxineadec/nosefart/nes_apu.c xine-lib-1.0.1/src/libxineadec/nosefart/nes_apu.c
+--- xine-lib-1.0.1.orig/src/libxineadec/nosefart/nes_apu.c	2005-04-26 10:09:16.000000000 +0200
++++ xine-lib-1.0.1/src/libxineadec/nosefart/nes_apu.c	2005-04-28 23:28:11.000000000 +0200
+@@ -1012,9 +1012,10 @@ void apu_process(void *buffer, int num_s
+ 
+       /* signed 16-bit output, unsigned 8-bit */
+       if (16 == apu-&gt;sample_bits)
+-         *((int16 *) buffer)++ = (int16) accum;
++         *(int16 *) buffer = (int16) accum;
+       else
+-         *((uint8 *) buffer)++ = (accum &gt;&gt; 8) ^ 0x80;
++         *(uint8 *) buffer = (accum &gt;&gt; 8) ^ 0x80;
++      buffer++;
+    }
+ 
+    /* resync cycle counter */
+diff -Naupr xine-lib-1.0.1.orig/src/post/audio/stretch.c xine-lib-1.0.1/src/post/audio/stretch.c
+--- xine-lib-1.0.1.orig/src/post/audio/stretch.c	2005-04-26 10:09:10.000000000 +0200
++++ xine-lib-1.0.1/src/post/audio/stretch.c	2005-04-28 23:28:11.000000000 +0200
+@@ -476,7 +476,7 @@ static void stretch_process_fragment( po
+     memcpy( outbuf-&gt;mem, data_out, 
+             outbuf-&gt;num_frames * this-&gt;bytes_per_frame );
+     num_frames_out -= outbuf-&gt;num_frames;
+-    (uint8_t *)data_out += outbuf-&gt;num_frames * this-&gt;bytes_per_frame;
++    data_out = (uint8_t *)data_out + outbuf-&gt;num_frames * this-&gt;bytes_per_frame;
+                 
+     outbuf-&gt;vpts        = this-&gt;pts;
+     this-&gt;pts           = 0;
+@@ -587,7 +587,7 @@ static void stretch_port_put_buffer (xin
+     memcpy( (uint8_t *)this-&gt;audiofrag + this-&gt;num_frames * this-&gt;bytes_per_frame,
+             data_in, frames_to_copy * this-&gt;bytes_per_frame );
+     
+-    (uint8_t *)data_in += frames_to_copy * this-&gt;bytes_per_frame;
++    data_in = (uint8_t *)data_in + frames_to_copy * this-&gt;bytes_per_frame;
+     this-&gt;num_frames += frames_to_copy;
+     buf-&gt;num_frames -= frames_to_copy;
+ 
+diff -Naupr xine-lib-1.0.1.orig/src/video_out/vidix/drivers/pm3_vid.c xine-lib-1.0.1/src/video_out/vidix/drivers/pm3_vid.c
+--- xine-lib-1.0.1.orig/src/video_out/vidix/drivers/pm3_vid.c	2005-04-26 10:09:11.000000000 +0200
++++ xine-lib-1.0.1/src/video_out/vidix/drivers/pm3_vid.c	2005-04-28 23:28:11.000000000 +0200
+@@ -49,7 +49,6 @@
+ 
+ static pciinfo_t pci_info;
+ 
+-static void *pm3_reg_base;
+ static void *pm3_mem;
+ 
+ static int pm3_vidmem = PM3_VIDMEM;
+diff -Naupr xine-lib-1.0.1.orig/src/xine-engine/post.c xine-lib-1.0.1/src/xine-engine/post.c
+--- xine-lib-1.0.1.orig/src/xine-engine/post.c	2005-04-26 10:09:12.000000000 +0200
++++ xine-lib-1.0.1/src/xine-engine/post.c	2005-04-28 23:28:26.000000000 +0200
+@@ -241,7 +241,7 @@ post_video_port_t *_x_post_intercept_vid
+     if (!*input) return port;
+     (*input)-&gt;xine_in.name = &quot;video in&quot;;
+     (*input)-&gt;xine_in.type = XINE_POST_DATA_VIDEO;
+-    (xine_video_port_t *)(*input)-&gt;xine_in.data = &amp;port-&gt;new_port;
++    (*input)-&gt;xine_in.data = &amp;port-&gt;new_port;
+     (*input)-&gt;post = post;
+     xine_list_append_content(post-&gt;input, *input);
+   }
+@@ -251,7 +251,7 @@ post_video_port_t *_x_post_intercept_vid
+     if (!*output) return port;
+     (*output)-&gt;xine_out.name = &quot;video out&quot;;
+     (*output)-&gt;xine_out.type = XINE_POST_DATA_VIDEO;
+-    (xine_video_port_t **)(*output)-&gt;xine_out.data = &amp;port-&gt;original_port;
++    (*output)-&gt;xine_out.data = &amp;port-&gt;original_port;
+     (*output)-&gt;xine_out.rewire = post_video_rewire;
+     (*output)-&gt;post = post;
+     (*output)-&gt;user_data = port;
+@@ -718,7 +718,7 @@ post_audio_port_t *_x_post_intercept_aud
+     if (!*input) return port;
+     (*input)-&gt;xine_in.name = &quot;audio in&quot;;
+     (*input)-&gt;xine_in.type = XINE_POST_DATA_AUDIO;
+-    (xine_audio_port_t *)(*input)-&gt;xine_in.data = &amp;port-&gt;new_port;
++    (*input)-&gt;xine_in.data = &amp;port-&gt;new_port;
+     (*input)-&gt;post = post;
+     xine_list_append_content(post-&gt;input, *input);
+   }
+@@ -728,7 +728,7 @@ post_audio_port_t *_x_post_intercept_aud
+     if (!*output) return port;
+     (*output)-&gt;xine_out.name = &quot;audio out&quot;;
+     (*output)-&gt;xine_out.type = XINE_POST_DATA_AUDIO;
+-    (xine_audio_port_t **)(*output)-&gt;xine_out.data = &amp;port-&gt;original_port;
++    (*output)-&gt;xine_out.data = &amp;port-&gt;original_port;
+     (*output)-&gt;xine_out.rewire = post_audio_rewire;
+     (*output)-&gt;post = post;
+     (*output)-&gt;user_data = port;
+diff -Naupr xine-lib-1.0.1.orig/src/xine-utils/color.c xine-lib-1.0.1/src/xine-utils/color.c
+--- xine-lib-1.0.1.orig/src/xine-utils/color.c	2005-04-26 10:09:15.000000000 +0200
++++ xine-lib-1.0.1/src/xine-utils/color.c	2005-04-28 23:28:26.000000000 +0200
+@@ -495,8 +495,10 @@ static void vscale_chroma_line (unsigned
+ 
+   /* process blocks of 4 pixels */
+   for (x=0; x &lt; (width / 4); x++) {
+-    n1  = *(((unsigned int *) src1)++);
+-    n2  = *(((unsigned int *) src2)++);
++    n1  = *((unsigned int *) src1);
++    src1++;
++    n2  = *((unsigned int *) src2);
++    src2++;
+     n3  = (n1 &amp; 0xFF00FF00) &gt;&gt; 8;
+     n4  = (n2 &amp; 0xFF00FF00) &gt;&gt; 8;
+     n1 &amp;= 0x00FF00FF;
+diff -Naupr xine-lib-1.0.1.orig/src/xine-utils/memcpy.c xine-lib-1.0.1/src/xine-utils/memcpy.c
+--- xine-lib-1.0.1.orig/src/xine-utils/memcpy.c	2005-04-26 10:09:15.000000000 +0200
++++ xine-lib-1.0.1/src/xine-utils/memcpy.c	2005-04-28 23:28:26.000000000 +0200
+@@ -218,8 +218,8 @@ static void * sse_memcpy(void * to, cons
+         &quot;movntps %%xmm2, 32(%1)\n&quot;
+         &quot;movntps %%xmm3, 48(%1)\n&quot;
+         :: &quot;r&quot; (from), &quot;r&quot; (to) : &quot;memory&quot;);
+-        ((const unsigned char *)from)+=64;
+-        ((unsigned char *)to)+=64;
++        from = ((const unsigned char *)from) + 64;
++        to = ((unsigned char *)to) + 64;
+       }
+     else
+       /*
+@@ -241,8 +241,8 @@ static void * sse_memcpy(void * to, cons
+         &quot;movntps %%xmm2, 32(%1)\n&quot;
+         &quot;movntps %%xmm3, 48(%1)\n&quot;
+         :: &quot;r&quot; (from), &quot;r&quot; (to) : &quot;memory&quot;);
+-        ((const unsigned char *)from)+=64;
+-        ((unsigned char *)to)+=64;
++        from = ((const unsigned char *)from) + 64;
++        to = ((unsigned char *)to) + 64;
+       }
+     /* since movntq is weakly-ordered, a &quot;sfence&quot;
+      * is needed to become ordered again. */
+@@ -296,8 +296,8 @@ static void * mmx_memcpy(void * to, cons
+       &quot;movq %%mm6, 48(%1)\n&quot;
+       &quot;movq %%mm7, 56(%1)\n&quot;
+       :: &quot;r&quot; (from), &quot;r&quot; (to) : &quot;memory&quot;);
+-      ((const unsigned char *)from)+=64;
+-      ((unsigned char *)to)+=64;
++      from = ((const unsigned char *)from) + 64;
++      to = ((unsigned char *)to) + 64;
+     }
+     __asm__ __volatile__ (&quot;emms&quot;:::&quot;memory&quot;);
+   }
+@@ -363,8 +363,8 @@ static void * mmx2_memcpy(void * to, con
+       &quot;movntq %%mm6, 48(%1)\n&quot;
+       &quot;movntq %%mm7, 56(%1)\n&quot;
+       :: &quot;r&quot; (from), &quot;r&quot; (to) : &quot;memory&quot;);
+-      ((const unsigned char *)from)+=64;
+-      ((unsigned char *)to)+=64;
++      from = ((const unsigned char *)from) + 64;
++      to = ((unsigned char *)to) + 64;
+     }
+      /* since movntq is weakly-ordered, a &quot;sfence&quot;
+      * is needed to become ordered again. */

Added: trunk/rpms/xine-lib/xine-lib-1.0.1-noffmmx.patch
===================================================================
--- trunk/rpms/xine-lib/xine-lib-1.0.1-noffmmx.patch	2005-05-02 00:28:48 UTC (rev 3172)
+++ trunk/rpms/xine-lib/xine-lib-1.0.1-noffmmx.patch	2005-05-02 09:14:53 UTC (rev 3173)
@@ -0,0 +1,38 @@
+diff -Naupr xine-lib-1.0.1.orig/configure xine-lib-1.0.1/configure
+--- xine-lib-1.0.1.orig/configure	2005-04-26 10:17:56.000000000 +0200
++++ xine-lib-1.0.1/configure	2005-04-28 23:52:05.000000000 +0200
+@@ -40979,7 +40979,6 @@ _ACEOF
+ 
+ 
+     enable_w32dll=&quot;yes&quot;
+-    enable_ffmmx=&quot;yes&quot;
+     no_fpic=&quot;yes&quot;
+     ;;
+ 
+@@ -41266,7 +41265,6 @@ cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
+ #define FPM_INTEL 1
+ _ACEOF
+ 
+-	enable_ffmmx=&quot;yes&quot;
+ 	enable_w32dll=&quot;yes&quot;
+ 
+         case &quot;$host_or_hostalias&quot; in
+diff -Naupr xine-lib-1.0.1.orig/configure.ac xine-lib-1.0.1/configure.ac
+--- xine-lib-1.0.1.orig/configure.ac	2005-04-26 10:09:18.000000000 +0200
++++ xine-lib-1.0.1/configure.ac	2005-04-28 23:51:48.000000000 +0200
+@@ -1664,7 +1664,6 @@ case &quot;$host_or_hostalias&quot; in
+     AC_DEFINE_UNQUOTED(FPM_INTEL,,[Define to select libmad fixed point arithmetic implementation])
+ 
+     enable_w32dll=&quot;yes&quot;
+-    enable_ffmmx=&quot;yes&quot;
+     no_fpic=&quot;yes&quot;
+     ;;
+ 
+@@ -1770,7 +1769,6 @@ case &quot;$host_or_hostalias&quot; in
+ 	dnl
+     	AC_DEFINE_UNQUOTED(ARCH_X86,,[Define this if you're running x86 architecture])
+ 	AC_DEFINE(FPM_INTEL,1,[Define to select libmad fixed point arithmetic implementation])
+-	enable_ffmmx=&quot;yes&quot;
+ 	enable_w32dll=&quot;yes&quot;
+ 
+         case &quot;$host_or_hostalias&quot; in

Modified: trunk/rpms/xine-lib/xine-lib.spec
===================================================================
--- trunk/rpms/xine-lib/xine-lib.spec	2005-05-02 00:28:48 UTC (rev 3172)
+++ trunk/rpms/xine-lib/xine-lib.spec	2005-05-02 09:14:53 UTC (rev 3173)
@@ -36,23 +36,25 @@
 
 %define libname libxine1
 %define libver  1.0
-%define apiver  1.0.0
 
 Summary: Core library of the xine multimedia player
 Name: xine-lib
-Version: %{apiver}
-Release: 2
+Version: 1.0.1
+Release: 1
 License: GPL
 Group: Applications/Multimedia
 URL: <A HREF="http://xinehq.de/">http://xinehq.de/</A>
-Source: <A HREF="http://dl.sf.net/xine/xine-lib-%{libver">http://dl.sf.net/xine/xine-lib-%{libver</A>}.tar.gz
-Patch: xine-lib-1.0-unbreak-64bit-faad.patch
+Source: <A HREF="http://dl.sf.net/xine/xine-lib-%{version">http://dl.sf.net/xine/xine-lib-%{version</A>}.tar.gz
+Patch0: xine-lib-1.0-unbreak-64bit-faad.patch
+Patch1: xine-lib-1.0.1-gcc4.patch
+Patch2: xine-lib-1.0.1-noffmmx.patch
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: libdvdcss
 BuildRequires: gcc-c++, pkgconfig, XFree86-devel, zlib-devel
 BuildRequires: libvorbis-devel, SDL-devel
 # BUG : libmng-devel should apparently require libjpeg-devel for includes
 BuildRequires: libpng-devel, libmng-devel, libjpeg-devel
+BuildRequires: libtool, autoconf, automake
 %{?_with_rte:BuildRequires: rte-devel}
 %{?_with_ext-dvdnav:BuildRequires: libdvdnav-devel &gt;= 0.1.4}
 %{!?_without_alsa:BuildRequires: alsa-lib-devel}
@@ -108,8 +110,11 @@
 
 
 %prep
-%setup -n %{name}-%{libver}
-%patch -p1 -b .faad
+%setup
+%patch0 -p1 -b .faad
+%patch1 -p1 -b .gcc4
+%patch2 -p1 -b .noffmmx
+#./autogen.sh noconfig
 
 
 %build
@@ -162,6 +167,12 @@
 
 
 %changelog
+* Thu Apr 28 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.1-1
+- Update to 1.0.1.
+- Add patch for GCC4 from Ville.
+- Disable ffmpeg's MMX, build fails otherwise.
+- Run autogen to fix lib linking problem.
+
 * Fri Feb  4 2005 Matthias Saou &lt;<A HREF="http://freshrpms.net/">http://freshrpms.net/</A>&gt; 1.0.0-2
 - Added patch to fix faad on x86_64, thanks to Nicholas Miell.
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001974.html">[svn] r3172 - trunk/tools/yam
</A></li>
	<LI>Next message: <A HREF="001976.html">[svn] r3174 - trunk/rpms/mplayer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1975">[ date ]</a>
              <a href="thread.html#1975">[ thread ]</a>
              <a href="subject.html#1975">[ subject ]</a>
              <a href="author.html#1975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
