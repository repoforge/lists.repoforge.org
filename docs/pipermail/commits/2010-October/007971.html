<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [svn] r9187 - in /trunk/tools/unoconv: ChangeLog TODO docs/unoconv.1 docs/unoconv.1.txt unoconv
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9187%20-%20in%20/trunk/tools/unoconv%3A%20ChangeLog%20TODO%20docs/unoconv.1%0A%20docs/unoconv.1.txt%20unoconv&In-Reply-To=%3C201010201121.o9KBLC2d000386%40surya.karan.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007970.html">
   <LINK REL="Next"  HREF="007972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[svn] r9187 - in /trunk/tools/unoconv: ChangeLog TODO docs/unoconv.1 docs/unoconv.1.txt unoconv</H1>
    <B>Dag Wieers</B> 
    <A HREF="mailto:commits%40lists.repoforge.org?Subject=Re:%20Re%3A%20%5Bsvn%5D%20r9187%20-%20in%20/trunk/tools/unoconv%3A%20ChangeLog%20TODO%20docs/unoconv.1%0A%20docs/unoconv.1.txt%20unoconv&In-Reply-To=%3C201010201121.o9KBLC2d000386%40surya.karan.org%3E"
       TITLE="[svn] r9187 - in /trunk/tools/unoconv: ChangeLog TODO docs/unoconv.1 docs/unoconv.1.txt unoconv">dag at wieers.com
       </A><BR>
    <I>Wed Oct 20 13:21:12 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="007970.html">[svn] r9186 - in /trunk/rpms: asciidoc/ cifs-utils/ feh/ libgc/ libtalloc/ lshw/ mock/ python-decoratortools/ python-hashlib/ samba-scannedonly/ samba3x-scannedonly/ samba3x-vscan/ syslinux/ wine/
</A></li>
        <LI>Next message: <A HREF="007972.html">[svn] r9188 - in /trunk/rpms/bzr-gtk: ./	bzr-gtk-0.99.0_pickle.patch bzr-gtk.spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7971">[ date ]</a>
              <a href="thread.html#7971">[ thread ]</a>
              <a href="subject.html#7971">[ subject ]</a>
              <a href="author.html#7971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dag
Date: Wed Oct 20 12:21:12 2010
New Revision: 9187

URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge?rev=9187&amp;view=rev">http://svn.rpmforge.net/viewvc/rpmforge?rev=9187&amp;view=rev</A>
Log:
- Support OpenOffice installations on Windows on drive-letters other than C: (Fernando Lucas Rodriguez)
- Allow to apply a style template during conversion
- Improvements to stdout and stderr messages consistency
- Updated documentation

Modified:
    trunk/tools/unoconv/ChangeLog
    trunk/tools/unoconv/TODO
    trunk/tools/unoconv/docs/unoconv.1
    trunk/tools/unoconv/docs/unoconv.1.txt
    trunk/tools/unoconv/unoconv

Modified: trunk/tools/unoconv/ChangeLog
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/ChangeLog?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/ChangeLog?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff</A>
==============================================================================
--- trunk/tools/unoconv/ChangeLog (original)
+++ trunk/tools/unoconv/ChangeLog Wed Oct 20 12:21:12 2010
@@ -1,4 +1,4 @@
-* 0.4 - released 28/09/2010
+* 0.4 - released 20/10/2010
 - Now properly check if there is a GUI attached and terminate() or -unaccept instance
 - Added official OpenOffice path '/opt/openoffice*/program'
 - Added support for OpenOffice on Windows (Fernando Lucas Rodriguez)
@@ -27,6 +27,10 @@
 - First update links, then indexes (Nicolae Mihalache)
 - More improvements to OpenOffice support on Windows (Fernando Lucas Rodriguez)
 - Improve terminating OpenOffice on Windows (Fernando Lucas Rodriguez)
+- Support OpenOffice installations on Windows on drive-letters other than C: (Fernando Lucas Rodriguez)
+- Allow to apply a style template during conversion
+- Improvements to stdout and stderr messages consistency
+- Updated documentation
 
 * 0.3 - released 31/08/2007
 - Determine doctype from input filename (if not specified)

Modified: trunk/tools/unoconv/TODO
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/TODO?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/TODO?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff</A>
==============================================================================
--- trunk/tools/unoconv/TODO (original)
+++ trunk/tools/unoconv/TODO Wed Oct 20 12:21:12 2010
@@ -19,7 +19,6 @@
 ### Features
 - Change/force the document size during conversion
 - Change/force the document encoding during conversion (UTF-8)
-- Change/force style template (eg. when input format is ODT)
 - Allow to only convert a selection of sheets in a spreadsheet
 - Add an --stdin option to read content from stdin
 - Add the option to select all (Ctrl-A) before converting (to PDF)

Modified: trunk/tools/unoconv/docs/unoconv.1
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/docs/unoconv.1?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/docs/unoconv.1?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff</A>
==============================================================================
--- trunk/tools/unoconv/docs/unoconv.1 (original)
+++ trunk/tools/unoconv/docs/unoconv.1 Wed Oct 20 12:21:12 2010
@@ -2,7 +2,7 @@
 .\&quot; It was generated using the DocBook XSL Stylesheets (version 1.69.1).
 .\&quot; Instead of manually editing it, you probably should edit the DocBook XML
 .\&quot; source for it and then use the DocBook XSL Stylesheets to regenerate it.
-.TH &quot;UNOCONV&quot; &quot;1&quot; &quot;08/08/2010&quot; &quot;\  0.3&quot; &quot;\ &quot;
+.TH &quot;UNOCONV&quot; &quot;1&quot; &quot;20 october 2010&quot; &quot;\  0.4&quot; &quot;\ &quot;
 .\&quot; disable hyphenation
 .nh
 .\&quot; disable justification (adjust text to left margin only)
@@ -39,6 +39,13 @@
 Default document type is 'document'.
 .fi
 .TP
+\-e, \-\-export
+Set specific export filter options (related to the used OpenOffice filter).
+.sp
+.nf
+eg. for the PDF output filter one can specify: \-e PageRange=1\-2
+.fi
+.TP
 \-f, \-\-format
 Specify the output format for the document. You can get a list of possible output formats per document type by using the
 \-\-show
@@ -48,14 +55,21 @@
 Default document type is 'pdf'.
 .fi
 .TP
-\-i, \-\-pipe
-Use a pipe as an alternative connection mechanism to talk to OpenOffice.
+\-i, \-\-import
+Set specific import filters options (related to the used OpenOffice filter).
+.sp
+.nf
+eg. for some input filters one can specify: \-i utf8
+.fi
 .TP
 \-l, \-\-listener
 Start unoconv as listener for unoconv clients to connect to.
 .TP
 \-o, \-\-outputpath
 Directory to put converted documents.
+.TP
+\-\-pipe
+Use a pipe as an alternative connection mechanism to talk to OpenOffice.
 .TP
 \-p, \-\-port
 Port to listen on (as listener) or to connect to (as client).
@@ -75,11 +89,14 @@
 List the possible output formats to be used with
 \-f.
 .TP
-\-S, \-\-sleep
-When unoconv starts its own listener, wait an amount of seconds before connecting to the listener. This may get rid of random errors caused by the listener not being ready to accept conversion jobs.
-.TP
 \-\-stdout
 Print converted output file to stdout.
+.TP
+\-t, \-\-template
+Specify the template to use for importing styles from. This can be very useful if you have a corporate identity you have to apply to every document you distribute.
+.TP
+\-T, \-\-timeout
+When unoconv starts its own listener, try to connect to it for an amount of seconds before giving up. Increasing this may help when you receive random errors caused by the listener not being ready to accept conversion jobs.
 .TP
 \-v, \-\-verbose
 Be more and more and more verbose.
@@ -117,7 +134,7 @@
 unoconv \-\-server 1.2.3.4 \-\-port 4567
 .fi
 .SH &quot;BUGS&quot;
-unoconv uses the UNO bindings to connect to OpenOffice, in absence of a usable socket, it will start its own OpenOffice instance with the correct parameters. However, OpenOffice requires a working DISPLAY (even with \-headless option) and therefor you cannot run it in a true console, you need X.
+unoconv uses the UNO bindings to connect to OpenOffice, in absence of a usable socket, it will start its own OpenOffice instance with the correct parameters.
 .sp
 .sp
 .it 1 an-trap
@@ -158,6 +175,8 @@
 .SH &quot;COPYING&quot;
 Copyright (C) 2007 Dag Wieers. Free use of this software is granted under the terms of the GNU General Public License (GPL).
 .sp
+.SH &quot;AUTHOR&quot;
+Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;. 
 .SH &quot;REFERENCES&quot;
 .TP 3
 1.\ <A HREF="http://www.methods.co.nz/asciidoc/">http://www.methods.co.nz/asciidoc/</A>

Modified: trunk/tools/unoconv/docs/unoconv.1.txt
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/docs/unoconv.1.txt?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/docs/unoconv.1.txt?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff</A>
==============================================================================
--- trunk/tools/unoconv/docs/unoconv.1.txt (original)
+++ trunk/tools/unoconv/docs/unoconv.1.txt Wed Oct 20 12:21:12 2010
@@ -1,6 +1,6 @@
 = unoconv(1)
 Dag Wieers &lt;<A HREF="http://lists.repoforge.org/mailman/listinfo/commits">dag at wieers.com</A>&gt;
-v0.3, 31 august 2007
+v0.4, 20 october 2010
 
 
 == NAME
@@ -40,20 +40,31 @@
 +
     Default document type is 'document'.
 
+-e, --export::
+    Set specific export filter options (related to the used OpenOffice filter).
++
+    eg. for the PDF output filter one can specify: -e PageRange=1-2
+
 -f, --format::
     Specify the output format for the document. You can get a list of
     possible output formats per document type by using the +--show+ option.
 +
     Default document type is 'pdf'.
 
--i, --pipe::
-    Use a pipe as an alternative connection mechanism to talk to OpenOffice.
+-i, --import::
+    Set specific import filters options (related to the used OpenOffice
+    filter).
++
+    eg. for some input filters one can specify: -i utf8
 
 -l, --listener::
     Start unoconv as listener for unoconv clients to connect to.
 
 -o, --outputpath::
     Directory to put converted documents.
+
+--pipe::
+    Use a pipe as an alternative connection mechanism to talk to OpenOffice.
 
 -p, --port::
     Port to listen on (as listener) or to connect to (as client).
@@ -68,13 +79,19 @@
 --show::
     List the possible output formats to be used with +-f+.
 
--S, --sleep::
-    When unoconv starts its own listener, wait an amount of seconds before
-    connecting to the listener. This may get rid of random errors caused
-    by the listener not being ready to accept conversion jobs.
-
 --stdout::
     Print converted output file to stdout.
+
+-t, --template::
+    Specify the template to use for importing styles from. This can be very
+    useful if you have a corporate identity you have to apply to every
+    document you distribute.
+
+-T, --timeout::
+    When unoconv starts its own listener, try to connect to it for an amount
+    of seconds before giving up. Increasing this may help when you receive
+    random errors caused by the listener not being ready to accept conversion
+    jobs.
 
 -v, --verbose::
     Be more and more and more verbose.
@@ -116,8 +133,6 @@
 == BUGS
 unoconv uses the UNO bindings to connect to OpenOffice, in absence of a usable
 socket, it will start its own OpenOffice instance with the correct parameters.
-However, OpenOffice requires a working +DISPLAY+ (even with +-headless+
-option) and therefor you cannot run it in a true console, you need X.
 
 [NOTE]
 Please see the TODO file for known bugs and future plans.

Modified: trunk/tools/unoconv/unoconv
URL: <A HREF="http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/unoconv?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff">http://svn.rpmforge.net/viewvc/rpmforge/trunk/tools/unoconv/unoconv?rev=9187&amp;r1=9186&amp;r2=9187&amp;view=diff</A>
==============================================================================
--- trunk/tools/unoconv/unoconv (original)
+++ trunk/tools/unoconv/unoconv Wed Oct 20 12:21:12 2010
@@ -34,12 +34,19 @@
              glob.glob('/Applications/OpenOffice.org.app/Contents/basis-link/program') + \
              glob.glob('/Applications/NeoOffice.app/Contents/program') + \
              glob.glob('/Applications/NeoOffice.app/Contents/basis-link/program') + \
-             glob.glob('C:\\Program Files\\OpenOffice.org*\\URE\\bin') + \
-             glob.glob('C:\\Program Files\\OpenOffice.org*\\program') + \
-             glob.glob('C:\\Program Files\\OpenOffice.org*\\Basis*\\program') + \
              glob.glob('/usr/bin') + \
              glob.glob('/usr/local/bin') + \
              glob.glob('/opt/bin')
+
+if 'ProgramFiles' in os.environ.keys():
+    extrapaths += glob.glob(os.environ['ProgramFiles']+'\\OpenOffice.org*\\URE\\bin') + \
+                  glob.glob(os.environ['ProgramFiles']+'\\OpenOffice.org*\\program') + \
+                  glob.glob(os.environ['ProgramFiles']+'\\OpenOffice.org*\\Basis*\\program')
+
+if 'ProgramFiles(x86)' in os.environ.keys():
+    extrapaths += glob.glob(os.environ['ProgramFiles(x86)']+'\\OpenOffice.org*\\URE\\bin') + \
+                  glob.glob(os.environ['ProgramFiles(x86)']+'\\OpenOffice.org*\\program') + \
+                  glob.glob(os.environ['ProgramFiles(x86)']+'\\OpenOffice.org*\\Basis*\\program')
 
 binaries = ( 'soffice.bin', 'soffice', 'soffice.exe' )
 
@@ -332,16 +339,17 @@
         self.server = 'localhost'
         self.showlist = False
         self.stdout = False
+        self.template = None
         self.timeout = 6
         self.verbose = 0
 
         ### Get options from the commandline
         try:
-            opts, args = getopt.getopt (args, 'c:d:e:f:hi:Llo:p:s:T:v',
+            opts, args = getopt.getopt (args, 'c:d:e:f:hi:Llo:p:s:t:T:v',
                 ['connection=', 'doctype=', 'export', 'format=', 'help',
                  'import', 'listener', 'outputpath=', 'pipe=', 'port=',
-                 'server=', 'timeout=', 'show', 'stdout', 'verbose',
-                 'version'] )
+                 'server=', 'timeout=', 'show', 'stdout', 'template',
+                 'verbose', 'version'] )
         except getopt.error, exc:
             print 'unoconv: %s, try unoconv -h for a list of all the options' % str(exc)
             sys.exit(255)
@@ -386,6 +394,8 @@
                 self.showlist = True
             elif opt in ['--stdout']:
                 self.stdout = True
+            elif opt in ['-t', '--template']:
+                self.template = arg
             elif opt in ['-T', '--timeout']:
                 self.timeout = int(arg)
             elif opt in ['-v', '--verbose']:
@@ -470,6 +480,7 @@
                              to be used by client or listener
   -s, --server=server      specify the server address (default: localhost)
                              to be used by client or listener
+  -t, --template=file      import the styles from template (.ott)
   -T, --timeout=secs       timeout after secs if connections to OpenOffice fail
       --show               list the available output formats
       --stdout             write output to stdout
@@ -485,23 +496,25 @@
         self.context = uno.getComponentContext()
         resolver = self.context.ServiceManager.createInstanceWithContext(&quot;com.sun.star.bridge.UnoUrlResolver&quot;, self.context)
 
-        ### Test for an existing connection (twice)
+        ### Test for an existing connection
         try:
             unocontext = resolver.resolve(&quot;uno:%s&quot; % op.connection)
         except NoConnectException, e:
-            error(3, &quot;Existing listener not found.\n%s&quot; % e)
-
-            ### Test if we can use an Openoffice *binary* in our (modified) path
-            error(3, &quot;Trying to launch our own listener using %s.&quot; % oobin)
+            info(3, &quot;Existing listener not found.\n%s&quot; % e)
+
+            ### Start our own OpenOffice instance
+            info(3, &quot;Launching our own listener using %s.&quot; % oobin)
             try:
                 ooproc = subprocess.Popen([oobin, &quot;-headless&quot;, &quot;-invisible&quot;, &quot;-nocrashreport&quot;, &quot;-nodefault&quot;, &quot;-nofirststartwizard&quot;, &quot;-nologo&quot;, &quot;-norestore&quot;, &quot;-accept=%s&quot; % op.connection])
-                error(2, 'OpenOffice listener successfully started. (pid=%s)' % ooproc.pid)
-
-                ### Try connection to it for op.timeout seconds
+                info(2, 'OpenOffice listener successfully started. (pid=%s)' % ooproc.pid)
+
+                ### Try connection to it for op.timeout seconds (flakky OpenOffice)
                 timeout = 0
                 while timeout &lt;= op.timeout:
-                    os.kill(ooproc.pid, 0)
-#                    ooproc.poll()
+                    ### Is it already/still running ?
+                    if ooproc.poll() != None:
+                        info(3, &quot;Process %s (pid=%s) is not running.&quot; % (oobin, ooproc.pid))
+                        break
                     try:
                         unocontext = resolver.resolve(&quot;uno:%s&quot; % op.connection)
                         break
@@ -511,10 +524,10 @@
                     except:
                         raise
                 else:
-                    error(3, &quot;Failed to connect to %s in %d seconds.\n%s&quot; % (oobin, op.timeout, e))
+                    error(&quot;Failed to connect to %s (pid=%s) in %d seconds.\n%s&quot; % (oobin, ooproc.pid, op.timeout, e))
             except Exception, e:
                 raise
-                error(1, &quot;Launch of %s failed.\n%s&quot; % (oobin, e))
+                error(&quot;Launch of %s failed.\n%s&quot; % (oobin, e))
 
         if not unocontext:
             die(251, &quot;Unable to connect or start own listener. Aborting.&quot;)
@@ -591,9 +604,23 @@
             if not doc:
                 raise UnoException(&quot;File could not be loaded by OpenOffice&quot;, None)
 
-            error(1, &quot;Selected output format: %s&quot; % outputfmt)
-            error(1, &quot;Selected ooffice filter: %s&quot; % outputfmt.filter)
-            error(1, &quot;Used doctype: %s&quot; % outputfmt.doctype)
+            ### Import style template
+            if op.template:
+                if os.path.exists(op.template):
+                    if op.verbose &gt; 0:
+                        print &gt;&gt;sys.stderr, 'Template file:', op.template
+                    templateprops = (
+                        PropertyValue( &quot;OverwriteStyles&quot;, 0, True, 0),
+                    )
+                    templateurl = unohelper.absolutize(self.cwd, unohelper.systemPathToFileUrl(op.template))
+                    doc.StyleFamilies.loadStylesFromURL(templateurl, templateprops)
+                else:
+                    print &gt;&gt;sys.stderr, 'unoconv: template file `%s\' does not exist.' % op.template
+                    exitcode = 1
+
+            info(1, &quot;Selected output format: %s&quot; % outputfmt)
+            info(1, &quot;Selected ooffice filter: %s&quot; % outputfmt.filter)
+            info(1, &quot;Used doctype: %s&quot; % outputfmt.doctype)
 
             ### Update document links
             try:
@@ -635,7 +662,7 @@
                     outputfn = os.path.join(op.outputpath, os.path.basename(outputfn) + os.extsep + outputfmt.extension)
                 outputurl = unohelper.absolutize( self.cwd, unohelper.systemPathToFileUrl(outputfn) )
                 doc.storeToURL(outputurl, tuple(outputprops) )
-                error(1, &quot;Output file: %s&quot; % outputfn)
+                info(1, &quot;Output file: %s&quot; % outputfn)
             else:
                 doc.storeToURL(&quot;private:stream&quot;, tuple(outputprops) )
 
@@ -643,50 +670,51 @@
             doc.close(True)
 
         except SystemError, e:
-            error(0, &quot;unoconv: SystemError during conversion: %s&quot; % e)
-            error(0, &quot;ERROR: The provided document cannot be converted to the desired format.&quot;)
+            error(&quot;unoconv: SystemError during conversion: %s&quot; % e)
+            error(&quot;ERROR: The provided document cannot be converted to the desired format.&quot;)
             exitcode = 1
 
         except UnoException, e:
-            error(0, &quot;unoconv: UnoException during conversion in %s: %s&quot; % (repr(e.__class__), e.Message))
-            error(0, &quot;ERROR: The provided document cannot be converted to the desired format. (code: %s)&quot; % e.ErrCode)
+            error(&quot;unoconv: UnoException during conversion in %s: %s&quot; % (repr(e.__class__), e.Message))
+            error(&quot;ERROR: The provided document cannot be converted to the desired format. (code: %s)&quot; % e.ErrCode)
             exitcode = e.ErrCode
 
         except IOException, e:
-            error(0, &quot;unoconv: IOException during conversion: %s&quot; % e.Message)
-            error(0, &quot;ERROR: The provided document cannot be exported to %s.&quot; % outputfmt)
+            error(&quot;unoconv: IOException during conversion: %s&quot; % e.Message)
+            error(&quot;ERROR: The provided document cannot be exported to %s.&quot; % outputfmt)
             exitcode = 3
 
         except CannotConvertException, e:
-            error(0, &quot;unoconv: CannotConvertException during conversion: %s&quot; % e.Message)
+            error(&quot;unoconv: CannotConvertException during conversion: %s&quot; % e.Message)
             exitcode = 4
 
 class Listener:
     def __init__(self):
-        error(1, &quot;Start listener on %s:%s&quot; % (op.server, op.port))
+        info(1, &quot;Start listener on %s:%s&quot; % (op.server, op.port))
         try:
             subprocess.call([oobin, &quot;-headless&quot;, &quot;-invisible&quot;, &quot;-nocrashreport&quot;, &quot;-nodefault&quot;, &quot;-nologo&quot;, &quot;-nofirststartwizard&quot;, &quot;-norestore&quot;, &quot;-accept=%s&quot; % op.connection])
         except Exception, e:
-            error(3, &quot;Launch of %s failed.\n%s&quot; % (oobin, e))
+            error(&quot;Launch of %s failed.\n%s&quot; % (oobin, e))
         else:
             die(253, &quot;Existing listener found, aborting.&quot;)
 
-def error(level, str):
+def error(str):
     &quot;Output error message&quot;
-    if level &lt;= op.verbose:
-        print &gt;&gt;sys.stderr, str
+    print &gt;&gt;sys.stderr, str
 
 def info(level, str):
     &quot;Output info message&quot;
     if not op.stdout and level &lt;= op.verbose:
         print &gt;&gt;sys.stdout, str
+    elif level &lt;= op.verbose:
+        print &gt;&gt;sys.stderr, str
 
 def die(ret, str=None):
     &quot;Print error and exit with errorcode&quot;
     global convertor, ooproc, oobin
 
     if str:
-        error(0, 'Error: %s' % str)
+        error('Error: %s' % str)
 
     ### Did we start an instance ?
     if ooproc and convertor:
@@ -695,17 +723,17 @@
         if convertor.desktop.getCurrentFrame():
             try:
                 subprocess.Popen([oobin, &quot;-headless&quot;, &quot;-invisible&quot;, &quot;-nocrashreport&quot;, &quot;-nodefault&quot;, &quot;-nofirststartwizard&quot;, &quot;-nologo&quot;, &quot;-norestore&quot;, &quot;-unaccept=%s&quot; % op.connection])
-                error(2, 'OpenOffice listener successfully disabled.')
+                info(2, 'OpenOffice listener successfully disabled.')
                 ooproc.wait()
             except Exception, e:
-                error(3, &quot;Terminate using %s failed.\n%s&quot; % (oobin, e))
+                error(&quot;Terminate using %s failed.\n%s&quot; % (oobin, e))
 
         ### If there is no GUI attached to the instance, terminate instance
         else:
             try:
                 convertor.desktop.terminate()
             except DisposedException:
-                error(2, 'OpenOffice instance unsuccessfully terminated.')
+                info(2, 'OpenOffice instance unsuccessfully closed, sending TERM signal.')
                 try:
                     ooproc.terminate()
                 except AttributeError:
@@ -714,15 +742,16 @@
 
         ### OpenOffice processes may get stuck and we have to kill them
         ### Is it still running ?
-        ooproc.poll()
-        if ooproc.returncode == None:
-            error(2, 'Taking down OpenOffice with pid %s.' % ooproc.pid)
-            try:
-                ooproc.kill()
-            except AttributeError:
-                os.kill(ooproc.pid, 9)
-            error(2, 'Waiting for OpenOffice with pid %s to disappear.' % ooproc.pid)
+        if ooproc.poll() == None:
+            info(1, 'OpenOffice instance still running, please investigate...')
             ooproc.wait()
+#            info(2, 'OpenOffice instance unsuccessfully terminated, sending KILL signal.')
+#            try:
+#                ooproc.kill()
+#            except AttributeError:
+#                os.kill(ooproc.pid, 9)
+#            info(2, 'Waiting for OpenOffice with pid %s to disappear.' % ooproc.pid)
+#            ooproc.wait()
 
     sys.exit(ret)
 
@@ -740,17 +769,17 @@
             convertor.convert(inputfn)
 
     except NoConnectException, e:
-        error(0, &quot;unoconv: could not find an existing connection to Open Office at %s:%s.&quot; % (op.server, op.port))
+        error(&quot;unoconv: could not find an existing connection to Open Office at %s:%s.&quot; % (op.server, op.port))
         if op.connection:
-            error(0, &quot;Please start an OpenOffice instance on server '%s' by doing:\n\n    unoconv --listener --server %s --port %s\n\nor alternatively:\n\n    ooffice -nologo -nodefault -accept=\&quot;%s\&quot;&quot; % (op.server, op.server, op.port, op.connection))
+            info(0, &quot;Please start an OpenOffice instance on server '%s' by doing:\n\n    unoconv --listener --server %s --port %s\n\nor alternatively:\n\n    ooffice -nologo -nodefault -accept=\&quot;%s\&quot;&quot; % (op.server, op.server, op.port, op.connection))
         else:
-            error(0, &quot;Please start an OpenOffice instance on server '%s' by doing:\n\n    unoconv --listener --server %s --port %s\n\nor alternatively:\n\n    ooffice -nologo -nodefault -accept=\&quot;socket,host=%s,port=%s;urp;\&quot;&quot; % (op.server, op.server, op.port, op.server, op.port))
-            error(0, &quot;Please start an ooffice instance on server '%s' by doing:\n\n    ooffice -nologo -nodefault -accept=\&quot;socket,host=localhost,port=%s;urp;\&quot;&quot; % (op.server, op.port))
+            info(0, &quot;Please start an OpenOffice instance on server '%s' by doing:\n\n    unoconv --listener --server %s --port %s\n\nor alternatively:\n\n    ooffice -nologo -nodefault -accept=\&quot;socket,host=%s,port=%s;urp;\&quot;&quot; % (op.server, op.server, op.port, op.server, op.port))
+            info(0, &quot;Please start an ooffice instance on server '%s' by doing:\n\n    ooffice -nologo -nodefault -accept=\&quot;socket,host=localhost,port=%s;urp;\&quot;&quot; % (op.server, op.port))
         exitcode = 1
 #    except UnboundLocalError:
 #        die(252, &quot;Failed to connect to remote listener.&quot;)
     except OSError:
-        error(0, &quot;Warning: failed to launch OpenOffice. Aborting.&quot;)
+        error(&quot;Warning: failed to launch OpenOffice. Aborting.&quot;)
 
 ### Main entrance
 if __name__ == '__main__':


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007970.html">[svn] r9186 - in /trunk/rpms: asciidoc/ cifs-utils/ feh/ libgc/ libtalloc/ lshw/ mock/ python-decoratortools/ python-hashlib/ samba-scannedonly/ samba3x-scannedonly/ samba3x-vscan/ syslinux/ wine/
</A></li>
	<LI>Next message: <A HREF="007972.html">[svn] r9188 - in /trunk/rpms/bzr-gtk: ./	bzr-gtk-0.99.0_pickle.patch bzr-gtk.spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7971">[ date ]</a>
              <a href="thread.html#7971">[ thread ]</a>
              <a href="subject.html#7971">[ subject ]</a>
              <a href="author.html#7971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.repoforge.org/mailman/listinfo/commits">More information about the commits
mailing list</a><br>
</body></html>
